/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/@pnp/common/dist/common.es5.js":
/*!*****************************************************!*\
  !*** ./node_modules/@pnp/common/dist/common.es5.js ***!
  \*****************************************************/
/*! exports provided: AdalClient, objectToMap, mergeMaps, setup, RuntimeConfigImpl, RuntimeConfig, mergeHeaders, mergeOptions, FetchClient, BearerTokenFetchClient, PnPClientStorageWrapper, PnPClientStorage, getCtxCallback, dateAdd, combine, getRandomString, getGUID, isFunc, objectDefinedNotNull, isArray, extend, isUrlAbsolute, stringIsNullOrEmpty, getAttrValueFromString, sanitizeGuid, jsS, hOP, getHashCode */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function(global) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdalClient", function() { return AdalClient; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "objectToMap", function() { return objectToMap; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "mergeMaps", function() { return mergeMaps; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setup", function() { return setup; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RuntimeConfigImpl", function() { return RuntimeConfigImpl; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RuntimeConfig", function() { return RuntimeConfig; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "mergeHeaders", function() { return mergeHeaders; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "mergeOptions", function() { return mergeOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FetchClient", function() { return FetchClient; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BearerTokenFetchClient", function() { return BearerTokenFetchClient; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PnPClientStorageWrapper", function() { return PnPClientStorageWrapper; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PnPClientStorage", function() { return PnPClientStorage; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getCtxCallback", function() { return getCtxCallback; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "dateAdd", function() { return dateAdd; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "combine", function() { return combine; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getRandomString", function() { return getRandomString; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getGUID", function() { return getGUID; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isFunc", function() { return isFunc; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "objectDefinedNotNull", function() { return objectDefinedNotNull; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isArray", function() { return isArray; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "extend", function() { return extend; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isUrlAbsolute", function() { return isUrlAbsolute; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "stringIsNullOrEmpty", function() { return stringIsNullOrEmpty; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getAttrValueFromString", function() { return getAttrValueFromString; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "sanitizeGuid", function() { return sanitizeGuid; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "jsS", function() { return jsS; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "hOP", function() { return hOP; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getHashCode", function() { return getHashCode; });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ "./node_modules/tslib/tslib.es6.js");
/* harmony import */ var adal_angular_dist_adal_min_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! adal-angular/dist/adal.min.js */ "./node_modules/adal-angular/dist/adal.min.js");
/* harmony import */ var adal_angular_dist_adal_min_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(adal_angular_dist_adal_min_js__WEBPACK_IMPORTED_MODULE_1__);
/**
@license
 * @pnp/common v1.2.1 - pnp - provides shared functionality across all pnp libraries
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https:github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */



var global$1 = (typeof global !== "undefined" ? global :
            typeof self !== "undefined" ? self :
            typeof window !== "undefined" ? window : {});

/**
 * Gets a callback function which will maintain context across async calls.
 * Allows for the calling pattern getCtxCallback(thisobj, method, methodarg1, methodarg2, ...)
 *
 * @param context The object that will be the 'this' value in the callback
 * @param method The method to which we will apply the context and parameters
 * @param params Optional, additional arguments to supply to the wrapped method when it is invoked
 */
function getCtxCallback(context, method) {
    var params = [];
    for (var _i = 2; _i < arguments.length; _i++) {
        params[_i - 2] = arguments[_i];
    }
    return function () {
        method.apply(context, params);
    };
}
/**
 * Adds a value to a date
 *
 * @param date The date to which we will add units, done in local time
 * @param interval The name of the interval to add, one of: ['year', 'quarter', 'month', 'week', 'day', 'hour', 'minute', 'second']
 * @param units The amount to add to date of the given interval
 *
 * http://stackoverflow.com/questions/1197928/how-to-add-30-minutes-to-a-javascript-date-object
 */
function dateAdd(date, interval, units) {
    var ret = new Date(date); // don't change original date
    switch (interval.toLowerCase()) {
        case "year":
            ret.setFullYear(ret.getFullYear() + units);
            break;
        case "quarter":
            ret.setMonth(ret.getMonth() + 3 * units);
            break;
        case "month":
            ret.setMonth(ret.getMonth() + units);
            break;
        case "week":
            ret.setDate(ret.getDate() + 7 * units);
            break;
        case "day":
            ret.setDate(ret.getDate() + units);
            break;
        case "hour":
            ret.setTime(ret.getTime() + units * 3600000);
            break;
        case "minute":
            ret.setTime(ret.getTime() + units * 60000);
            break;
        case "second":
            ret.setTime(ret.getTime() + units * 1000);
            break;
        default:
            ret = undefined;
            break;
    }
    return ret;
}
/**
 * Combines an arbitrary set of paths ensuring and normalizes the slashes
 *
 * @param paths 0 to n path parts to combine
 */
function combine() {
    var paths = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        paths[_i] = arguments[_i];
    }
    return paths
        .filter(function (path) { return !stringIsNullOrEmpty(path); })
        .map(function (path) { return path.replace(/^[\\|\/]/, "").replace(/[\\|\/]$/, ""); })
        .join("/")
        .replace(/\\/g, "/");
}
/**
 * Gets a random string of chars length
 *
 * https://stackoverflow.com/questions/1349404/generate-random-string-characters-in-javascript
 *
 * @param chars The length of the random string to generate
 */
function getRandomString(chars) {
    var text = new Array(chars);
    var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    for (var i = 0; i < chars; i++) {
        text[i] = possible.charAt(Math.floor(Math.random() * possible.length));
    }
    return text.join("");
}
/**
 * Gets a random GUID value
 *
 * http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript
 */
/* tslint:disable no-bitwise */
function getGUID() {
    var d = new Date().getTime();
    var guid = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
        var r = (d + Math.random() * 16) % 16 | 0;
        d = Math.floor(d / 16);
        return (c === "x" ? r : (r & 0x3 | 0x8)).toString(16);
    });
    return guid;
}
/* tslint:enable */
/**
 * Determines if a given value is a function
 *
 * @param cf The thing to test for functionness
 */
function isFunc(cf) {
    return typeof cf === "function";
}
/**
 * Determines if an object is both defined and not null
 * @param obj Object to test
 */
function objectDefinedNotNull(obj) {
    return typeof obj !== "undefined" && obj !== null;
}
/**
 * @returns whether the provided parameter is a JavaScript Array or not.
*/
function isArray(array) {
    if (Array.isArray) {
        return Array.isArray(array);
    }
    return array && typeof array.length === "number" && array.constructor === Array;
}
/**
 * Provides functionality to extend the given object by doing a shallow copy
 *
 * @param target The object to which properties will be copied
 * @param source The source object from which properties will be copied
 * @param noOverwrite If true existing properties on the target are not overwritten from the source
 * @param filter If provided allows additional filtering on what properties are copied (propName: string) => boolean
 *
 */
function extend(target, source, noOverwrite, filter) {
    if (noOverwrite === void 0) { noOverwrite = false; }
    if (filter === void 0) { filter = function () { return true; }; }
    if (!objectDefinedNotNull(source)) {
        return target;
    }
    // ensure we don't overwrite things we don't want overwritten
    var check = noOverwrite ? function (o, i) { return !(i in o); } : function () { return true; };
    // final filter we will use
    var f = function (v) { return check(target, v) && filter(v); };
    return Object.getOwnPropertyNames(source)
        .filter(f)
        .reduce(function (t, v) {
        t[v] = source[v];
        return t;
    }, target);
}
/**
 * Determines if a given url is absolute
 *
 * @param url The url to check to see if it is absolute
 */
function isUrlAbsolute(url) {
    return /^https?:\/\/|^\/\//i.test(url);
}
/**
 * Determines if a string is null or empty or undefined
 *
 * @param s The string to test
 */
function stringIsNullOrEmpty(s) {
    return s === undefined || s === null || s.length < 1;
}
/**
 * Gets an attribute value from an html/xml string block. NOTE: if the input attribute value has
 * RegEx special characters they will be escaped in the returned string
 *
 * @param html HTML to search
 * @param attrName The name of the attribute to find
 */
function getAttrValueFromString(html, attrName) {
    // make the input safe for regex
    html = html.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    var reg = new RegExp(attrName + "\\s*?=\\s*?(\"|')([^\\1]*?)\\1", "i");
    var match = reg.exec(html);
    return match !== null && match.length > 0 ? match[2] : null;
}
/**
 * Ensures guid values are represented consistently as "ea123463-137d-4ae3-89b8-cf3fc578ca05"
 *
 * @param guid The candidate guid
 */
function sanitizeGuid(guid) {
    if (stringIsNullOrEmpty(guid)) {
        return guid;
    }
    var matches = /([0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12})/i.exec(guid);
    return matches === null ? guid : matches[1];
}
/**
 * Shorthand for oToS
 *
 * @param o Any type of object
 */
function jsS(o) {
    return JSON.stringify(o);
}
/**
 * Shorthand for Object.hasOwnProperty
 *
 * @param o Object to check for
 * @param p Name of the property
 */
function hOP(o, p) {
    return Object.hasOwnProperty.call(o, p);
}
/**
 * Generates a ~unique hash code for this ObjectPathQueue
 *
 * From: https://stackoverflow.com/questions/6122571/simple-non-secure-hash-function-for-javascript
 */
// tslint:disable:no-bitwise
function getHashCode(s) {
    var hash = 0;
    if (s.length === 0) {
        return hash;
    }
    for (var i = 0; i < s.length; i++) {
        var chr = s.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        hash |= 0; // Convert to 32bit integer
    }
    return hash;
}
// tslint:enable:no-bitwise

function mergeHeaders(target, source) {
    if (source !== undefined && source !== null) {
        var temp = new Request("", { headers: source });
        temp.headers.forEach(function (value, name) {
            target.append(name, value);
        });
    }
}
function mergeOptions(target, source) {
    if (objectDefinedNotNull(source)) {
        var headers = extend(target.headers || {}, source.headers);
        target = extend(target, source);
        target.headers = headers;
    }
}
/**
 * Makes requests using the global/window fetch API
 */
var FetchClient = /** @class */ (function () {
    function FetchClient() {
    }
    FetchClient.prototype.fetch = function (url, options) {
        return global$1.fetch(url, options);
    };
    return FetchClient;
}());
/**
 * Makes requests using the fetch API adding the supplied token to the Authorization header
 */
var BearerTokenFetchClient = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(BearerTokenFetchClient, _super);
    function BearerTokenFetchClient(_token) {
        var _this = _super.call(this) || this;
        _this._token = _token;
        return _this;
    }
    Object.defineProperty(BearerTokenFetchClient.prototype, "token", {
        get: function () {
            return this._token;
        },
        set: function (token) {
            this._token = token;
        },
        enumerable: true,
        configurable: true
    });
    BearerTokenFetchClient.prototype.fetch = function (url, options) {
        if (options === void 0) { options = {}; }
        var headers = new Headers();
        mergeHeaders(headers, options.headers);
        headers.set("Authorization", "Bearer " + this._token);
        options.headers = headers;
        return _super.prototype.fetch.call(this, url, options);
    };
    return BearerTokenFetchClient;
}(FetchClient));

/**
 * Azure AD Client for use in the browser
 */
var AdalClient = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_0__["__extends"])(AdalClient, _super);
    /**
     * Creates a new instance of AdalClient
     * @param clientId Azure App Id
     * @param tenant Office 365 tenant (Ex: {tenant}.onmicrosoft.com)
     * @param redirectUri The redirect url used to authenticate the
     */
    function AdalClient(clientId, tenant, redirectUri) {
        var _this = _super.call(this, null) || this;
        _this.clientId = clientId;
        _this.tenant = tenant;
        _this.redirectUri = redirectUri;
        return _this;
    }
    /**
     * Creates a new AdalClient using the values of the supplied SPFx context
     *
     * @param spfxContext Current SPFx context
     * @param clientId Optional client id to use instead of the built-in SPFx id
     * @description Using this method and the default clientId requires that the features described in
     * this article https://docs.microsoft.com/en-us/sharepoint/dev/spfx/use-aadhttpclient are activated in the tenant. If not you can
     * creat your own app, grant permissions and use that clientId here along with the SPFx context
     */
    AdalClient.fromSPFxContext = function (spfxContext, cliendId) {
        if (cliendId === void 0) { cliendId = "c58637bb-e2e1-4312-8a00-04b5ffcd3403"; }
        // this "magic" client id is the one to which permissions are granted behind the scenes
        // this redirectUrl is the page as used by spfx
        return new AdalClient(cliendId, spfxContext.pageContext.aadInfo.tenantId.toString(), combine(window.location.origin, "/_forms/spfxsinglesignon.aspx"));
    };
    /**
     * Conducts the fetch opertation against the AAD secured resource
     *
     * @param url Absolute URL for the request
     * @param options Any fetch options passed to the underlying fetch implementation
     */
    AdalClient.prototype.fetch = function (url, options) {
        var _this = this;
        if (!isUrlAbsolute(url)) {
            throw new Error("You must supply absolute urls to AdalClient.fetch.");
        }
        // the url we are calling is the resource
        return this.getToken(this.getResource(url)).then(function (token) {
            _this.token = token;
            return _super.prototype.fetch.call(_this, url, options);
        });
    };
    /**
     * Gets a token based on the current user
     *
     * @param resource The resource for which we are requesting a token
     */
    AdalClient.prototype.getToken = function (resource) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.ensureAuthContext().then(function (_) { return _this.login(); }).then(function (_) {
                AdalClient._authContext.acquireToken(resource, function (message, token) {
                    if (message) {
                        return reject(new Error(message));
                    }
                    resolve(token);
                });
            }).catch(reject);
        });
    };
    /**
     * Ensures we have created and setup the adal AuthenticationContext instance
     */
    AdalClient.prototype.ensureAuthContext = function () {
        var _this = this;
        return new Promise(function (resolve) {
            if (AdalClient._authContext === null) {
                AdalClient._authContext = Object(adal_angular_dist_adal_min_js__WEBPACK_IMPORTED_MODULE_1__["inject"])({
                    clientId: _this.clientId,
                    displayCall: function (url) {
                        if (_this._displayCallback) {
                            _this._displayCallback(url);
                        }
                    },
                    navigateToLoginRequestUrl: false,
                    redirectUri: _this.redirectUri,
                    tenant: _this.tenant,
                });
            }
            resolve();
        });
    };
    /**
     * Ensures the current user is logged in
     */
    AdalClient.prototype.login = function () {
        var _this = this;
        if (this._loginPromise) {
            return this._loginPromise;
        }
        this._loginPromise = new Promise(function (resolve, reject) {
            if (AdalClient._authContext.getCachedUser()) {
                return resolve();
            }
            _this._displayCallback = function (url) {
                var popupWindow = window.open(url, "login", "width=483, height=600");
                if (!popupWindow) {
                    return reject(new Error("Could not open pop-up window for auth. Likely pop-ups are blocked by the browser."));
                }
                if (popupWindow && popupWindow.focus) {
                    popupWindow.focus();
                }
                var pollTimer = window.setInterval(function () {
                    if (!popupWindow || popupWindow.closed || popupWindow.closed === undefined) {
                        window.clearInterval(pollTimer);
                    }
                    try {
                        if (popupWindow.document.URL.indexOf(_this.redirectUri) !== -1) {
                            window.clearInterval(pollTimer);
                            AdalClient._authContext.handleWindowCallback(popupWindow.location.hash);
                            popupWindow.close();
                            resolve();
                        }
                    }
                    catch (e) {
                        reject(e);
                    }
                }, 30);
            };
            // this triggers the login process
            _this.ensureAuthContext().then(function (_) {
                AdalClient._authContext._loginInProgress = false;
                AdalClient._authContext.login();
                _this._displayCallback = null;
            });
        });
        return this._loginPromise;
    };
    /**
     * Parses out the root of the request url to use as the resource when getting the token
     *
     * After: https://gist.github.com/jlong/2428561
     * @param url The url to parse
     */
    AdalClient.prototype.getResource = function (url) {
        var parser = document.createElement("a");
        parser.href = url;
        return parser.protocol + "//" + parser.hostname;
    };
    /**
     * Our auth context
     */
    AdalClient._authContext = null;
    return AdalClient;
}(BearerTokenFetchClient));

/**
 * Used to calculate the object properties, with polyfill if needed
 */
var objectEntries = isFunc(Object.entries) ? Object.entries : function (o) { return Object.keys(o).map(function (k) { return [k, o[k]]; }); };
/**
 * Converts the supplied object to a map
 *
 * @param o The object to map
 */
function objectToMap(o) {
    if (o !== undefined && o !== null) {
        return new Map(objectEntries(o));
    }
    return new Map();
}
/**
 * Merges to Map instances together, overwriting values in target with matching keys, last in wins
 *
 * @param target map into which the other maps are merged
 * @param maps One or more maps to merge into the target
 */
function mergeMaps(target) {
    var maps = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        maps[_i - 1] = arguments[_i];
    }
    for (var i = 0; i < maps.length; i++) {
        maps[i].forEach(function (v, k) {
            target.set(k, v);
        });
    }
    return target;
}

function setup(config) {
    RuntimeConfig.extend(config);
}
// lable mapping for known config values
var s = [
    "defaultCachingStore",
    "defaultCachingTimeoutSeconds",
    "globalCacheDisable",
    "enableCacheExpiration",
    "cacheExpirationIntervalMilliseconds",
    "spfxContext",
];
var RuntimeConfigImpl = /** @class */ (function () {
    function RuntimeConfigImpl(_v) {
        if (_v === void 0) { _v = new Map(); }
        this._v = _v;
        // setup defaults
        this._v.set(s[0], "session");
        this._v.set(s[1], 60);
        this._v.set(s[2], false);
        this._v.set(s[3], false);
        this._v.set(s[4], 750);
        this._v.set(s[5], null);
    }
    /**
     *
     * @param config The set of properties to add to the globa configuration instance
     */
    RuntimeConfigImpl.prototype.extend = function (config) {
        this._v = mergeMaps(this._v, objectToMap(config));
    };
    RuntimeConfigImpl.prototype.get = function (key) {
        return this._v.get(key);
    };
    Object.defineProperty(RuntimeConfigImpl.prototype, "defaultCachingStore", {
        get: function () {
            return this.get(s[0]);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuntimeConfigImpl.prototype, "defaultCachingTimeoutSeconds", {
        get: function () {
            return this.get(s[1]);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuntimeConfigImpl.prototype, "globalCacheDisable", {
        get: function () {
            return this.get(s[2]);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuntimeConfigImpl.prototype, "enableCacheExpiration", {
        get: function () {
            return this.get(s[3]);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuntimeConfigImpl.prototype, "cacheExpirationIntervalMilliseconds", {
        get: function () {
            return this.get(s[4]);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RuntimeConfigImpl.prototype, "spfxContext", {
        get: function () {
            return this.get(s[5]);
        },
        enumerable: true,
        configurable: true
    });
    return RuntimeConfigImpl;
}());
var _runtimeConfig = new RuntimeConfigImpl();
var RuntimeConfig = _runtimeConfig;

/**
 * A wrapper class to provide a consistent interface to browser based storage
 *
 */
var PnPClientStorageWrapper = /** @class */ (function () {
    /**
     * Creates a new instance of the PnPClientStorageWrapper class
     *
     * @constructor
     */
    function PnPClientStorageWrapper(store, defaultTimeoutMinutes) {
        if (defaultTimeoutMinutes === void 0) { defaultTimeoutMinutes = -1; }
        this.store = store;
        this.defaultTimeoutMinutes = defaultTimeoutMinutes;
        this.enabled = this.test();
        // if the cache timeout is enabled call the handler
        // this will clear any expired items and set the timeout function
        if (RuntimeConfig.enableCacheExpiration) {
            this.cacheExpirationHandler();
        }
    }
    /**
     * Get a value from storage, or null if that value does not exist
     *
     * @param key The key whose value we want to retrieve
     */
    PnPClientStorageWrapper.prototype.get = function (key) {
        if (!this.enabled) {
            return null;
        }
        var o = this.store.getItem(key);
        if (!objectDefinedNotNull(o)) {
            return null;
        }
        var persistable = JSON.parse(o);
        if (new Date(persistable.expiration) <= new Date()) {
            this.delete(key);
            return null;
        }
        else {
            return persistable.value;
        }
    };
    /**
     * Adds a value to the underlying storage
     *
     * @param key The key to use when storing the provided value
     * @param o The value to store
     * @param expire Optional, if provided the expiration of the item, otherwise the default is used
     */
    PnPClientStorageWrapper.prototype.put = function (key, o, expire) {
        if (this.enabled) {
            this.store.setItem(key, this.createPersistable(o, expire));
        }
    };
    /**
     * Deletes a value from the underlying storage
     *
     * @param key The key of the pair we want to remove from storage
     */
    PnPClientStorageWrapper.prototype.delete = function (key) {
        if (this.enabled) {
            this.store.removeItem(key);
        }
    };
    /**
     * Gets an item from the underlying storage, or adds it if it does not exist using the supplied getter function
     *
     * @param key The key to use when storing the provided value
     * @param getter A function which will upon execution provide the desired value
     * @param expire Optional, if provided the expiration of the item, otherwise the default is used
     */
    PnPClientStorageWrapper.prototype.getOrPut = function (key, getter, expire) {
        var _this = this;
        if (!this.enabled) {
            return getter();
        }
        return new Promise(function (resolve) {
            var o = _this.get(key);
            if (o == null) {
                getter().then(function (d) {
                    _this.put(key, d, expire);
                    resolve(d);
                });
            }
            else {
                resolve(o);
            }
        });
    };
    /**
     * Deletes any expired items placed in the store by the pnp library, leaves other items untouched
     */
    PnPClientStorageWrapper.prototype.deleteExpired = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (!_this.enabled) {
                resolve();
            }
            try {
                for (var i = 0; i < _this.store.length; i++) {
                    var key = _this.store.key(i);
                    if (key !== null) {
                        // test the stored item to see if we stored it
                        if (/["|']?pnp["|']? ?: ?1/i.test(_this.store.getItem(key))) {
                            // get those items as get will delete from cache if they are expired
                            _this.get(key);
                        }
                    }
                }
                resolve();
            }
            catch (e) {
                reject(e);
            }
        });
    };
    /**
     * Used to determine if the wrapped storage is available currently
     */
    PnPClientStorageWrapper.prototype.test = function () {
        var str = "t";
        try {
            this.store.setItem(str, str);
            this.store.removeItem(str);
            return true;
        }
        catch (e) {
            return false;
        }
    };
    /**
     * Creates the persistable to store
     */
    PnPClientStorageWrapper.prototype.createPersistable = function (o, expire) {
        if (expire === undefined) {
            // ensure we are by default inline with the global library setting
            var defaultTimeout = RuntimeConfig.defaultCachingTimeoutSeconds;
            if (this.defaultTimeoutMinutes > 0) {
                defaultTimeout = this.defaultTimeoutMinutes * 60;
            }
            expire = dateAdd(new Date(), "second", defaultTimeout);
        }
        return jsS({ pnp: 1, expiration: expire, value: o });
    };
    /**
     * Deletes expired items added by this library in this.store and sets a timeout to call itself
     */
    PnPClientStorageWrapper.prototype.cacheExpirationHandler = function () {
        var _this = this;
        this.deleteExpired().then(function (_) {
            // call ourself in the future
            setTimeout(getCtxCallback(_this, _this.cacheExpirationHandler), RuntimeConfig.cacheExpirationIntervalMilliseconds);
        }).catch(function (e) {
            console.error(e);
        });
    };
    return PnPClientStorageWrapper;
}());
/**
 * A thin implementation of in-memory storage for use in nodejs
 */
var MemoryStorage = /** @class */ (function () {
    function MemoryStorage(_store) {
        if (_store === void 0) { _store = new Map(); }
        this._store = _store;
    }
    Object.defineProperty(MemoryStorage.prototype, "length", {
        get: function () {
            return this._store.size;
        },
        enumerable: true,
        configurable: true
    });
    MemoryStorage.prototype.clear = function () {
        this._store.clear();
    };
    MemoryStorage.prototype.getItem = function (key) {
        return this._store.get(key);
    };
    MemoryStorage.prototype.key = function (index) {
        return Array.from(this._store)[index][0];
    };
    MemoryStorage.prototype.removeItem = function (key) {
        this._store.delete(key);
    };
    MemoryStorage.prototype.setItem = function (key, data) {
        this._store.set(key, data);
    };
    return MemoryStorage;
}());
/**
 * A class that will establish wrappers for both local and session storage
 */
var PnPClientStorage = /** @class */ (function () {
    /**
     * Creates a new instance of the PnPClientStorage class
     *
     * @constructor
     */
    function PnPClientStorage(_local, _session) {
        if (_local === void 0) { _local = null; }
        if (_session === void 0) { _session = null; }
        this._local = _local;
        this._session = _session;
    }
    Object.defineProperty(PnPClientStorage.prototype, "local", {
        /**
         * Provides access to the local storage of the browser
         */
        get: function () {
            if (this._local === null) {
                this._local = this.getStore("local");
            }
            return this._local;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PnPClientStorage.prototype, "session", {
        /**
         * Provides access to the session storage of the browser
         */
        get: function () {
            if (this._session === null) {
                this._session = this.getStore("session");
            }
            return this._session;
        },
        enumerable: true,
        configurable: true
    });
    PnPClientStorage.prototype.getStore = function (name) {
        if (name === "local") {
            return new PnPClientStorageWrapper(typeof (localStorage) === "undefined" ? new MemoryStorage() : localStorage);
        }
        return new PnPClientStorageWrapper(typeof (sessionStorage) === "undefined" ? new MemoryStorage() : sessionStorage);
    };
    return PnPClientStorage;
}());


//# sourceMappingURL=common.es5.js.map

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! (webpack)/buildin/global.js */ "C:\\Users\\Administrator\\AppData\\Roaming\\npm\\node_modules\\webpack\\buildin\\global.js")))

/***/ }),

/***/ "./node_modules/@pnp/logging/dist/logging.es5.js":
/*!*******************************************************!*\
  !*** ./node_modules/@pnp/logging/dist/logging.es5.js ***!
  \*******************************************************/
/*! exports provided: Logger, LogLevel, ConsoleListener, FunctionListener */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Logger", function() { return Logger; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "LogLevel", function() { return LogLevel; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ConsoleListener", function() { return ConsoleListener; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FunctionListener", function() { return FunctionListener; });
/**
@license
 * @pnp/logging v1.2.1 - pnp - light-weight, subscribable logging framework
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https:github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */
/**
 * Class used to subscribe ILogListener and log messages throughout an application
 *
 */
var Logger = /** @class */ (function () {
    function Logger() {
    }
    Object.defineProperty(Logger, "activeLogLevel", {
        /**
         * Gets or sets the active log level to apply for log filtering
         */
        get: function () {
            return Logger.instance.activeLogLevel;
        },
        set: function (value) {
            Logger.instance.activeLogLevel = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Logger, "instance", {
        get: function () {
            if (Logger._instance === undefined || Logger._instance === null) {
                Logger._instance = new LoggerImpl();
            }
            return Logger._instance;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Adds ILogListener instances to the set of subscribed listeners
     *
     * @param listeners One or more listeners to subscribe to this log
     */
    Logger.subscribe = function () {
        var listeners = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            listeners[_i] = arguments[_i];
        }
        listeners.map(function (listener) { return Logger.instance.subscribe(listener); });
    };
    /**
     * Clears the subscribers collection, returning the collection before modifiction
     */
    Logger.clearSubscribers = function () {
        return Logger.instance.clearSubscribers();
    };
    Object.defineProperty(Logger, "count", {
        /**
         * Gets the current subscriber count
         */
        get: function () {
            return Logger.instance.count;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Writes the supplied string to the subscribed listeners
     *
     * @param message The message to write
     * @param level [Optional] if supplied will be used as the level of the entry (Default: LogLevel.Info)
     */
    Logger.write = function (message, level) {
        if (level === void 0) { level = 1 /* Info */; }
        Logger.instance.log({ level: level, message: message });
    };
    /**
     * Writes the supplied string to the subscribed listeners
     *
     * @param json The json object to stringify and write
     * @param level [Optional] if supplied will be used as the level of the entry (Default: LogLevel.Info)
     */
    Logger.writeJSON = function (json, level) {
        if (level === void 0) { level = 1 /* Info */; }
        this.write(JSON.stringify(json), level);
    };
    /**
     * Logs the supplied entry to the subscribed listeners
     *
     * @param entry The message to log
     */
    Logger.log = function (entry) {
        Logger.instance.log(entry);
    };
    /**
     * Logs an error object to the subscribed listeners
     *
     * @param err The error object
     */
    Logger.error = function (err) {
        Logger.instance.log({ data: err, level: 3 /* Error */, message: err.message });
    };
    return Logger;
}());
var LoggerImpl = /** @class */ (function () {
    function LoggerImpl(activeLogLevel, subscribers) {
        if (activeLogLevel === void 0) { activeLogLevel = 2 /* Warning */; }
        if (subscribers === void 0) { subscribers = []; }
        this.activeLogLevel = activeLogLevel;
        this.subscribers = subscribers;
    }
    LoggerImpl.prototype.subscribe = function (listener) {
        this.subscribers.push(listener);
    };
    LoggerImpl.prototype.clearSubscribers = function () {
        var s = this.subscribers.slice(0);
        this.subscribers.length = 0;
        return s;
    };
    Object.defineProperty(LoggerImpl.prototype, "count", {
        get: function () {
            return this.subscribers.length;
        },
        enumerable: true,
        configurable: true
    });
    LoggerImpl.prototype.write = function (message, level) {
        if (level === void 0) { level = 1 /* Info */; }
        this.log({ level: level, message: message });
    };
    LoggerImpl.prototype.log = function (entry) {
        if (entry !== undefined && this.activeLogLevel <= entry.level) {
            this.subscribers.map(function (subscriber) { return subscriber.log(entry); });
        }
    };
    return LoggerImpl;
}());

/**
 * A set of logging levels
 */
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["Verbose"] = 0] = "Verbose";
    LogLevel[LogLevel["Info"] = 1] = "Info";
    LogLevel[LogLevel["Warning"] = 2] = "Warning";
    LogLevel[LogLevel["Error"] = 3] = "Error";
    LogLevel[LogLevel["Off"] = 99] = "Off";
})(LogLevel || (LogLevel = {}));

/**
 * Implementation of LogListener which logs to the console
 *
 */
var ConsoleListener = /** @class */ (function () {
    function ConsoleListener() {
    }
    /**
     * Any associated data that a given logging listener may choose to log or ignore
     *
     * @param entry The information to be logged
     */
    ConsoleListener.prototype.log = function (entry) {
        var msg = this.format(entry);
        switch (entry.level) {
            case 0 /* Verbose */:
            case 1 /* Info */:
                console.log(msg);
                break;
            case 2 /* Warning */:
                console.warn(msg);
                break;
            case 3 /* Error */:
                console.error(msg);
                break;
        }
    };
    /**
     * Formats the message
     *
     * @param entry The information to format into a string
     */
    ConsoleListener.prototype.format = function (entry) {
        var msg = [];
        msg.push("Message: " + entry.message);
        if (entry.data !== undefined) {
            msg.push(" Data: " + JSON.stringify(entry.data));
        }
        return msg.join("");
    };
    return ConsoleListener;
}());
/**
 * Implementation of LogListener which logs to the supplied function
 *
 */
var FunctionListener = /** @class */ (function () {
    /**
     * Creates a new instance of the FunctionListener class
     *
     * @constructor
     * @param  method The method to which any logging data will be passed
     */
    function FunctionListener(method) {
        this.method = method;
    }
    /**
     * Any associated data that a given logging listener may choose to log or ignore
     *
     * @param entry The information to be logged
     */
    FunctionListener.prototype.log = function (entry) {
        this.method(entry);
    };
    return FunctionListener;
}());


//# sourceMappingURL=logging.es5.js.map


/***/ }),

/***/ "./node_modules/@pnp/odata/dist/odata.es5.js":
/*!***************************************************!*\
  !*** ./node_modules/@pnp/odata/dist/odata.es5.js ***!
  \***************************************************/
/*! exports provided: CachingOptions, CachingParserWrapper, ODataParserBase, ODataDefaultParser, TextParser, BlobParser, JSONParser, BufferParser, LambdaParser, setResult, pipe, requestPipelineMethod, PipelineMethods, getDefaultPipeline, Queryable, ODataQueryable, ODataBatch */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CachingOptions", function() { return CachingOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CachingParserWrapper", function() { return CachingParserWrapper; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ODataParserBase", function() { return ODataParserBase; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ODataDefaultParser", function() { return ODataDefaultParser; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TextParser", function() { return TextParser; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BlobParser", function() { return BlobParser; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "JSONParser", function() { return JSONParser; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BufferParser", function() { return BufferParser; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "LambdaParser", function() { return LambdaParser; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setResult", function() { return setResult; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "pipe", function() { return pipe; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "requestPipelineMethod", function() { return requestPipelineMethod; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PipelineMethods", function() { return PipelineMethods; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDefaultPipeline", function() { return getDefaultPipeline; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Queryable", function() { return Queryable; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ODataQueryable", function() { return ODataQueryable; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ODataBatch", function() { return ODataBatch; });
/* harmony import */ var _pnp_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @pnp/common */ "./node_modules/@pnp/common/dist/common.es5.js");
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ "./node_modules/tslib/tslib.es6.js");
/* harmony import */ var _pnp_logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @pnp/logging */ "./node_modules/@pnp/logging/dist/logging.es5.js");
/**
@license
 * @pnp/odata v1.2.1 - pnp - provides shared odata functionality and base classes
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https:github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */




var CachingOptions = /** @class */ (function () {
    function CachingOptions(key) {
        this.key = key;
        this.expiration = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["dateAdd"])(new Date(), "second", _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].defaultCachingTimeoutSeconds);
        this.storeName = _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].defaultCachingStore;
    }
    Object.defineProperty(CachingOptions.prototype, "store", {
        get: function () {
            if (this.storeName === "local") {
                return CachingOptions.storage.local;
            }
            else {
                return CachingOptions.storage.session;
            }
        },
        enumerable: true,
        configurable: true
    });
    CachingOptions.storage = new _pnp_common__WEBPACK_IMPORTED_MODULE_0__["PnPClientStorage"]();
    return CachingOptions;
}());
var CachingParserWrapper = /** @class */ (function () {
    function CachingParserWrapper(parser, cacheOptions) {
        this.parser = parser;
        this.cacheOptions = cacheOptions;
    }
    CachingParserWrapper.prototype.parse = function (response) {
        var _this = this;
        return this.parser.parse(response).then(function (r) { return _this.cacheData(r); });
    };
    CachingParserWrapper.prototype.cacheData = function (data) {
        if (this.cacheOptions.store !== null) {
            this.cacheOptions.store.put(this.cacheOptions.key, data, this.cacheOptions.expiration);
        }
        return data;
    };
    return CachingParserWrapper;
}());

var ODataParserBase = /** @class */ (function () {
    function ODataParserBase() {
    }
    ODataParserBase.prototype.parse = function (r) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (_this.handleError(r, reject)) {
                _this.parseImpl(r, resolve, reject);
            }
        });
    };
    ODataParserBase.prototype.parseImpl = function (r, resolve, reject) {
        var _this = this;
        if ((r.headers.has("Content-Length") && parseFloat(r.headers.get("Content-Length")) === 0) || r.status === 204) {
            resolve({});
        }
        else {
            // patch to handle cases of 200 response with no or whitespace only bodies (#487 & #545)
            r.text()
                .then(function (txt) { return txt.replace(/\s/ig, "").length > 0 ? JSON.parse(txt) : {}; })
                .then(function (json) { return resolve(_this.parseODataJSON(json)); })
                .catch(function (e) { return reject(e); });
        }
    };
    /**
     * Handles a response with ok === false by parsing the body and creating a ProcessHttpClientResponseException
     * which is passed to the reject delegate. This method returns true if there is no error, otherwise false
     *
     * @param r Current response object
     * @param reject reject delegate for the surrounding promise
     */
    ODataParserBase.prototype.handleError = function (r, reject) {
        if (!r.ok) {
            // read the response as text, it may not be valid json
            r.json().then(function (json) {
                // include the headers as they contain diagnostic information
                var data = {
                    responseBody: json,
                    responseHeaders: r.headers,
                };
                reject(new Error("Error making HttpClient request in queryable: [" + r.status + "] " + r.statusText + " ::> " + JSON.stringify(data)));
            }).catch(function (e) {
                reject(new Error("Error making HttpClient request in queryable: [" + r.status + "] " + r.statusText + " ::> " + e));
            });
        }
        return r.ok;
    };
    /**
     * Normalizes the json response by removing the various nested levels
     *
     * @param json json object to parse
     */
    ODataParserBase.prototype.parseODataJSON = function (json) {
        var result = json;
        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(json, "d")) {
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(json.d, "results")) {
                result = json.d.results;
            }
            else {
                result = json.d;
            }
        }
        else if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(json, "value")) {
            result = json.value;
        }
        return result;
    };
    return ODataParserBase;
}());
var ODataDefaultParser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ODataDefaultParser, _super);
    function ODataDefaultParser() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ODataDefaultParser;
}(ODataParserBase));
var TextParser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(TextParser, _super);
    function TextParser() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TextParser.prototype.parseImpl = function (r, resolve) {
        r.text().then(resolve);
    };
    return TextParser;
}(ODataParserBase));
var BlobParser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(BlobParser, _super);
    function BlobParser() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    BlobParser.prototype.parseImpl = function (r, resolve) {
        r.blob().then(resolve);
    };
    return BlobParser;
}(ODataParserBase));
var JSONParser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(JSONParser, _super);
    function JSONParser() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    JSONParser.prototype.parseImpl = function (r, resolve) {
        r.json().then(resolve);
    };
    return JSONParser;
}(ODataParserBase));
var BufferParser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(BufferParser, _super);
    function BufferParser() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    BufferParser.prototype.parseImpl = function (r, resolve) {
        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["isFunc"])(r.arrayBuffer)) {
            r.arrayBuffer().then(resolve);
        }
        else {
            r.buffer().then(resolve);
        }
    };
    return BufferParser;
}(ODataParserBase));
var LambdaParser = /** @class */ (function () {
    function LambdaParser(parser) {
        this.parser = parser;
    }
    LambdaParser.prototype.parse = function (r) {
        return this.parser(r);
    };
    return LambdaParser;
}());

/**
 * Resolves the context's result value
 *
 * @param context The current context
 */
function returnResult(context) {
    _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].log({
        data: _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].activeLogLevel === 0 /* Verbose */ ? context.result : {},
        level: 1 /* Info */,
        message: "[" + context.requestId + "] (" + (new Date()).getTime() + ") Returning result from pipeline. Set logging to verbose to see data.",
    });
    return Promise.resolve(context.result || null);
}
/**
 * Sets the result on the context
 */
function setResult(context, value) {
    return new Promise(function (resolve) {
        context.result = value;
        context.hasResult = true;
        resolve(context);
    });
}
/**
 * Invokes the next method in the provided context's pipeline
 *
 * @param c The current request context
 */
function next(c) {
    if (c.pipeline.length > 0) {
        return c.pipeline.shift()(c);
    }
    else {
        return Promise.resolve(c);
    }
}
/**
 * Executes the current request context's pipeline
 *
 * @param context Current context
 */
function pipe(context) {
    if (context.pipeline.length < 1) {
        _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + context.requestId + "] (" + (new Date()).getTime() + ") Request pipeline contains no methods!", 2 /* Warning */);
    }
    var promise = next(context).then(function (ctx) { return returnResult(ctx); }).catch(function (e) {
        _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].error(e);
        throw e;
    });
    if (context.isBatched) {
        // this will block the batch's execute method from returning until the child requets have been resolved
        context.batch.addResolveBatchDependency(promise);
    }
    return promise;
}
/**
 * decorator factory applied to methods in the pipeline to control behavior
 */
function requestPipelineMethod(alwaysRun) {
    if (alwaysRun === void 0) { alwaysRun = false; }
    return function (target, propertyKey, descriptor) {
        var method = descriptor.value;
        descriptor.value = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            // if we have a result already in the pipeline, pass it along and don't call the tagged method
            if (!alwaysRun && args.length > 0 && Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(args[0], "hasResult") && args[0].hasResult) {
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + args[0].requestId + "] (" + (new Date()).getTime() + ") Skipping request pipeline method " + propertyKey + ", existing result in pipeline.", 0 /* Verbose */);
                return Promise.resolve(args[0]);
            }
            // apply the tagged method
            _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + args[0].requestId + "] (" + (new Date()).getTime() + ") Calling request pipeline method " + propertyKey + ".", 0 /* Verbose */);
            // then chain the next method in the context's pipeline - allows for dynamic pipeline
            return method.apply(target, args).then(function (ctx) { return next(ctx); });
        };
    };
}
/**
 * Contains the methods used within the request pipeline
 */
var PipelineMethods = /** @class */ (function () {
    function PipelineMethods() {
    }
    /**
     * Logs the start of the request
     */
    PipelineMethods.logStart = function (context) {
        return new Promise(function (resolve) {
            _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].log({
                data: _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].activeLogLevel === 1 /* Info */ ? {} : context,
                level: 1 /* Info */,
                message: "[" + context.requestId + "] (" + (new Date()).getTime() + ") Beginning " + context.verb + " request (" + context.requestAbsoluteUrl + ")",
            });
            resolve(context);
        });
    };
    /**
     * Handles caching of the request
     */
    PipelineMethods.caching = function (context) {
        return new Promise(function (resolve) {
            // handle caching, if applicable
            if (context.isCached) {
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + context.requestId + "] (" + (new Date()).getTime() + ") Caching is enabled for request, checking cache...", 1 /* Info */);
                var cacheOptions = new CachingOptions(context.requestAbsoluteUrl.toLowerCase());
                if (context.cachingOptions !== undefined) {
                    cacheOptions = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(cacheOptions, context.cachingOptions);
                }
                // we may not have a valid store
                if (cacheOptions.store !== null) {
                    // check if we have the data in cache and if so resolve the promise and return
                    var data = cacheOptions.store.get(cacheOptions.key);
                    if (data !== null) {
                        // ensure we clear any held batch dependency we are resolving from the cache
                        _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].log({
                            data: _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].activeLogLevel === 1 /* Info */ ? {} : data,
                            level: 1 /* Info */,
                            message: "[" + context.requestId + "] (" + (new Date()).getTime() + ") Value returned from cache.",
                        });
                        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["isFunc"])(context.batchDependency)) {
                            context.batchDependency();
                        }
                        // handle the case where a parser needs to take special actions with a cached result
                        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(context.parser, "hydrate")) {
                            data = context.parser.hydrate(data);
                        }
                        return setResult(context, data).then(function (ctx) { return resolve(ctx); });
                    }
                }
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + context.requestId + "] (" + (new Date()).getTime() + ") Value not found in cache.", 1 /* Info */);
                // if we don't then wrap the supplied parser in the caching parser wrapper
                // and send things on their way
                context.parser = new CachingParserWrapper(context.parser, cacheOptions);
            }
            return resolve(context);
        });
    };
    /**
     * Sends the request
     */
    PipelineMethods.send = function (context) {
        return new Promise(function (resolve, reject) {
            // send or batch the request
            if (context.isBatched) {
                // we are in a batch, so add to batch, remove dependency, and resolve with the batch's promise
                var p = context.batch.add(context.requestAbsoluteUrl, context.verb, context.options, context.parser, context.requestId);
                // we release the dependency here to ensure the batch does not execute until the request is added to the batch
                if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["isFunc"])(context.batchDependency)) {
                    context.batchDependency();
                }
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + context.requestId + "] (" + (new Date()).getTime() + ") Batching request in batch " + context.batch.batchId + ".", 1 /* Info */);
                // we set the result as the promise which will be resolved by the batch's execution
                resolve(setResult(context, p));
            }
            else {
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + context.requestId + "] (" + (new Date()).getTime() + ") Sending request.", 1 /* Info */);
                // we are not part of a batch, so proceed as normal
                var client = context.clientFactory();
                var opts = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(context.options || {}, { method: context.verb });
                client.fetch(context.requestAbsoluteUrl, opts)
                    .then(function (response) { return context.parser.parse(response); })
                    .then(function (result) { return setResult(context, result); })
                    .then(function (ctx) { return resolve(ctx); })
                    .catch(function (e) { return reject(e); });
            }
        });
    };
    /**
     * Logs the end of the request
     */
    PipelineMethods.logEnd = function (context) {
        return new Promise(function (resolve) {
            if (context.isBatched) {
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].log({
                    data: _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].activeLogLevel === 1 /* Info */ ? {} : context,
                    level: 1 /* Info */,
                    message: "[" + context.requestId + "] (" + (new Date()).getTime() + ") " + context.verb + " request will complete in batch " + context.batch.batchId + ".",
                });
            }
            else {
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].log({
                    data: _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].activeLogLevel === 1 /* Info */ ? {} : context,
                    level: 1 /* Info */,
                    message: "[" + context.requestId + "] (" + (new Date()).getTime() + ") Completing " + context.verb + " request.",
                });
            }
            resolve(context);
        });
    };
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        requestPipelineMethod(true)
    ], PipelineMethods, "logStart", null);
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        requestPipelineMethod()
    ], PipelineMethods, "caching", null);
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        requestPipelineMethod()
    ], PipelineMethods, "send", null);
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        requestPipelineMethod(true)
    ], PipelineMethods, "logEnd", null);
    return PipelineMethods;
}());
function getDefaultPipeline() {
    return [
        PipelineMethods.logStart,
        PipelineMethods.caching,
        PipelineMethods.send,
        PipelineMethods.logEnd,
    ].slice(0);
}

var Queryable = /** @class */ (function () {
    function Queryable() {
        this._query = new Map();
        this._options = {};
        this._url = "";
        this._parentUrl = "";
        this._useCaching = false;
        this._cachingOptions = null;
    }
    /**
    * Gets the currentl url
    *
    */
    Queryable.prototype.toUrl = function () {
        return this._url;
    };
    /**
     * Directly concatonates the supplied string to the current url, not normalizing "/" chars
     *
     * @param pathPart The string to concatonate to the url
     */
    Queryable.prototype.concat = function (pathPart) {
        this._url += pathPart;
        return this;
    };
    Object.defineProperty(Queryable.prototype, "query", {
        /**
         * Provides access to the query builder for this url
         *
         */
        get: function () {
            return this._query;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Sets custom options for current object and all derived objects accessible via chaining
     *
     * @param options custom options
     */
    Queryable.prototype.configure = function (options) {
        Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeOptions"])(this._options, options);
        return this;
    };
    /**
     * Configures this instance from the configure options of the supplied instance
     *
     * @param o Instance from which options should be taken
     */
    Queryable.prototype.configureFrom = function (o) {
        Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeOptions"])(this._options, o._options);
        return this;
    };
    /**
     * Enables caching for this request
     *
     * @param options Defines the options used when caching this request
     */
    Queryable.prototype.usingCaching = function (options) {
        if (!_pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].globalCacheDisable) {
            this._useCaching = true;
            if (options !== undefined) {
                this._cachingOptions = options;
            }
        }
        return this;
    };
    Queryable.prototype.getCore = function (parser, options) {
        if (parser === void 0) { parser = new JSONParser(); }
        if (options === void 0) { options = {}; }
        return this.toRequestContext("GET", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    Queryable.prototype.postCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new JSONParser(); }
        return this.toRequestContext("POST", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    Queryable.prototype.patchCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new JSONParser(); }
        return this.toRequestContext("PATCH", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    Queryable.prototype.deleteCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new JSONParser(); }
        return this.toRequestContext("DELETE", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    Queryable.prototype.putCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new JSONParser(); }
        return this.toRequestContext("PUT", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    /**
     * Appends the given string and normalizes "/" chars
     *
     * @param pathPart The string to append
     */
    Queryable.prototype.append = function (pathPart) {
        this._url = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(this._url, pathPart);
    };
    Object.defineProperty(Queryable.prototype, "parentUrl", {
        /**
         * Gets the parent url used when creating this instance
         *
         */
        get: function () {
            return this._parentUrl;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Extends this queryable from the provided parent
     *
     * @param parent Parent queryable from which we will derive a base url
     * @param path Additional path
     */
    Queryable.prototype.extend = function (parent, path) {
        this._parentUrl = parent._url;
        this._url = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(this._parentUrl, path);
        this.configureFrom(parent);
    };
    return Queryable;
}());
var ODataQueryable = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ODataQueryable, _super);
    function ODataQueryable() {
        var _this = _super.call(this) || this;
        _this._batch = null;
        return _this;
    }
    /**
     * Adds this query to the supplied batch
     *
     * @example
     * ```
     *
     * let b = pnp.sp.createBatch();
     * pnp.sp.web.inBatch(b).get().then(...);
     * b.execute().then(...)
     * ```
     */
    ODataQueryable.prototype.inBatch = function (batch) {
        if (this.batch !== null) {
            throw new Error("This query is already part of a batch.");
        }
        this._batch = batch;
        return this;
    };
    /**
     * Gets the currentl url
     *
     */
    ODataQueryable.prototype.toUrl = function () {
        return this._url;
    };
    /**
     * Executes the currently built request
     *
     * @param parser Allows you to specify a parser to handle the result
     * @param getOptions The options used for this request
     */
    ODataQueryable.prototype.get = function (parser, options) {
        if (parser === void 0) { parser = new ODataDefaultParser(); }
        if (options === void 0) { options = {}; }
        return this.getCore(parser, options);
    };
    ODataQueryable.prototype.getCore = function (parser, options) {
        if (parser === void 0) { parser = new ODataDefaultParser(); }
        if (options === void 0) { options = {}; }
        return this.toRequestContext("GET", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    ODataQueryable.prototype.postCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new ODataDefaultParser(); }
        return this.toRequestContext("POST", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    ODataQueryable.prototype.patchCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new ODataDefaultParser(); }
        return this.toRequestContext("PATCH", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    ODataQueryable.prototype.deleteCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new ODataDefaultParser(); }
        return this.toRequestContext("DELETE", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    ODataQueryable.prototype.putCore = function (options, parser) {
        if (options === void 0) { options = {}; }
        if (parser === void 0) { parser = new ODataDefaultParser(); }
        return this.toRequestContext("PUT", options, parser, getDefaultPipeline()).then(function (context) { return pipe(context); });
    };
    /**
     * Blocks a batch call from occuring, MUST be cleared by calling the returned function
    */
    ODataQueryable.prototype.addBatchDependency = function () {
        if (this._batch !== null) {
            return this._batch.addDependency();
        }
        return function () { return null; };
    };
    Object.defineProperty(ODataQueryable.prototype, "hasBatch", {
        /**
         * Indicates if the current query has a batch associated
         *
         */
        get: function () {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["objectDefinedNotNull"])(this._batch);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ODataQueryable.prototype, "batch", {
        /**
         * The batch currently associated with this query or null
         *
         */
        get: function () {
            return this.hasBatch ? this._batch : null;
        },
        enumerable: true,
        configurable: true
    });
    return ODataQueryable;
}(Queryable));

var ODataBatch = /** @class */ (function () {
    function ODataBatch(_batchId) {
        if (_batchId === void 0) { _batchId = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getGUID"])(); }
        this._batchId = _batchId;
        this._reqs = [];
        this._deps = [];
        this._rDeps = [];
    }
    Object.defineProperty(ODataBatch.prototype, "batchId", {
        get: function () {
            return this._batchId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ODataBatch.prototype, "requests", {
        /**
         * The requests contained in this batch
         */
        get: function () {
            return this._reqs;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     * @param url Request url
     * @param method Request method (GET, POST, etc)
     * @param options Any request options
     * @param parser The parser used to handle the eventual return from the query
     * @param id An identifier used to track a request within a batch
     */
    ODataBatch.prototype.add = function (url, method, options, parser, id) {
        var info = {
            id: id,
            method: method.toUpperCase(),
            options: options,
            parser: parser,
            reject: null,
            resolve: null,
            url: url,
        };
        var p = new Promise(function (resolve, reject) {
            info.resolve = resolve;
            info.reject = reject;
        });
        this._reqs.push(info);
        return p;
    };
    /**
     * Adds a dependency insuring that some set of actions will occur before a batch is processed.
     * MUST be cleared using the returned resolve delegate to allow batches to run
     */
    ODataBatch.prototype.addDependency = function () {
        var resolver = function () { return void (0); };
        this._deps.push(new Promise(function (resolve) {
            resolver = resolve;
        }));
        return resolver;
    };
    /**
     * The batch's execute method will not resolve util any promises added here resolve
     *
     * @param p The dependent promise
     */
    ODataBatch.prototype.addResolveBatchDependency = function (p) {
        this._rDeps.push(p);
    };
    /**
     * Execute the current batch and resolve the associated promises
     *
     * @returns A promise which will be resolved once all of the batch's child promises have resolved
     */
    ODataBatch.prototype.execute = function () {
        var _this = this;
        // we need to check the dependencies twice due to how different engines handle things.
        // We can get a second set of promises added during the first set resolving
        return Promise.all(this._deps)
            .then(function () { return Promise.all(_this._deps); })
            .then(function () { return _this.executeImpl(); })
            .then(function () { return Promise.all(_this._rDeps); })
            .then(function () { return void (0); });
    };
    return ODataBatch;
}());


//# sourceMappingURL=odata.es5.js.map


/***/ }),

/***/ "./node_modules/@pnp/sp/dist/sp.es5.js":
/*!*********************************************!*\
  !*** ./node_modules/@pnp/sp/dist/sp.es5.js ***!
  \*********************************************/
/*! exports provided: odataUrlFrom, spODataEntity, spODataEntityArray, SharePointQueryable, SharePointQueryableInstance, SharePointQueryableCollection, SharePointQueryableSecurable, FileFolderShared, SharePointQueryableShareable, SharePointQueryableShareableFile, SharePointQueryableShareableFolder, SharePointQueryableShareableItem, SharePointQueryableShareableWeb, AppCatalog, App, SPBatch, ContentType, ContentTypes, FieldLink, FieldLinks, Field, Fields, CheckinType, WebPartsPersonalizationScope, MoveOperations, TemplateFileType, File, Files, Folder, Folders, SPHttpClient, Item, Items, ItemVersion, ItemVersions, PagedItemCollection, NavigationNodes, NavigationNode, NavigationService, List, Lists, RegionalSettings, InstalledLanguages, TimeZone, TimeZones, sp, SPRest, RoleDefinitionBindings, Search, SearchQueryBuilder, SearchResults, SortDirection, ReorderingRuleMatchType, QueryPropertyValueType, SearchBuiltInSourceId, SearchSuggest, Site, UserProfileQuery, toAbsoluteUrl, extractWebUrl, UtilityMethod, View, Views, ViewFields, WebPartDefinitions, WebPartDefinition, WebPart, Web, PromotedState, ClientSidePage, CanvasSection, CanvasControl, CanvasColumn, ClientSidePart, ClientSideText, ClientSideWebpart, Comments, Comment, Replies, SocialQuery, MySocialQuery, SocialActorType, SocialActorTypes, SocialFollowResult, SocialStatusCode, ControlMode, FieldTypes, DateTimeFieldFormatType, AddFieldOptions, CalendarType, UrlFieldFormatType, PermissionKind, PrincipalType, PrincipalSource, RoleType, PageType, SharingLinkKind, SharingRole, SharingOperationStatusCode, SPSharedObjectType, SharingDomainRestrictionMode, RenderListDataOptions, FieldUserSelectionMode, ChoiceFieldFormatType, UrlZone */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function(global) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "odataUrlFrom", function() { return odataUrlFrom; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "spODataEntity", function() { return spODataEntity; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "spODataEntityArray", function() { return spODataEntityArray; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryable", function() { return SharePointQueryable; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableInstance", function() { return SharePointQueryableInstance; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableCollection", function() { return SharePointQueryableCollection; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableSecurable", function() { return SharePointQueryableSecurable; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FileFolderShared", function() { return FileFolderShared; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableShareable", function() { return SharePointQueryableShareable; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableShareableFile", function() { return SharePointQueryableShareableFile; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableShareableFolder", function() { return SharePointQueryableShareableFolder; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableShareableItem", function() { return SharePointQueryableShareableItem; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharePointQueryableShareableWeb", function() { return SharePointQueryableShareableWeb; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AppCatalog", function() { return AppCatalog; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "App", function() { return App; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SPBatch", function() { return SPBatch; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContentType", function() { return ContentType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ContentTypes", function() { return ContentTypes; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FieldLink", function() { return FieldLink; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FieldLinks", function() { return FieldLinks; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Field", function() { return Field; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Fields", function() { return Fields; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CheckinType", function() { return CheckinType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WebPartsPersonalizationScope", function() { return WebPartsPersonalizationScope; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MoveOperations", function() { return MoveOperations; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TemplateFileType", function() { return TemplateFileType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "File", function() { return File; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Files", function() { return Files; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Folder", function() { return Folder; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Folders", function() { return Folders; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SPHttpClient", function() { return SPHttpClient; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Item", function() { return Item; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Items", function() { return Items; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ItemVersion", function() { return ItemVersion; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ItemVersions", function() { return ItemVersions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PagedItemCollection", function() { return PagedItemCollection; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NavigationNodes", function() { return NavigationNodes; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NavigationNode", function() { return NavigationNode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NavigationService", function() { return NavigationService; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "List", function() { return List; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Lists", function() { return Lists; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RegionalSettings", function() { return RegionalSettings; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "InstalledLanguages", function() { return InstalledLanguages; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TimeZone", function() { return TimeZone; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "TimeZones", function() { return TimeZones; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "sp", function() { return sp; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SPRest", function() { return SPRest; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RoleDefinitionBindings", function() { return RoleDefinitionBindings; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Search", function() { return Search; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SearchQueryBuilder", function() { return SearchQueryBuilder; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SearchResults", function() { return SearchResults; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SortDirection", function() { return SortDirection; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReorderingRuleMatchType", function() { return ReorderingRuleMatchType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "QueryPropertyValueType", function() { return QueryPropertyValueType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SearchBuiltInSourceId", function() { return SearchBuiltInSourceId; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SearchSuggest", function() { return SearchSuggest; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Site", function() { return Site; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "UserProfileQuery", function() { return UserProfileQuery; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "toAbsoluteUrl", function() { return toAbsoluteUrl; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "extractWebUrl", function() { return extractWebUrl; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "UtilityMethod", function() { return UtilityMethod; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "View", function() { return View; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Views", function() { return Views; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ViewFields", function() { return ViewFields; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WebPartDefinitions", function() { return WebPartDefinitions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WebPartDefinition", function() { return WebPartDefinition; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "WebPart", function() { return WebPart; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Web", function() { return Web; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PromotedState", function() { return PromotedState; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ClientSidePage", function() { return ClientSidePage; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CanvasSection", function() { return CanvasSection; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CanvasControl", function() { return CanvasControl; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CanvasColumn", function() { return CanvasColumn; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ClientSidePart", function() { return ClientSidePart; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ClientSideText", function() { return ClientSideText; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ClientSideWebpart", function() { return ClientSideWebpart; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Comments", function() { return Comments; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Comment", function() { return Comment; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Replies", function() { return Replies; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SocialQuery", function() { return SocialQuery; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MySocialQuery", function() { return MySocialQuery; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SocialActorType", function() { return SocialActorType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SocialActorTypes", function() { return SocialActorTypes; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SocialFollowResult", function() { return SocialFollowResult; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SocialStatusCode", function() { return SocialStatusCode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ControlMode", function() { return ControlMode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FieldTypes", function() { return FieldTypes; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DateTimeFieldFormatType", function() { return DateTimeFieldFormatType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AddFieldOptions", function() { return AddFieldOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CalendarType", function() { return CalendarType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "UrlFieldFormatType", function() { return UrlFieldFormatType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PermissionKind", function() { return PermissionKind; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PrincipalType", function() { return PrincipalType$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PrincipalSource", function() { return PrincipalSource; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RoleType", function() { return RoleType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PageType", function() { return PageType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharingLinkKind", function() { return SharingLinkKind; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharingRole", function() { return SharingRole; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharingOperationStatusCode", function() { return SharingOperationStatusCode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SPSharedObjectType", function() { return SPSharedObjectType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SharingDomainRestrictionMode", function() { return SharingDomainRestrictionMode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RenderListDataOptions", function() { return RenderListDataOptions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FieldUserSelectionMode", function() { return FieldUserSelectionMode; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ChoiceFieldFormatType", function() { return ChoiceFieldFormatType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "UrlZone", function() { return UrlZone; });
/* harmony import */ var _pnp_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @pnp/common */ "./node_modules/@pnp/common/dist/common.es5.js");
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ "./node_modules/tslib/tslib.es6.js");
/* harmony import */ var _pnp_logging__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @pnp/logging */ "./node_modules/@pnp/logging/dist/logging.es5.js");
/* harmony import */ var _pnp_odata__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @pnp/odata */ "./node_modules/@pnp/odata/dist/odata.es5.js");
/**
@license
 * @pnp/sp v1.2.1 - pnp - provides a fluent api for working with SharePoint REST
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2018 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https:github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */





function extractWebUrl(candidateUrl) {
    if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["stringIsNullOrEmpty"])(candidateUrl)) {
        return "";
    }
    var index = candidateUrl.indexOf("_api/");
    if (index < 0) {
        index = candidateUrl.indexOf("_vti_bin/");
    }
    if (index > -1) {
        return candidateUrl.substr(0, index);
    }
    // if all else fails just give them what they gave us back
    return candidateUrl;
}

function odataUrlFrom(candidate) {
    var parts = [];
    var s = ["odata.type", "odata.editLink", "__metadata", "odata.metadata"];
    if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(candidate, s[0]) && candidate[s[0]] === "SP.Web") {
        // webs return an absolute url in the editLink
        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(candidate, s[1])) {
            parts.push(candidate[s[1]]);
        }
        else if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(candidate, s[2])) {
            // we are dealing with verbose, which has an absolute uri
            parts.push(candidate.__metadata.uri);
        }
    }
    else {
        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(candidate, s[3]) && Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(candidate, s[1])) {
            // we are dealign with minimal metadata (default)
            parts.push(extractWebUrl(candidate[s[3]]), "_api", candidate[s[1]]);
        }
        else if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(candidate, s[1])) {
            parts.push("_api", candidate[s[1]]);
        }
        else if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(candidate, s[2])) {
            // we are dealing with verbose, which has an absolute uri
            parts.push(candidate.__metadata.uri);
        }
    }
    if (parts.length < 1) {
        _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("No uri information found in ODataEntity parsing, chaining will fail for this object.", 2 /* Warning */);
        return "";
    }
    return _pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"].apply(void 0, parts);
}
var SPODataEntityParserImpl = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SPODataEntityParserImpl, _super);
    function SPODataEntityParserImpl(factory) {
        var _this = _super.call(this) || this;
        _this.factory = factory;
        _this.hydrate = function (d) {
            var o = new _this.factory(odataUrlFrom(d), null);
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(o, d);
        };
        return _this;
    }
    SPODataEntityParserImpl.prototype.parse = function (r) {
        var _this = this;
        return _super.prototype.parse.call(this, r).then(function (d) {
            var o = new _this.factory(odataUrlFrom(d), null);
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(o, d);
        });
    };
    return SPODataEntityParserImpl;
}(_pnp_odata__WEBPACK_IMPORTED_MODULE_3__["ODataParserBase"]));
var SPODataEntityArrayParserImpl = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SPODataEntityArrayParserImpl, _super);
    function SPODataEntityArrayParserImpl(factory) {
        var _this = _super.call(this) || this;
        _this.factory = factory;
        _this.hydrate = function (d) {
            return d.map(function (v) {
                var o = new _this.factory(odataUrlFrom(v), null);
                return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(o, v);
            });
        };
        return _this;
    }
    SPODataEntityArrayParserImpl.prototype.parse = function (r) {
        var _this = this;
        return _super.prototype.parse.call(this, r).then(function (d) {
            return d.map(function (v) {
                var o = new _this.factory(odataUrlFrom(v), null);
                return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(o, v);
            });
        });
    };
    return SPODataEntityArrayParserImpl;
}(_pnp_odata__WEBPACK_IMPORTED_MODULE_3__["ODataParserBase"]));
function spODataEntity(factory) {
    return new SPODataEntityParserImpl(factory);
}
function spODataEntityArray(factory) {
    return new SPODataEntityArrayParserImpl(factory);
}

function setup(config) {
    _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].extend(config);
}
var SPRuntimeConfigImpl = /** @class */ (function () {
    function SPRuntimeConfigImpl() {
    }
    Object.defineProperty(SPRuntimeConfigImpl.prototype, "headers", {
        get: function () {
            var spPart = _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].get("sp");
            if (spPart !== undefined && spPart.headers !== undefined) {
                return spPart.headers;
            }
            return {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SPRuntimeConfigImpl.prototype, "baseUrl", {
        get: function () {
            var spPart = _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].get("sp");
            if (spPart !== undefined && spPart.baseUrl !== undefined) {
                return spPart.baseUrl;
            }
            if (_pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].spfxContext !== undefined && _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].spfxContext !== null) {
                return _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].spfxContext.pageContext.web.absoluteUrl;
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SPRuntimeConfigImpl.prototype, "fetchClientFactory", {
        get: function () {
            var spPart = _pnp_common__WEBPACK_IMPORTED_MODULE_0__["RuntimeConfig"].get("sp");
            // use a configured factory firt
            if (spPart !== undefined && spPart.fetchClientFactory !== undefined) {
                return spPart.fetchClientFactory;
            }
            else {
                return function () { return new _pnp_common__WEBPACK_IMPORTED_MODULE_0__["FetchClient"](); };
            }
        },
        enumerable: true,
        configurable: true
    });
    return SPRuntimeConfigImpl;
}());
var SPRuntimeConfig = new SPRuntimeConfigImpl();

var CachedDigest = /** @class */ (function () {
    function CachedDigest() {
    }
    return CachedDigest;
}());
// allows for the caching of digests across all HttpClient's which each have their own DigestCache wrapper.
var digests = new Map();
var DigestCache = /** @class */ (function () {
    function DigestCache(_httpClient, _digests) {
        if (_digests === void 0) { _digests = digests; }
        this._httpClient = _httpClient;
        this._digests = _digests;
    }
    DigestCache.prototype.getDigest = function (webUrl) {
        var _this = this;
        var cachedDigest = this._digests.get(webUrl);
        if (cachedDigest !== undefined) {
            var now = new Date();
            if (now < cachedDigest.expiration) {
                return Promise.resolve(cachedDigest.value);
            }
        }
        var url = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(webUrl, "/_api/contextinfo");
        var headers = {
            "Accept": "application/json;odata=verbose",
            "Content-Type": "application/json;odata=verbose;charset=utf-8",
        };
        return this._httpClient.fetchRaw(url, {
            cache: "no-cache",
            credentials: "same-origin",
            headers: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(headers, SPRuntimeConfig.headers, true),
            method: "POST",
        }).then(function (response) {
            var parser = new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["ODataDefaultParser"]();
            return parser.parse(response).then(function (d) { return d.GetContextWebInformation; });
        }).then(function (data) {
            var newCachedDigest = new CachedDigest();
            newCachedDigest.value = data.FormDigestValue;
            var seconds = data.FormDigestTimeoutSeconds;
            var expiration = new Date();
            expiration.setTime(expiration.getTime() + 1000 * seconds);
            newCachedDigest.expiration = expiration;
            _this._digests.set(webUrl, newCachedDigest);
            return newCachedDigest.value;
        });
    };
    DigestCache.prototype.clear = function () {
        this._digests.clear();
    };
    return DigestCache;
}());

var SPHttpClient = /** @class */ (function () {
    function SPHttpClient(_impl) {
        if (_impl === void 0) { _impl = SPRuntimeConfig.fetchClientFactory(); }
        this._impl = _impl;
        this._digestCache = new DigestCache(this);
    }
    SPHttpClient.prototype.fetch = function (url, options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        var opts = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(options, { cache: "no-cache", credentials: "same-origin" }, true);
        var headers = new Headers();
        // first we add the global headers so they can be overwritten by any passed in locally to this call
        Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeHeaders"])(headers, SPRuntimeConfig.headers);
        // second we add the local options so we can overwrite the globals
        Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeHeaders"])(headers, options.headers);
        // lastly we apply any default headers we need that may not exist
        if (!headers.has("Accept")) {
            headers.append("Accept", "application/json");
        }
        if (!headers.has("Content-Type")) {
            headers.append("Content-Type", "application/json;odata=verbose;charset=utf-8");
        }
        if (!headers.has("X-ClientService-ClientTag")) {
            headers.append("X-ClientService-ClientTag", "PnPCoreJS:@pnp-1.2.1");
        }
        if (!headers.has("User-Agent")) {
            // this marks the requests for understanding by the service
            headers.append("User-Agent", "NONISV|SharePointPnP|PnPCoreJS/1.2.1");
        }
        opts = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(opts, { headers: headers });
        if (opts.method && opts.method.toUpperCase() !== "GET") {
            // if we have either a request digest or an authorization header we don't need a digest
            if (!headers.has("X-RequestDigest") && !headers.has("Authorization")) {
                return this._digestCache.getDigest(extractWebUrl(url))
                    .then(function (digest) {
                    headers.append("X-RequestDigest", digest);
                    return _this.fetchRaw(url, opts);
                });
            }
        }
        return this.fetchRaw(url, opts);
    };
    SPHttpClient.prototype.fetchRaw = function (url, options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        // here we need to normalize the headers
        var rawHeaders = new Headers();
        Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeHeaders"])(rawHeaders, options.headers);
        options = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(options, { headers: rawHeaders });
        var retry = function (ctx) {
            // handles setting the proper timeout for a retry
            var setRetry = function (response) {
                var delay;
                if (response.headers.has("Retry-After")) {
                    // if we have gotten a header, use that value as the delay value
                    delay = parseInt(response.headers.get("Retry-After"), 10);
                }
                else {
                    // grab our current delay
                    delay = ctx.delay;
                    // Increment our counters.
                    ctx.delay *= 2;
                }
                ctx.attempts++;
                // If we have exceeded the retry count, reject.
                if (ctx.retryCount <= ctx.attempts) {
                    ctx.reject(new Error("Retry count exceeded (" + ctx.retryCount + ") for request. Response status: [" + response.status + "] " + response.statusText));
                }
                else {
                    // Set our retry timeout for {delay} milliseconds.
                    setTimeout(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getCtxCallback"])(_this, retry, ctx), delay);
                }
            };
            // send the actual request
            _this._impl.fetch(url, options).then(function (response) {
                if (response.status === 429) {
                    // we have been throttled
                    setRetry(response);
                }
                else {
                    ctx.resolve(response);
                }
            }).catch(function (response) {
                if (response.status === 503) {
                    // http status code 503, we can retry this
                    setRetry(response);
                }
                else {
                    ctx.reject(response);
                }
            });
        };
        return new Promise(function (resolve, reject) {
            var retryContext = {
                attempts: 0,
                delay: 100,
                reject: reject,
                resolve: resolve,
                retryCount: 7,
            };
            retry.call(_this, retryContext);
        });
    };
    SPHttpClient.prototype.get = function (url, options) {
        if (options === void 0) { options = {}; }
        var opts = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(options, { method: "GET" });
        return this.fetch(url, opts);
    };
    SPHttpClient.prototype.post = function (url, options) {
        if (options === void 0) { options = {}; }
        var opts = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(options, { method: "POST" });
        return this.fetch(url, opts);
    };
    SPHttpClient.prototype.patch = function (url, options) {
        if (options === void 0) { options = {}; }
        var opts = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(options, { method: "PATCH" });
        return this.fetch(url, opts);
    };
    SPHttpClient.prototype.delete = function (url, options) {
        if (options === void 0) { options = {}; }
        var opts = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(options, { method: "DELETE" });
        return this.fetch(url, opts);
    };
    return SPHttpClient;
}());

var global$1 = (typeof global !== "undefined" ? global :
            typeof self !== "undefined" ? self :
            typeof window !== "undefined" ? window : {});

/**
 * Ensures that a given url is absolute for the current web based on context
 *
 * @param candidateUrl The url to make absolute
 *
 */
function toAbsoluteUrl(candidateUrl) {
    return new Promise(function (resolve) {
        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["isUrlAbsolute"])(candidateUrl)) {
            // if we are already absolute, then just return the url
            return resolve(candidateUrl);
        }
        if (SPRuntimeConfig.baseUrl !== null) {
            // base url specified either with baseUrl of spfxContext config property
            return resolve(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(SPRuntimeConfig.baseUrl, candidateUrl));
        }
        if (global$1._spPageContextInfo !== undefined) {
            // operating in classic pages
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(global$1._spPageContextInfo, "webAbsoluteUrl")) {
                return resolve(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(global$1._spPageContextInfo.webAbsoluteUrl, candidateUrl));
            }
            else if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(global$1._spPageContextInfo, "webServerRelativeUrl")) {
                return resolve(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(global$1._spPageContextInfo.webServerRelativeUrl, candidateUrl));
            }
        }
        // does window.location exist and have a certain path part in it?
        if (global$1.location !== undefined) {
            var baseUrl_1 = global$1.location.toString().toLowerCase();
            ["/_layouts/", "/siteassets/"].forEach(function (s) {
                var index = baseUrl_1.indexOf(s);
                if (index > 0) {
                    return resolve(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(baseUrl_1.substr(0, index), candidateUrl));
                }
            });
        }
        return resolve(candidateUrl);
    });
}

function metadata(type) {
    return {
        "__metadata": { "type": type },
    };
}

/**
 * SharePointQueryable Base Class
 *
 */
var SharePointQueryable = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryable, _super);
    /**
     * Creates a new instance of the SharePointQueryable class
     *
     * @constructor
     * @param baseUrl A string or SharePointQueryable that should form the base part of the url
     *
     */
    function SharePointQueryable(baseUrl, path) {
        var _this = _super.call(this) || this;
        _this._forceCaching = false;
        if (typeof baseUrl === "string") {
            // we need to do some extra parsing to get the parent url correct if we are
            // being created from just a string.
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["isUrlAbsolute"])(baseUrl) || baseUrl.lastIndexOf("/") < 0) {
                _this._parentUrl = baseUrl;
                _this._url = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(baseUrl, path);
            }
            else if (baseUrl.lastIndexOf("/") > baseUrl.lastIndexOf("(")) {
                // .../items(19)/fields
                var index = baseUrl.lastIndexOf("/");
                _this._parentUrl = baseUrl.slice(0, index);
                path = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(baseUrl.slice(index), path);
                _this._url = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(_this._parentUrl, path);
            }
            else {
                // .../items(19)
                var index = baseUrl.lastIndexOf("(");
                _this._parentUrl = baseUrl.slice(0, index);
                _this._url = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(baseUrl, path);
            }
        }
        else {
            _this.extend(baseUrl, path);
            var target = baseUrl.query.get("@target");
            if (target !== undefined) {
                _this.query.set("@target", target);
            }
        }
        return _this;
    }
    /**
     * Creates a new instance of the supplied factory and extends this into that new instance
     *
     * @param factory constructor for the new SharePointQueryable
     */
    SharePointQueryable.prototype.as = function (factory) {
        var o = new factory(this._url, null);
        return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(o, this, true);
    };
    /**
     * Gets the full url with query information
     *
     */
    SharePointQueryable.prototype.toUrlAndQuery = function () {
        var aliasedParams = new Map(this.query);
        var url = this.toUrl().replace(/'!(@.*?)::(.*?)'/ig, function (match, labelName, value) {
            _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("Rewriting aliased parameter from match " + match + " to label: " + labelName + " value: " + value, 0 /* Verbose */);
            aliasedParams.set(labelName, "'" + value + "'");
            return labelName;
        });
        if (aliasedParams.size > 0) {
            var char = url.indexOf("?") > -1 ? "&" : "?";
            url += "" + char + Array.from(aliasedParams).map(function (v) { return v[0] + "=" + v[1]; }).join("&");
        }
        return url;
    };
    /**
     * Choose which fields to return
     *
     * @param selects One or more fields to return
     */
    SharePointQueryable.prototype.select = function () {
        var selects = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            selects[_i] = arguments[_i];
        }
        if (selects.length > 0) {
            this.query.set("$select", selects.join(","));
        }
        return this;
    };
    /**
     * Expands fields such as lookups to get additional data
     *
     * @param expands The Fields for which to expand the values
     */
    SharePointQueryable.prototype.expand = function () {
        var expands = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            expands[_i] = arguments[_i];
        }
        if (expands.length > 0) {
            this.query.set("$expand", expands.join(","));
        }
        return this;
    };
    /**
     * Gets a parent for this instance as specified
     *
     * @param factory The contructor for the class to create
     */
    SharePointQueryable.prototype.getParent = function (factory, baseUrl, path, batch) {
        if (baseUrl === void 0) { baseUrl = this.parentUrl; }
        var parent = new factory(baseUrl, path).configureFrom(this);
        var t = "@target";
        if (this.query.has(t)) {
            parent.query.set(t, this.query.get(t));
        }
        if (batch !== undefined) {
            parent = parent.inBatch(batch);
        }
        return parent;
    };
    /**
     * Clones this SharePointQueryable into a new SharePointQueryable instance of T
     * @param factory Constructor used to create the new instance
     * @param additionalPath Any additional path to include in the clone
     * @param includeBatch If true this instance's batch will be added to the cloned instance
     */
    SharePointQueryable.prototype.clone = function (factory, additionalPath, includeBatch) {
        if (includeBatch === void 0) { includeBatch = true; }
        var clone = new factory(this, additionalPath).configureFrom(this);
        var t = "@target";
        if (this.query.has(t)) {
            clone.query.set(t, this.query.get(t));
        }
        if (includeBatch && this.hasBatch) {
            clone = clone.inBatch(this.batch);
        }
        return clone;
    };
    /**
     * Converts the current instance to a request context
     *
     * @param verb The request verb
     * @param options The set of supplied request options
     * @param parser The supplied ODataParser instance
     * @param pipeline Optional request processing pipeline
     */
    SharePointQueryable.prototype.toRequestContext = function (verb, options, parser, pipeline) {
        var _this = this;
        if (options === void 0) { options = {}; }
        var dependencyDispose = this.hasBatch ? this.addBatchDependency() : function () { return; };
        return toAbsoluteUrl(this.toUrlAndQuery()).then(function (url) {
            Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeOptions"])(options, _this._options);
            // build our request context
            var context = {
                batch: _this.batch,
                batchDependency: dependencyDispose,
                cachingOptions: _this._cachingOptions,
                clientFactory: function () { return new SPHttpClient(); },
                isBatched: _this.hasBatch,
                isCached: _this._forceCaching || (_this._useCaching && /^get$/i.test(verb)),
                options: options,
                parser: parser,
                pipeline: pipeline,
                requestAbsoluteUrl: url,
                requestId: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getGUID"])(),
                verb: verb,
            };
            return context;
        });
    };
    return SharePointQueryable;
}(_pnp_odata__WEBPACK_IMPORTED_MODULE_3__["ODataQueryable"]));
/**
 * Represents a REST collection which can be filtered, paged, and selected
 *
 */
var SharePointQueryableCollection = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableCollection, _super);
    function SharePointQueryableCollection() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Filters the returned collection (https://msdn.microsoft.com/en-us/library/office/fp142385.aspx#bk_supported)
     *
     * @param filter The string representing the filter query
     */
    SharePointQueryableCollection.prototype.filter = function (filter) {
        this.query.set("$filter", filter);
        return this;
    };
    /**
     * Orders based on the supplied fields
     *
     * @param orderby The name of the field on which to sort
     * @param ascending If false DESC is appended, otherwise ASC (default)
     */
    SharePointQueryableCollection.prototype.orderBy = function (orderBy, ascending) {
        if (ascending === void 0) { ascending = true; }
        var o = "$orderby";
        var query = this.query.has(o) ? this.query.get(o).split(",") : [];
        query.push(orderBy + " " + (ascending ? "asc" : "desc"));
        this.query.set(o, query.join(","));
        return this;
    };
    /**
     * Skips the specified number of items
     *
     * @param skip The number of items to skip
     */
    SharePointQueryableCollection.prototype.skip = function (skip) {
        this.query.set("$skip", skip.toString());
        return this;
    };
    /**
     * Limits the query to only return the specified number of items
     *
     * @param top The query row limit
     */
    SharePointQueryableCollection.prototype.top = function (top) {
        this.query.set("$top", top.toString());
        return this;
    };
    return SharePointQueryableCollection;
}(SharePointQueryable));
/**
 * Represents an instance that can be selected
 *
 */
var SharePointQueryableInstance = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableInstance, _super);
    function SharePointQueryableInstance() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Curries the update function into the common pieces
     *
     * @param type
     * @param mapper
     */
    SharePointQueryableInstance.prototype._update = function (type, mapper) {
        var _this = this;
        return function (props) { return _this.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata(type), props)),
            headers: {
                "X-HTTP-Method": "MERGE",
            },
        }).then(function (d) { return mapper(d, props); }); };
    };
    /**
    * Deletes this instance
    *
    */
    SharePointQueryableInstance.prototype._delete = function () {
        return this.postCore({
            headers: {
                "X-HTTP-Method": "DELETE",
            },
        });
    };
    /**
     * Deletes this instance with an etag value in the headers
     *
     * @param eTag eTag to delete
     */
    SharePointQueryableInstance.prototype._deleteWithETag = function (eTag) {
        if (eTag === void 0) { eTag = "*"; }
        return this.postCore({
            headers: {
                "IF-Match": eTag,
                "X-HTTP-Method": "DELETE",
            },
        });
    };
    return SharePointQueryableInstance;
}(SharePointQueryable));
/**
 * Decorator used to specify the default path for SharePointQueryable objects
 *
 * @param path
 */
function defaultPath(path) {
    return function (target) {
        return /** @class */ (function (_super) {
            Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(class_1, _super);
            function class_1() {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                return _super.call(this, args[0], args.length > 1 && args[1] !== undefined ? args[1] : path) || this;
            }
            return class_1;
        }(target));
    };
}

/**
 * Describes a collection of all site collection users
 *
 */
var SiteUsers = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SiteUsers, _super);
    function SiteUsers() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SiteUsers_1 = SiteUsers;
    /**
     * Gets a user from the collection by id
     *
     * @param id The id of the user to retrieve
     */
    SiteUsers.prototype.getById = function (id) {
        return new SiteUser(this, "getById(" + id + ")");
    };
    /**
     * Gets a user from the collection by email
     *
     * @param email The email address of the user to retrieve
     */
    SiteUsers.prototype.getByEmail = function (email) {
        return new SiteUser(this, "getByEmail('" + email + "')");
    };
    /**
     * Gets a user from the collection by login name
     *
     * @param loginName The login name of the user to retrieve
     */
    SiteUsers.prototype.getByLoginName = function (loginName) {
        var su = new SiteUser(this);
        su.concat("(@v)");
        su.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return su;
    };
    /**
     * Removes a user from the collection by id
     *
     * @param id The id of the user to remove
     */
    SiteUsers.prototype.removeById = function (id) {
        return this.clone(SiteUsers_1, "removeById(" + id + ")").postCore();
    };
    /**
     * Removes a user from the collection by login name
     *
     * @param loginName The login name of the user to remove
     */
    SiteUsers.prototype.removeByLoginName = function (loginName) {
        var o = this.clone(SiteUsers_1, "removeByLoginName(@v)");
        o.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return o.postCore();
    };
    /**
     * Adds a user to a group
     *
     * @param loginName The login name of the user to add to the group
     *
     */
    SiteUsers.prototype.add = function (loginName) {
        var _this = this;
        return this.clone(SiteUsers_1, null).postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.User"), { LoginName: loginName })),
        }).then(function () { return _this.getByLoginName(loginName); });
    };
    var SiteUsers_1;
    SiteUsers = SiteUsers_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("siteusers")
    ], SiteUsers);
    return SiteUsers;
}(SharePointQueryableCollection));
/**
 * Describes a single user
 *
 */
var SiteUser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SiteUser, _super);
    function SiteUser() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
        * Updates this user instance with the supplied properties
        *
        * @param properties A plain object of property names and values to update for the user
        */
        _this.update = _this._update("SP.User", function (data) { return ({ data: data, user: _this }); });
        /**
         * Delete this user
         *
         */
        _this.delete = _this._delete;
        return _this;
    }
    Object.defineProperty(SiteUser.prototype, "groups", {
        /**
         * Gets the groups for this user
         *
         */
        get: function () {
            return new SiteGroups(this, "groups");
        },
        enumerable: true,
        configurable: true
    });
    return SiteUser;
}(SharePointQueryableInstance));
/**
 * Represents the current user
 */
var CurrentUser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(CurrentUser, _super);
    function CurrentUser() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CurrentUser = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("currentuser")
    ], CurrentUser);
    return CurrentUser;
}(SharePointQueryableInstance));

/**
 * Principal Type enum
 *
 */
var PrincipalType;
(function (PrincipalType) {
    PrincipalType[PrincipalType["None"] = 0] = "None";
    PrincipalType[PrincipalType["User"] = 1] = "User";
    PrincipalType[PrincipalType["DistributionList"] = 2] = "DistributionList";
    PrincipalType[PrincipalType["SecurityGroup"] = 4] = "SecurityGroup";
    PrincipalType[PrincipalType["SharePointGroup"] = 8] = "SharePointGroup";
    PrincipalType[PrincipalType["All"] = 15] = "All";
})(PrincipalType || (PrincipalType = {}));
/**
 * Describes a collection of site groups
 *
 */
var SiteGroups = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SiteGroups, _super);
    function SiteGroups() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SiteGroups_1 = SiteGroups;
    /**
     * Gets a group from the collection by id
     *
     * @param id The id of the group to retrieve
     */
    SiteGroups.prototype.getById = function (id) {
        var sg = new SiteGroup(this);
        sg.concat("(" + id + ")");
        return sg;
    };
    /**
     * Adds a new group to the site collection
     *
     * @param props The group properties object of property names and values to be set for the group
     */
    SiteGroups.prototype.add = function (properties) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.Group"), properties));
        return this.postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                group: _this.getById(data.Id),
            };
        });
    };
    /**
     * Gets a group from the collection by name
     *
     * @param groupName The name of the group to retrieve
     */
    SiteGroups.prototype.getByName = function (groupName) {
        return new SiteGroup(this, "getByName('" + groupName + "')");
    };
    /**
     * Removes the group with the specified member id from the collection
     *
     * @param id The id of the group to remove
     */
    SiteGroups.prototype.removeById = function (id) {
        return this.clone(SiteGroups_1, "removeById('" + id + "')").postCore();
    };
    /**
     * Removes the cross-site group with the specified name from the collection
     *
     * @param loginName The name of the group to remove
     */
    SiteGroups.prototype.removeByLoginName = function (loginName) {
        return this.clone(SiteGroups_1, "removeByLoginName('" + loginName + "')").postCore();
    };
    var SiteGroups_1;
    SiteGroups = SiteGroups_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("sitegroups")
    ], SiteGroups);
    return SiteGroups;
}(SharePointQueryableCollection));
/**
 * Describes a single group
 *
 */
var SiteGroup = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SiteGroup, _super);
    function SiteGroup() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.update = _this._update("SP.Group", function (d, p) {
            var retGroup = _this;
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(p, "Title")) {
                /* tslint:disable-next-line no-string-literal */
                retGroup = _this.getParent(SiteGroup, _this.parentUrl, "getByName('" + p["Title"] + "')");
            }
            return {
                data: d,
                group: retGroup,
            };
        });
        return _this;
    }
    Object.defineProperty(SiteGroup.prototype, "users", {
        /**
         * Gets the users for this group
         *
         */
        get: function () {
            return new SiteUsers(this, "users");
        },
        enumerable: true,
        configurable: true
    });
    return SiteGroup;
}(SharePointQueryableInstance));

/**
 * Describes a set of role assignments for the current scope
 *
 */
var RoleAssignments = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(RoleAssignments, _super);
    function RoleAssignments() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RoleAssignments_1 = RoleAssignments;
    /**
     * Gets the role assignment associated with the specified principal id from the collection.
     *
     * @param id The id of the role assignment
     */
    RoleAssignments.prototype.getById = function (id) {
        var ra = new RoleAssignment(this);
        ra.concat("(" + id + ")");
        return ra;
    };
    /**
     * Adds a new role assignment with the specified principal and role definitions to the collection
     *
     * @param principalId The id of the user or group to assign permissions to
     * @param roleDefId The id of the role definition that defines the permissions to assign
     *
     */
    RoleAssignments.prototype.add = function (principalId, roleDefId) {
        return this.clone(RoleAssignments_1, "addroleassignment(principalid=" + principalId + ", roledefid=" + roleDefId + ")").postCore();
    };
    /**
     * Removes the role assignment with the specified principal and role definition from the collection
     *
     * @param principalId The id of the user or group in the role assignment
     * @param roleDefId The id of the role definition in the role assignment
     *
     */
    RoleAssignments.prototype.remove = function (principalId, roleDefId) {
        return this.clone(RoleAssignments_1, "removeroleassignment(principalid=" + principalId + ", roledefid=" + roleDefId + ")").postCore();
    };
    var RoleAssignments_1;
    RoleAssignments = RoleAssignments_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("roleassignments")
    ], RoleAssignments);
    return RoleAssignments;
}(SharePointQueryableCollection));
/**
 * Describes a role assignment
 *
 */
var RoleAssignment = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(RoleAssignment, _super);
    function RoleAssignment() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
         * Deletes this role assignment
         *
         */
        _this.delete = _this._delete;
        return _this;
    }
    Object.defineProperty(RoleAssignment.prototype, "groups", {
        /**
         * Gets the groups that directly belong to the access control list (ACL) for this securable object
         *
         */
        get: function () {
            return new SiteGroups(this, "groups");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RoleAssignment.prototype, "bindings", {
        /**
         * Gets the role definition bindings for this role assignment
         *
         */
        get: function () {
            return new RoleDefinitionBindings(this);
        },
        enumerable: true,
        configurable: true
    });
    return RoleAssignment;
}(SharePointQueryableInstance));
/**
 * Describes a collection of role definitions
 *
 */
var RoleDefinitions = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(RoleDefinitions, _super);
    function RoleDefinitions() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets the role definition with the specified id from the collection
     *
     * @param id The id of the role definition
     *
     */
    RoleDefinitions.prototype.getById = function (id) {
        return new RoleDefinition(this, "getById(" + id + ")");
    };
    /**
     * Gets the role definition with the specified name
     *
     * @param name The name of the role definition
     *
     */
    RoleDefinitions.prototype.getByName = function (name) {
        return new RoleDefinition(this, "getbyname('" + name + "')");
    };
    /**
     * Gets the role definition with the specified role type
     *
     * @param roleTypeKind The roletypekind of the role definition (None=0, Guest=1, Reader=2, Contributor=3, WebDesigner=4, Administrator=5, Editor=6, System=7)
     *
     */
    RoleDefinitions.prototype.getByType = function (roleTypeKind) {
        return new RoleDefinition(this, "getbytype(" + roleTypeKind + ")");
    };
    /**
     * Creates a role definition
     *
     * @param name The new role definition's name
     * @param description The new role definition's description
     * @param order The order in which the role definition appears
     * @param basePermissions The permissions mask for this role definition
     *
     */
    RoleDefinitions.prototype.add = function (name, description, order, basePermissions) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            BasePermissions: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ __metadata: { type: "SP.BasePermissions" } }, basePermissions),
            Description: description,
            Name: name,
            Order: order,
            __metadata: { "type": "SP.RoleDefinition" },
        });
        return this.postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                definition: _this.getById(data.Id),
            };
        });
    };
    RoleDefinitions = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("roledefinitions")
    ], RoleDefinitions);
    return RoleDefinitions;
}(SharePointQueryableCollection));
/**
 * Describes a role definition
 *
 */
var RoleDefinition = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(RoleDefinition, _super);
    function RoleDefinition() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
         * Deletes this role definition
         *
         */
        _this.delete = _this._delete;
        return _this;
        /* tslint:enable */
    }
    /**
     * Updates this role definition with the supplied properties
     *
     * @param properties A plain object hash of values to update for the role definition
     */
    /* tslint:disable no-string-literal */
    RoleDefinition.prototype.update = function (properties) {
        var _this = this;
        var s = ["BasePermissions"];
        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(properties, s[0]) !== undefined) {
            properties[s[0]] = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ __metadata: { type: "SP." + s[0] } }, properties[s[0]]);
        }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.RoleDefinition"), properties));
        return this.postCore({
            body: postBody,
            headers: {
                "X-HTTP-Method": "MERGE",
            },
        }).then(function (data) {
            var retDef = _this;
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(properties, "Name")) {
                var parent_1 = _this.getParent(RoleDefinitions, _this.parentUrl, "");
                retDef = parent_1.getByName(properties["Name"]);
            }
            return {
                data: data,
                definition: retDef,
            };
        });
    };
    return RoleDefinition;
}(SharePointQueryableInstance));
/**
 * Describes the role definitons bound to a role assignment object
 *
 */
var RoleDefinitionBindings = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(RoleDefinitionBindings, _super);
    function RoleDefinitionBindings() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RoleDefinitionBindings = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("roledefinitionbindings")
    ], RoleDefinitionBindings);
    return RoleDefinitionBindings;
}(SharePointQueryableCollection));

/**
 * Determines the display mode of the given control or view
 */
var ControlMode;
(function (ControlMode) {
    ControlMode[ControlMode["Display"] = 1] = "Display";
    ControlMode[ControlMode["Edit"] = 2] = "Edit";
    ControlMode[ControlMode["New"] = 3] = "New";
})(ControlMode || (ControlMode = {}));
/**
 * Specifies the type of the field.
 */
var FieldTypes;
(function (FieldTypes) {
    FieldTypes[FieldTypes["Invalid"] = 0] = "Invalid";
    FieldTypes[FieldTypes["Integer"] = 1] = "Integer";
    FieldTypes[FieldTypes["Text"] = 2] = "Text";
    FieldTypes[FieldTypes["Note"] = 3] = "Note";
    FieldTypes[FieldTypes["DateTime"] = 4] = "DateTime";
    FieldTypes[FieldTypes["Counter"] = 5] = "Counter";
    FieldTypes[FieldTypes["Choice"] = 6] = "Choice";
    FieldTypes[FieldTypes["Lookup"] = 7] = "Lookup";
    FieldTypes[FieldTypes["Boolean"] = 8] = "Boolean";
    FieldTypes[FieldTypes["Number"] = 9] = "Number";
    FieldTypes[FieldTypes["Currency"] = 10] = "Currency";
    FieldTypes[FieldTypes["URL"] = 11] = "URL";
    FieldTypes[FieldTypes["Computed"] = 12] = "Computed";
    FieldTypes[FieldTypes["Threading"] = 13] = "Threading";
    FieldTypes[FieldTypes["Guid"] = 14] = "Guid";
    FieldTypes[FieldTypes["MultiChoice"] = 15] = "MultiChoice";
    FieldTypes[FieldTypes["GridChoice"] = 16] = "GridChoice";
    FieldTypes[FieldTypes["Calculated"] = 17] = "Calculated";
    FieldTypes[FieldTypes["File"] = 18] = "File";
    FieldTypes[FieldTypes["Attachments"] = 19] = "Attachments";
    FieldTypes[FieldTypes["User"] = 20] = "User";
    FieldTypes[FieldTypes["Recurrence"] = 21] = "Recurrence";
    FieldTypes[FieldTypes["CrossProjectLink"] = 22] = "CrossProjectLink";
    FieldTypes[FieldTypes["ModStat"] = 23] = "ModStat";
    FieldTypes[FieldTypes["Error"] = 24] = "Error";
    FieldTypes[FieldTypes["ContentTypeId"] = 25] = "ContentTypeId";
    FieldTypes[FieldTypes["PageSeparator"] = 26] = "PageSeparator";
    FieldTypes[FieldTypes["ThreadIndex"] = 27] = "ThreadIndex";
    FieldTypes[FieldTypes["WorkflowStatus"] = 28] = "WorkflowStatus";
    FieldTypes[FieldTypes["AllDayEvent"] = 29] = "AllDayEvent";
    FieldTypes[FieldTypes["WorkflowEventType"] = 30] = "WorkflowEventType";
})(FieldTypes || (FieldTypes = {}));
var DateTimeFieldFormatType;
(function (DateTimeFieldFormatType) {
    DateTimeFieldFormatType[DateTimeFieldFormatType["DateOnly"] = 0] = "DateOnly";
    DateTimeFieldFormatType[DateTimeFieldFormatType["DateTime"] = 1] = "DateTime";
})(DateTimeFieldFormatType || (DateTimeFieldFormatType = {}));
/**
 * Specifies the control settings while adding a field.
 */
var AddFieldOptions;
(function (AddFieldOptions) {
    /**
     *  Specify that a new field added to the list must also be added to the default content type in the site collection
     */
    AddFieldOptions[AddFieldOptions["DefaultValue"] = 0] = "DefaultValue";
    /**
     * Specify that a new field added to the list must also be added to the default content type in the site collection.
     */
    AddFieldOptions[AddFieldOptions["AddToDefaultContentType"] = 1] = "AddToDefaultContentType";
    /**
     * Specify that a new field must not be added to any other content type
     */
    AddFieldOptions[AddFieldOptions["AddToNoContentType"] = 2] = "AddToNoContentType";
    /**
     *  Specify that a new field that is added to the specified list must also be added to all content types in the site collection
     */
    AddFieldOptions[AddFieldOptions["AddToAllContentTypes"] = 4] = "AddToAllContentTypes";
    /**
     * Specify adding an internal field name hint for the purpose of avoiding possible database locking or field renaming operations
     */
    AddFieldOptions[AddFieldOptions["AddFieldInternalNameHint"] = 8] = "AddFieldInternalNameHint";
    /**
     * Specify that a new field that is added to the specified list must also be added to the default list view
     */
    AddFieldOptions[AddFieldOptions["AddFieldToDefaultView"] = 16] = "AddFieldToDefaultView";
    /**
     * Specify to confirm that no other field has the same display name
     */
    AddFieldOptions[AddFieldOptions["AddFieldCheckDisplayName"] = 32] = "AddFieldCheckDisplayName";
})(AddFieldOptions || (AddFieldOptions = {}));
var CalendarType;
(function (CalendarType) {
    CalendarType[CalendarType["Gregorian"] = 1] = "Gregorian";
    CalendarType[CalendarType["Japan"] = 3] = "Japan";
    CalendarType[CalendarType["Taiwan"] = 4] = "Taiwan";
    CalendarType[CalendarType["Korea"] = 5] = "Korea";
    CalendarType[CalendarType["Hijri"] = 6] = "Hijri";
    CalendarType[CalendarType["Thai"] = 7] = "Thai";
    CalendarType[CalendarType["Hebrew"] = 8] = "Hebrew";
    CalendarType[CalendarType["GregorianMEFrench"] = 9] = "GregorianMEFrench";
    CalendarType[CalendarType["GregorianArabic"] = 10] = "GregorianArabic";
    CalendarType[CalendarType["GregorianXLITEnglish"] = 11] = "GregorianXLITEnglish";
    CalendarType[CalendarType["GregorianXLITFrench"] = 12] = "GregorianXLITFrench";
    CalendarType[CalendarType["KoreaJapanLunar"] = 14] = "KoreaJapanLunar";
    CalendarType[CalendarType["ChineseLunar"] = 15] = "ChineseLunar";
    CalendarType[CalendarType["SakaEra"] = 16] = "SakaEra";
    CalendarType[CalendarType["UmAlQura"] = 23] = "UmAlQura";
})(CalendarType || (CalendarType = {}));
var UrlFieldFormatType;
(function (UrlFieldFormatType) {
    UrlFieldFormatType[UrlFieldFormatType["Hyperlink"] = 0] = "Hyperlink";
    UrlFieldFormatType[UrlFieldFormatType["Image"] = 1] = "Image";
})(UrlFieldFormatType || (UrlFieldFormatType = {}));
var PermissionKind;
(function (PermissionKind) {
    /**
     * Has no permissions on the Site. Not available through the user interface.
     */
    PermissionKind[PermissionKind["EmptyMask"] = 0] = "EmptyMask";
    /**
     * View items in lists, documents in document libraries, and Web discussion comments.
     */
    PermissionKind[PermissionKind["ViewListItems"] = 1] = "ViewListItems";
    /**
     * Add items to lists, documents to document libraries, and Web discussion comments.
     */
    PermissionKind[PermissionKind["AddListItems"] = 2] = "AddListItems";
    /**
     * Edit items in lists, edit documents in document libraries, edit Web discussion comments
     * in documents, and customize Web Part Pages in document libraries.
     */
    PermissionKind[PermissionKind["EditListItems"] = 3] = "EditListItems";
    /**
     * Delete items from a list, documents from a document library, and Web discussion
     * comments in documents.
     */
    PermissionKind[PermissionKind["DeleteListItems"] = 4] = "DeleteListItems";
    /**
     * Approve a minor version of a list item or document.
     */
    PermissionKind[PermissionKind["ApproveItems"] = 5] = "ApproveItems";
    /**
     * View the source of documents with server-side file handlers.
     */
    PermissionKind[PermissionKind["OpenItems"] = 6] = "OpenItems";
    /**
     * View past versions of a list item or document.
     */
    PermissionKind[PermissionKind["ViewVersions"] = 7] = "ViewVersions";
    /**
     * Delete past versions of a list item or document.
     */
    PermissionKind[PermissionKind["DeleteVersions"] = 8] = "DeleteVersions";
    /**
     * Discard or check in a document which is checked out to another user.
     */
    PermissionKind[PermissionKind["CancelCheckout"] = 9] = "CancelCheckout";
    /**
     * Create, change, and delete personal views of lists.
     */
    PermissionKind[PermissionKind["ManagePersonalViews"] = 10] = "ManagePersonalViews";
    /**
     * Create and delete lists, add or remove columns in a list, and add or remove public views of a list.
     */
    PermissionKind[PermissionKind["ManageLists"] = 12] = "ManageLists";
    /**
     * View forms, views, and application pages, and enumerate lists.
     */
    PermissionKind[PermissionKind["ViewFormPages"] = 13] = "ViewFormPages";
    /**
     * Make content of a list or document library retrieveable for anonymous users through SharePoint search.
     * The list permissions in the site do not change.
     */
    PermissionKind[PermissionKind["AnonymousSearchAccessList"] = 14] = "AnonymousSearchAccessList";
    /**
     * Allow users to open a Site, list, or folder to access items inside that container.
     */
    PermissionKind[PermissionKind["Open"] = 17] = "Open";
    /**
     * View pages in a Site.
     */
    PermissionKind[PermissionKind["ViewPages"] = 18] = "ViewPages";
    /**
     * Add, change, or delete HTML pages or Web Part Pages, and edit the Site using
     * a Windows SharePoint Services compatible editor.
     */
    PermissionKind[PermissionKind["AddAndCustomizePages"] = 19] = "AddAndCustomizePages";
    /**
     * Apply a theme or borders to the entire Site.
     */
    PermissionKind[PermissionKind["ApplyThemeAndBorder"] = 20] = "ApplyThemeAndBorder";
    /**
     * Apply a style sheet (.css file) to the Site.
     */
    PermissionKind[PermissionKind["ApplyStyleSheets"] = 21] = "ApplyStyleSheets";
    /**
     * View reports on Site usage.
     */
    PermissionKind[PermissionKind["ViewUsageData"] = 22] = "ViewUsageData";
    /**
     * Create a Site using Self-Service Site Creation.
     */
    PermissionKind[PermissionKind["CreateSSCSite"] = 23] = "CreateSSCSite";
    /**
     * Create subsites such as team sites, Meeting Workspace sites, and Document Workspace sites.
     */
    PermissionKind[PermissionKind["ManageSubwebs"] = 24] = "ManageSubwebs";
    /**
     * Create a group of users that can be used anywhere within the site collection.
     */
    PermissionKind[PermissionKind["CreateGroups"] = 25] = "CreateGroups";
    /**
     * Create and change permission levels on the Site and assign permissions to users
     * and groups.
     */
    PermissionKind[PermissionKind["ManagePermissions"] = 26] = "ManagePermissions";
    /**
     * Enumerate files and folders in a Site using Microsoft Office SharePoint Designer
     * and WebDAV interfaces.
     */
    PermissionKind[PermissionKind["BrowseDirectories"] = 27] = "BrowseDirectories";
    /**
     * View information about users of the Site.
     */
    PermissionKind[PermissionKind["BrowseUserInfo"] = 28] = "BrowseUserInfo";
    /**
     * Add or remove personal Web Parts on a Web Part Page.
     */
    PermissionKind[PermissionKind["AddDelPrivateWebParts"] = 29] = "AddDelPrivateWebParts";
    /**
     * Update Web Parts to display personalized information.
     */
    PermissionKind[PermissionKind["UpdatePersonalWebParts"] = 30] = "UpdatePersonalWebParts";
    /**
     * Grant the ability to perform all administration tasks for the Site as well as
     * manage content, activate, deactivate, or edit properties of Site scoped Features
     * through the object model or through the user interface (UI). When granted on the
     * root Site of a Site Collection, activate, deactivate, or edit properties of
     * site collection scoped Features through the object model. To browse to the Site
     * Collection Features page and activate or deactivate Site Collection scoped Features
     * through the UI, you must be a Site Collection administrator.
     */
    PermissionKind[PermissionKind["ManageWeb"] = 31] = "ManageWeb";
    /**
     * Content of lists and document libraries in the Web site will be retrieveable for anonymous users through
     * SharePoint search if the list or document library has AnonymousSearchAccessList set.
     */
    PermissionKind[PermissionKind["AnonymousSearchAccessWebLists"] = 32] = "AnonymousSearchAccessWebLists";
    /**
     * Use features that launch client applications. Otherwise, users must work on documents
     * locally and upload changes.
     */
    PermissionKind[PermissionKind["UseClientIntegration"] = 37] = "UseClientIntegration";
    /**
     * Use SOAP, WebDAV, or Microsoft Office SharePoint Designer interfaces to access the Site.
     */
    PermissionKind[PermissionKind["UseRemoteAPIs"] = 38] = "UseRemoteAPIs";
    /**
     * Manage alerts for all users of the Site.
     */
    PermissionKind[PermissionKind["ManageAlerts"] = 39] = "ManageAlerts";
    /**
     * Create e-mail alerts.
     */
    PermissionKind[PermissionKind["CreateAlerts"] = 40] = "CreateAlerts";
    /**
     * Allows a user to change his or her user information, such as adding a picture.
     */
    PermissionKind[PermissionKind["EditMyUserInfo"] = 41] = "EditMyUserInfo";
    /**
     * Enumerate permissions on Site, list, folder, document, or list item.
     */
    PermissionKind[PermissionKind["EnumeratePermissions"] = 63] = "EnumeratePermissions";
    /**
     * Has all permissions on the Site. Not available through the user interface.
     */
    PermissionKind[PermissionKind["FullMask"] = 65] = "FullMask";
})(PermissionKind || (PermissionKind = {}));
/**
 * Specifies the type of a principal.
 */
/* tslint:disable:no-bitwise */
var PrincipalType$1;
(function (PrincipalType) {
    /**
     * Enumeration whose value specifies no principal type.
     */
    PrincipalType[PrincipalType["None"] = 0] = "None";
    /**
     * Enumeration whose value specifies a user as the principal type.
     */
    PrincipalType[PrincipalType["User"] = 1] = "User";
    /**
     * Enumeration whose value specifies a distribution list as the principal type.
     */
    PrincipalType[PrincipalType["DistributionList"] = 2] = "DistributionList";
    /**
     * Enumeration whose value specifies a security group as the principal type.
     */
    PrincipalType[PrincipalType["SecurityGroup"] = 4] = "SecurityGroup";
    /**
     * Enumeration whose value specifies a group as the principal type.
     */
    PrincipalType[PrincipalType["SharePointGroup"] = 8] = "SharePointGroup";
    /**
     * Enumeration whose value specifies all principal types.
     */
    PrincipalType[PrincipalType["All"] = 15] = "All";
})(PrincipalType$1 || (PrincipalType$1 = {}));
/* tslint:enable:no-bitwise */
/**
 * Specifies the source of a principal.
 */
/* tslint:disable:no-bitwise */
var PrincipalSource;
(function (PrincipalSource) {
    /**
     * Enumeration whose value specifies no principal source.
     */
    PrincipalSource[PrincipalSource["None"] = 0] = "None";
    /**
     * Enumeration whose value specifies user information list as the principal source.
     */
    PrincipalSource[PrincipalSource["UserInfoList"] = 1] = "UserInfoList";
    /**
     * Enumeration whose value specifies Active Directory as the principal source.
     */
    PrincipalSource[PrincipalSource["Windows"] = 2] = "Windows";
    /**
     * Enumeration whose value specifies the current membership provider as the principal source.
     */
    PrincipalSource[PrincipalSource["MembershipProvider"] = 4] = "MembershipProvider";
    /**
     * Enumeration whose value specifies the current role provider as the principal source.
     */
    PrincipalSource[PrincipalSource["RoleProvider"] = 8] = "RoleProvider";
    /**
     * Enumeration whose value specifies all principal sources.
     */
    PrincipalSource[PrincipalSource["All"] = 15] = "All";
})(PrincipalSource || (PrincipalSource = {}));
/* tslint:enable:no-bitwise */
var RoleType;
(function (RoleType) {
    RoleType[RoleType["None"] = 0] = "None";
    RoleType[RoleType["Guest"] = 1] = "Guest";
    RoleType[RoleType["Reader"] = 2] = "Reader";
    RoleType[RoleType["Contributor"] = 3] = "Contributor";
    RoleType[RoleType["WebDesigner"] = 4] = "WebDesigner";
    RoleType[RoleType["Administrator"] = 5] = "Administrator";
})(RoleType || (RoleType = {}));
var PageType;
(function (PageType) {
    PageType[PageType["Invalid"] = -1] = "Invalid";
    PageType[PageType["DefaultView"] = 0] = "DefaultView";
    PageType[PageType["NormalView"] = 1] = "NormalView";
    PageType[PageType["DialogView"] = 2] = "DialogView";
    PageType[PageType["View"] = 3] = "View";
    PageType[PageType["DisplayForm"] = 4] = "DisplayForm";
    PageType[PageType["DisplayFormDialog"] = 5] = "DisplayFormDialog";
    PageType[PageType["EditForm"] = 6] = "EditForm";
    PageType[PageType["EditFormDialog"] = 7] = "EditFormDialog";
    PageType[PageType["NewForm"] = 8] = "NewForm";
    PageType[PageType["NewFormDialog"] = 9] = "NewFormDialog";
    PageType[PageType["SolutionForm"] = 10] = "SolutionForm";
    PageType[PageType["PAGE_MAXITEMS"] = 11] = "PAGE_MAXITEMS";
})(PageType || (PageType = {}));
var SharingLinkKind;
(function (SharingLinkKind) {
    /**
     * Uninitialized link
     */
    SharingLinkKind[SharingLinkKind["Uninitialized"] = 0] = "Uninitialized";
    /**
     * Direct link to the object being shared
     */
    SharingLinkKind[SharingLinkKind["Direct"] = 1] = "Direct";
    /**
     * Organization-shareable link to the object being shared with view permissions
     */
    SharingLinkKind[SharingLinkKind["OrganizationView"] = 2] = "OrganizationView";
    /**
     * Organization-shareable link to the object being shared with edit permissions
     */
    SharingLinkKind[SharingLinkKind["OrganizationEdit"] = 3] = "OrganizationEdit";
    /**
     * View only anonymous link
     */
    SharingLinkKind[SharingLinkKind["AnonymousView"] = 4] = "AnonymousView";
    /**
     * Read/Write anonymous link
     */
    SharingLinkKind[SharingLinkKind["AnonymousEdit"] = 5] = "AnonymousEdit";
    /**
     * Flexible sharing Link where properties can change without affecting link URL
     */
    SharingLinkKind[SharingLinkKind["Flexible"] = 6] = "Flexible";
})(SharingLinkKind || (SharingLinkKind = {}));
/**
 * Indicates the role of the sharing link
 */
var SharingRole;
(function (SharingRole) {
    SharingRole[SharingRole["None"] = 0] = "None";
    SharingRole[SharingRole["View"] = 1] = "View";
    SharingRole[SharingRole["Edit"] = 2] = "Edit";
    SharingRole[SharingRole["Owner"] = 3] = "Owner";
})(SharingRole || (SharingRole = {}));
var SharingOperationStatusCode;
(function (SharingOperationStatusCode) {
    /**
     * The share operation completed without errors.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["CompletedSuccessfully"] = 0] = "CompletedSuccessfully";
    /**
     * The share operation completed and generated requests for access.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["AccessRequestsQueued"] = 1] = "AccessRequestsQueued";
    /**
     * The share operation failed as there were no resolved users.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["NoResolvedUsers"] = -1] = "NoResolvedUsers";
    /**
     * The share operation failed due to insufficient permissions.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["AccessDenied"] = -2] = "AccessDenied";
    /**
     * The share operation failed when attempting a cross site share, which is not supported.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["CrossSiteRequestNotSupported"] = -3] = "CrossSiteRequestNotSupported";
    /**
     * The sharing operation failed due to an unknown error.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["UnknowError"] = -4] = "UnknowError";
    /**
     * The text you typed is too long. Please shorten it.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["EmailBodyTooLong"] = -5] = "EmailBodyTooLong";
    /**
     * The maximum number of unique scopes in the list has been exceeded.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["ListUniqueScopesExceeded"] = -6] = "ListUniqueScopesExceeded";
    /**
     * The share operation failed because a sharing capability is disabled in the site.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["CapabilityDisabled"] = -7] = "CapabilityDisabled";
    /**
     * The specified object for the share operation is not supported.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["ObjectNotSupported"] = -8] = "ObjectNotSupported";
    /**
     * A SharePoint group cannot contain another SharePoint group.
     */
    SharingOperationStatusCode[SharingOperationStatusCode["NestedGroupsNotSupported"] = -9] = "NestedGroupsNotSupported";
})(SharingOperationStatusCode || (SharingOperationStatusCode = {}));
var SPSharedObjectType;
(function (SPSharedObjectType) {
    SPSharedObjectType[SPSharedObjectType["Unknown"] = 0] = "Unknown";
    SPSharedObjectType[SPSharedObjectType["File"] = 1] = "File";
    SPSharedObjectType[SPSharedObjectType["Folder"] = 2] = "Folder";
    SPSharedObjectType[SPSharedObjectType["Item"] = 3] = "Item";
    SPSharedObjectType[SPSharedObjectType["List"] = 4] = "List";
    SPSharedObjectType[SPSharedObjectType["Web"] = 5] = "Web";
    SPSharedObjectType[SPSharedObjectType["Max"] = 6] = "Max";
})(SPSharedObjectType || (SPSharedObjectType = {}));
var SharingDomainRestrictionMode;
(function (SharingDomainRestrictionMode) {
    SharingDomainRestrictionMode[SharingDomainRestrictionMode["None"] = 0] = "None";
    SharingDomainRestrictionMode[SharingDomainRestrictionMode["AllowList"] = 1] = "AllowList";
    SharingDomainRestrictionMode[SharingDomainRestrictionMode["BlockList"] = 2] = "BlockList";
})(SharingDomainRestrictionMode || (SharingDomainRestrictionMode = {}));
var RenderListDataOptions;
(function (RenderListDataOptions) {
    RenderListDataOptions[RenderListDataOptions["None"] = 0] = "None";
    RenderListDataOptions[RenderListDataOptions["ContextInfo"] = 1] = "ContextInfo";
    RenderListDataOptions[RenderListDataOptions["ListData"] = 2] = "ListData";
    RenderListDataOptions[RenderListDataOptions["ListSchema"] = 4] = "ListSchema";
    RenderListDataOptions[RenderListDataOptions["MenuView"] = 8] = "MenuView";
    RenderListDataOptions[RenderListDataOptions["ListContentType"] = 16] = "ListContentType";
    RenderListDataOptions[RenderListDataOptions["FileSystemItemId"] = 32] = "FileSystemItemId";
    RenderListDataOptions[RenderListDataOptions["ClientFormSchema"] = 64] = "ClientFormSchema";
    RenderListDataOptions[RenderListDataOptions["QuickLaunch"] = 128] = "QuickLaunch";
    RenderListDataOptions[RenderListDataOptions["Spotlight"] = 256] = "Spotlight";
    RenderListDataOptions[RenderListDataOptions["Visualization"] = 512] = "Visualization";
    RenderListDataOptions[RenderListDataOptions["ViewMetadata"] = 1024] = "ViewMetadata";
    RenderListDataOptions[RenderListDataOptions["DisableAutoHyperlink"] = 2048] = "DisableAutoHyperlink";
    RenderListDataOptions[RenderListDataOptions["EnableMediaTAUrls"] = 4096] = "EnableMediaTAUrls";
    RenderListDataOptions[RenderListDataOptions["ParentInfo"] = 8192] = "ParentInfo";
    RenderListDataOptions[RenderListDataOptions["PageContextInfo"] = 16384] = "PageContextInfo";
    RenderListDataOptions[RenderListDataOptions["ClientSideComponentManifest"] = 32768] = "ClientSideComponentManifest";
})(RenderListDataOptions || (RenderListDataOptions = {}));
var FieldUserSelectionMode;
(function (FieldUserSelectionMode) {
    FieldUserSelectionMode[FieldUserSelectionMode["PeopleAndGroups"] = 1] = "PeopleAndGroups";
    FieldUserSelectionMode[FieldUserSelectionMode["PeopleOnly"] = 0] = "PeopleOnly";
})(FieldUserSelectionMode || (FieldUserSelectionMode = {}));
var ChoiceFieldFormatType;
(function (ChoiceFieldFormatType) {
    ChoiceFieldFormatType[ChoiceFieldFormatType["Dropdown"] = 0] = "Dropdown";
    ChoiceFieldFormatType[ChoiceFieldFormatType["RadioButtons"] = 1] = "RadioButtons";
})(ChoiceFieldFormatType || (ChoiceFieldFormatType = {}));
/**
 * Specifies the originating zone of a request received.
 */
var UrlZone;
(function (UrlZone) {
    /**
     * Specifies the default zone used for requests unless another zone is specified.
     */
    UrlZone[UrlZone["DefaultZone"] = 0] = "DefaultZone";
    /**
     * Specifies an intranet zone.
     */
    UrlZone[UrlZone["Intranet"] = 1] = "Intranet";
    /**
     * Specifies an Internet zone.
     */
    UrlZone[UrlZone["Internet"] = 2] = "Internet";
    /**
     * Specifies a custom zone.
     */
    UrlZone[UrlZone["Custom"] = 3] = "Custom";
    /**
     * Specifies an extranet zone.
     */
    UrlZone[UrlZone["Extranet"] = 4] = "Extranet";
})(UrlZone || (UrlZone = {}));

var SharePointQueryableSecurable = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableSecurable, _super);
    function SharePointQueryableSecurable() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(SharePointQueryableSecurable.prototype, "roleAssignments", {
        /**
         * Gets the set of role assignments for this item
         *
         */
        get: function () {
            return new RoleAssignments(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SharePointQueryableSecurable.prototype, "firstUniqueAncestorSecurableObject", {
        /**
         * Gets the closest securable up the security hierarchy whose permissions are applied to this list item
         *
         */
        get: function () {
            return new SharePointQueryableInstance(this, "FirstUniqueAncestorSecurableObject");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets the effective permissions for the user supplied
     *
     * @param loginName The claims username for the user (ex: i:0#.f|membership|user@domain.com)
     */
    SharePointQueryableSecurable.prototype.getUserEffectivePermissions = function (loginName) {
        var q = this.clone(SharePointQueryable, "getUserEffectivePermissions(@user)");
        q.query.set("@user", "'" + encodeURIComponent(loginName) + "'");
        return q.get().then(function (r) {
            // handle verbose mode
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(r, "GetUserEffectivePermissions") ? r.GetUserEffectivePermissions : r;
        });
    };
    /**
     * Gets the effective permissions for the current user
     */
    SharePointQueryableSecurable.prototype.getCurrentUserEffectivePermissions = function () {
        var _this = this;
        // remove need to reference Web here, which created a circular build issue
        var w = new SharePointQueryableInstance("_api/web", "currentuser");
        return w.select("LoginName").get().then(function (user) {
            return _this.getUserEffectivePermissions(user.LoginName);
        });
    };
    /**
     * Breaks the security inheritance at this level optinally copying permissions and clearing subscopes
     *
     * @param copyRoleAssignments If true the permissions are copied from the current parent scope
     * @param clearSubscopes Optional. true to make all child securable objects inherit role assignments from the current object
     */
    SharePointQueryableSecurable.prototype.breakRoleInheritance = function (copyRoleAssignments, clearSubscopes) {
        if (copyRoleAssignments === void 0) { copyRoleAssignments = false; }
        if (clearSubscopes === void 0) { clearSubscopes = false; }
        return this.clone(SharePointQueryableSecurable, "breakroleinheritance(copyroleassignments=" + copyRoleAssignments + ", clearsubscopes=" + clearSubscopes + ")").postCore();
    };
    /**
     * Removes the local role assignments so that it re-inherit role assignments from the parent object.
     *
     */
    SharePointQueryableSecurable.prototype.resetRoleInheritance = function () {
        return this.clone(SharePointQueryableSecurable, "resetroleinheritance").postCore();
    };
    /**
     * Determines if a given user has the appropriate permissions
     *
     * @param loginName The user to check
     * @param permission The permission being checked
     */
    SharePointQueryableSecurable.prototype.userHasPermissions = function (loginName, permission) {
        var _this = this;
        return this.getUserEffectivePermissions(loginName).then(function (perms) {
            return _this.hasPermissions(perms, permission);
        });
    };
    /**
     * Determines if the current user has the requested permissions
     *
     * @param permission The permission we wish to check
     */
    SharePointQueryableSecurable.prototype.currentUserHasPermissions = function (permission) {
        var _this = this;
        return this.getCurrentUserEffectivePermissions().then(function (perms) {
            return _this.hasPermissions(perms, permission);
        });
    };
    /**
     * Taken from sp.js, checks the supplied permissions against the mask
     *
     * @param value The security principal's permissions on the given object
     * @param perm The permission checked against the value
     */
    /* tslint:disable:no-bitwise */
    SharePointQueryableSecurable.prototype.hasPermissions = function (value, perm) {
        if (!perm) {
            return true;
        }
        if (perm === PermissionKind.FullMask) {
            return (value.High & 32767) === 32767 && value.Low === 65535;
        }
        perm = perm - 1;
        var num = 1;
        if (perm >= 0 && perm < 32) {
            num = num << perm;
            return 0 !== (value.Low & num);
        }
        else if (perm >= 32 && perm < 64) {
            num = num << perm - 32;
            return 0 !== (value.High & num);
        }
        return false;
    };
    return SharePointQueryableSecurable;
}(SharePointQueryableInstance));

/**
 * Internal helper class used to augment classes to include sharing functionality
 */
var SharePointQueryableShareable = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableShareable, _super);
    function SharePointQueryableShareable() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a sharing link for the supplied
     *
     * @param kind The kind of link to share
     * @param expiration The optional expiration for this link
     */
    SharePointQueryableShareable.prototype.getShareLink = function (kind, expiration) {
        if (expiration === void 0) { expiration = null; }
        // date needs to be an ISO string or null
        var expString = expiration !== null ? expiration.toISOString() : null;
        // clone using the factory and send the request
        return this.clone(SharePointQueryableShareable, "shareLink").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                request: {
                    createLink: true,
                    emailData: null,
                    settings: {
                        expiration: expString,
                        linkKind: kind,
                    },
                },
            }),
        });
    };
    /**
     * Shares this instance with the supplied users
     *
     * @param loginNames Resolved login names to share
     * @param role The role
     * @param requireSignin True to require the user is authenticated, otherwise false
     * @param propagateAcl True to apply this share to all children
     * @param emailData If supplied an email will be sent with the indicated properties
     */
    SharePointQueryableShareable.prototype.shareWith = function (loginNames, role, requireSignin, propagateAcl, emailData) {
        var _this = this;
        if (requireSignin === void 0) { requireSignin = false; }
        if (propagateAcl === void 0) { propagateAcl = false; }
        // handle the multiple input types
        if (!Array.isArray(loginNames)) {
            loginNames = [loginNames];
        }
        var userStr = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(loginNames.map(function (login) { return { Key: login }; }));
        var roleFilter = role === SharingRole.Edit ? RoleType.Contributor : RoleType.Reader;
        // start by looking up the role definition id we need to set the roleValue
        // remove need to reference Web here, which created a circular build issue
        var w = new SharePointQueryableCollection("_api/web", "roledefinitions");
        return w.select("Id").filter("RoleTypeKind eq " + roleFilter).get().then(function (def) {
            if (!Array.isArray(def) || def.length < 1) {
                throw new Error("Could not locate a role defintion with RoleTypeKind " + roleFilter);
            }
            var postBody = {
                includeAnonymousLinkInEmail: requireSignin,
                peoplePickerInput: userStr,
                propagateAcl: propagateAcl,
                roleValue: "role:" + def[0].Id,
                useSimplifiedRoles: true,
            };
            if (emailData !== undefined) {
                postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(postBody, {
                    emailBody: emailData.body,
                    emailSubject: emailData.subject !== undefined ? emailData.subject : "",
                    sendEmail: true,
                });
            }
            return _this.clone(SharePointQueryableShareable, "shareObject").postCore({
                body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(postBody),
            });
        });
    };
    /**
     * Shares an object based on the supplied options
     *
     * @param options The set of options to send to the ShareObject method
     * @param bypass If true any processing is skipped and the options are sent directly to the ShareObject method
     */
    SharePointQueryableShareable.prototype.shareObject = function (options, bypass) {
        var _this = this;
        if (bypass === void 0) { bypass = false; }
        if (bypass) {
            // if the bypass flag is set send the supplied parameters directly to the service
            return this.sendShareObjectRequest(options);
        }
        // extend our options with some defaults
        options = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(options, {
            group: null,
            includeAnonymousLinkInEmail: false,
            propagateAcl: false,
            useSimplifiedRoles: true,
        }, true);
        return this.getRoleValue(options.role, options.group).then(function (roleValue) {
            // handle the multiple input types
            if (!Array.isArray(options.loginNames)) {
                options.loginNames = [options.loginNames];
            }
            var userStr = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(options.loginNames.map(function (login) { return { Key: login }; }));
            var postBody = {
                peoplePickerInput: userStr,
                roleValue: roleValue,
                url: options.url,
            };
            if (options.emailData !== undefined && options.emailData !== null) {
                postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(postBody, {
                    emailBody: options.emailData.body,
                    emailSubject: options.emailData.subject !== undefined ? options.emailData.subject : "Shared with you.",
                    sendEmail: true,
                });
            }
            return _this.sendShareObjectRequest(postBody);
        });
    };
    /**
     * Calls the web's UnshareObject method
     *
     * @param url The url of the object to unshare
     */
    SharePointQueryableShareable.prototype.unshareObjectWeb = function (url) {
        return this.clone(SharePointQueryableShareable, "unshareObject").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                url: url,
            }),
        });
    };
    /**
     * Checks Permissions on the list of Users and returns back role the users have on the Item.
     *
     * @param recipients The array of Entities for which Permissions need to be checked.
     */
    SharePointQueryableShareable.prototype.checkPermissions = function (recipients) {
        return this.clone(SharePointQueryableShareable, "checkPermissions").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                recipients: recipients,
            }),
        });
    };
    /**
     * Get Sharing Information.
     *
     * @param request The SharingInformationRequest Object.
     */
    SharePointQueryableShareable.prototype.getSharingInformation = function (request) {
        if (request === void 0) { request = null; }
        return this.clone(SharePointQueryableShareable, "getSharingInformation").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                request: request,
            }),
        });
    };
    /**
     * Gets the sharing settings of an item.
     *
     * @param useSimplifiedRoles Determines whether to use simplified roles.
     */
    SharePointQueryableShareable.prototype.getObjectSharingSettings = function (useSimplifiedRoles) {
        if (useSimplifiedRoles === void 0) { useSimplifiedRoles = true; }
        return this.clone(SharePointQueryableShareable, "getObjectSharingSettings").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                useSimplifiedRoles: useSimplifiedRoles,
            }),
        });
    };
    /**
     * Unshares this object
     */
    SharePointQueryableShareable.prototype.unshareObject = function () {
        return this.clone(SharePointQueryableShareable, "unshareObject").postCore();
    };
    /**
     * Deletes a link by type
     *
     * @param kind Deletes a sharing link by the kind of link
     */
    SharePointQueryableShareable.prototype.deleteLinkByKind = function (kind) {
        return this.clone(SharePointQueryableShareable, "deleteLinkByKind").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ linkKind: kind }),
        });
    };
    /**
     * Removes the specified link to the item.
     *
     * @param kind The kind of link to be deleted.
     * @param shareId
     */
    SharePointQueryableShareable.prototype.unshareLink = function (kind, shareId) {
        if (shareId === void 0) { shareId = "00000000-0000-0000-0000-000000000000"; }
        return this.clone(SharePointQueryableShareable, "unshareLink").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ linkKind: kind, shareId: shareId }),
        });
    };
    /**
     * Calculates the roleValue string used in the sharing query
     *
     * @param role The Sharing Role
     * @param group The Group type
     */
    SharePointQueryableShareable.prototype.getRoleValue = function (role, group) {
        // we will give group precedence, because we had to make a choice
        if (group !== undefined && group !== null) {
            switch (group) {
                case RoleType.Contributor:
                    // remove need to reference Web here, which created a circular build issue
                    var memberGroup = new SharePointQueryableInstance("_api/web", "associatedmembergroup");
                    return memberGroup.select("Id").get().then(function (g) { return "group: " + g.Id; });
                case RoleType.Reader:
                case RoleType.Guest:
                    // remove need to reference Web here, which created a circular build issue
                    var visitorGroup = new SharePointQueryableInstance("_api/web", "associatedvisitorgroup");
                    return visitorGroup.select("Id").get().then(function (g) { return "group: " + g.Id; });
                default:
                    throw new Error("Could not determine role value for supplied value. Contributor, Reader, and Guest are supported");
            }
        }
        else {
            var roleFilter = role === SharingRole.Edit ? RoleType.Contributor : RoleType.Reader;
            // remove need to reference Web here, which created a circular build issue
            var roleDefs = new SharePointQueryableCollection("_api/web", "roledefinitions");
            return roleDefs.select("Id").top(1).filter("RoleTypeKind eq " + roleFilter).get().then(function (def) {
                if (def.length < 1) {
                    throw new Error("Could not locate associated role definition for supplied role. Edit and View are supported");
                }
                return "role: " + def[0].Id;
            });
        }
    };
    SharePointQueryableShareable.prototype.getShareObjectWeb = function (candidate) {
        return Promise.resolve(new SharePointQueryableInstance(extractWebUrl(candidate), "/_api/SP.Web.ShareObject"));
    };
    SharePointQueryableShareable.prototype.sendShareObjectRequest = function (options) {
        return this.getShareObjectWeb(this.toUrl()).then(function (web) {
            return web.expand("UsersWithAccessRequests", "GroupsSharedWith").as(SharePointQueryableShareable).postCore({
                body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(options),
            });
        });
    };
    return SharePointQueryableShareable;
}(SharePointQueryable));
var SharePointQueryableShareableWeb = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableShareableWeb, _super);
    function SharePointQueryableShareableWeb() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Shares this web with the supplied users
     * @param loginNames The resolved login names to share
     * @param role The role to share this web
     * @param emailData Optional email data
     */
    SharePointQueryableShareableWeb.prototype.shareWith = function (loginNames, role, emailData) {
        var _this = this;
        if (role === void 0) { role = SharingRole.View; }
        var dependency = this.addBatchDependency();
        // remove need to reference Web here, which created a circular build issue
        var web = new SharePointQueryableInstance(extractWebUrl(this.toUrl()), "/_api/web/url");
        return web.get().then(function (url) {
            dependency();
            return _this.shareObject(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(url, "/_layouts/15/aclinv.aspx?forSharing=1&mbypass=1"), loginNames, role, emailData);
        });
    };
    /**
     * Provides direct access to the static web.ShareObject method
     *
     * @param url The url to share
     * @param loginNames Resolved loginnames string[] of a single login name string
     * @param roleValue Role value
     * @param emailData Optional email data
     * @param groupId Optional group id
     * @param propagateAcl
     * @param includeAnonymousLinkInEmail
     * @param useSimplifiedRoles
     */
    SharePointQueryableShareableWeb.prototype.shareObject = function (url, loginNames, role, emailData, group, propagateAcl, includeAnonymousLinkInEmail, useSimplifiedRoles) {
        if (propagateAcl === void 0) { propagateAcl = false; }
        if (includeAnonymousLinkInEmail === void 0) { includeAnonymousLinkInEmail = false; }
        if (useSimplifiedRoles === void 0) { useSimplifiedRoles = true; }
        return this.clone(SharePointQueryableShareable, null).shareObject({
            emailData: emailData,
            group: group,
            includeAnonymousLinkInEmail: includeAnonymousLinkInEmail,
            loginNames: loginNames,
            propagateAcl: propagateAcl,
            role: role,
            url: url,
            useSimplifiedRoles: useSimplifiedRoles,
        });
    };
    /**
     * Supplies a method to pass any set of arguments to ShareObject
     *
     * @param options The set of options to send to ShareObject
     */
    SharePointQueryableShareableWeb.prototype.shareObjectRaw = function (options) {
        return this.clone(SharePointQueryableShareable, null).shareObject(options, true);
    };
    /**
     * Unshares the object
     *
     * @param url The url of the object to stop sharing
     */
    SharePointQueryableShareableWeb.prototype.unshareObject = function (url) {
        return this.clone(SharePointQueryableShareable, null).unshareObjectWeb(url);
    };
    return SharePointQueryableShareableWeb;
}(SharePointQueryableSecurable));
var SharePointQueryableShareableItem = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableShareableItem, _super);
    function SharePointQueryableShareableItem() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a link suitable for sharing for this item
     *
     * @param kind The type of link to share
     * @param expiration The optional expiration date
     */
    SharePointQueryableShareableItem.prototype.getShareLink = function (kind, expiration) {
        if (kind === void 0) { kind = SharingLinkKind.OrganizationView; }
        if (expiration === void 0) { expiration = null; }
        return this.clone(SharePointQueryableShareable, null).getShareLink(kind, expiration);
    };
    /**
     * Shares this item with one or more users
     *
     * @param loginNames string or string[] of resolved login names to which this item will be shared
     * @param role The role (View | Edit) applied to the share
     * @param emailData Optional, if inlucded an email will be sent. Note subject currently has no effect.
     */
    SharePointQueryableShareableItem.prototype.shareWith = function (loginNames, role, requireSignin, emailData) {
        if (role === void 0) { role = SharingRole.View; }
        if (requireSignin === void 0) { requireSignin = false; }
        return this.clone(SharePointQueryableShareable, null).shareWith(loginNames, role, requireSignin, false, emailData);
    };
    /**
     * Checks Permissions on the list of Users and returns back role the users have on the Item.
     *
     * @param recipients The array of Entities for which Permissions need to be checked.
     */
    SharePointQueryableShareableItem.prototype.checkSharingPermissions = function (recipients) {
        return this.clone(SharePointQueryableShareable, null).checkPermissions(recipients);
    };
    /**
     * Get Sharing Information.
     *
     * @param request The SharingInformationRequest Object.
     */
    SharePointQueryableShareableItem.prototype.getSharingInformation = function (request) {
        if (request === void 0) { request = null; }
        return this.clone(SharePointQueryableShareable, null).getSharingInformation(request);
    };
    /**
     * Gets the sharing settings of an item.
     *
     * @param useSimplifiedRoles Determines whether to use simplified roles.
     */
    SharePointQueryableShareableItem.prototype.getObjectSharingSettings = function (useSimplifiedRoles) {
        if (useSimplifiedRoles === void 0) { useSimplifiedRoles = true; }
        return this.clone(SharePointQueryableShareable, null).getObjectSharingSettings(useSimplifiedRoles);
    };
    /**
     * Unshare this item
     */
    SharePointQueryableShareableItem.prototype.unshare = function () {
        return this.clone(SharePointQueryableShareable, null).unshareObject();
    };
    /**
     * Deletes a sharing link by kind
     *
     * @param kind Deletes a sharing link by the kind of link
     */
    SharePointQueryableShareableItem.prototype.deleteSharingLinkByKind = function (kind) {
        return this.clone(SharePointQueryableShareable, null).deleteLinkByKind(kind);
    };
    /**
     * Removes the specified link to the item.
     *
     * @param kind The kind of link to be deleted.
     * @param shareId
     */
    SharePointQueryableShareableItem.prototype.unshareLink = function (kind, shareId) {
        return this.clone(SharePointQueryableShareable, null).unshareLink(kind, shareId);
    };
    return SharePointQueryableShareableItem;
}(SharePointQueryableSecurable));
var FileFolderShared = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(FileFolderShared, _super);
    function FileFolderShared() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a link suitable for sharing
     *
     * @param kind The kind of link to get
     * @param expiration Optional, an expiration for this link
     */
    FileFolderShared.prototype.getShareLink = function (kind, expiration) {
        if (kind === void 0) { kind = SharingLinkKind.OrganizationView; }
        if (expiration === void 0) { expiration = null; }
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.getShareLink(kind, expiration);
        });
    };
    /**
         * Checks Permissions on the list of Users and returns back role the users have on the Item.
         *
         * @param recipients The array of Entities for which Permissions need to be checked.
         */
    FileFolderShared.prototype.checkSharingPermissions = function (recipients) {
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.checkPermissions(recipients);
        });
    };
    /**
     * Get Sharing Information.
     *
     * @param request The SharingInformationRequest Object.
     */
    FileFolderShared.prototype.getSharingInformation = function (request) {
        if (request === void 0) { request = null; }
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.getSharingInformation(request);
        });
    };
    /**
     * Gets the sharing settings of an item.
     *
     * @param useSimplifiedRoles Determines whether to use simplified roles.
     */
    FileFolderShared.prototype.getObjectSharingSettings = function (useSimplifiedRoles) {
        if (useSimplifiedRoles === void 0) { useSimplifiedRoles = true; }
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.getObjectSharingSettings(useSimplifiedRoles);
        });
    };
    /**
     * Unshare this item
     */
    FileFolderShared.prototype.unshare = function () {
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.unshareObject();
        });
    };
    /**
     * Deletes a sharing link by the kind of link
     *
     * @param kind The kind of link to be deleted.
     */
    FileFolderShared.prototype.deleteSharingLinkByKind = function (kind) {
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.deleteLinkByKind(kind);
        });
    };
    /**
     * Removes the specified link to the item.
     *
     * @param kind The kind of link to be deleted.
     * @param shareId The share id to delete
     */
    FileFolderShared.prototype.unshareLink = function (kind, shareId) {
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.unshareLink(kind, shareId);
        });
    };
    /**
     * For files and folders we need to use the associated item end point
     */
    FileFolderShared.prototype.getShareable = function () {
        var _this = this;
        // sharing only works on the item end point, not the file one - so we create a folder instance with the item url internally
        return this.clone(SharePointQueryableShareableFile, "listItemAllFields", false).select("odata.id").get().then(function (d) {
            var shareable = new SharePointQueryableShareable(odataUrlFrom(d));
            // we need to handle batching
            if (_this.hasBatch) {
                shareable = shareable.inBatch(_this.batch);
            }
            return shareable;
        });
    };
    return FileFolderShared;
}(SharePointQueryableInstance));
var SharePointQueryableShareableFile = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableShareableFile, _super);
    function SharePointQueryableShareableFile() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Shares this item with one or more users
     *
     * @param loginNames string or string[] of resolved login names to which this item will be shared
     * @param role The role (View | Edit) applied to the share
     * @param shareEverything Share everything in this folder, even items with unique permissions.
     * @param requireSignin If true the user must signin to view link, otherwise anyone with the link can access the resource
     * @param emailData Optional, if inlucded an email will be sent. Note subject currently has no effect.
     */
    SharePointQueryableShareableFile.prototype.shareWith = function (loginNames, role, requireSignin, emailData) {
        if (role === void 0) { role = SharingRole.View; }
        if (requireSignin === void 0) { requireSignin = false; }
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.shareWith(loginNames, role, requireSignin, false, emailData);
        });
    };
    return SharePointQueryableShareableFile;
}(FileFolderShared));
var SharePointQueryableShareableFolder = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SharePointQueryableShareableFolder, _super);
    function SharePointQueryableShareableFolder() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Shares this item with one or more users
     *
     * @param loginNames string or string[] of resolved login names to which this item will be shared
     * @param role The role (View | Edit) applied to the share
     * @param shareEverything Share everything in this folder, even items with unique permissions.
     * @param requireSignin If true the user must signin to view link, otherwise anyone with the link can access the resource
     * @param emailData Optional, if inlucded an email will be sent. Note subject currently has no effect.
     */
    SharePointQueryableShareableFolder.prototype.shareWith = function (loginNames, role, requireSignin, shareEverything, emailData) {
        if (role === void 0) { role = SharingRole.View; }
        if (requireSignin === void 0) { requireSignin = false; }
        if (shareEverything === void 0) { shareEverything = false; }
        var dependency = this.addBatchDependency();
        return this.getShareable().then(function (shareable) {
            dependency();
            return shareable.shareWith(loginNames, role, requireSignin, shareEverything, emailData);
        });
    };
    return SharePointQueryableShareableFolder;
}(FileFolderShared));

var LimitedWebPartManager = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(LimitedWebPartManager, _super);
    function LimitedWebPartManager() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(LimitedWebPartManager.prototype, "webparts", {
        /**
         * Gets the set of web part definitions contained by this web part manager
         *
         */
        get: function () {
            return new WebPartDefinitions(this, "webparts");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Exports a webpart definition
     *
     * @param id the GUID id of the definition to export
     */
    LimitedWebPartManager.prototype.export = function (id) {
        return this.clone(LimitedWebPartManager, "ExportWebPart").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ webPartId: id }),
        });
    };
    /**
     * Imports a webpart
     *
     * @param xml webpart definition which must be valid XML in the .dwp or .webpart format
     */
    LimitedWebPartManager.prototype.import = function (xml) {
        return this.clone(LimitedWebPartManager, "ImportWebPart").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ webPartXml: xml }),
        });
    };
    return LimitedWebPartManager;
}(SharePointQueryable));
var WebPartDefinitions = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(WebPartDefinitions, _super);
    function WebPartDefinitions() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a web part definition from the collection by id
     *
     * @param id The storage ID of the SPWebPartDefinition to retrieve
     */
    WebPartDefinitions.prototype.getById = function (id) {
        return new WebPartDefinition(this, "getbyid('" + id + "')");
    };
    /**
     * Gets a web part definition from the collection by storage id
     *
     * @param id The WebPart.ID of the SPWebPartDefinition to retrieve
     */
    WebPartDefinitions.prototype.getByControlId = function (id) {
        return new WebPartDefinition(this, "getByControlId('" + id + "')");
    };
    return WebPartDefinitions;
}(SharePointQueryableCollection));
var WebPartDefinition = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(WebPartDefinition, _super);
    function WebPartDefinition() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(WebPartDefinition.prototype, "webpart", {
        /**
         * Gets the webpart information associated with this definition
         */
        get: function () {
            return new WebPart(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Saves changes to the Web Part made using other properties and methods on the SPWebPartDefinition object
     */
    WebPartDefinition.prototype.saveChanges = function () {
        return this.clone(WebPartDefinition, "SaveWebPartChanges").postCore();
    };
    /**
     * Moves the Web Part to a different location on a Web Part Page
     *
     * @param zoneId The ID of the Web Part Zone to which to move the Web Part
     * @param zoneIndex A Web Part zone index that specifies the position at which the Web Part is to be moved within the destination Web Part zone
     */
    WebPartDefinition.prototype.moveTo = function (zoneId, zoneIndex) {
        return this.clone(WebPartDefinition, "MoveWebPartTo(zoneID='" + zoneId + "', zoneIndex=" + zoneIndex + ")").postCore();
    };
    /**
     * Closes the Web Part. If the Web Part is already closed, this method does nothing
     */
    WebPartDefinition.prototype.close = function () {
        return this.clone(WebPartDefinition, "CloseWebPart").postCore();
    };
    /**
     * Opens the Web Part. If the Web Part is already closed, this method does nothing
     */
    WebPartDefinition.prototype.open = function () {
        return this.clone(WebPartDefinition, "OpenWebPart").postCore();
    };
    /**
     * Removes a webpart from a page, all settings will be lost
     */
    WebPartDefinition.prototype.delete = function () {
        return this.clone(WebPartDefinition, "DeleteWebPart").postCore();
    };
    return WebPartDefinition;
}(SharePointQueryableInstance));
var WebPart = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(WebPart, _super);
    function WebPart() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WebPart = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("webpart")
    ], WebPart);
    return WebPart;
}(SharePointQueryableInstance));

/**
 * Describes a collection of Folder objects
 *
 */
var Folders = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Folders, _super);
    function Folders() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Folders_1 = Folders;
    /**
     * Gets a folder by folder name
     *
     */
    Folders.prototype.getByName = function (name) {
        var f = new Folder(this);
        f.concat("('" + name + "')");
        return f;
    };
    /**
     * Adds a new folder to the current folder (relative) or any folder (absolute)
     *
     * @param url The relative or absolute url where the new folder will be created. Urls starting with a forward slash are absolute.
     * @returns The new Folder and the raw response.
     */
    Folders.prototype.add = function (url) {
        var _this = this;
        return this.clone(Folders_1, "add('" + url + "')").postCore().then(function (response) {
            return {
                data: response,
                folder: _this.getByName(url),
            };
        });
    };
    var Folders_1;
    Folders = Folders_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("folders")
    ], Folders);
    return Folders;
}(SharePointQueryableCollection));
/**
 * Describes a single Folder instance
 *
 */
var Folder = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Folder, _super);
    function Folder() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.update = _this._update("SP.Folder", function (data) { return ({ data: data, folder: _this }); });
        return _this;
    }
    Object.defineProperty(Folder.prototype, "contentTypeOrder", {
        /**
         * Specifies the sequence in which content types are displayed.
         *
         */
        get: function () {
            return new SharePointQueryableCollection(this, "contentTypeOrder");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Folder.prototype, "files", {
        /**
         * Gets this folder's files
         *
         */
        get: function () {
            return new Files(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Folder.prototype, "folders", {
        /**
         * Gets this folder's sub folders
         *
         */
        get: function () {
            return new Folders(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Folder.prototype, "listItemAllFields", {
        /**
         * Gets this folder's list item field values
         *
         */
        get: function () {
            return new SharePointQueryableInstance(this, "listItemAllFields");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Folder.prototype, "parentFolder", {
        /**
         * Gets the parent folder, if available
         *
         */
        get: function () {
            return new Folder(this, "parentFolder");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Folder.prototype, "properties", {
        /**
         * Gets this folder's properties
         *
         */
        get: function () {
            return new SharePointQueryableInstance(this, "properties");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Folder.prototype, "serverRelativeUrl", {
        /**
         * Gets this folder's server relative url
         *
         */
        get: function () {
            return new SharePointQueryable(this, "serverRelativeUrl");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Folder.prototype, "uniqueContentTypeOrder", {
        /**
         * Gets a value that specifies the content type order.
         *
         */
        get: function () {
            return new SharePointQueryableCollection(this, "uniqueContentTypeOrder");
        },
        enumerable: true,
        configurable: true
    });
    /**
    * Delete this folder
    *
    * @param eTag Value used in the IF-Match header, by default "*"
    */
    Folder.prototype.delete = function (eTag) {
        if (eTag === void 0) { eTag = "*"; }
        return this.clone(Folder, null).postCore({
            headers: {
                "IF-Match": eTag,
                "X-HTTP-Method": "DELETE",
            },
        });
    };
    /**
     * Moves the folder to the Recycle Bin and returns the identifier of the new Recycle Bin item.
     */
    Folder.prototype.recycle = function () {
        return this.clone(Folder, "recycle").postCore();
    };
    /**
     * Gets the associated list item for this folder, loading the default properties
     */
    Folder.prototype.getItem = function () {
        var selects = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            selects[_i] = arguments[_i];
        }
        var q = this.listItemAllFields;
        return q.select.apply(q, selects).get().then(function (d) {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(new Item(odataUrlFrom(d)), d);
        });
    };
    /**
     * Moves a folder to destination path
     *
     * @param destUrl Absolute or relative URL of the destination path
     */
    Folder.prototype.moveTo = function (destUrl) {
        var _this = this;
        return this.select("ServerRelativeUrl").get().then(function (_a) {
            var srcUrl = _a.ServerRelativeUrl;
            var client = new SPHttpClient();
            var webBaseUrl = _this.toUrl().split("/_api")[0];
            var hostUrl = webBaseUrl.replace("://", "___").split("/")[0].replace("___", "://");
            var methodUrl = webBaseUrl + "/_api/SP.MoveCopyUtil.MoveFolder()";
            return client.post(methodUrl, {
                body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                    destUrl: destUrl.indexOf("http") === 0 ? destUrl : "" + hostUrl + destUrl,
                    srcUrl: "" + hostUrl + srcUrl,
                }),
            }).then(function (r) { return r.json(); });
        });
    };
    return Folder;
}(SharePointQueryableShareableFolder));

/**
 * Describes a collection of content types
 *
 */
var ContentTypes = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ContentTypes, _super);
    function ContentTypes() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ContentTypes_1 = ContentTypes;
    /**
     * Adds an existing contenttype to a content type collection
     *
     * @param contentTypeId in the following format, for example: 0x010102
     */
    ContentTypes.prototype.addAvailableContentType = function (contentTypeId) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            "contentTypeId": contentTypeId,
        });
        return this.clone(ContentTypes_1, "addAvailableContentType").postCore({ body: postBody }).then(function (data) {
            return {
                contentType: _this.getById(data.id),
                data: data,
            };
        });
    };
    /**
     * Gets a ContentType by content type id
     */
    ContentTypes.prototype.getById = function (id) {
        var ct = new ContentType(this);
        ct.concat("('" + id + "')");
        return ct;
    };
    /**
     * Adds a new content type to the collection
     *
     * @param id The desired content type id for the new content type (also determines the parent content type)
     * @param name The name of the content type
     * @param description The description of the content type
     * @param group The group in which to add the content type
     * @param additionalSettings Any additional settings to provide when creating the content type
     *
     */
    ContentTypes.prototype.add = function (id, name, description, group, additionalSettings) {
        var _this = this;
        if (description === void 0) { description = ""; }
        if (group === void 0) { group = "Custom Content Types"; }
        if (additionalSettings === void 0) { additionalSettings = {}; }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object.assign(metadata("SP.ContentType"), {
            "Description": description,
            "Group": group,
            "Id": { "StringValue": id },
            "Name": name,
        }, additionalSettings));
        return this.postCore({ body: postBody }).then(function (data) {
            return { contentType: _this.getById(data.id), data: data };
        });
    };
    var ContentTypes_1;
    ContentTypes = ContentTypes_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("contenttypes")
    ], ContentTypes);
    return ContentTypes;
}(SharePointQueryableCollection));
/**
 * Describes a single ContentType instance
 *
 */
var ContentType = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ContentType, _super);
    function ContentType() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
         * Delete this content type
         */
        _this.delete = _this._delete;
        return _this;
    }
    Object.defineProperty(ContentType.prototype, "fieldLinks", {
        /**
         * Gets the column (also known as field) references in the content type.
        */
        get: function () {
            return new FieldLinks(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContentType.prototype, "fields", {
        /**
         * Gets a value that specifies the collection of fields for the content type.
         */
        get: function () {
            return new SharePointQueryableCollection(this, "fields");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContentType.prototype, "parent", {
        /**
         * Gets the parent content type of the content type.
         */
        get: function () {
            return new ContentType(this, "parent");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContentType.prototype, "workflowAssociations", {
        /**
         * Gets a value that specifies the collection of workflow associations for the content type.
         */
        get: function () {
            return new SharePointQueryableCollection(this, "workflowAssociations");
        },
        enumerable: true,
        configurable: true
    });
    return ContentType;
}(SharePointQueryableInstance));
/**
 * Represents a collection of field link instances
 */
var FieldLinks = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(FieldLinks, _super);
    function FieldLinks() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a FieldLink by GUID id
     *
     * @param id The GUID id of the field link
     */
    FieldLinks.prototype.getById = function (id) {
        var fl = new FieldLink(this);
        fl.concat("(guid'" + id + "')");
        return fl;
    };
    FieldLinks = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("fieldlinks")
    ], FieldLinks);
    return FieldLinks;
}(SharePointQueryableCollection));
/**
 * Represents a field link instance
 */
var FieldLink = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(FieldLink, _super);
    function FieldLink() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return FieldLink;
}(SharePointQueryableInstance));

/**
 * Describes a collection of Item objects
 *
 */
var AttachmentFiles = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(AttachmentFiles, _super);
    function AttachmentFiles() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AttachmentFiles_1 = AttachmentFiles;
    /**
     * Gets a Attachment File by filename
     *
     * @param name The name of the file, including extension.
     */
    AttachmentFiles.prototype.getByName = function (name) {
        var f = new AttachmentFile(this);
        f.concat("('" + name + "')");
        return f;
    };
    /**
     * Adds a new attachment to the collection. Not supported for batching.
     *
     * @param name The name of the file, including extension.
     * @param content The Base64 file content.
     */
    AttachmentFiles.prototype.add = function (name, content) {
        var _this = this;
        return this.clone(AttachmentFiles_1, "add(FileName='" + name + "')", false).postCore({
            body: content,
        }).then(function (response) {
            return {
                data: response,
                file: _this.getByName(name),
            };
        });
    };
    /**
     * Adds multiple new attachment to the collection. Not supported for batching.
     *
     * @files name The collection of files to add
     */
    AttachmentFiles.prototype.addMultiple = function (files) {
        var _this = this;
        // add the files in series so we don't get update conflicts
        return files.reduce(function (chain, file) { return chain.then(function () { return _this.clone(AttachmentFiles_1, "add(FileName='" + file.name + "')", false).postCore({
            body: file.content,
        }); }); }, Promise.resolve());
    };
    /**
     * Delete multiple attachments from the collection. Not supported for batching.
     *
     * @files name The collection of files to delete
     */
    AttachmentFiles.prototype.deleteMultiple = function () {
        var _this = this;
        var files = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            files[_i] = arguments[_i];
        }
        return files.reduce(function (chain, file) { return chain.then(function () { return _this.getByName(file).delete(); }); }, Promise.resolve());
    };
    var AttachmentFiles_1;
    AttachmentFiles = AttachmentFiles_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("AttachmentFiles")
    ], AttachmentFiles);
    return AttachmentFiles;
}(SharePointQueryableCollection));
/**
 * Describes a single attachment file instance
 *
 */
var AttachmentFile = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(AttachmentFile, _super);
    function AttachmentFile() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.delete = _this._deleteWithETag;
        return _this;
    }
    /**
     * Gets the contents of the file as text
     *
     */
    AttachmentFile.prototype.getText = function () {
        return this.getParsed(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["TextParser"]());
    };
    /**
     * Gets the contents of the file as a blob, does not work in Node.js
     *
     */
    AttachmentFile.prototype.getBlob = function () {
        return this.getParsed(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["BlobParser"]());
    };
    /**
     * Gets the contents of a file as an ArrayBuffer, works in Node.js
     */
    AttachmentFile.prototype.getBuffer = function () {
        return this.getParsed(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["BufferParser"]());
    };
    /**
     * Gets the contents of a file as an ArrayBuffer, works in Node.js
     */
    AttachmentFile.prototype.getJSON = function () {
        return this.getParsed(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["JSONParser"]());
    };
    /**
     * Sets the content of a file. Not supported for batching
     *
     * @param content The value to set for the file contents
     */
    AttachmentFile.prototype.setContent = function (content) {
        var _this = this;
        return this.clone(AttachmentFile, "$value", false).postCore({
            body: content,
            headers: {
                "X-HTTP-Method": "PUT",
            },
        }).then(function (_) { return new AttachmentFile(_this); });
    };
    // /**
    //  * Delete this attachment file
    //  *
    //  * @param eTag Value used in the IF-Match header, by default "*"
    //  */
    // public delete(eTag = "*"): Promise<void> {
    //     return this.postCore({
    //         headers: {
    //             "IF-Match": eTag,
    //             "X-HTTP-Method": "DELETE",
    //         },
    //     });
    // }
    AttachmentFile.prototype.getParsed = function (parser) {
        return this.clone(AttachmentFile, "$value", false).get(parser);
    };
    return AttachmentFile;
}(SharePointQueryableInstance));

/**
 * Describes the views available in the current context
 *
 */
var Views = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Views, _super);
    function Views() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Views_1 = Views;
    /**
     * Gets a view by guid id
     *
     * @param id The GUID id of the view
     */
    Views.prototype.getById = function (id) {
        var v = new View(this);
        v.concat("('" + id + "')");
        return v;
    };
    /**
     * Gets a view by title (case-sensitive)
     *
     * @param title The case-sensitive title of the view
     */
    Views.prototype.getByTitle = function (title) {
        return new View(this, "getByTitle('" + title + "')");
    };
    /**
     * Adds a new view to the collection
     *
     * @param title The new views's title
     * @param personalView True if this is a personal view, otherwise false, default = false
     * @param additionalSettings Will be passed as part of the view creation body
     */
    Views.prototype.add = function (title, personalView, additionalSettings) {
        var _this = this;
        if (personalView === void 0) { personalView = false; }
        if (additionalSettings === void 0) { additionalSettings = {}; }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object.assign(metadata("SP.View"), {
            "PersonalView": personalView,
            "Title": title,
        }, additionalSettings));
        return this.clone(Views_1, null).postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                view: _this.getById(data.Id),
            };
        });
    };
    var Views_1;
    Views = Views_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("views")
    ], Views);
    return Views;
}(SharePointQueryableCollection));
/**
 * Describes a single View instance
 *
 */
var View = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(View, _super);
    function View() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
         * Updates this view intance with the supplied properties
         *
         * @param properties A plain object hash of values to update for the view
         */
        _this.update = _this._update("SP.View", function (data) { return ({ data: data, view: _this }); });
        /**
         * Delete this view
         *
         */
        _this.delete = _this._delete;
        return _this;
    }
    Object.defineProperty(View.prototype, "fields", {
        get: function () {
            return new ViewFields(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Returns the list view as HTML.
     *
     */
    View.prototype.renderAsHtml = function () {
        return this.clone(SharePointQueryable, "renderashtml").get();
    };
    return View;
}(SharePointQueryableInstance));
var ViewFields = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ViewFields, _super);
    function ViewFields() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ViewFields_1 = ViewFields;
    /**
     * Gets a value that specifies the XML schema that represents the collection.
     */
    ViewFields.prototype.getSchemaXml = function () {
        return this.clone(SharePointQueryable, "schemaxml").get();
    };
    /**
     * Adds the field with the specified field internal name or display name to the collection.
     *
     * @param fieldTitleOrInternalName The case-sensitive internal name or display name of the field to add.
     */
    ViewFields.prototype.add = function (fieldTitleOrInternalName) {
        return this.clone(ViewFields_1, "addviewfield('" + fieldTitleOrInternalName + "')").postCore();
    };
    /**
     * Moves the field with the specified field internal name to the specified position in the collection.
     *
     * @param fieldInternalName The case-sensitive internal name of the field to move.
     * @param index The zero-based index of the new position for the field.
     */
    ViewFields.prototype.move = function (fieldInternalName, index) {
        return this.clone(ViewFields_1, "moveviewfieldto").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ "field": fieldInternalName, "index": index }),
        });
    };
    /**
     * Removes all the fields from the collection.
     */
    ViewFields.prototype.removeAll = function () {
        return this.clone(ViewFields_1, "removeallviewfields").postCore();
    };
    /**
     * Removes the field with the specified field internal name from the collection.
     *
     * @param fieldInternalName The case-sensitive internal name of the field to remove from the view.
     */
    ViewFields.prototype.remove = function (fieldInternalName) {
        return this.clone(ViewFields_1, "removeviewfield('" + fieldInternalName + "')").postCore();
    };
    var ViewFields_1;
    ViewFields = ViewFields_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("viewfields")
    ], ViewFields);
    return ViewFields;
}(SharePointQueryableCollection));

/**
 * Describes a collection of Field objects
 *
 */
var Fields = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Fields, _super);
    function Fields() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Fields_1 = Fields;
    /**
     * Gets a field from the collection by id
     *
     * @param id The Id of the list
     */
    Fields.prototype.getById = function (id) {
        var f = new Field(this);
        f.concat("('" + id + "')");
        return f;
    };
    /**
     * Gets a field from the collection by title
     *
     * @param title The case-sensitive title of the field
     */
    Fields.prototype.getByTitle = function (title) {
        return new Field(this, "getByTitle('" + title + "')");
    };
    /**
     * Gets a field from the collection by using internal name or title
     *
     * @param name The case-sensitive internal name or title of the field
     */
    Fields.prototype.getByInternalNameOrTitle = function (name) {
        return new Field(this, "getByInternalNameOrTitle('" + name + "')");
    };
    /**
     * Creates a field based on the specified schema
     */
    Fields.prototype.createFieldAsXml = function (xml) {
        var _this = this;
        var info;
        if (typeof xml === "string") {
            info = { SchemaXml: xml };
        }
        else {
            info = xml;
        }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            "parameters": Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.XmlSchemaFieldCreationInformation"), info),
        });
        return this.clone(Fields_1, "createfieldasxml").postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                field: _this.getById(data.Id),
            };
        });
    };
    /**
     * Adds a new field to the collection
     *
     * @param title The new field's title
     * @param fieldType The new field's type (ex: SP.FieldText)
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.add = function (title, fieldType, properties) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object.assign(metadata(fieldType), {
            "Title": title,
        }, properties));
        return this.clone(Fields_1, null).postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                field: _this.getById(data.Id),
            };
        });
    };
    /**
     * Adds a new SP.FieldText to the collection
     *
     * @param title The field title
     * @param maxLength The maximum number of characters allowed in the value of the field.
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addText = function (title, maxLength, properties) {
        if (maxLength === void 0) { maxLength = 255; }
        var props = {
            FieldTypeKind: 2,
            MaxLength: maxLength,
        };
        return this.add(title, "SP.FieldText", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldCalculated to the collection
     *
     * @param title The field title.
     * @param formula The formula for the field.
     * @param dateFormat The date and time format that is displayed in the field.
     * @param outputType Specifies the output format for the field. Represents a FieldType value.
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addCalculated = function (title, formula, dateFormat, outputType, properties) {
        if (outputType === void 0) { outputType = FieldTypes.Text; }
        var props = {
            DateFormat: dateFormat,
            FieldTypeKind: 17,
            Formula: formula,
            OutputType: outputType,
        };
        return this.add(title, "SP.FieldCalculated", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldDateTime to the collection
     *
     * @param title The field title
     * @param displayFormat The format of the date and time that is displayed in the field.
     * @param calendarType Specifies the calendar type of the field.
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addDateTime = function (title, displayFormat, calendarType, friendlyDisplayFormat, properties) {
        if (displayFormat === void 0) { displayFormat = DateTimeFieldFormatType.DateOnly; }
        if (calendarType === void 0) { calendarType = CalendarType.Gregorian; }
        if (friendlyDisplayFormat === void 0) { friendlyDisplayFormat = 0; }
        var props = {
            DateTimeCalendarType: calendarType,
            DisplayFormat: displayFormat,
            FieldTypeKind: 4,
            FriendlyDisplayFormat: friendlyDisplayFormat,
        };
        return this.add(title, "SP.FieldDateTime", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldNumber to the collection
     *
     * @param title The field title
     * @param minValue The field's minimum value
     * @param maxValue The field's maximum value
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addNumber = function (title, minValue, maxValue, properties) {
        var props = { FieldTypeKind: 9 };
        if (minValue !== undefined) {
            props = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ MinimumValue: minValue }, props);
        }
        if (maxValue !== undefined) {
            props = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ MaximumValue: maxValue }, props);
        }
        return this.add(title, "SP.FieldNumber", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldCurrency to the collection
     *
     * @param title The field title
     * @param minValue The field's minimum value
     * @param maxValue The field's maximum value
     * @param currencyLocalId Specifies the language code identifier (LCID) used to format the value of the field
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addCurrency = function (title, minValue, maxValue, currencyLocalId, properties) {
        if (currencyLocalId === void 0) { currencyLocalId = 1033; }
        var props = {
            CurrencyLocaleId: currencyLocalId,
            FieldTypeKind: 10,
        };
        if (minValue !== undefined) {
            props = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ MinimumValue: minValue }, props);
        }
        if (maxValue !== undefined) {
            props = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ MaximumValue: maxValue }, props);
        }
        return this.add(title, "SP.FieldCurrency", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldMultiLineText to the collection
     *
     * @param title The field title
     * @param numberOfLines Specifies the number of lines of text to display for the field.
     * @param richText Specifies whether the field supports rich formatting.
     * @param restrictedMode Specifies whether the field supports a subset of rich formatting.
     * @param appendOnly Specifies whether all changes to the value of the field are displayed in list forms.
     * @param allowHyperlink Specifies whether a hyperlink is allowed as a value of the field.
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     *
     */
    Fields.prototype.addMultilineText = function (title, numberOfLines, richText, restrictedMode, appendOnly, allowHyperlink, properties) {
        if (numberOfLines === void 0) { numberOfLines = 6; }
        if (richText === void 0) { richText = true; }
        if (restrictedMode === void 0) { restrictedMode = false; }
        if (appendOnly === void 0) { appendOnly = false; }
        if (allowHyperlink === void 0) { allowHyperlink = true; }
        var props = {
            AllowHyperlink: allowHyperlink,
            AppendOnly: appendOnly,
            FieldTypeKind: 3,
            NumberOfLines: numberOfLines,
            RestrictedMode: restrictedMode,
            RichText: richText,
        };
        return this.add(title, "SP.FieldMultiLineText", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldUrl to the collection
     *
     * @param title The field title
     */
    Fields.prototype.addUrl = function (title, displayFormat, properties) {
        if (displayFormat === void 0) { displayFormat = UrlFieldFormatType.Hyperlink; }
        var props = {
            DisplayFormat: displayFormat,
            FieldTypeKind: 11,
        };
        return this.add(title, "SP.FieldUrl", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /** Adds a user field to the colleciton
    *
    * @param title The new field's title
    * @param selectionMode The selection mode of the field
    * @param selectionGroup Value that specifies the identifier of the SharePoint group whose members can be selected as values of the field
    * @param properties
    */
    Fields.prototype.addUser = function (title, selectionMode, properties) {
        var props = {
            FieldTypeKind: 20,
            SelectionMode: selectionMode,
        };
        return this.add(title, "SP.FieldUser", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a SP.FieldLookup to the collection
     *
     * @param title The new field's title
     * @param lookupListId The guid id of the list where the source of the lookup is found
     * @param lookupFieldName The internal name of the field in the source list
     * @param properties Set of additional properties to set on the new field
     */
    Fields.prototype.addLookup = function (title, lookupListId, lookupFieldName, properties) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object.assign(metadata("SP.FieldCreationInformation"), {
            parameters: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({
                FieldTypeKind: 7,
                LookupFieldName: lookupFieldName,
                LookupListId: lookupListId,
                Title: title,
            }, properties),
        }));
        return this.clone(Fields_1, "addfield").postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                field: _this.getById(data.Id),
            };
        });
    };
    /**
     * Adds a new SP.FieldChoice to the collection
     *
     * @param title The field title.
     * @param choices The choices for the field.
     * @param format The display format of the available options for the field.
     * @param fillIn Specifies whether the field allows fill-in values.
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addChoice = function (title, choices, format, fillIn, properties) {
        if (format === void 0) { format = ChoiceFieldFormatType.Dropdown; }
        var props = {
            Choices: {
                results: choices,
            },
            EditFormat: format,
            FieldTypeKind: 6,
            FillInChoice: fillIn,
        };
        return this.add(title, "SP.FieldChoice", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldMultiChoice to the collection
     *
     * @param title The field title.
     * @param choices The choices for the field.
     * @param fillIn Specifies whether the field allows fill-in values.
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addMultiChoice = function (title, choices, fillIn, properties) {
        var props = {
            Choices: {
                results: choices,
            },
            FieldTypeKind: 15,
            FillInChoice: fillIn,
        };
        return this.add(title, "SP.FieldMultiChoice", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    /**
     * Adds a new SP.FieldBoolean to the collection
     *
     * @param title The field title.
     * @param properties Differ by type of field being created (see: https://msdn.microsoft.com/en-us/library/office/dn600182.aspx)
     */
    Fields.prototype.addBoolean = function (title, properties) {
        var props = {
            FieldTypeKind: 8,
        };
        return this.add(title, "SP.Field", Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(props, properties));
    };
    var Fields_1;
    Fields = Fields_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("fields")
    ], Fields);
    return Fields;
}(SharePointQueryableCollection));
/**
 * Describes a single of Field instance
 *
 */
var Field = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Field, _super);
    function Field() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
         * Delete this fields
         *
         */
        _this.delete = _this._delete;
        return _this;
    }
    /**
     * Updates this field intance with the supplied properties
     *
     * @param properties A plain object hash of values to update for the list
     * @param fieldType The type value, required to update child field type properties
     */
    Field.prototype.update = function (properties, fieldType) {
        var _this = this;
        if (fieldType === void 0) { fieldType = "SP.Field"; }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata(fieldType), properties));
        return this.postCore({
            body: postBody,
            headers: {
                "X-HTTP-Method": "MERGE",
            },
        }).then(function (data) {
            return {
                data: data,
                field: _this,
            };
        });
    };
    /**
     * Sets the value of the ShowInDisplayForm property for this field.
     */
    Field.prototype.setShowInDisplayForm = function (show) {
        return this.clone(Field, "setshowindisplayform(" + show + ")").postCore();
    };
    /**
     * Sets the value of the ShowInEditForm property for this field.
     */
    Field.prototype.setShowInEditForm = function (show) {
        return this.clone(Field, "setshowineditform(" + show + ")").postCore();
    };
    /**
     * Sets the value of the ShowInNewForm property for this field.
     */
    Field.prototype.setShowInNewForm = function (show) {
        return this.clone(Field, "setshowinnewform(" + show + ")").postCore();
    };
    return Field;
}(SharePointQueryableInstance));

/**
 * Describes a collection of Field objects
 *
 */
var Forms = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Forms, _super);
    function Forms() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a form by id
     *
     * @param id The guid id of the item to retrieve
     */
    Forms.prototype.getById = function (id) {
        var i = new Form(this);
        i.concat("('" + id + "')");
        return i;
    };
    Forms = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("forms")
    ], Forms);
    return Forms;
}(SharePointQueryableCollection));
/**
 * Describes a single of Form instance
 *
 */
var Form = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Form, _super);
    function Form() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return Form;
}(SharePointQueryableInstance));

/**
 * Describes a collection of webhook subscriptions
 *
 */
var Subscriptions = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Subscriptions, _super);
    function Subscriptions() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Returns all the webhook subscriptions or the specified webhook subscription
     *
     * @param subscriptionId The id of a specific webhook subscription to retrieve, omit to retrieve all the webhook subscriptions
     */
    Subscriptions.prototype.getById = function (subscriptionId) {
        var s = new Subscription(this);
        s.concat("('" + subscriptionId + "')");
        return s;
    };
    /**
     * Creates a new webhook subscription
     *
     * @param notificationUrl The url to receive the notifications
     * @param expirationDate The date and time to expire the subscription in the form YYYY-MM-ddTHH:mm:ss+00:00 (maximum of 6 months)
     * @param clientState A client specific string (defaults to pnp-js-core-subscription when omitted)
     */
    Subscriptions.prototype.add = function (notificationUrl, expirationDate, clientState) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            "clientState": clientState || "pnp-js-core-subscription",
            "expirationDateTime": expirationDate,
            "notificationUrl": notificationUrl,
            "resource": this.toUrl(),
        });
        return this.postCore({ body: postBody, headers: { "Content-Type": "application/json" } }).then(function (result) {
            return { data: result, subscription: _this.getById(result.id) };
        });
    };
    Subscriptions = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("subscriptions")
    ], Subscriptions);
    return Subscriptions;
}(SharePointQueryableCollection));
/**
 * Describes a single webhook subscription instance
 *
 */
var Subscription = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Subscription, _super);
    function Subscription() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Renews this webhook subscription
     *
     * @param expirationDate The date and time to expire the subscription in the form YYYY-MM-ddTHH:mm:ss+00:00 (maximum of 6 months)
     */
    Subscription.prototype.update = function (expirationDate) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            "expirationDateTime": expirationDate,
        });
        return this.patchCore({ body: postBody, headers: { "Content-Type": "application/json" } }).then(function (data) {
            return { data: data, subscription: _this };
        });
    };
    /**
     * Removes this webhook subscription
     *
     */
    Subscription.prototype.delete = function () {
        return _super.prototype.deleteCore.call(this);
    };
    return Subscription;
}(SharePointQueryableInstance));

/**
 * Describes a collection of user custom actions
 *
 */
var UserCustomActions = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(UserCustomActions, _super);
    function UserCustomActions() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    UserCustomActions_1 = UserCustomActions;
    /**
     * Returns the user custom action with the specified id
     *
     * @param id The GUID id of the user custom action to retrieve
     */
    UserCustomActions.prototype.getById = function (id) {
        var uca = new UserCustomAction(this);
        uca.concat("('" + id + "')");
        return uca;
    };
    /**
     * Creates a user custom action
     *
     * @param properties The information object of property names and values which define the new user custom action
     *
     */
    UserCustomActions.prototype.add = function (properties) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ __metadata: { "type": "SP.UserCustomAction" } }, properties));
        return this.postCore({ body: postBody }).then(function (data) {
            return {
                action: _this.getById(data.Id),
                data: data,
            };
        });
    };
    /**
     * Deletes all user custom actions in the collection
     *
     */
    UserCustomActions.prototype.clear = function () {
        return this.clone(UserCustomActions_1, "clear").postCore();
    };
    var UserCustomActions_1;
    UserCustomActions = UserCustomActions_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("usercustomactions")
    ], UserCustomActions);
    return UserCustomActions;
}(SharePointQueryableCollection));
/**
 * Describes a single user custom action
 *
 */
var UserCustomAction = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(UserCustomAction, _super);
    function UserCustomAction() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
        * Updates this user custom action with the supplied properties
        *
        * @param properties An information object of property names and values to update for this user custom action
        */
        _this.update = _this._update("SP.UserCustomAction", function (data) { return ({ data: data, action: _this }); });
        return _this;
    }
    /**
    * Removes this user custom action
    *
    */
    UserCustomAction.prototype.delete = function () {
        return _super.prototype.deleteCore.call(this);
    };
    return UserCustomAction;
}(SharePointQueryableInstance));

/**
 * Describes a collection of List objects
 *
 */
var Lists = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Lists, _super);
    function Lists() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Lists_1 = Lists;
    /**
     * Gets a list from the collection by guid id
     *
     * @param id The Id of the list (GUID)
     */
    Lists.prototype.getById = function (id) {
        var list = new List(this);
        list.concat("('" + id + "')");
        return list;
    };
    /**
     * Gets a list from the collection by title
     *
     * @param title The title of the list
     */
    Lists.prototype.getByTitle = function (title) {
        return new List(this, "getByTitle('" + title + "')");
    };
    /**
     * Adds a new list to the collection
     *
     * @param title The new list's title
     * @param description The new list's description
     * @param template The list template value
     * @param enableContentTypes If true content types will be allowed and enabled, otherwise they will be disallowed and not enabled
     * @param additionalSettings Will be passed as part of the list creation body
     */
    Lists.prototype.add = function (title, description, template, enableContentTypes, additionalSettings) {
        var _this = this;
        if (description === void 0) { description = ""; }
        if (template === void 0) { template = 100; }
        if (enableContentTypes === void 0) { enableContentTypes = false; }
        if (additionalSettings === void 0) { additionalSettings = {}; }
        var addSettings = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({
            "AllowContentTypes": enableContentTypes,
            "BaseTemplate": template,
            "ContentTypesEnabled": enableContentTypes,
            "Description": description,
            "Title": title,
            "__metadata": { "type": "SP.List" },
        }, additionalSettings);
        return this.postCore({ body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(addSettings) }).then(function (data) {
            return { data: data, list: _this.getByTitle(addSettings.Title) };
        });
    };
    /**
     * Ensures that the specified list exists in the collection (note: this method not supported for batching)
     *
     * @param title The new list's title
     * @param description The new list's description
     * @param template The list template value
     * @param enableContentTypes If true content types will be allowed and enabled, otherwise they will be disallowed and not enabled
     * @param additionalSettings Will be passed as part of the list creation body or used to update an existing list
     */
    Lists.prototype.ensure = function (title, description, template, enableContentTypes, additionalSettings) {
        var _this = this;
        if (description === void 0) { description = ""; }
        if (template === void 0) { template = 100; }
        if (enableContentTypes === void 0) { enableContentTypes = false; }
        if (additionalSettings === void 0) { additionalSettings = {}; }
        if (this.hasBatch) {
            throw new Error("The ensure list method is not supported for use in a batch.");
        }
        return new Promise(function (resolve, reject) {
            var addOrUpdateSettings = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(additionalSettings, { Title: title, Description: description, ContentTypesEnabled: enableContentTypes }, true);
            var list = _this.getByTitle(addOrUpdateSettings.Title);
            list.get().then(function (_) {
                list.update(addOrUpdateSettings).then(function (d) {
                    resolve({ created: false, data: d, list: _this.getByTitle(addOrUpdateSettings.Title) });
                }).catch(function (e) { return reject(e); });
            }).catch(function (_) {
                _this.add(title, description, template, enableContentTypes, addOrUpdateSettings).then(function (r) {
                    resolve({ created: true, data: r.data, list: _this.getByTitle(addOrUpdateSettings.Title) });
                }).catch(function (e) { return reject(e); });
            });
        });
    };
    /**
     * Gets a list that is the default asset location for images or other files, which the users upload to their wiki pages.
     */
    Lists.prototype.ensureSiteAssetsLibrary = function () {
        return this.clone(Lists_1, "ensuresiteassetslibrary").postCore().then(function (json) {
            return new List(odataUrlFrom(json));
        });
    };
    /**
     * Gets a list that is the default location for wiki pages.
     */
    Lists.prototype.ensureSitePagesLibrary = function () {
        return this.clone(Lists_1, "ensuresitepageslibrary").postCore().then(function (json) {
            return new List(odataUrlFrom(json));
        });
    };
    var Lists_1;
    Lists = Lists_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("lists")
    ], Lists);
    return Lists;
}(SharePointQueryableCollection));
/**
 * Describes a single List instance
 *
 */
var List = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(List, _super);
    function List() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(List.prototype, "contentTypes", {
        /**
         * Gets the content types in this list
         *
         */
        get: function () {
            return new ContentTypes(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "items", {
        /**
         * Gets the items in this list
         *
         */
        get: function () {
            return new Items(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "views", {
        /**
         * Gets the views in this list
         *
         */
        get: function () {
            return new Views(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "fields", {
        /**
         * Gets the fields in this list
         *
         */
        get: function () {
            return new Fields(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "forms", {
        /**
         * Gets the forms in this list
         *
         */
        get: function () {
            return new Forms(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "defaultView", {
        /**
         * Gets the default view of this list
         *
         */
        get: function () {
            return new View(this, "DefaultView");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "userCustomActions", {
        /**
         * Get all custom actions on a site collection
         *
         */
        get: function () {
            return new UserCustomActions(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "effectiveBasePermissions", {
        /**
         * Gets the effective base permissions of this list
         *
         */
        get: function () {
            return new SharePointQueryable(this, "EffectiveBasePermissions");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "eventReceivers", {
        /**
         * Gets the event receivers attached to this list
         *
         */
        get: function () {
            return new SharePointQueryableCollection(this, "EventReceivers");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "relatedFields", {
        /**
         * Gets the related fields of this list
         *
         */
        get: function () {
            return new SharePointQueryable(this, "getRelatedFields");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "informationRightsManagementSettings", {
        /**
         * Gets the IRM settings for this list
         *
         */
        get: function () {
            return new SharePointQueryable(this, "InformationRightsManagementSettings");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "subscriptions", {
        /**
         * Gets the webhook subscriptions of this list
         *
         */
        get: function () {
            return new Subscriptions(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(List.prototype, "rootFolder", {
        /**
         * The root folder of the list
         */
        get: function () {
            return new Folder(this, "rootFolder");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets a view by view guid id
     *
     */
    List.prototype.getView = function (viewId) {
        return new View(this, "getView('" + viewId + "')");
    };
    /**
     * Updates this list intance with the supplied properties
     *
     * @param properties A plain object hash of values to update for the list
     * @param eTag Value used in the IF-Match header, by default "*"
     */
    /* tslint:disable no-string-literal */
    List.prototype.update = function (properties, eTag) {
        var _this = this;
        if (eTag === void 0) { eTag = "*"; }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({
            "__metadata": { "type": "SP.List" },
        }, properties));
        return this.postCore({
            body: postBody,
            headers: {
                "IF-Match": eTag,
                "X-HTTP-Method": "MERGE",
            },
        }).then(function (data) {
            var retList = _this;
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(properties, "Title")) {
                retList = _this.getParent(List, _this.parentUrl, "getByTitle('" + properties["Title"] + "')");
            }
            return {
                data: data,
                list: retList,
            };
        });
    };
    /* tslint:enable */
    /**
     * Delete this list
     *
     * @param eTag Value used in the IF-Match header, by default "*"
     */
    List.prototype.delete = function (eTag) {
        if (eTag === void 0) { eTag = "*"; }
        return this.postCore({
            headers: {
                "IF-Match": eTag,
                "X-HTTP-Method": "DELETE",
            },
        });
    };
    /**
     * Returns the collection of changes from the change log that have occurred within the list, based on the specified query.
     */
    List.prototype.getChanges = function (query) {
        return this.clone(List, "getchanges").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ "query": Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ "__metadata": { "type": "SP.ChangeQuery" } }, query) }),
        });
    };
    /**
     * Returns a collection of items from the list based on the specified query.
     *
     * @param CamlQuery The Query schema of Collaborative Application Markup
     * Language (CAML) is used in various ways within the context of Microsoft SharePoint Foundation
     * to define queries against list data.
     * see:
     *
     * https://msdn.microsoft.com/en-us/library/office/ms467521.aspx
     *
     * @param expands A URI with a $expand System Query Option indicates that Entries associated with
     * the Entry or Collection of Entries identified by the Resource Path
     * section of the URI must be represented inline (i.e. eagerly loaded).
     * see:
     *
     * https://msdn.microsoft.com/en-us/library/office/fp142385.aspx
     *
     * http://www.odata.org/documentation/odata-version-2-0/uri-conventions/#ExpandSystemQueryOption
     */
    List.prototype.getItemsByCAMLQuery = function (query) {
        var expands = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            expands[_i - 1] = arguments[_i];
        }
        var q = this.clone(List, "getitems");
        return q.expand.apply(q, expands).postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ "query": Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ "__metadata": { "type": "SP.CamlQuery" } }, query) }),
        });
    };
    /**
     * See: https://msdn.microsoft.com/en-us/library/office/dn292554.aspx
     */
    List.prototype.getListItemChangesSinceToken = function (query) {
        return this.clone(List, "getlistitemchangessincetoken").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ "query": Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ "__metadata": { "type": "SP.ChangeLogItemQuery" } }, query) }),
        }, { parse: function (r) { return r.text(); } });
    };
    /**
     * Moves the list to the Recycle Bin and returns the identifier of the new Recycle Bin item.
     */
    List.prototype.recycle = function () {
        return this.clone(List, "recycle").postCore().then(function (data) {
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "Recycle")) {
                return data.Recycle;
            }
            else {
                return data;
            }
        });
    };
    /**
     * Renders list data based on the view xml provided
     */
    List.prototype.renderListData = function (viewXml) {
        var q = this.clone(List, "renderlistdata(@viewXml)");
        q.query.set("@viewXml", "'" + viewXml + "'");
        return q.postCore().then(function (data) {
            // data will be a string, so we parse it again
            data = JSON.parse(data);
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "RenderListData")) {
                return data.RenderListData;
            }
            else {
                return data;
            }
        });
    };
    /**
     * Returns the data for the specified query view
     *
     * @param parameters The parameters to be used to render list data as JSON string.
     * @param overrideParameters The parameters that are used to override and extend the regular SPRenderListDataParameters.
     */
    List.prototype.renderListDataAsStream = function (parameters, overrideParameters) {
        if (overrideParameters === void 0) { overrideParameters = null; }
        var postBody = {
            overrideParameters: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.RenderListDataOverrideParameters"), overrideParameters),
            parameters: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.RenderListDataParameters"), parameters),
        };
        return this.clone(List, "RenderListDataAsStream", true).postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(postBody),
        });
    };
    /**
     * Gets the field values and field schema attributes for a list item.
     */
    List.prototype.renderListFormData = function (itemId, formId, mode) {
        return this.clone(List, "renderlistformdata(itemid=" + itemId + ", formid='" + formId + "', mode='" + mode + "')").postCore().then(function (data) {
            // data will be a string, so we parse it again
            data = JSON.parse(data);
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "ListData")) {
                return data.ListData;
            }
            else {
                return data;
            }
        });
    };
    /**
     * Reserves a list item ID for idempotent list item creation.
     */
    List.prototype.reserveListItemId = function () {
        return this.clone(List, "reservelistitemid").postCore().then(function (data) {
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "ReserveListItemId")) {
                return data.ReserveListItemId;
            }
            else {
                return data;
            }
        });
    };
    /**
     * Returns the ListItemEntityTypeFullName for this list, used when adding/updating list items. Does not support batching.
     *
     */
    List.prototype.getListItemEntityTypeFullName = function () {
        return this.clone(List, null, false).select("ListItemEntityTypeFullName").get().then(function (o) { return o.ListItemEntityTypeFullName; });
    };
    /**
     * Creates an item using path (in a folder), validates and sets its field values.
     *
     * @param formValues The fields to change and their new values.
     * @param decodedUrl Path decoded url; folder's server relative path.
     * @param bNewDocumentUpdate true if the list item is a document being updated after upload; otherwise false.
     * @param checkInComment Optional check in comment.
     */
    List.prototype.addValidateUpdateItemUsingPath = function (formValues, decodedUrl, bNewDocumentUpdate, checkInComment) {
        if (bNewDocumentUpdate === void 0) { bNewDocumentUpdate = false; }
        return this.clone(List, "AddValidateUpdateItemUsingPath()").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                bNewDocumentUpdate: bNewDocumentUpdate,
                checkInComment: checkInComment,
                formValues: formValues,
                listItemCreateInfo: {
                    FolderPath: {
                        DecodedUrl: decodedUrl,
                        __metadata: { type: "SP.ResourcePath" },
                    },
                    __metadata: { type: "SP.ListItemCreationInformationUsingPath" },
                },
            }),
        }).then(function (res) {
            if (typeof res.AddValidateUpdateItemUsingPath !== "undefined") {
                return res.AddValidateUpdateItemUsingPath.results;
            }
            return res;
        });
    };
    return List;
}(SharePointQueryableSecurable));

/**
 * Represents a Collection of comments
 */
var Comments = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Comments, _super);
    function Comments() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Comments_1 = Comments;
    /**
     * Adds a new comment to this collection
     *
     * @param info Comment information to add
     */
    Comments.prototype.add = function (info) {
        var _this = this;
        if (typeof info === "string") {
            info = { text: info };
        }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("Microsoft.SharePoint.Comments.comment"), info));
        return this.clone(Comments_1, null).postCore({ body: postBody }).then(function (d) {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(_this.getById(d.id), d);
        });
    };
    /**
     * Gets a comment by id
     *
     * @param id Id of the comment to load
     */
    Comments.prototype.getById = function (id) {
        var c = new Comment(this);
        c.concat("(" + id + ")");
        return c;
    };
    /**
     * Deletes all the comments in this collection
     */
    Comments.prototype.clear = function () {
        return this.clone(Comments_1, "DeleteAll").postCore();
    };
    var Comments_1;
    Comments = Comments_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("comments")
    ], Comments);
    return Comments;
}(SharePointQueryableCollection));
/**
 * Represents a comment
 */
var Comment = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Comment, _super);
    function Comment() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(Comment.prototype, "replies", {
        get: function () {
            return new Replies(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Likes the comment as the current user
     */
    Comment.prototype.like = function () {
        return this.clone(Comment, "Like").postCore();
    };
    /**
     * Unlikes the comment as the current user
     */
    Comment.prototype.unlike = function () {
        return this.clone(Comment, "Unlike").postCore();
    };
    /**
     * Deletes this comment
     */
    Comment.prototype.delete = function () {
        return this.clone(Comment, "DeleteComment").postCore();
    };
    return Comment;
}(SharePointQueryableInstance));
/**
 * Represents a Collection of comments
 */
var Replies = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Replies, _super);
    function Replies() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Replies_1 = Replies;
    /**
     * Adds a new reply to this collection
     *
     * @param info Comment information to add
     */
    Replies.prototype.add = function (info) {
        if (typeof info === "string") {
            info = { text: info };
        }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("Microsoft.SharePoint.Comments.comment"), info));
        return this.clone(Replies_1, null).postCore({ body: postBody }).then(function (d) {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(new Comment(odataUrlFrom(d)), d);
        });
    };
    var Replies_1;
    Replies = Replies_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("replies")
    ], Replies);
    return Replies;
}(SharePointQueryableCollection));

/**
 * Describes a collection of Item objects
 *
 */
var Items = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Items, _super);
    function Items() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Items_1 = Items;
    /**
    * Gets an Item by id
    *
    * @param id The integer id of the item to retrieve
    */
    Items.prototype.getById = function (id) {
        var i = new Item(this);
        i.concat("(" + id + ")");
        return i;
    };
    /**
     * Gets BCS Item by string id
     *
     * @param stringId The string id of the BCS item to retrieve
     */
    Items.prototype.getItemByStringId = function (stringId) {
        // creates an item with the parent list path and append out method call
        return new Item(this.parentUrl, "getItemByStringId('" + stringId + "')");
    };
    /**
     * Skips the specified number of items (https://msdn.microsoft.com/en-us/library/office/fp142385.aspx#sectionSection6)
     *
     * @param skip The starting id where the page should start, use with top to specify pages
     * @param reverse It true the PagedPrev=true parameter is added allowing backwards navigation in the collection
     */
    Items.prototype.skip = function (skip, reverse) {
        if (reverse === void 0) { reverse = false; }
        if (reverse) {
            this.query.set("$skiptoken", encodeURIComponent("Paged=TRUE&PagedPrev=TRUE&p_ID=" + skip));
        }
        else {
            this.query.set("$skiptoken", encodeURIComponent("Paged=TRUE&p_ID=" + skip));
        }
        return this;
    };
    /**
     * Gets a collection designed to aid in paging through data
     *
     */
    Items.prototype.getPaged = function () {
        return this.get(new PagedItemCollectionParser(this));
    };
    /**
     * Gets all the items in a list, regardless of count. Does not support batching or caching
     *
     *  @param requestSize Number of items to return in each request (Default: 2000)
     *  @param acceptHeader Allows for setting the value of the Accept header for SP 2013 support
     */
    Items.prototype.getAll = function (requestSize, acceptHeader) {
        if (requestSize === void 0) { requestSize = 2000; }
        if (acceptHeader === void 0) { acceptHeader = "application/json;odata=nometadata"; }
        _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("Calling items.getAll should be done sparingly. Ensure this is the correct choice. If you are unsure, it is not.", 2 /* Warning */);
        // this will be used for the actual query
        // and we set no metadata here to try and reduce traffic
        var items = new Items_1(this, "").top(requestSize).configure({
            headers: {
                "Accept": acceptHeader,
            },
        });
        // let's copy over the odata query params that can be applied
        // $top - allow setting the page size this way (override what we did above)
        // $select - allow picking the return fields (good behavior)
        // $filter - allow setting a filter, though this may fail due for large lists
        this.query.forEach(function (v, k) {
            if (/^\$select|filter|top|expand$/i.test(k)) {
                items.query.set(k, v);
            }
        });
        // give back the promise
        return new Promise(function (resolve, reject) {
            // this will eventually hold the items we return
            var itemsCollector = [];
            // action that will gather up our results recursively
            var gatherer = function (last) {
                // collect that set of results
                [].push.apply(itemsCollector, last.results);
                // if we have more, repeat - otherwise resolve with the collected items
                if (last.hasNext) {
                    last.getNext().then(gatherer).catch(reject);
                }
                else {
                    resolve(itemsCollector);
                }
            };
            // start the cycle
            items.getPaged().then(gatherer).catch(reject);
        });
    };
    /**
     * Adds a new item to the collection
     *
     * @param properties The new items's properties
     * @param listItemEntityTypeFullName The type name of the list's entities
     */
    Items.prototype.add = function (properties, listItemEntityTypeFullName) {
        var _this = this;
        if (properties === void 0) { properties = {}; }
        if (listItemEntityTypeFullName === void 0) { listItemEntityTypeFullName = null; }
        var removeDependency = this.addBatchDependency();
        return this.ensureListItemEntityTypeName(listItemEntityTypeFullName).then(function (listItemEntityType) {
            var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata(listItemEntityType), properties));
            var promise = _this.clone(Items_1, "").postCore({ body: postBody }).then(function (data) {
                return {
                    data: data,
                    item: _this.getById(data.Id),
                };
            });
            removeDependency();
            return promise;
        });
    };
    /**
     * Ensures we have the proper list item entity type name, either from the value provided or from the list
     *
     * @param candidatelistItemEntityTypeFullName The potential type name
     */
    Items.prototype.ensureListItemEntityTypeName = function (candidatelistItemEntityTypeFullName) {
        return candidatelistItemEntityTypeFullName ?
            Promise.resolve(candidatelistItemEntityTypeFullName) :
            this.getParent(List).getListItemEntityTypeFullName();
    };
    var Items_1;
    Items = Items_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("items")
    ], Items);
    return Items;
}(SharePointQueryableCollection));
/**
 * Descrines a single Item instance
 *
 */
var Item = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Item, _super);
    function Item() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
         * Delete this item
         *
         * @param eTag Value used in the IF-Match header, by default "*"
         */
        _this.delete = _this._deleteWithETag;
        return _this;
    }
    Object.defineProperty(Item.prototype, "attachmentFiles", {
        /**
         * Gets the set of attachments for this item
         *
         */
        get: function () {
            return new AttachmentFiles(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "contentType", {
        /**
         * Gets the content type for this item
         *
         */
        get: function () {
            return new ContentType(this, "ContentType");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "comments", {
        /**
         * Gets the collection of comments associated with this list item
         */
        get: function () {
            return new Comments(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "effectiveBasePermissions", {
        /**
         * Gets the effective base permissions for the item
         *
         */
        get: function () {
            return new SharePointQueryable(this, "EffectiveBasePermissions");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "effectiveBasePermissionsForUI", {
        /**
         * Gets the effective base permissions for the item in a UI context
         *
         */
        get: function () {
            return new SharePointQueryable(this, "EffectiveBasePermissionsForUI");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "fieldValuesAsHTML", {
        /**
         * Gets the field values for this list item in their HTML representation
         *
         */
        get: function () {
            return new SharePointQueryableInstance(this, "FieldValuesAsHTML");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "fieldValuesAsText", {
        /**
         * Gets the field values for this list item in their text representation
         *
         */
        get: function () {
            return new SharePointQueryableInstance(this, "FieldValuesAsText");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "fieldValuesForEdit", {
        /**
         * Gets the field values for this list item for use in editing controls
         *
         */
        get: function () {
            return new SharePointQueryableInstance(this, "FieldValuesForEdit");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "folder", {
        /**
         * Gets the folder associated with this list item (if this item represents a folder)
         *
         */
        get: function () {
            return new Folder(this, "folder");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "file", {
        /**
         * Gets the folder associated with this list item (if this item represents a folder)
         *
         */
        get: function () {
            return new File(this, "file");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "versions", {
        /**
         * Gets the collection of versions associated with this item
         */
        get: function () {
            return new ItemVersions(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Updates this list intance with the supplied properties
     *
     * @param properties A plain object hash of values to update for the list
     * @param eTag Value used in the IF-Match header, by default "*"
     * @param listItemEntityTypeFullName The type name of the list's entities
     */
    Item.prototype.update = function (properties, eTag, listItemEntityTypeFullName) {
        var _this = this;
        if (eTag === void 0) { eTag = "*"; }
        if (listItemEntityTypeFullName === void 0) { listItemEntityTypeFullName = null; }
        return new Promise(function (resolve, reject) {
            var removeDependency = _this.addBatchDependency();
            return _this.ensureListItemEntityTypeName(listItemEntityTypeFullName).then(function (listItemEntityType) {
                var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata(listItemEntityType), properties));
                removeDependency();
                return _this.postCore({
                    body: postBody,
                    headers: {
                        "IF-Match": eTag,
                        "X-HTTP-Method": "MERGE",
                    },
                }, new ItemUpdatedParser()).then(function (data) {
                    resolve({
                        data: data,
                        item: _this,
                    });
                });
            }).catch(function (e) { return reject(e); });
        });
    };
    /**
     * Gets the collection of people who have liked this item
     */
    Item.prototype.getLikedBy = function () {
        return this.clone(Item, "likedBy").postCore();
    };
    /**
     * Likes this item as the current user
     */
    Item.prototype.like = function () {
        return this.clone(Item, "like").postCore();
    };
    /**
     * Unlikes this item as the current user
     */
    Item.prototype.unlike = function () {
        return this.clone(Item, "unlike").postCore();
    };
    /**
     * Moves the list item to the Recycle Bin and returns the identifier of the new Recycle Bin item.
     */
    Item.prototype.recycle = function () {
        return this.clone(Item, "recycle").postCore();
    };
    /**
     * Gets a string representation of the full URL to the WOPI frame.
     * If there is no associated WOPI application, or no associated action, an empty string is returned.
     *
     * @param action Display mode: 0: view, 1: edit, 2: mobileView, 3: interactivePreview
     */
    Item.prototype.getWopiFrameUrl = function (action) {
        if (action === void 0) { action = 0; }
        var i = this.clone(Item, "getWOPIFrameUrl(@action)");
        i.query.set("@action", action);
        return i.postCore().then(function (data) {
            // handle verbose mode
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "GetWOPIFrameUrl")) {
                return data.GetWOPIFrameUrl;
            }
            return data;
        });
    };
    /**
     * Validates and sets the values of the specified collection of fields for the list item.
     *
     * @param formValues The fields to change and their new values.
     * @param newDocumentUpdate true if the list item is a document being updated after upload; otherwise false.
     */
    Item.prototype.validateUpdateListItem = function (formValues, newDocumentUpdate) {
        if (newDocumentUpdate === void 0) { newDocumentUpdate = false; }
        return this.clone(Item, "validateupdatelistitem").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ "formValues": formValues, bNewDocumentUpdate: newDocumentUpdate }),
        });
    };
    /**
     * Ensures we have the proper list item entity type name, either from the value provided or from the list
     *
     * @param candidatelistItemEntityTypeFullName The potential type name
     */
    Item.prototype.ensureListItemEntityTypeName = function (candidatelistItemEntityTypeFullName) {
        return candidatelistItemEntityTypeFullName ?
            Promise.resolve(candidatelistItemEntityTypeFullName) :
            this.getParent(List, this.parentUrl.substr(0, this.parentUrl.lastIndexOf("/"))).getListItemEntityTypeFullName();
    };
    return Item;
}(SharePointQueryableShareableItem));
/**
 * Describes a collection of Version objects
 *
 */
var ItemVersions = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ItemVersions, _super);
    function ItemVersions() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a version by id
     *
     * @param versionId The id of the version to retrieve
     */
    ItemVersions.prototype.getById = function (versionId) {
        var v = new ItemVersion(this);
        v.concat("(" + versionId + ")");
        return v;
    };
    ItemVersions = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("versions")
    ], ItemVersions);
    return ItemVersions;
}(SharePointQueryableCollection));
/**
 * Describes a single Version instance
 *
 */
var ItemVersion = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ItemVersion, _super);
    function ItemVersion() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
        * Delete a specific version of a file.
        *
        * @param eTag Value used in the IF-Match header, by default "*"
        */
        _this.delete = _this._deleteWithETag;
        return _this;
    }
    return ItemVersion;
}(SharePointQueryableInstance));
/**
 * Provides paging functionality for list items
 */
var PagedItemCollection = /** @class */ (function () {
    function PagedItemCollection(parent, nextUrl, results) {
        this.parent = parent;
        this.nextUrl = nextUrl;
        this.results = results;
    }
    Object.defineProperty(PagedItemCollection.prototype, "hasNext", {
        /**
         * If true there are more results available in the set, otherwise there are not
         */
        get: function () {
            return typeof this.nextUrl === "string" && this.nextUrl.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets the next set of results, or resolves to null if no results are available
     */
    PagedItemCollection.prototype.getNext = function () {
        if (this.hasNext) {
            var items = new Items(this.nextUrl, null).configureFrom(this.parent);
            return items.getPaged();
        }
        return new Promise(function (r) { return r(null); });
    };
    return PagedItemCollection;
}());
var PagedItemCollectionParser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(PagedItemCollectionParser, _super);
    function PagedItemCollectionParser(_parent) {
        var _this = _super.call(this) || this;
        _this._parent = _parent;
        return _this;
    }
    PagedItemCollectionParser.prototype.parse = function (r) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (_this.handleError(r, reject)) {
                r.json().then(function (json) {
                    var nextUrl = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(json, "d") && Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(json.d, "__next") ? json.d.__next : json["odata.nextLink"];
                    resolve(new PagedItemCollection(_this._parent, nextUrl, _this.parseODataJSON(json)));
                });
            }
        });
    };
    return PagedItemCollectionParser;
}(_pnp_odata__WEBPACK_IMPORTED_MODULE_3__["ODataParserBase"]));
var ItemUpdatedParser = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ItemUpdatedParser, _super);
    function ItemUpdatedParser() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ItemUpdatedParser.prototype.parse = function (r) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (_this.handleError(r, reject)) {
                resolve({
                    "odata.etag": r.headers.get("etag"),
                });
            }
        });
    };
    return ItemUpdatedParser;
}(_pnp_odata__WEBPACK_IMPORTED_MODULE_3__["ODataParserBase"]));

/**
 * Describes a collection of File objects
 *
 */
var Files = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Files, _super);
    function Files() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Files_1 = Files;
    /**
     * Gets a File by filename
     *
     * @param name The name of the file, including extension.
     */
    Files.prototype.getByName = function (name) {
        var f = new File(this);
        f.concat("('" + name + "')");
        return f;
    };
    /**
     * Uploads a file. Not supported for batching
     *
     * @param url The folder-relative url of the file.
     * @param content The file contents blob.
     * @param shouldOverWrite Should a file with the same name in the same location be overwritten? (default: true)
     * @returns The new File and the raw response.
     */
    Files.prototype.add = function (url, content, shouldOverWrite) {
        var _this = this;
        if (shouldOverWrite === void 0) { shouldOverWrite = true; }
        return new Files_1(this, "add(overwrite=" + shouldOverWrite + ",url='" + url + "')")
            .postCore({
            body: content,
        }).then(function (response) {
            return {
                data: response,
                file: _this.getByName(url),
            };
        });
    };
    /**
     * Uploads a file. Not supported for batching
     *
     * @param url The folder-relative url of the file.
     * @param content The Blob file content to add
     * @param progress A callback function which can be used to track the progress of the upload
     * @param shouldOverWrite Should a file with the same name in the same location be overwritten? (default: true)
     * @param chunkSize The size of each file slice, in bytes (default: 10485760)
     * @returns The new File and the raw response.
     */
    Files.prototype.addChunked = function (url, content, progress, shouldOverWrite, chunkSize) {
        var _this = this;
        if (shouldOverWrite === void 0) { shouldOverWrite = true; }
        if (chunkSize === void 0) { chunkSize = 10485760; }
        var adder = this.clone(Files_1, "add(overwrite=" + shouldOverWrite + ",url='" + url + "')", false);
        return adder.postCore()
            .then(function () { return _this.getByName(url); })
            .then(function (file) { return file.setContentChunked(content, progress, chunkSize); });
    };
    /**
     * Adds a ghosted file to an existing list or document library. Not supported for batching.
     *
     * @param fileUrl The server-relative url where you want to save the file.
     * @param templateFileType The type of use to create the file.
     * @returns The template file that was added and the raw response.
     */
    Files.prototype.addTemplateFile = function (fileUrl, templateFileType) {
        var _this = this;
        return this.clone(Files_1, "addTemplateFile(urloffile='" + fileUrl + "',templatefiletype=" + templateFileType + ")", false)
            .postCore().then(function (response) {
            return {
                data: response,
                file: _this.getByName(fileUrl),
            };
        });
    };
    var Files_1;
    Files = Files_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("files")
    ], Files);
    return Files;
}(SharePointQueryableCollection));
/**
 * Describes a single File instance
 *
 */
var File = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(File, _super);
    function File() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(File.prototype, "listItemAllFields", {
        /**
         * Gets a value that specifies the list item field values for the list item corresponding to the file.
         *
         */
        get: function () {
            return new SharePointQueryableInstance(this, "listItemAllFields");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(File.prototype, "versions", {
        /**
         * Gets a collection of versions
         *
         */
        get: function () {
            return new Versions(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Approves the file submitted for content approval with the specified comment.
     * Only documents in lists that are enabled for content approval can be approved.
     *
     * @param comment The comment for the approval.
     */
    File.prototype.approve = function (comment) {
        if (comment === void 0) { comment = ""; }
        return this.clone(File, "approve(comment='" + comment + "')").postCore();
    };
    /**
     * Stops the chunk upload session without saving the uploaded data. Does not support batching.
     * If the file doesn’t already exist in the library, the partially uploaded file will be deleted.
     * Use this in response to user action (as in a request to cancel an upload) or an error or exception.
     * Use the uploadId value that was passed to the StartUpload method that started the upload session.
     * This method is currently available only on Office 365.
     *
     * @param uploadId The unique identifier of the upload session.
     */
    File.prototype.cancelUpload = function (uploadId) {
        return this.clone(File, "cancelUpload(uploadId=guid'" + uploadId + "')", false).postCore();
    };
    /**
     * Checks the file in to a document library based on the check-in type.
     *
     * @param comment A comment for the check-in. Its length must be <= 1023.
     * @param checkinType The check-in type for the file.
     */
    File.prototype.checkin = function (comment, checkinType) {
        if (comment === void 0) { comment = ""; }
        if (checkinType === void 0) { checkinType = CheckinType.Major; }
        if (comment.length > 1023) {
            throw new Error("The maximum comment length is 1023 characters.");
        }
        return this.clone(File, "checkin(comment='" + comment + "',checkintype=" + checkinType + ")").postCore();
    };
    /**
     * Checks out the file from a document library.
     */
    File.prototype.checkout = function () {
        return this.clone(File, "checkout").postCore();
    };
    /**
     * Copies the file to the destination url.
     *
     * @param url The absolute url or server relative url of the destination file path to copy to.
     * @param shouldOverWrite Should a file with the same name in the same location be overwritten?
     */
    File.prototype.copyTo = function (url, shouldOverWrite) {
        if (shouldOverWrite === void 0) { shouldOverWrite = true; }
        return this.clone(File, "copyTo(strnewurl='" + url + "',boverwrite=" + shouldOverWrite + ")").postCore();
    };
    /**
     * Delete this file.
     *
     * @param eTag Value used in the IF-Match header, by default "*"
     */
    File.prototype.delete = function (eTag) {
        if (eTag === void 0) { eTag = "*"; }
        return this.clone(File, null).postCore({
            headers: {
                "IF-Match": eTag,
                "X-HTTP-Method": "DELETE",
            },
        });
    };
    /**
     * Denies approval for a file that was submitted for content approval.
     * Only documents in lists that are enabled for content approval can be denied.
     *
     * @param comment The comment for the denial.
     */
    File.prototype.deny = function (comment) {
        if (comment === void 0) { comment = ""; }
        if (comment.length > 1023) {
            throw new Error("The maximum comment length is 1023 characters.");
        }
        return this.clone(File, "deny(comment='" + comment + "')").postCore();
    };
    /**
     * Specifies the control set used to access, modify, or add Web Parts associated with this Web Part Page and view.
     * An exception is thrown if the file is not an ASPX page.
     *
     * @param scope The WebPartsPersonalizationScope view on the Web Parts page.
     */
    File.prototype.getLimitedWebPartManager = function (scope) {
        if (scope === void 0) { scope = WebPartsPersonalizationScope.Shared; }
        return new LimitedWebPartManager(this, "getLimitedWebPartManager(scope=" + scope + ")");
    };
    /**
     * Moves the file to the specified destination url.
     *
     * @param url The absolute url or server relative url of the destination file path to move to.
     * @param moveOperations The bitwise MoveOperations value for how to move the file.
     */
    File.prototype.moveTo = function (url, moveOperations) {
        if (moveOperations === void 0) { moveOperations = MoveOperations.Overwrite; }
        return this.clone(File, "moveTo(newurl='" + url + "',flags=" + moveOperations + ")").postCore();
    };
    /**
     * Submits the file for content approval with the specified comment.
     *
     * @param comment The comment for the published file. Its length must be <= 1023.
     */
    File.prototype.publish = function (comment) {
        if (comment === void 0) { comment = ""; }
        if (comment.length > 1023) {
            throw new Error("The maximum comment length is 1023 characters.");
        }
        return this.clone(File, "publish(comment='" + comment + "')").postCore();
    };
    /**
     * Moves the file to the Recycle Bin and returns the identifier of the new Recycle Bin item.
     *
     * @returns The GUID of the recycled file.
     */
    File.prototype.recycle = function () {
        return this.clone(File, "recycle").postCore();
    };
    /**
     * Reverts an existing checkout for the file.
     *
     */
    File.prototype.undoCheckout = function () {
        return this.clone(File, "undoCheckout").postCore();
    };
    /**
     * Removes the file from content approval or unpublish a major version.
     *
     * @param comment The comment for the unpublish operation. Its length must be <= 1023.
     */
    File.prototype.unpublish = function (comment) {
        if (comment === void 0) { comment = ""; }
        if (comment.length > 1023) {
            throw new Error("The maximum comment length is 1023 characters.");
        }
        return this.clone(File, "unpublish(comment='" + comment + "')").postCore();
    };
    /**
     * Gets the contents of the file as text. Not supported in batching.
     *
     */
    File.prototype.getText = function () {
        return this.clone(File, "$value", false).get(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["TextParser"](), { headers: { "binaryStringResponseBody": "true" } });
    };
    /**
     * Gets the contents of the file as a blob, does not work in Node.js. Not supported in batching.
     *
     */
    File.prototype.getBlob = function () {
        return this.clone(File, "$value", false).get(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["BlobParser"](), { headers: { "binaryStringResponseBody": "true" } });
    };
    /**
     * Gets the contents of a file as an ArrayBuffer, works in Node.js. Not supported in batching.
     */
    File.prototype.getBuffer = function () {
        return this.clone(File, "$value", false).get(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["BufferParser"](), { headers: { "binaryStringResponseBody": "true" } });
    };
    /**
     * Gets the contents of a file as an ArrayBuffer, works in Node.js. Not supported in batching.
     */
    File.prototype.getJSON = function () {
        return this.clone(File, "$value", false).get(new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["JSONParser"](), { headers: { "binaryStringResponseBody": "true" } });
    };
    /**
     * Sets the content of a file, for large files use setContentChunked. Not supported in batching.
     *
     * @param content The file content
     *
     */
    File.prototype.setContent = function (content) {
        var _this = this;
        return this.clone(File, "$value", false).postCore({
            body: content,
            headers: {
                "X-HTTP-Method": "PUT",
            },
        }).then(function (_) { return new File(_this); });
    };
    /**
     * Gets the associated list item for this folder, loading the default properties
     */
    File.prototype.getItem = function () {
        var selects = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            selects[_i] = arguments[_i];
        }
        var q = this.listItemAllFields;
        return q.select.apply(q, selects).get().then(function (d) {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(new Item(odataUrlFrom(d)), d);
        });
    };
    /**
     * Sets the contents of a file using a chunked upload approach. Not supported in batching.
     *
     * @param file The file to upload
     * @param progress A callback function which can be used to track the progress of the upload
     * @param chunkSize The size of each file slice, in bytes (default: 10485760)
     */
    File.prototype.setContentChunked = function (file, progress, chunkSize) {
        var _this = this;
        if (chunkSize === void 0) { chunkSize = 10485760; }
        if (progress === undefined) {
            progress = function () { return null; };
        }
        var fileSize = file.size;
        var blockCount = parseInt((file.size / chunkSize).toString(), 10) + ((file.size % chunkSize === 0) ? 1 : 0);
        var uploadId = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getGUID"])();
        // start the chain with the first fragment
        progress({ uploadId: uploadId, blockNumber: 1, chunkSize: chunkSize, currentPointer: 0, fileSize: fileSize, stage: "starting", totalBlocks: blockCount });
        var chain = this.startUpload(uploadId, file.slice(0, chunkSize));
        var _loop_1 = function (i) {
            chain = chain.then(function (pointer) {
                progress({ uploadId: uploadId, blockNumber: i, chunkSize: chunkSize, currentPointer: pointer, fileSize: fileSize, stage: "continue", totalBlocks: blockCount });
                return _this.continueUpload(uploadId, pointer, file.slice(pointer, pointer + chunkSize));
            });
        };
        // skip the first and last blocks
        for (var i = 2; i < blockCount; i++) {
            _loop_1(i);
        }
        return chain.then(function (pointer) {
            progress({ uploadId: uploadId, blockNumber: blockCount, chunkSize: chunkSize, currentPointer: pointer, fileSize: fileSize, stage: "finishing", totalBlocks: blockCount });
            return _this.finishUpload(uploadId, pointer, file.slice(pointer));
        });
    };
    /**
     * Starts a new chunk upload session and uploads the first fragment.
     * The current file content is not changed when this method completes.
     * The method is idempotent (and therefore does not change the result) as long as you use the same values for uploadId and stream.
     * The upload session ends either when you use the CancelUpload method or when you successfully
     * complete the upload session by passing the rest of the file contents through the ContinueUpload and FinishUpload methods.
     * The StartUpload and ContinueUpload methods return the size of the running total of uploaded data in bytes,
     * so you can pass those return values to subsequent uses of ContinueUpload and FinishUpload.
     * This method is currently available only on Office 365.
     *
     * @param uploadId The unique identifier of the upload session.
     * @param fragment The file contents.
     * @returns The size of the total uploaded data in bytes.
     */
    File.prototype.startUpload = function (uploadId, fragment) {
        return this.clone(File, "startUpload(uploadId=guid'" + uploadId + "')", false)
            .postCore({ body: fragment })
            .then(function (n) {
            // When OData=verbose the payload has the following shape:
            // { StartUpload: "10485760" }
            if (typeof n === "object") {
                n = n.StartUpload;
            }
            return parseFloat(n);
        });
    };
    /**
     * Continues the chunk upload session with an additional fragment.
     * The current file content is not changed.
     * Use the uploadId value that was passed to the StartUpload method that started the upload session.
     * This method is currently available only on Office 365.
     *
     * @param uploadId The unique identifier of the upload session.
     * @param fileOffset The size of the offset into the file where the fragment starts.
     * @param fragment The file contents.
     * @returns The size of the total uploaded data in bytes.
     */
    File.prototype.continueUpload = function (uploadId, fileOffset, fragment) {
        return this.clone(File, "continueUpload(uploadId=guid'" + uploadId + "',fileOffset=" + fileOffset + ")", false)
            .postCore({ body: fragment })
            .then(function (n) {
            // When OData=verbose the payload has the following shape:
            // { ContinueUpload: "20971520" }
            if (typeof n === "object") {
                n = n.ContinueUpload;
            }
            return parseFloat(n);
        });
    };
    /**
     * Uploads the last file fragment and commits the file. The current file content is changed when this method completes.
     * Use the uploadId value that was passed to the StartUpload method that started the upload session.
     * This method is currently available only on Office 365.
     *
     * @param uploadId The unique identifier of the upload session.
     * @param fileOffset The size of the offset into the file where the fragment starts.
     * @param fragment The file contents.
     * @returns The newly uploaded file.
     */
    File.prototype.finishUpload = function (uploadId, fileOffset, fragment) {
        return this.clone(File, "finishUpload(uploadId=guid'" + uploadId + "',fileOffset=" + fileOffset + ")", false)
            .postCore({ body: fragment })
            .then(function (response) {
            return {
                data: response,
                file: new File(odataUrlFrom(response)),
            };
        });
    };
    return File;
}(SharePointQueryableShareableFile));
/**
 * Describes a collection of Version objects
 *
 */
var Versions = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Versions, _super);
    function Versions() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Versions_1 = Versions;
    /**
     * Gets a version by id
     *
     * @param versionId The id of the version to retrieve
     */
    Versions.prototype.getById = function (versionId) {
        var v = new Version(this);
        v.concat("(" + versionId + ")");
        return v;
    };
    /**
     * Deletes all the file version objects in the collection.
     *
     */
    Versions.prototype.deleteAll = function () {
        return new Versions_1(this, "deleteAll").postCore();
    };
    /**
     * Deletes the specified version of the file.
     *
     * @param versionId The ID of the file version to delete.
     */
    Versions.prototype.deleteById = function (versionId) {
        return this.clone(Versions_1, "deleteById(vid=" + versionId + ")").postCore();
    };
    /**
     * Recycles the specified version of the file.
     *
     * @param versionId The ID of the file version to delete.
     */
    Versions.prototype.recycleByID = function (versionId) {
        return this.clone(Versions_1, "recycleByID(vid=" + versionId + ")").postCore();
    };
    /**
     * Deletes the file version object with the specified version label.
     *
     * @param label The version label of the file version to delete, for example: 1.2
     */
    Versions.prototype.deleteByLabel = function (label) {
        return this.clone(Versions_1, "deleteByLabel(versionlabel='" + label + "')").postCore();
    };
    /**
     * Recycles the file version object with the specified version label.
     *
     * @param label The version label of the file version to delete, for example: 1.2
     */
    Versions.prototype.recycleByLabel = function (label) {
        return this.clone(Versions_1, "recycleByLabel(versionlabel='" + label + "')").postCore();
    };
    /**
     * Creates a new file version from the file specified by the version label.
     *
     * @param label The version label of the file version to restore, for example: 1.2
     */
    Versions.prototype.restoreByLabel = function (label) {
        return this.clone(Versions_1, "restoreByLabel(versionlabel='" + label + "')").postCore();
    };
    var Versions_1;
    Versions = Versions_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("versions")
    ], Versions);
    return Versions;
}(SharePointQueryableCollection));
/**
 * Describes a single Version instance
 *
 */
var Version = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Version, _super);
    function Version() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
        * Delete a specific version of a file.
        *
        * @param eTag Value used in the IF-Match header, by default "*"
        */
        _this.delete = _this._deleteWithETag;
        return _this;
        // /**
        // * Delete a specific version of a file.
        // *
        // * @param eTag Value used in the IF-Match header, by default "*"
        // */
        // public delete(eTag = "*"): Promise<void> {
        //     return this.postCore({
        //         headers: {
        //             "IF-Match": eTag,
        //             "X-HTTP-Method": "DELETE",
        //         },
        //     });
        // }
    }
    return Version;
}(SharePointQueryableInstance));
var CheckinType;
(function (CheckinType) {
    CheckinType[CheckinType["Minor"] = 0] = "Minor";
    CheckinType[CheckinType["Major"] = 1] = "Major";
    CheckinType[CheckinType["Overwrite"] = 2] = "Overwrite";
})(CheckinType || (CheckinType = {}));
var WebPartsPersonalizationScope;
(function (WebPartsPersonalizationScope) {
    WebPartsPersonalizationScope[WebPartsPersonalizationScope["User"] = 0] = "User";
    WebPartsPersonalizationScope[WebPartsPersonalizationScope["Shared"] = 1] = "Shared";
})(WebPartsPersonalizationScope || (WebPartsPersonalizationScope = {}));
var MoveOperations;
(function (MoveOperations) {
    MoveOperations[MoveOperations["Overwrite"] = 1] = "Overwrite";
    MoveOperations[MoveOperations["AllowBrokenThickets"] = 8] = "AllowBrokenThickets";
})(MoveOperations || (MoveOperations = {}));
var TemplateFileType;
(function (TemplateFileType) {
    TemplateFileType[TemplateFileType["StandardPage"] = 0] = "StandardPage";
    TemplateFileType[TemplateFileType["WikiPage"] = 1] = "WikiPage";
    TemplateFileType[TemplateFileType["FormPage"] = 2] = "FormPage";
    TemplateFileType[TemplateFileType["ClientSidePage"] = 3] = "ClientSidePage";
})(TemplateFileType || (TemplateFileType = {}));

/**
 * Represents an app catalog
 */
var AppCatalog = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(AppCatalog, _super);
    function AppCatalog(baseUrl, path) {
        if (path === void 0) { path = "_api/web/tenantappcatalog/AvailableApps"; }
        return _super.call(this, extractWebUrl(typeof baseUrl === "string" ? baseUrl : baseUrl.toUrl()), path) || this;
    }
    /**
     * Get details of specific app from the app catalog
     * @param id - Specify the guid of the app
     */
    AppCatalog.prototype.getAppById = function (id) {
        return new App(this, "getById('" + id + "')");
    };
    /**
     * Uploads an app package. Not supported for batching
     *
     * @param filename Filename to create.
     * @param content app package data (eg: the .app or .sppkg file).
     * @param shouldOverWrite Should an app with the same name in the same location be overwritten? (default: true)
     * @returns Promise<AppAddResult>
     */
    AppCatalog.prototype.add = function (filename, content, shouldOverWrite) {
        if (shouldOverWrite === void 0) { shouldOverWrite = true; }
        // you don't add to the availableapps collection
        var adder = new AppCatalog(extractWebUrl(this.toUrl()), "_api/web/tenantappcatalog/add(overwrite=" + shouldOverWrite + ",url='" + filename + "')");
        return adder.postCore({
            body: content,
        }).then(function (r) {
            return {
                data: r,
                file: new File(odataUrlFrom(r)),
            };
        });
    };
    return AppCatalog;
}(SharePointQueryableCollection));
/**
 * Represents the actions you can preform on a given app within the catalog
 */
var App = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(App, _super);
    function App() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * This method deploys an app on the app catalog.  It must be called in the context
     * of the tenant app catalog web or it will fail.
     */
    App.prototype.deploy = function () {
        return this.clone(App, "Deploy").postCore();
    };
    /**
     * This method retracts a deployed app on the app catalog.  It must be called in the context
     * of the tenant app catalog web or it will fail.
     */
    App.prototype.retract = function () {
        return this.clone(App, "Retract").postCore();
    };
    /**
     * This method allows an app which is already deployed to be installed on a web
     */
    App.prototype.install = function () {
        return this.clone(App, "Install").postCore();
    };
    /**
     * This method allows an app which is already insatlled to be uninstalled on a web
     */
    App.prototype.uninstall = function () {
        return this.clone(App, "Uninstall").postCore();
    };
    /**
     * This method allows an app which is already insatlled to be upgraded on a web
     */
    App.prototype.upgrade = function () {
        return this.clone(App, "Upgrade").postCore();
    };
    /**
     * This method removes an app from the app catalog.  It must be called in the context
     * of the tenant app catalog web or it will fail.
     */
    App.prototype.remove = function () {
        return this.clone(App, "Remove").postCore();
    };
    return App;
}(SharePointQueryableInstance));

/**
 * Manages a batch of OData operations
 */
var SPBatch = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SPBatch, _super);
    function SPBatch(baseUrl) {
        var _this = _super.call(this) || this;
        _this.baseUrl = baseUrl;
        return _this;
    }
    /**
     * Parses the response from a batch request into an array of Response instances
     *
     * @param body Text body of the response from the batch request
     */
    SPBatch.ParseResponse = function (body) {
        return new Promise(function (resolve, reject) {
            var responses = [];
            var header = "--batchresponse_";
            // Ex. "HTTP/1.1 500 Internal Server Error"
            var statusRegExp = new RegExp("^HTTP/[0-9.]+ +([0-9]+) +(.*)", "i");
            var lines = body.split("\n");
            var state = "batch";
            var status;
            var statusText;
            for (var i = 0; i < lines.length; ++i) {
                var line = lines[i];
                switch (state) {
                    case "batch":
                        if (line.substr(0, header.length) === header) {
                            state = "batchHeaders";
                        }
                        else {
                            if (line.trim() !== "") {
                                throw new Error("Invalid response, line " + i);
                            }
                        }
                        break;
                    case "batchHeaders":
                        if (line.trim() === "") {
                            state = "status";
                        }
                        break;
                    case "status":
                        var parts = statusRegExp.exec(line);
                        if (parts.length !== 3) {
                            throw new Error("Invalid status, line " + i);
                        }
                        status = parseInt(parts[1], 10);
                        statusText = parts[2];
                        state = "statusHeaders";
                        break;
                    case "statusHeaders":
                        if (line.trim() === "") {
                            state = "body";
                        }
                        break;
                    case "body":
                        responses.push((status === 204) ? new Response() : new Response(line, { status: status, statusText: statusText }));
                        state = "batch";
                        break;
                }
            }
            if (state !== "status") {
                reject(new Error("Unexpected end of input"));
            }
            resolve(responses);
        });
    };
    SPBatch.prototype.executeImpl = function () {
        var _this = this;
        _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + this.batchId + "] (" + (new Date()).getTime() + ") Executing batch with " + this.requests.length + " requests.", 1 /* Info */);
        // if we don't have any requests, don't bother sending anything
        // this could be due to caching further upstream, or just an empty batch
        if (this.requests.length < 1) {
            _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("Resolving empty batch.", 1 /* Info */);
            return Promise.resolve();
        }
        // creating the client here allows the url to be populated for nodejs client as well as potentially
        // any other hacks needed for other types of clients. Essentially allows the absoluteRequestUrl
        // below to be correct
        var client = new SPHttpClient();
        // due to timing we need to get the absolute url here so we can use it for all the individual requests
        // and for sending the entire batch
        return toAbsoluteUrl(this.baseUrl).then(function (absoluteRequestUrl) {
            // build all the requests, send them, pipe results in order to parsers
            var batchBody = [];
            var currentChangeSetId = "";
            for (var i = 0; i < _this.requests.length; i++) {
                var reqInfo = _this.requests[i];
                if (reqInfo.method === "GET") {
                    if (currentChangeSetId.length > 0) {
                        // end an existing change set
                        batchBody.push("--changeset_" + currentChangeSetId + "--\n\n");
                        currentChangeSetId = "";
                    }
                    batchBody.push("--batch_" + _this.batchId + "\n");
                }
                else {
                    if (currentChangeSetId.length < 1) {
                        // start new change set
                        currentChangeSetId = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getGUID"])();
                        batchBody.push("--batch_" + _this.batchId + "\n");
                        batchBody.push("Content-Type: multipart/mixed; boundary=\"changeset_" + currentChangeSetId + "\"\n\n");
                    }
                    batchBody.push("--changeset_" + currentChangeSetId + "\n");
                }
                // common batch part prefix
                batchBody.push("Content-Type: application/http\n");
                batchBody.push("Content-Transfer-Encoding: binary\n\n");
                var headers = new Headers();
                // this is the url of the individual request within the batch
                var url = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["isUrlAbsolute"])(reqInfo.url) ? reqInfo.url : Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(absoluteRequestUrl, reqInfo.url);
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + _this.batchId + "] (" + (new Date()).getTime() + ") Adding request " + reqInfo.method + " " + url + " to batch.", 0 /* Verbose */);
                if (reqInfo.method !== "GET") {
                    var method = reqInfo.method;
                    var castHeaders = reqInfo.options.headers;
                    if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(reqInfo, "options") && Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(reqInfo.options, "headers") && castHeaders["X-HTTP-Method"] !== undefined) {
                        method = castHeaders["X-HTTP-Method"];
                        delete castHeaders["X-HTTP-Method"];
                    }
                    batchBody.push(method + " " + url + " HTTP/1.1\n");
                    headers.set("Content-Type", "application/json;odata=verbose;charset=utf-8");
                }
                else {
                    batchBody.push(reqInfo.method + " " + url + " HTTP/1.1\n");
                }
                // merge global config headers
                Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeHeaders"])(headers, SPRuntimeConfig.headers);
                // merge per-request headers
                if (reqInfo.options) {
                    Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["mergeHeaders"])(headers, reqInfo.options.headers);
                }
                // lastly we apply any default headers we need that may not exist
                if (!headers.has("Accept")) {
                    headers.append("Accept", "application/json");
                }
                if (!headers.has("Content-Type")) {
                    headers.append("Content-Type", "application/json;odata=verbose;charset=utf-8");
                }
                if (!headers.has("X-ClientService-ClientTag")) {
                    headers.append("X-ClientService-ClientTag", "PnPCoreJS:@pnp-1.2.1");
                }
                // write headers into batch body
                headers.forEach(function (value, name) {
                    batchBody.push(name + ": " + value + "\n");
                });
                batchBody.push("\n");
                if (reqInfo.options.body) {
                    batchBody.push(reqInfo.options.body + "\n\n");
                }
            }
            if (currentChangeSetId.length > 0) {
                // Close the changeset
                batchBody.push("--changeset_" + currentChangeSetId + "--\n\n");
                currentChangeSetId = "";
            }
            batchBody.push("--batch_" + _this.batchId + "--\n");
            var batchOptions = {
                "body": batchBody.join(""),
                "headers": {
                    "Content-Type": "multipart/mixed; boundary=batch_" + _this.batchId,
                },
                "method": "POST",
            };
            _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + _this.batchId + "] (" + (new Date()).getTime() + ") Sending batch request.", 1 /* Info */);
            return client.fetch(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])(absoluteRequestUrl, "/_api/$batch"), batchOptions)
                .then(function (r) { return r.text(); })
                .then(SPBatch.ParseResponse)
                .then(function (responses) {
                if (responses.length !== _this.requests.length) {
                    throw new Error("Could not properly parse responses to match requests in batch.");
                }
                _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + _this.batchId + "] (" + (new Date()).getTime() + ") Resolving batched requests.", 1 /* Info */);
                return responses.reduce(function (chain, response, index) {
                    var request = _this.requests[index];
                    _pnp_logging__WEBPACK_IMPORTED_MODULE_2__["Logger"].write("[" + request.id + "] (" + (new Date()).getTime() + ") Resolving request in batch " + _this.batchId + ".", 1 /* Info */);
                    return chain.then(function (_) { return request.parser.parse(response).then(request.resolve).catch(request.reject); });
                }, Promise.resolve());
            });
        });
    };
    return SPBatch;
}(_pnp_odata__WEBPACK_IMPORTED_MODULE_3__["ODataBatch"]));

/**
 * Page promotion state
 */
var PromotedState;
(function (PromotedState) {
    /**
     * Regular client side page
     */
    PromotedState[PromotedState["NotPromoted"] = 0] = "NotPromoted";
    /**
     * Page that will be promoted as news article after publishing
     */
    PromotedState[PromotedState["PromoteOnPublish"] = 1] = "PromoteOnPublish";
    /**
     * Page that is promoted as news article
     */
    PromotedState[PromotedState["Promoted"] = 2] = "Promoted";
})(PromotedState || (PromotedState = {}));
/**
 * Gets the next order value 1 based for the provided collection
 *
 * @param collection Collection of orderable things
 */
function getNextOrder(collection) {
    if (collection.length < 1) {
        return 1;
    }
    return Math.max.apply(null, collection.map(function (i) { return i.order; })) + 1;
}
/**
 * After https://stackoverflow.com/questions/273789/is-there-a-version-of-javascripts-string-indexof-that-allows-for-regular-expr/274094#274094
 *
 * @param this Types the called context this to a string in which the search will be conducted
 * @param regex A regex or string to match
 * @param startpos A starting position from which the search will begin
 */
function regexIndexOf(regex, startpos) {
    if (startpos === void 0) { startpos = 0; }
    var indexOf = this.substring(startpos).search(regex);
    return (indexOf >= 0) ? (indexOf + (startpos)) : indexOf;
}
/**
 * Finds bounded blocks of markup bounded by divs, ensuring to match the ending div even with nested divs in the interstitial markup
 *
 * @param html HTML to search
 * @param boundaryStartPattern The starting pattern to find, typically a div with attribute
 * @param collector A func to take the found block and provide a way to form it into a useful return that is added into the return array
 */
function getBoundedDivMarkup(html, boundaryStartPattern, collector) {
    var blocks = [];
    if (html === undefined || html === null) {
        return blocks;
    }
    // remove some extra whitespace if present
    var cleanedHtml = html.replace(/[\t\r\n]/g, "");
    // find the first div
    var startIndex = regexIndexOf.call(cleanedHtml, boundaryStartPattern);
    if (startIndex < 0) {
        // we found no blocks in the supplied html
        return blocks;
    }
    // this loop finds each of the blocks
    while (startIndex > -1) {
        // we have one open div counting from the one found above using boundaryStartPattern so we need to ensure we find it's close
        var openCounter = 1;
        var searchIndex = startIndex + 1;
        var nextDivOpen = -1;
        var nextCloseDiv = -1;
        // this loop finds the </div> tag that matches the opening of the control
        while (true) {
            // find both the next opening and closing div tags from our current searching index
            nextDivOpen = regexIndexOf.call(cleanedHtml, /<div[^>]*>/i, searchIndex);
            nextCloseDiv = regexIndexOf.call(cleanedHtml, /<\/div>/i, searchIndex);
            if (nextDivOpen < 0) {
                // we have no more opening divs, just set this to simplify checks below
                nextDivOpen = cleanedHtml.length + 1;
            }
            // determine which we found first, then increment or decrement our counter
            // and set the location to begin searching again
            if (nextDivOpen < nextCloseDiv) {
                openCounter++;
                searchIndex = nextDivOpen + 1;
            }
            else if (nextCloseDiv < nextDivOpen) {
                openCounter--;
                searchIndex = nextCloseDiv + 1;
            }
            // once we have no open divs back to the level of the opening control div
            // meaning we have all of the markup we intended to find
            if (openCounter === 0) {
                // get the bounded markup, +6 is the size of the ending </div> tag
                var markup = cleanedHtml.substring(startIndex, nextCloseDiv + 6).trim();
                // save the control data we found to the array
                blocks.push(collector(markup));
                // get out of our while loop
                break;
            }
            if (openCounter > 1000 || openCounter < 0) {
                // this is an arbitrary cut-off but likely we will not have 1000 nested divs
                // something has gone wrong above and we are probably stuck in our while loop
                // let's get out of our while loop and not hang everything
                throw new Error("getBoundedDivMarkup exceeded depth parameters.");
            }
        }
        // get the start of the next control
        startIndex = regexIndexOf.call(cleanedHtml, boundaryStartPattern, nextCloseDiv);
    }
    return blocks;
}
/**
 * Normalizes the order value for all the sections, columns, and controls to be 1 based and stepped (1, 2, 3...)
 *
 * @param collection The collection to normalize
 */
function reindex(collection) {
    for (var i = 0; i < collection.length; i++) {
        collection[i].order = i + 1;
        if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(collection[i], "columns")) {
            reindex(collection[i].columns);
        }
        else if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(collection[i], "controls")) {
            reindex(collection[i].controls);
        }
    }
}
/**
 * Represents the data and methods associated with client side "modern" pages
 */
var ClientSidePage = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ClientSidePage, _super);
    /**
     * Creates a new instance of the ClientSidePage class
     *
     * @param baseUrl The url or SharePointQueryable which forms the parent of this web collection
     * @param commentsDisabled Indicates if comments are disabled, not valid until load is called
     */
    function ClientSidePage(file, sections, commentsDisabled) {
        if (sections === void 0) { sections = []; }
        if (commentsDisabled === void 0) { commentsDisabled = false; }
        var _this = _super.call(this, file) || this;
        _this.sections = sections;
        _this.commentsDisabled = commentsDisabled;
        return _this;
    }
    /**
     * Creates a new blank page within the supplied library
     *
     * @param library The library in which to create the page
     * @param pageName Filename of the page, such as "page.aspx"
     * @param title The display title of the page
     * @param pageLayoutType Layout type of the page to use
     */
    ClientSidePage.create = function (library, pageName, title, pageLayoutType) {
        if (pageLayoutType === void 0) { pageLayoutType = "Article"; }
        // see if file exists, if not create it
        return library.rootFolder.files.select("Name").filter("Name eq '" + pageName + "'").get().then(function (fs) {
            if (fs.length > 0) {
                throw new Error("A file with the name '" + pageName + "' already exists in the library '" + library.toUrl() + "'.");
            }
            // get our server relative path
            return library.rootFolder.select("ServerRelativePath").get().then(function (path) {
                var pageServerRelPath = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["combine"])("/", path.ServerRelativePath.DecodedUrl, pageName);
                // add the template file
                return library.rootFolder.files.addTemplateFile(pageServerRelPath, TemplateFileType.ClientSidePage).then(function (far) {
                    // get the item associated with the file
                    return far.file.getItem().then(function (i) {
                        // update the item to have the correct values to create the client side page
                        return i.update({
                            BannerImageUrl: {
                                Url: "/_layouts/15/images/sitepagethumbnail.png",
                            },
                            CanvasContent1: "",
                            ClientSideApplicationId: "b6917cb1-93a0-4b97-a84d-7cf49975d4ec",
                            ContentTypeId: "0x0101009D1CB255DA76424F860D91F20E6C4118",
                            PageLayoutType: pageLayoutType,
                            PromotedState: 0 /* NotPromoted */,
                            Title: title,
                        }).then(function (iar) { return new ClientSidePage(iar.item.file, iar.item.CommentsDisabled); });
                    });
                });
            });
        });
    };
    /**
     * Creates a new ClientSidePage instance from the provided html content string
     *
     * @param html HTML markup representing the page
     */
    ClientSidePage.fromFile = function (file) {
        var page = new ClientSidePage(file);
        return page.load().then(function (_) { return page; });
    };
    /**
     * Converts a json object to an escaped string appropriate for use in attributes when storing client-side controls
     *
     * @param json The json object to encode into a string
     */
    ClientSidePage.jsonToEscapedString = function (json) {
        return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(json)
            .replace(/"/g, "&quot;")
            .replace(/:/g, "&#58;")
            .replace(/{/g, "&#123;")
            .replace(/}/g, "&#125;")
            .replace(/\[/g, "\[")
            .replace(/\]/g, "\]")
            .replace(/\./g, "\.");
    };
    /**
     * Converts an escaped string from a client-side control attribute to a json object
     *
     * @param escapedString
     */
    ClientSidePage.escapedStringToJson = function (escapedString) {
        var unespace = function (escaped) {
            var mapDict = [
                [/&quot;/g, "\""], [/&#58;/g, ":"], [/&#123;/g, "{"], [/&#125;/g, "}"],
                [/\\\\/g, "\\"], [/\\\?/g, "?"], [/\\\./g, "."], [/\\\[/g, "["], [/\\\]/g, "]"],
                [/\\\(/g, "("], [/\\\)/g, ")"], [/\\\|/g, "|"], [/\\\+/g, "+"],
            ];
            return mapDict.reduce(function (r, m) { return r.replace(m[0], m[1]); }, escaped);
        };
        return JSON.parse(unespace(escapedString));
    };
    /**
     * Add a section to this page
     */
    ClientSidePage.prototype.addSection = function () {
        var section = new CanvasSection(this, getNextOrder(this.sections));
        this.sections.push(section);
        return section;
    };
    /**
     * Converts this page's content to html markup
     */
    ClientSidePage.prototype.toHtml = function () {
        // trigger reindex of the entire tree
        reindex(this.sections);
        var html = [];
        html.push("<div>");
        for (var i = 0; i < this.sections.length; i++) {
            html.push(this.sections[i].toHtml());
        }
        html.push("</div>");
        return html.join("");
    };
    /**
     * Loads this page instance's content from the supplied html
     *
     * @param html html string representing the page's content
     */
    ClientSidePage.prototype.fromHtml = function (html) {
        var _this = this;
        // reset sections
        this.sections = [];
        // gather our controls from the supplied html
        getBoundedDivMarkup(html, /<div\b[^>]*data-sp-canvascontrol[^>]*?>/i, function (markup) {
            // get the control type
            var ct = /controlType&quot;&#58;(\d*?),/i.exec(markup);
            // if no control type is present this is a column which we give type 0 to let us process it
            var controlType = ct == null || ct.length < 2 ? 0 : parseInt(ct[1], 10);
            var control = null;
            switch (controlType) {
                case 0:
                    // empty canvas column
                    control = new CanvasColumn(null, 0);
                    control.fromHtml(markup);
                    _this.mergeColumnToTree(control);
                    break;
                case 3:
                    // client side webpart
                    control = new ClientSideWebpart("");
                    control.fromHtml(markup);
                    _this.mergePartToTree(control);
                    break;
                case 4:
                    // client side text
                    control = new ClientSideText();
                    control.fromHtml(markup);
                    _this.mergePartToTree(control);
                    break;
            }
        });
        // refresh all the orders within the tree
        reindex(this.sections);
        return this;
    };
    /**
     * Loads this page's content from the server
     */
    ClientSidePage.prototype.load = function () {
        var _this = this;
        return this.getItem("CanvasContent1", "CommentsDisabled").then(function (item) {
            _this.fromHtml(item.CanvasContent1);
            _this.commentsDisabled = item.CommentsDisabled;
        });
    };
    /**
     * Persists the content changes (sections, columns, and controls)
     */
    ClientSidePage.prototype.save = function () {
        return this.updateProperties({ CanvasContent1: this.toHtml() });
    };
    /**
     * Enables comments on this page
     */
    ClientSidePage.prototype.enableComments = function () {
        var _this = this;
        return this.setCommentsOn(true).then(function (r) {
            _this.commentsDisabled = false;
            return r;
        });
    };
    /**
     * Disables comments on this page
     */
    ClientSidePage.prototype.disableComments = function () {
        var _this = this;
        return this.setCommentsOn(false).then(function (r) {
            _this.commentsDisabled = true;
            return r;
        });
    };
    /**
     * Finds a control by the specified instance id
     *
     * @param id Instance id of the control to find
     */
    ClientSidePage.prototype.findControlById = function (id) {
        return this.findControl(function (c) { return c.id === id; });
    };
    /**
     * Finds a control within this page's control tree using the supplied predicate
     *
     * @param predicate Takes a control and returns true or false, if true that control is returned by findControl
     */
    ClientSidePage.prototype.findControl = function (predicate) {
        // check all sections
        for (var i = 0; i < this.sections.length; i++) {
            // check all columns
            for (var j = 0; j < this.sections[i].columns.length; j++) {
                // check all controls
                for (var k = 0; k < this.sections[i].columns[j].controls.length; k++) {
                    // check to see if the predicate likes this control
                    if (predicate(this.sections[i].columns[j].controls[k])) {
                        return this.sections[i].columns[j].controls[k];
                    }
                }
            }
        }
        // we found nothing so give nothing back
        return null;
    };
    /**
     * Sets the comments flag for a page
     *
     * @param on If true comments are enabled, false they are disabled
     */
    ClientSidePage.prototype.setCommentsOn = function (on) {
        return this.getItem().then(function (i) {
            var updater = new Item(i, "SetCommentsDisabled(" + !on + ")");
            return updater.update({});
        });
    };
    /**
     * Merges the control into the tree of sections and columns for this page
     *
     * @param control The control to merge
     */
    ClientSidePage.prototype.mergePartToTree = function (control) {
        var section = null;
        var column = null;
        var sections = this.sections.filter(function (s) { return s.order === control.controlData.position.zoneIndex; });
        if (sections.length < 1) {
            section = new CanvasSection(this, control.controlData.position.zoneIndex);
            this.sections.push(section);
        }
        else {
            section = sections[0];
        }
        var columns = section.columns.filter(function (c) { return c.order === control.controlData.position.sectionIndex; });
        if (columns.length < 1) {
            column = new CanvasColumn(section, control.controlData.position.sectionIndex, control.controlData.position.sectionFactor);
            section.columns.push(column);
        }
        else {
            column = columns[0];
        }
        control.column = column;
        column.addControl(control);
    };
    /**
     * Merges the supplied column into the tree
     *
     * @param column Column to merge
     * @param position The position data for the column
     */
    ClientSidePage.prototype.mergeColumnToTree = function (column) {
        var section = null;
        var sections = this.sections.filter(function (s) { return s.order === column.controlData.position.zoneIndex; });
        if (sections.length < 1) {
            section = new CanvasSection(this, column.controlData.position.zoneIndex);
            this.sections.push(section);
        }
        else {
            section = sections[0];
        }
        column.section = section;
        section.columns.push(column);
    };
    /**
     * Updates the properties of the underlying ListItem associated with this ClientSidePage
     *
     * @param properties Set of properties to update
     * @param eTag Value used in the IF-Match header, by default "*"
     */
    ClientSidePage.prototype.updateProperties = function (properties, eTag) {
        if (eTag === void 0) { eTag = "*"; }
        return this.getItem().then(function (i) { return i.update(properties, eTag); });
    };
    return ClientSidePage;
}(File));
var CanvasSection = /** @class */ (function () {
    function CanvasSection(page, order, columns) {
        if (columns === void 0) { columns = []; }
        this.page = page;
        this.order = order;
        this.columns = columns;
        this._memId = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getGUID"])();
    }
    Object.defineProperty(CanvasSection.prototype, "defaultColumn", {
        /**
         * Default column (this.columns[0]) for this section
         */
        get: function () {
            if (this.columns.length < 1) {
                this.addColumn(12);
            }
            return this.columns[0];
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Adds a new column to this section
     */
    CanvasSection.prototype.addColumn = function (factor) {
        var column = new CanvasColumn(this, getNextOrder(this.columns), factor);
        this.columns.push(column);
        return column;
    };
    /**
     * Adds a control to the default column for this section
     *
     * @param control Control to add to the default column
     */
    CanvasSection.prototype.addControl = function (control) {
        this.defaultColumn.addControl(control);
        return this;
    };
    CanvasSection.prototype.toHtml = function () {
        var html = [];
        for (var i = 0; i < this.columns.length; i++) {
            html.push(this.columns[i].toHtml());
        }
        return html.join("");
    };
    /**
     * Removes this section and all contained columns and controls from the collection
     */
    CanvasSection.prototype.remove = function () {
        var _this = this;
        this.page.sections = this.page.sections.filter(function (section) { return section._memId !== _this._memId; });
        reindex(this.page.sections);
    };
    return CanvasSection;
}());
var CanvasControl = /** @class */ (function () {
    function CanvasControl(controlType, dataVersion, column, order, id, controlData) {
        if (column === void 0) { column = null; }
        if (order === void 0) { order = 1; }
        if (id === void 0) { id = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getGUID"])(); }
        if (controlData === void 0) { controlData = null; }
        this.controlType = controlType;
        this.dataVersion = dataVersion;
        this.column = column;
        this.order = order;
        this.id = id;
        this.controlData = controlData;
    }
    Object.defineProperty(CanvasControl.prototype, "jsonData", {
        /**
         * Value of the control's "data-sp-controldata" attribute
         */
        get: function () {
            return ClientSidePage.jsonToEscapedString(this.getControlData());
        },
        enumerable: true,
        configurable: true
    });
    CanvasControl.prototype.fromHtml = function (html) {
        this.controlData = ClientSidePage.escapedStringToJson(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getAttrValueFromString"])(html, "data-sp-controldata"));
        this.dataVersion = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getAttrValueFromString"])(html, "data-sp-canvasdataversion");
        this.controlType = this.controlData.controlType;
        this.id = this.controlData.id;
    };
    return CanvasControl;
}());
var CanvasColumn = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(CanvasColumn, _super);
    function CanvasColumn(section, order, factor, controls, dataVersion) {
        if (factor === void 0) { factor = 12; }
        if (controls === void 0) { controls = []; }
        if (dataVersion === void 0) { dataVersion = "1.0"; }
        var _this = _super.call(this, 0, dataVersion) || this;
        _this.section = section;
        _this.order = order;
        _this.factor = factor;
        _this.controls = controls;
        return _this;
    }
    CanvasColumn.prototype.addControl = function (control) {
        control.column = this;
        this.controls.push(control);
        return this;
    };
    CanvasColumn.prototype.getControl = function (index) {
        return this.controls[index];
    };
    CanvasColumn.prototype.toHtml = function () {
        var html = [];
        if (this.controls.length < 1) {
            html.push("<div data-sp-canvascontrol=\"\" data-sp-canvasdataversion=\"" + this.dataVersion + "\" data-sp-controldata=\"" + this.jsonData + "\"></div>");
        }
        else {
            for (var i = 0; i < this.controls.length; i++) {
                html.push(this.controls[i].toHtml(i + 1));
            }
        }
        return html.join("");
    };
    CanvasColumn.prototype.fromHtml = function (html) {
        _super.prototype.fromHtml.call(this, html);
        this.controlData = ClientSidePage.escapedStringToJson(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getAttrValueFromString"])(html, "data-sp-controldata"));
        this.factor = this.controlData.position.sectionFactor;
        this.order = this.controlData.position.sectionIndex;
    };
    CanvasColumn.prototype.getControlData = function () {
        return {
            displayMode: 2,
            position: {
                sectionFactor: this.factor,
                sectionIndex: this.order,
                zoneIndex: this.section.order,
            },
        };
    };
    /**
     * Removes this column and all contained controls from the collection
     */
    CanvasColumn.prototype.remove = function () {
        var _this = this;
        this.section.columns = this.section.columns.filter(function (column) { return column.id !== _this.id; });
        reindex(this.column.controls);
    };
    return CanvasColumn;
}(CanvasControl));
/**
 * Abstract class with shared functionality for parts
 */
var ClientSidePart = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ClientSidePart, _super);
    function ClientSidePart() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Removes this column and all contained controls from the collection
     */
    ClientSidePart.prototype.remove = function () {
        var _this = this;
        this.column.controls = this.column.controls.filter(function (control) { return control.id !== _this.id; });
        reindex(this.column.controls);
    };
    return ClientSidePart;
}(CanvasControl));
var ClientSideText = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ClientSideText, _super);
    function ClientSideText(text) {
        if (text === void 0) { text = ""; }
        var _this = _super.call(this, 4, "1.0") || this;
        _this.text = text;
        return _this;
    }
    Object.defineProperty(ClientSideText.prototype, "text", {
        /**
         * The text markup of this control
         */
        get: function () {
            return this._text;
        },
        set: function (text) {
            if (!text.startsWith("<p>")) {
                text = "<p>" + text + "</p>";
            }
            this._text = text;
        },
        enumerable: true,
        configurable: true
    });
    ClientSideText.prototype.getControlData = function () {
        return {
            controlType: this.controlType,
            editorType: "CKEditor",
            id: this.id,
            position: {
                controlIndex: this.order,
                sectionFactor: this.column.factor,
                sectionIndex: this.column.order,
                zoneIndex: this.column.section.order,
            },
        };
    };
    ClientSideText.prototype.toHtml = function (index) {
        // set our order to the value passed in
        this.order = index;
        var html = [];
        html.push("<div data-sp-canvascontrol=\"\" data-sp-canvasdataversion=\"" + this.dataVersion + "\" data-sp-controldata=\"" + this.jsonData + "\">");
        html.push("<div data-sp-rte=\"\">");
        html.push("" + this.text);
        html.push("</div>");
        html.push("</div>");
        return html.join("");
    };
    ClientSideText.prototype.fromHtml = function (html) {
        var _this = this;
        _super.prototype.fromHtml.call(this, html);
        this.text = "";
        getBoundedDivMarkup(html, /<div[^>]*data-sp-rte[^>]*>/i, function (s) {
            // now we need to grab the inner text between the divs
            var match = /<div[^>]*data-sp-rte[^>]*>(.*?)<\/div>$/i.exec(s);
            _this.text = match.length > 1 ? match[1] : "";
        });
    };
    return ClientSideText;
}(ClientSidePart));
var ClientSideWebpart = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ClientSideWebpart, _super);
    function ClientSideWebpart(title, description, propertieJson, webPartId, htmlProperties, serverProcessedContent, canvasDataVersion) {
        if (description === void 0) { description = ""; }
        if (propertieJson === void 0) { propertieJson = {}; }
        if (webPartId === void 0) { webPartId = ""; }
        if (htmlProperties === void 0) { htmlProperties = ""; }
        if (serverProcessedContent === void 0) { serverProcessedContent = null; }
        if (canvasDataVersion === void 0) { canvasDataVersion = "1.0"; }
        var _this = _super.call(this, 3, "1.0") || this;
        _this.title = title;
        _this.description = description;
        _this.propertieJson = propertieJson;
        _this.webPartId = webPartId;
        _this.htmlProperties = htmlProperties;
        _this.serverProcessedContent = serverProcessedContent;
        _this.canvasDataVersion = canvasDataVersion;
        return _this;
    }
    ClientSideWebpart.fromComponentDef = function (definition) {
        var part = new ClientSideWebpart("");
        part.import(definition);
        return part;
    };
    ClientSideWebpart.prototype.import = function (component) {
        this.webPartId = component.Id.replace(/^\{|\}$/g, "").toLowerCase();
        var manifest = JSON.parse(component.Manifest);
        this.title = manifest.preconfiguredEntries[0].title.default;
        this.description = manifest.preconfiguredEntries[0].description.default;
        this.dataVersion = "";
        this.propertieJson = this.parseJsonProperties(manifest.preconfiguredEntries[0].properties);
    };
    ClientSideWebpart.prototype.setProperties = function (properties) {
        this.propertieJson = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(this.propertieJson, properties);
        return this;
    };
    ClientSideWebpart.prototype.getProperties = function () {
        return this.propertieJson;
    };
    ClientSideWebpart.prototype.toHtml = function (index) {
        // set our order to the value passed in
        this.order = index;
        // will form the value of the data-sp-webpartdata attribute
        var data = {
            dataVersion: this.dataVersion,
            description: this.description,
            id: this.webPartId,
            instanceId: this.id,
            properties: this.propertieJson,
            serverProcessedContent: this.serverProcessedContent,
            title: this.title,
        };
        var html = [];
        html.push("<div data-sp-canvascontrol=\"\" data-sp-canvasdataversion=\"" + this.canvasDataVersion + "\" data-sp-controldata=\"" + this.jsonData + "\">");
        html.push("<div data-sp-webpart=\"\" data-sp-webpartdataversion=\"" + this.dataVersion + "\" data-sp-webpartdata=\"" + ClientSidePage.jsonToEscapedString(data) + "\">");
        html.push("<div data-sp-componentid>");
        html.push(this.webPartId);
        html.push("</div>");
        html.push("<div data-sp-htmlproperties=\"\">");
        html.push(this.renderHtmlProperties());
        html.push("</div>");
        html.push("</div>");
        html.push("</div>");
        return html.join("");
    };
    ClientSideWebpart.prototype.fromHtml = function (html) {
        _super.prototype.fromHtml.call(this, html);
        var webPartData = ClientSidePage.escapedStringToJson(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getAttrValueFromString"])(html, "data-sp-webpartdata"));
        this.title = webPartData.title;
        this.description = webPartData.description;
        this.webPartId = webPartData.id;
        this.canvasDataVersion = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getAttrValueFromString"])(html, "data-sp-canvasdataversion").replace(/\\\./, ".");
        this.dataVersion = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getAttrValueFromString"])(html, "data-sp-webpartdataversion").replace(/\\\./, ".");
        this.setProperties(webPartData.properties);
        if (webPartData.serverProcessedContent !== undefined) {
            this.serverProcessedContent = webPartData.serverProcessedContent;
        }
        // get our html properties
        var htmlProps = getBoundedDivMarkup(html, /<div\b[^>]*data-sp-htmlproperties[^>]*?>/i, function (markup) {
            return markup.replace(/^<div\b[^>]*data-sp-htmlproperties[^>]*?>/i, "").replace(/<\/div>$/i, "");
        });
        this.htmlProperties = htmlProps.length > 0 ? htmlProps[0] : "";
    };
    ClientSideWebpart.prototype.getControlData = function () {
        return {
            controlType: this.controlType,
            id: this.id,
            position: {
                controlIndex: this.order,
                sectionFactor: this.column.factor,
                sectionIndex: this.column.order,
                zoneIndex: this.column.section.order,
            },
            webPartId: this.webPartId,
        };
    };
    ClientSideWebpart.prototype.renderHtmlProperties = function () {
        var html = [];
        if (this.serverProcessedContent === undefined || this.serverProcessedContent === null) {
            html.push(this.htmlProperties);
        }
        else if (this.serverProcessedContent !== undefined) {
            if (this.serverProcessedContent.searchablePlainTexts !== undefined) {
                var keys = Object.keys(this.serverProcessedContent.searchablePlainTexts);
                for (var i = 0; i < keys.length; i++) {
                    html.push("<div data-sp-prop-name=\"" + keys[i] + "\" data-sp-searchableplaintext=\"true\">");
                    html.push(this.serverProcessedContent.searchablePlainTexts[keys[i]]);
                    html.push("</div>");
                }
            }
            if (this.serverProcessedContent.imageSources !== undefined) {
                var keys = Object.keys(this.serverProcessedContent.imageSources);
                for (var i = 0; i < keys.length; i++) {
                    html.push("<img data-sp-prop-name=\"" + keys[i] + "\" src=\"" + this.serverProcessedContent.imageSources[keys[i]] + "\" />");
                }
            }
            if (this.serverProcessedContent.links !== undefined) {
                var keys = Object.keys(this.serverProcessedContent.links);
                for (var i = 0; i < keys.length; i++) {
                    html.push("<a data-sp-prop-name=\"" + keys[i] + "\" href=\"" + this.serverProcessedContent.links[keys[i]] + "\"></a>");
                }
            }
        }
        return html.join("");
    };
    ClientSideWebpart.prototype.parseJsonProperties = function (props) {
        // If the web part has the serverProcessedContent property then keep this one as it might be needed as input to render the web part HTML later on
        if (props.webPartData !== undefined && props.webPartData.serverProcessedContent !== undefined) {
            this.serverProcessedContent = props.webPartData.serverProcessedContent;
        }
        else if (props.serverProcessedContent !== undefined) {
            this.serverProcessedContent = props.serverProcessedContent;
        }
        else {
            this.serverProcessedContent = null;
        }
        if (props.webPartData !== undefined && props.webPartData.properties !== undefined) {
            return props.webPartData.properties;
        }
        else if (props.properties !== undefined) {
            return props.properties;
        }
        else {
            return props;
        }
    };
    return ClientSideWebpart;
}(ClientSidePart));

/**
 * Represents a collection of navigation nodes
 *
 */
var NavigationNodes = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(NavigationNodes, _super);
    function NavigationNodes() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Gets a navigation node by id
     *
     * @param id The id of the node
     */
    NavigationNodes.prototype.getById = function (id) {
        var node = new NavigationNode(this);
        node.concat("(" + id + ")");
        return node;
    };
    /**
     * Adds a new node to the collection
     *
     * @param title Display name of the node
     * @param url The url of the node
     * @param visible If true the node is visible, otherwise it is hidden (default: true)
     */
    NavigationNodes.prototype.add = function (title, url, visible) {
        var _this = this;
        if (visible === void 0) { visible = true; }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.NavigationNode"), {
            IsVisible: visible,
            Title: title,
            Url: url,
        }));
        return this.clone(NavigationNodes, null).postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                node: _this.getById(data.Id),
            };
        });
    };
    /**
     * Moves a node to be after another node in the navigation
     *
     * @param nodeId Id of the node to move
     * @param previousNodeId Id of the node after which we move the node specified by nodeId
     */
    NavigationNodes.prototype.moveAfter = function (nodeId, previousNodeId) {
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            nodeId: nodeId,
            previousNodeId: previousNodeId,
        });
        return this.clone(NavigationNodes, "MoveAfter").postCore({ body: postBody });
    };
    return NavigationNodes;
}(SharePointQueryableCollection));
/**
 * Represents an instance of a navigation node
 *
 */
var NavigationNode = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(NavigationNode, _super);
    function NavigationNode() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(NavigationNode.prototype, "children", {
        /**
         * Represents the child nodes of this node
         */
        get: function () {
            return new NavigationNodes(this, "Children");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Deletes this node and any child nodes
     */
    NavigationNode.prototype.delete = function () {
        return _super.prototype.deleteCore.call(this);
    };
    return NavigationNode;
}(SharePointQueryableInstance));
/**
 * Exposes the navigation components
 *
 */
var Navigation = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Navigation, _super);
    function Navigation() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(Navigation.prototype, "quicklaunch", {
        /**
         * Gets the quicklaunch navigation nodes for the current context
         *
         */
        get: function () {
            return new NavigationNodes(this, "quicklaunch");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Navigation.prototype, "topNavigationBar", {
        /**
         * Gets the top bar navigation nodes for the current context
         *
         */
        get: function () {
            return new NavigationNodes(this, "topnavigationbar");
        },
        enumerable: true,
        configurable: true
    });
    Navigation = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("navigation")
    ], Navigation);
    return Navigation;
}(SharePointQueryable));
/**
 * Represents the top level navigation service
 */
var NavigationService = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(NavigationService, _super);
    function NavigationService(path) {
        if (path === void 0) { path = null; }
        return _super.call(this, "_api/navigation", path) || this;
    }
    /**
     * The MenuState service operation returns a Menu-State (dump) of a SiteMapProvider on a site.
     *
     * @param menuNodeKey MenuNode.Key of the start node within the SiteMapProvider If no key is provided the SiteMapProvider.RootNode will be the root of the menu state.
     * @param depth Depth of the dump. If no value is provided a dump with the depth of 10 is returned
     * @param mapProviderName The name identifying the SiteMapProvider to be used
     * @param customProperties comma seperated list of custom properties to be returned.
     */
    NavigationService.prototype.getMenuState = function (menuNodeKey, depth, mapProviderName, customProperties) {
        if (menuNodeKey === void 0) { menuNodeKey = null; }
        if (depth === void 0) { depth = 10; }
        if (mapProviderName === void 0) { mapProviderName = null; }
        if (customProperties === void 0) { customProperties = null; }
        return (new NavigationService("MenuState")).postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                customProperties: customProperties,
                depth: depth,
                mapProviderName: mapProviderName,
                menuNodeKey: menuNodeKey,
            }),
        });
    };
    /**
     * Tries to get a SiteMapNode.Key for a given URL within a site collection.
     *
     * @param currentUrl A url representing the SiteMapNode
     * @param mapProviderName The name identifying the SiteMapProvider to be used
     */
    NavigationService.prototype.getMenuNodeKey = function (currentUrl, mapProviderName) {
        if (mapProviderName === void 0) { mapProviderName = null; }
        return (new NavigationService("MenuNodeKey")).postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                currentUrl: currentUrl,
                mapProviderName: mapProviderName,
            }),
        });
    };
    return NavigationService;
}(SharePointQueryable));

/**
 * Describes regional settings ODada object
 */
var RegionalSettings = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(RegionalSettings, _super);
    function RegionalSettings() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(RegionalSettings.prototype, "installedLanguages", {
        /**
         * Gets the collection of languages used in a server farm.
         */
        get: function () {
            return new InstalledLanguages(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RegionalSettings.prototype, "globalInstalledLanguages", {
        /**
         * Gets the collection of language packs that are installed on the server.
         */
        get: function () {
            return new InstalledLanguages(this, "globalinstalledlanguages");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RegionalSettings.prototype, "timeZone", {
        /**
         * Gets time zone
         */
        get: function () {
            return new TimeZone(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RegionalSettings.prototype, "timeZones", {
        /**
         * Gets time zones
         */
        get: function () {
            return new TimeZones(this);
        },
        enumerable: true,
        configurable: true
    });
    RegionalSettings = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("regionalsettings")
    ], RegionalSettings);
    return RegionalSettings;
}(SharePointQueryableInstance));
/**
 * Describes installed languages ODada queriable collection
 */
var InstalledLanguages = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(InstalledLanguages, _super);
    function InstalledLanguages() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    InstalledLanguages = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("installedlanguages")
    ], InstalledLanguages);
    return InstalledLanguages;
}(SharePointQueryableCollection));
/**
 * Describes TimeZone ODada object
 */
var TimeZone = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(TimeZone, _super);
    function TimeZone() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TimeZone_1 = TimeZone;
    /**
     * Gets an Local Time by UTC Time
     *
     * @param utcTime UTC Time as Date or ISO String
     */
    TimeZone.prototype.utcToLocalTime = function (utcTime) {
        var dateIsoString;
        if (typeof utcTime === "string") {
            dateIsoString = utcTime;
        }
        else {
            dateIsoString = utcTime.toISOString();
        }
        return this.clone(TimeZone_1, "utctolocaltime('" + dateIsoString + "')")
            .postCore()
            .then(function (res) { return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(res, "UTCToLocalTime") ? res.UTCToLocalTime : res; });
    };
    /**
     * Gets an UTC Time by Local Time
     *
     * @param localTime Local Time as Date or ISO String
     */
    TimeZone.prototype.localTimeToUTC = function (localTime) {
        var dateIsoString;
        if (typeof localTime === "string") {
            dateIsoString = localTime;
        }
        else {
            dateIsoString = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["dateAdd"])(localTime, "minute", localTime.getTimezoneOffset() * -1).toISOString();
        }
        return this.clone(TimeZone_1, "localtimetoutc('" + dateIsoString + "')")
            .postCore()
            .then(function (res) { return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(res, "LocalTimeToUTC") ? res.LocalTimeToUTC : res; });
    };
    var TimeZone_1;
    TimeZone = TimeZone_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("timezone")
    ], TimeZone);
    return TimeZone;
}(SharePointQueryableInstance));
/**
 * Describes time zones queriable collection
 */
var TimeZones = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(TimeZones, _super);
    function TimeZones() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TimeZones_1 = TimeZones;
    // https://msdn.microsoft.com/en-us/library/office/jj247008.aspx - timezones ids
    /**
     * Gets an TimeZone by id
     *
     * @param id The integer id of the timezone to retrieve
     */
    TimeZones.prototype.getById = function (id) {
        // do the post and merge the result into a TimeZone instance so the data and methods are available
        return this.clone(TimeZones_1, "GetById(" + id + ")").postCore({}, spODataEntity(TimeZone));
    };
    var TimeZones_1;
    TimeZones = TimeZones_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("timezones")
    ], TimeZones);
    return TimeZones;
}(SharePointQueryableCollection));

var funcs = new Map([
    ["text", "Querytext"],
    ["template", "QueryTemplate"],
    ["sourceId", "SourceId"],
    ["trimDuplicatesIncludeId", ""],
    ["startRow", ""],
    ["rowLimit", ""],
    ["rankingModelId", ""],
    ["rowsPerPage", ""],
    ["selectProperties", ""],
    ["culture", ""],
    ["timeZoneId", ""],
    ["refinementFilters", ""],
    ["refiners", ""],
    ["hiddenConstraints", ""],
    ["sortList", ""],
    ["timeout", ""],
    ["hithighlightedProperties", ""],
    ["clientType", ""],
    ["personalizationData", ""],
    ["resultsURL", ""],
    ["queryTag", ""],
    ["properties", ""],
    ["queryTemplatePropertiesUrl", ""],
    ["reorderingRules", ""],
    ["hitHighlightedMultivaluePropertyLimit", ""],
    ["collapseSpecification", ""],
    ["uiLanguage", ""],
    ["desiredSnippetLength", ""],
    ["maxSnippetLength", ""],
    ["summaryLength", ""],
]);
var props = new Map([]);
function toPropCase(str) {
    return str.replace(/^(.)/, function ($1) { return $1.toUpperCase(); });
}
/**
 * Creates a new instance of the SearchQueryBuilder
 *
 * @param queryText Initial query text
 * @param _query Any initial query configuration
 */
function SearchQueryBuilder(queryText, _query) {
    if (queryText === void 0) { queryText = ""; }
    if (_query === void 0) { _query = {}; }
    return new Proxy({
        query: Object.assign({
            Querytext: queryText,
        }, _query),
    }, {
        get: function (self, propertyKey, proxy) {
            var pk = propertyKey.toString();
            if (pk === "toSearchQuery") {
                return function () { return self.query; };
            }
            if (funcs.has(pk)) {
                return function () {
                    var value = [];
                    for (var _i = 0; _i < arguments.length; _i++) {
                        value[_i] = arguments[_i];
                    }
                    var mappedPk = funcs.get(pk);
                    self.query[mappedPk.length > 0 ? mappedPk : toPropCase(pk)] = value.length > 1 ? value : value[0];
                    return proxy;
                };
            }
            var propKey = props.has(pk) ? props.get(pk) : toPropCase(pk);
            self.query[propKey] = true;
            return proxy;
        },
    });
}
/**
 * Describes the search API
 *
 */
var Search = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Search, _super);
    function Search() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * @returns Promise
     */
    Search.prototype.execute = function (queryInit) {
        var _this = this;
        var query = this.parseQuery(queryInit);
        var formattedBody;
        formattedBody = query;
        if (formattedBody.SelectProperties) {
            formattedBody.SelectProperties = this.fixupProp(query.SelectProperties);
        }
        if (formattedBody.RefinementFilters) {
            formattedBody.RefinementFilters = this.fixupProp(query.RefinementFilters);
        }
        if (formattedBody.SortList) {
            formattedBody.SortList = this.fixupProp(query.SortList);
        }
        if (formattedBody.HithighlightedProperties) {
            formattedBody.HithighlightedProperties = this.fixupProp(query.HitHighlightedProperties);
        }
        if (formattedBody.ReorderingRules) {
            formattedBody.ReorderingRules = this.fixupProp(query.ReorderingRules);
        }
        if (formattedBody.Properties) {
            formattedBody.Properties = this.fixupProp(query.Properties);
        }
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            request: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("Microsoft.Office.Server.Search.REST.SearchRequest"), formattedBody),
        });
        // if we are using caching with this search request, then we need to handle some work upfront to enable that
        if (this._useCaching) {
            // force use of the cache for this request if .usingCaching was called
            this._forceCaching = true;
            // because all the requests use the same url they would collide in the cache we use a special key
            var cacheKey = "PnPjs.SearchWithCaching(" + Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["getHashCode"])(postBody) + ")";
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["objectDefinedNotNull"])(this._cachingOptions)) {
                // if our key ends in the postquery url we overwrite it
                if (/\/_api\/search\/postquery$/i.test(this._cachingOptions.key)) {
                    this._cachingOptions.key = cacheKey;
                }
            }
            else {
                this._cachingOptions = new _pnp_odata__WEBPACK_IMPORTED_MODULE_3__["CachingOptions"](cacheKey);
            }
        }
        return this.postCore({ body: postBody }).then(function (data) { return new SearchResults(data, _this.toUrl(), query); });
    };
    /**
     * Fixes up properties that expect to consist of a "results" collection when needed
     *
     * @param prop property to fixup for container struct
     */
    Search.prototype.fixupProp = function (prop) {
        return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(prop, "results") ? prop : { results: prop };
    };
    /**
     * Translates one of the query initializers into a SearchQuery instance
     *
     * @param query
     */
    Search.prototype.parseQuery = function (query) {
        var finalQuery;
        if (typeof query === "string") {
            finalQuery = { Querytext: query };
        }
        else if (query.toSearchQuery) {
            finalQuery = query.toSearchQuery();
        }
        else {
            finalQuery = query;
        }
        return finalQuery;
    };
    Search = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/search/postquery")
    ], Search);
    return Search;
}(SharePointQueryableInstance));
/**
 * Describes the SearchResults class, which returns the formatted and raw version of the query response
 */
var SearchResults = /** @class */ (function () {
    /**
     * Creates a new instance of the SearchResult class
     *
     */
    function SearchResults(rawResponse, _url, _query, _raw, _primary) {
        if (_raw === void 0) { _raw = null; }
        if (_primary === void 0) { _primary = null; }
        this._url = _url;
        this._query = _query;
        this._raw = _raw;
        this._primary = _primary;
        this._raw = rawResponse.postquery ? rawResponse.postquery : rawResponse;
    }
    Object.defineProperty(SearchResults.prototype, "ElapsedTime", {
        get: function () {
            return this.RawSearchResults.ElapsedTime;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchResults.prototype, "RowCount", {
        get: function () {
            return this.RawSearchResults.PrimaryQueryResult.RelevantResults.RowCount;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchResults.prototype, "TotalRows", {
        get: function () {
            return this.RawSearchResults.PrimaryQueryResult.RelevantResults.TotalRows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchResults.prototype, "TotalRowsIncludingDuplicates", {
        get: function () {
            return this.RawSearchResults.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchResults.prototype, "RawSearchResults", {
        get: function () {
            return this._raw;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SearchResults.prototype, "PrimarySearchResults", {
        get: function () {
            if (this._primary === null) {
                this._primary = this.formatSearchResults(this._raw.PrimaryQueryResult.RelevantResults.Table.Rows);
            }
            return this._primary;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets a page of results
     *
     * @param pageNumber Index of the page to return. Used to determine StartRow
     * @param pageSize Optional, items per page (default = 10)
     */
    SearchResults.prototype.getPage = function (pageNumber, pageSize) {
        // if we got all the available rows we don't have another page
        if (this.TotalRows < this.RowCount) {
            return Promise.resolve(null);
        }
        // if pageSize is supplied, then we use that regardless of any previous values
        // otherwise get the previous RowLimit or default to 10
        var rows = pageSize !== undefined ? pageSize : Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(this._query, "RowLimit") ? this._query.RowLimit : 10;
        var query = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(this._query, {
            RowLimit: rows,
            StartRow: rows * (pageNumber - 1),
        });
        // we have reached the end
        if (query.StartRow > this.TotalRows) {
            return Promise.resolve(null);
        }
        var search = new Search(this._url, null);
        return search.execute(query);
    };
    /**
     * Formats a search results array
     *
     * @param rawResults The array to process
     */
    SearchResults.prototype.formatSearchResults = function (rawResults) {
        var results = new Array();
        var tempResults = rawResults.results ? rawResults.results : rawResults;
        for (var _i = 0, tempResults_1 = tempResults; _i < tempResults_1.length; _i++) {
            var tempResult = tempResults_1[_i];
            var cells = tempResult.Cells.results ? tempResult.Cells.results : tempResult.Cells;
            results.push(cells.reduce(function (res, cell) {
                Object.defineProperty(res, cell.Key, {
                    configurable: false,
                    enumerable: true,
                    value: cell.Value,
                    writable: false,
                });
                return res;
            }, {}));
        }
        return results;
    };
    return SearchResults;
}());
/**
 * defines the SortDirection enum
 */
var SortDirection;
(function (SortDirection) {
    SortDirection[SortDirection["Ascending"] = 0] = "Ascending";
    SortDirection[SortDirection["Descending"] = 1] = "Descending";
    SortDirection[SortDirection["FQLFormula"] = 2] = "FQLFormula";
})(SortDirection || (SortDirection = {}));
/**
 * defines the ReorderingRuleMatchType  enum
 */
var ReorderingRuleMatchType;
(function (ReorderingRuleMatchType) {
    ReorderingRuleMatchType[ReorderingRuleMatchType["ResultContainsKeyword"] = 0] = "ResultContainsKeyword";
    ReorderingRuleMatchType[ReorderingRuleMatchType["TitleContainsKeyword"] = 1] = "TitleContainsKeyword";
    ReorderingRuleMatchType[ReorderingRuleMatchType["TitleMatchesKeyword"] = 2] = "TitleMatchesKeyword";
    ReorderingRuleMatchType[ReorderingRuleMatchType["UrlStartsWith"] = 3] = "UrlStartsWith";
    ReorderingRuleMatchType[ReorderingRuleMatchType["UrlExactlyMatches"] = 4] = "UrlExactlyMatches";
    ReorderingRuleMatchType[ReorderingRuleMatchType["ContentTypeIs"] = 5] = "ContentTypeIs";
    ReorderingRuleMatchType[ReorderingRuleMatchType["FileExtensionMatches"] = 6] = "FileExtensionMatches";
    ReorderingRuleMatchType[ReorderingRuleMatchType["ResultHasTag"] = 7] = "ResultHasTag";
    ReorderingRuleMatchType[ReorderingRuleMatchType["ManualCondition"] = 8] = "ManualCondition";
})(ReorderingRuleMatchType || (ReorderingRuleMatchType = {}));
/**
 * Specifies the type value for the property
 */
var QueryPropertyValueType;
(function (QueryPropertyValueType) {
    QueryPropertyValueType[QueryPropertyValueType["None"] = 0] = "None";
    QueryPropertyValueType[QueryPropertyValueType["StringType"] = 1] = "StringType";
    QueryPropertyValueType[QueryPropertyValueType["Int32Type"] = 2] = "Int32Type";
    QueryPropertyValueType[QueryPropertyValueType["BooleanType"] = 3] = "BooleanType";
    QueryPropertyValueType[QueryPropertyValueType["StringArrayType"] = 4] = "StringArrayType";
    QueryPropertyValueType[QueryPropertyValueType["UnSupportedType"] = 5] = "UnSupportedType";
})(QueryPropertyValueType || (QueryPropertyValueType = {}));
var SearchBuiltInSourceId = /** @class */ (function () {
    function SearchBuiltInSourceId() {
    }
    SearchBuiltInSourceId.Documents = "e7ec8cee-ded8-43c9-beb5-436b54b31e84";
    SearchBuiltInSourceId.ItemsMatchingContentType = "5dc9f503-801e-4ced-8a2c-5d1237132419";
    SearchBuiltInSourceId.ItemsMatchingTag = "e1327b9c-2b8c-4b23-99c9-3730cb29c3f7";
    SearchBuiltInSourceId.ItemsRelatedToCurrentUser = "48fec42e-4a92-48ce-8363-c2703a40e67d";
    SearchBuiltInSourceId.ItemsWithSameKeywordAsThisItem = "5c069288-1d17-454a-8ac6-9c642a065f48";
    SearchBuiltInSourceId.LocalPeopleResults = "b09a7990-05ea-4af9-81ef-edfab16c4e31";
    SearchBuiltInSourceId.LocalReportsAndDataResults = "203fba36-2763-4060-9931-911ac8c0583b";
    SearchBuiltInSourceId.LocalSharePointResults = "8413cd39-2156-4e00-b54d-11efd9abdb89";
    SearchBuiltInSourceId.LocalVideoResults = "78b793ce-7956-4669-aa3b-451fc5defebf";
    SearchBuiltInSourceId.Pages = "5e34578e-4d08-4edc-8bf3-002acf3cdbcc";
    SearchBuiltInSourceId.Pictures = "38403c8c-3975-41a8-826e-717f2d41568a";
    SearchBuiltInSourceId.Popular = "97c71db1-58ce-4891-8b64-585bc2326c12";
    SearchBuiltInSourceId.RecentlyChangedItems = "ba63bbae-fa9c-42c0-b027-9a878f16557c";
    SearchBuiltInSourceId.RecommendedItems = "ec675252-14fa-4fbe-84dd-8d098ed74181";
    SearchBuiltInSourceId.Wiki = "9479bf85-e257-4318-b5a8-81a180f5faa1";
    return SearchBuiltInSourceId;
}());

var SearchSuggest = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SearchSuggest, _super);
    function SearchSuggest() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SearchSuggest.prototype.execute = function (query) {
        this.mapQueryToQueryString(query);
        return this.get().then(function (response) {
            var mapper = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(response, "suggest") ? function (s) { return response.suggest[s].results; } : function (s) { return response[s]; };
            return {
                PeopleNames: mapper("PeopleNames"),
                PersonalResults: mapper("PersonalResults"),
                Queries: mapper("Queries"),
            };
        });
    };
    SearchSuggest.prototype.mapQueryToQueryString = function (query) {
        var _this = this;
        var setProp = function (q) { return function (checkProp) { return function (sp) {
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(q, checkProp)) {
                _this.query.set(sp, q[checkProp].toString());
            }
        }; }; };
        this.query.set("querytext", "'" + query.querytext + "'");
        var querySetter = setProp(query);
        querySetter("count")("inumberofquerysuggestions");
        querySetter("personalCount")("inumberofresultsuggestions");
        querySetter("preQuery")("fprequerysuggestions");
        querySetter("hitHighlighting")("fhithighlighting");
        querySetter("capitalize")("fcapitalizefirstletters");
        querySetter("culture")("culture");
        querySetter("stemming")("enablestemming");
        querySetter("includePeople")("showpeoplenamesuggestions");
        querySetter("queryRules")("enablequeryrules");
        querySetter("prefixMatch")("fprefixmatchallterms");
    };
    SearchSuggest = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/search/suggest")
    ], SearchSuggest);
    return SearchSuggest;
}(SharePointQueryableInstance));

/**
 * Describes a collection of List objects
 *
 */
var Features = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Features, _super);
    function Features() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Features_1 = Features;
    /**
     * Adds a new list to the collection
     *
     * @param id The Id of the feature (GUID)
     * @param force If true the feature activation will be forced
     */
    Features.prototype.add = function (id, force) {
        var _this = this;
        if (force === void 0) { force = false; }
        return this.clone(Features_1, "add").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                featdefScope: 0,
                featureId: id,
                force: force,
            }),
        }).then(function (data) {
            return {
                data: data,
                feature: _this.getById(id),
            };
        });
    };
    /**
     * Gets a list from the collection by guid id
     *
     * @param id The Id of the feature (GUID)
     */
    Features.prototype.getById = function (id) {
        var feature = new Feature(this);
        feature.concat("('" + id + "')");
        return feature;
    };
    /**
     * Removes (deactivates) a feature from the collection
     *
     * @param id The Id of the feature (GUID)
     * @param force If true the feature deactivation will be forced
     */
    Features.prototype.remove = function (id, force) {
        if (force === void 0) { force = false; }
        return this.clone(Features_1, "remove").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                featureId: id,
                force: force,
            }),
        });
    };
    var Features_1;
    Features = Features_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("features")
    ], Features);
    return Features;
}(SharePointQueryableCollection));
var Feature = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Feature, _super);
    function Feature() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * Removes (deactivates) a feature from the collection
     *
     * @param force If true the feature deactivation will be forced
     */
    Feature.prototype.deactivate = function (force) {
        var _this = this;
        if (force === void 0) { force = false; }
        var removeDependency = this.addBatchDependency();
        var idGet = new Feature(this).select("DefinitionId");
        return idGet.get().then(function (feature) {
            var promise = _this.getParent(Features, _this.parentUrl, "", _this.batch).remove(feature.DefinitionId, force);
            removeDependency();
            return promise;
        });
    };
    return Feature;
}(SharePointQueryableInstance));

var RelatedItemManagerImpl = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(RelatedItemManagerImpl, _super);
    function RelatedItemManagerImpl() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RelatedItemManagerImpl_1 = RelatedItemManagerImpl;
    RelatedItemManagerImpl.FromUrl = function (url) {
        if (url === null) {
            return new RelatedItemManagerImpl_1("");
        }
        var index = url.indexOf("_api/");
        if (index > -1) {
            return new RelatedItemManagerImpl_1(url.substr(0, index));
        }
        return new RelatedItemManagerImpl_1(url);
    };
    RelatedItemManagerImpl.prototype.getRelatedItems = function (sourceListName, sourceItemId) {
        var query = this.clone(RelatedItemManagerImpl_1, null);
        query.concat(".GetRelatedItems");
        return query.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                SourceItemID: sourceItemId,
                SourceListName: sourceListName,
            }),
        });
    };
    RelatedItemManagerImpl.prototype.getPageOneRelatedItems = function (sourceListName, sourceItemId) {
        var query = this.clone(RelatedItemManagerImpl_1, null);
        query.concat(".GetPageOneRelatedItems");
        return query.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                SourceItemID: sourceItemId,
                SourceListName: sourceListName,
            }),
        });
    };
    RelatedItemManagerImpl.prototype.addSingleLink = function (sourceListName, sourceItemId, sourceWebUrl, targetListName, targetItemID, targetWebUrl, tryAddReverseLink) {
        if (tryAddReverseLink === void 0) { tryAddReverseLink = false; }
        var query = this.clone(RelatedItemManagerImpl_1, null);
        query.concat(".AddSingleLink");
        return query.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                SourceItemID: sourceItemId,
                SourceListName: sourceListName,
                SourceWebUrl: sourceWebUrl,
                TargetItemID: targetItemID,
                TargetListName: targetListName,
                TargetWebUrl: targetWebUrl,
                TryAddReverseLink: tryAddReverseLink,
            }),
        });
    };
    /**
     * Adds a related item link from an item specified by list name and item id, to an item specified by url
     *
     * @param sourceListName The source list name or list id
     * @param sourceItemId The source item id
     * @param targetItemUrl The target item url
     * @param tryAddReverseLink If set to true try to add the reverse link (will not return error if it fails)
     */
    RelatedItemManagerImpl.prototype.addSingleLinkToUrl = function (sourceListName, sourceItemId, targetItemUrl, tryAddReverseLink) {
        if (tryAddReverseLink === void 0) { tryAddReverseLink = false; }
        var query = this.clone(RelatedItemManagerImpl_1, null);
        query.concat(".AddSingleLinkToUrl");
        return query.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                SourceItemID: sourceItemId,
                SourceListName: sourceListName,
                TargetItemUrl: targetItemUrl,
                TryAddReverseLink: tryAddReverseLink,
            }),
        });
    };
    /**
     * Adds a related item link from an item specified by url, to an item specified by list name and item id
     *
     * @param sourceItemUrl The source item url
     * @param targetListName The target list name or list id
     * @param targetItemId The target item id
     * @param tryAddReverseLink If set to true try to add the reverse link (will not return error if it fails)
     */
    RelatedItemManagerImpl.prototype.addSingleLinkFromUrl = function (sourceItemUrl, targetListName, targetItemId, tryAddReverseLink) {
        if (tryAddReverseLink === void 0) { tryAddReverseLink = false; }
        var query = this.clone(RelatedItemManagerImpl_1, null);
        query.concat(".AddSingleLinkFromUrl");
        return query.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                SourceItemUrl: sourceItemUrl,
                TargetItemID: targetItemId,
                TargetListName: targetListName,
                TryAddReverseLink: tryAddReverseLink,
            }),
        });
    };
    RelatedItemManagerImpl.prototype.deleteSingleLink = function (sourceListName, sourceItemId, sourceWebUrl, targetListName, targetItemId, targetWebUrl, tryDeleteReverseLink) {
        if (tryDeleteReverseLink === void 0) { tryDeleteReverseLink = false; }
        var query = this.clone(RelatedItemManagerImpl_1, null);
        query.concat(".DeleteSingleLink");
        return query.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                SourceItemID: sourceItemId,
                SourceListName: sourceListName,
                SourceWebUrl: sourceWebUrl,
                TargetItemID: targetItemId,
                TargetListName: targetListName,
                TargetWebUrl: targetWebUrl,
                TryDeleteReverseLink: tryDeleteReverseLink,
            }),
        });
    };
    var RelatedItemManagerImpl_1;
    RelatedItemManagerImpl = RelatedItemManagerImpl_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/SP.RelatedItemManager")
    ], RelatedItemManagerImpl);
    return RelatedItemManagerImpl;
}(SharePointQueryable));

/**
 * Describes a collection of webs
 *
 */
var Webs = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Webs, _super);
    function Webs() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Webs_1 = Webs;
    /**
     * Adds a new web to the collection
     *
     * @param title The new web's title
     * @param url The new web's relative url
     * @param description The new web's description
     * @param template The new web's template internal name (default = STS)
     * @param language The locale id that specifies the new web's language (default = 1033 [English, US])
     * @param inheritPermissions When true, permissions will be inherited from the new web's parent (default = true)
     */
    Webs.prototype.add = function (title, url, description, template, language, inheritPermissions) {
        if (description === void 0) { description = ""; }
        if (template === void 0) { template = "STS"; }
        if (language === void 0) { language = 1033; }
        if (inheritPermissions === void 0) { inheritPermissions = true; }
        var props = {
            Description: description,
            Language: language,
            Title: title,
            Url: url,
            UseSamePermissionsAsParentSite: inheritPermissions,
            WebTemplate: template,
        };
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            "parameters": Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({
                "__metadata": { "type": "SP.WebCreationInformation" },
            }, props),
        });
        return this.clone(Webs_1, "add").postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                web: new Web(odataUrlFrom(data).replace(/_api\/web\/?/i, "")),
            };
        });
    };
    var Webs_1;
    Webs = Webs_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("webs")
    ], Webs);
    return Webs;
}(SharePointQueryableCollection));
/**
 * Describes a collection of web infos
 *
 */
var WebInfos = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(WebInfos, _super);
    function WebInfos() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WebInfos = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("webinfos")
    ], WebInfos);
    return WebInfos;
}(SharePointQueryableCollection));
/**
 * Describes a web
 *
 */
var Web = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Web, _super);
    function Web() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Web_1 = Web;
    /**
     * Creates a new web instance from the given url by indexing the location of the /_api/
     * segment. If this is not found the method creates a new web with the entire string as
     * supplied.
     *
     * @param url
     */
    Web.fromUrl = function (url, path) {
        return new Web_1(extractWebUrl(url), path);
    };
    Object.defineProperty(Web.prototype, "webs", {
        /**
         * Gets this web's subwebs
         *
         */
        get: function () {
            return new Webs(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets this web's parent web and data
     *
     */
    Web.prototype.getParentWeb = function () {
        var _this = this;
        return this.select("ParentWeb/Id").expand("ParentWeb").get()
            .then(function (_a) {
            var ParentWeb = _a.ParentWeb;
            return new Site(_this.toUrlAndQuery().split("/_api")[0]).openWebById(ParentWeb.Id);
        });
    };
    /**
    * Returns a collection of objects that contain metadata about subsites of the current site in which the current user is a member.
    *
    * @param nWebTemplateFilter Specifies the site definition (default = -1)
    * @param nConfigurationFilter A 16-bit integer that specifies the identifier of a configuration (default = -1)
    */
    Web.prototype.getSubwebsFilteredForCurrentUser = function (nWebTemplateFilter, nConfigurationFilter) {
        if (nWebTemplateFilter === void 0) { nWebTemplateFilter = -1; }
        if (nConfigurationFilter === void 0) { nConfigurationFilter = -1; }
        return this.clone(Webs, "getSubwebsFilteredForCurrentUser(nWebTemplateFilter=" + nWebTemplateFilter + ",nConfigurationFilter=" + nConfigurationFilter + ")");
    };
    Object.defineProperty(Web.prototype, "allProperties", {
        /**
         * Allows access to the web's all properties collection
         */
        get: function () {
            return this.clone(SharePointQueryableCollection, "allproperties");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "webinfos", {
        /**
         * Gets a collection of WebInfos for this web's subwebs
         *
         */
        get: function () {
            return new WebInfos(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "contentTypes", {
        /**
         * Gets the content types available in this web
         *
         */
        get: function () {
            return new ContentTypes(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "lists", {
        /**
         * Gets the lists in this web
         *
         */
        get: function () {
            return new Lists(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "fields", {
        /**
         * Gets the fields in this web
         *
         */
        get: function () {
            return new Fields(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "features", {
        /**
         * Gets the active features for this web
         *
         */
        get: function () {
            return new Features(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "availablefields", {
        /**
         * Gets the available fields in this web
         *
         */
        get: function () {
            return new Fields(this, "availablefields");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "navigation", {
        /**
         * Gets the navigation options in this web
         *
         */
        get: function () {
            return new Navigation(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "siteUsers", {
        /**
         * Gets the site users
         *
         */
        get: function () {
            return new SiteUsers(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "siteGroups", {
        /**
         * Gets the site groups
         *
         */
        get: function () {
            return new SiteGroups(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "siteUserInfoList", {
        /**
         * Gets site user info list
         *
         */
        get: function () {
            return new List(this, "siteuserinfolist");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "regionalSettings", {
        /**
         * Gets regional settings
         *
         */
        get: function () {
            return new RegionalSettings(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "currentUser", {
        /**
         * Gets the current user
         */
        get: function () {
            return new CurrentUser(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "folders", {
        /**
         * Gets the top-level folders in this web
         *
         */
        get: function () {
            return new Folders(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "userCustomActions", {
        /**
         * Gets all user custom actions for this web
         *
         */
        get: function () {
            return new UserCustomActions(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "roleDefinitions", {
        /**
         * Gets the collection of RoleDefinition resources
         *
         */
        get: function () {
            return new RoleDefinitions(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "relatedItems", {
        /**
         * Provides an interface to manage related items
         *
         */
        get: function () {
            return RelatedItemManagerImpl.FromUrl(this.toUrl());
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Creates a new batch for requests within the context of this web
     *
     */
    Web.prototype.createBatch = function () {
        return new SPBatch(this.parentUrl);
    };
    Object.defineProperty(Web.prototype, "rootFolder", {
        /**
         * Gets the root folder of this web
         *
         */
        get: function () {
            return new Folder(this, "rootFolder");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "associatedOwnerGroup", {
        /**
         * Gets the associated owner group for this web
         *
         */
        get: function () {
            return new SiteGroup(this, "associatedownergroup");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "associatedMemberGroup", {
        /**
         * Gets the associated member group for this web
         *
         */
        get: function () {
            return new SiteGroup(this, "associatedmembergroup");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Web.prototype, "associatedVisitorGroup", {
        /**
         * Gets the associated visitor group for this web
         *
         */
        get: function () {
            return new SiteGroup(this, "associatedvisitorgroup");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets a folder by server relative url
     *
     * @param folderRelativeUrl The server relative path to the folder (including /sites/ if applicable)
     */
    Web.prototype.getFolderByServerRelativeUrl = function (folderRelativeUrl) {
        return new Folder(this, "getFolderByServerRelativeUrl('" + folderRelativeUrl + "')");
    };
    /**
     * Gets a folder by server relative relative path if your folder name contains # and % characters
     * you need to first encode the file name using encodeURIComponent() and then pass the url
     * let url = "/sites/test/Shared Documents/" + encodeURIComponent("%123");
     * This works only in SharePoint online.
     *
     * @param folderRelativeUrl The server relative path to the folder (including /sites/ if applicable)
     */
    Web.prototype.getFolderByServerRelativePath = function (folderRelativeUrl) {
        return new Folder(this, "getFolderByServerRelativePath(decodedUrl='" + folderRelativeUrl + "')");
    };
    /**
     * Gets a file by server relative url
     *
     * @param fileRelativeUrl The server relative path to the file (including /sites/ if applicable)
     */
    Web.prototype.getFileByServerRelativeUrl = function (fileRelativeUrl) {
        return new File(this, "getFileByServerRelativeUrl('" + fileRelativeUrl + "')");
    };
    /**
     * Gets a file by server relative url if your file name contains # and % characters
     * you need to first encode the file name using encodeURIComponent() and then pass the url
     * let url = "/sites/test/Shared Documents/" + encodeURIComponent("%123.docx");
     *
     * @param fileRelativeUrl The server relative path to the file (including /sites/ if applicable)
     */
    Web.prototype.getFileByServerRelativePath = function (fileRelativeUrl) {
        return new File(this, "getFileByServerRelativePath(decodedUrl='" + fileRelativeUrl + "')");
    };
    /**
     * Gets a list by server relative url (list's root folder)
     *
     * @param listRelativeUrl The server relative path to the list's root folder (including /sites/ if applicable)
     */
    Web.prototype.getList = function (listRelativeUrl) {
        return new List(this, "getList('" + listRelativeUrl + "')");
    };
    /**
     * Updates this web instance with the supplied properties
     *
     * @param properties A plain object hash of values to update for the web
     */
    Web.prototype.update = function (properties) {
        var _this = this;
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({
            "__metadata": { "type": "SP.Web" },
        }, properties));
        return this.postCore({
            body: postBody,
            headers: {
                "X-HTTP-Method": "MERGE",
            },
        }).then(function (data) {
            return {
                data: data,
                web: _this,
            };
        });
    };
    /**
     * Deletes this web
     *
     */
    Web.prototype.delete = function () {
        return _super.prototype.deleteCore.call(this);
    };
    /**
     * Applies the theme specified by the contents of each of the files specified in the arguments to the site
     *
     * @param colorPaletteUrl The server-relative URL of the color palette file
     * @param fontSchemeUrl The server-relative URL of the font scheme
     * @param backgroundImageUrl The server-relative URL of the background image
     * @param shareGenerated When true, the generated theme files are stored in the root site. When false, they are stored in this web
     */
    Web.prototype.applyTheme = function (colorPaletteUrl, fontSchemeUrl, backgroundImageUrl, shareGenerated) {
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            backgroundImageUrl: backgroundImageUrl,
            colorPaletteUrl: colorPaletteUrl,
            fontSchemeUrl: fontSchemeUrl,
            shareGenerated: shareGenerated,
        });
        return this.clone(Web_1, "applytheme").postCore({ body: postBody });
    };
    /**
     * Applies the specified site definition or site template to the Web site that has no template applied to it
     *
     * @param template Name of the site definition or the name of the site template
     */
    Web.prototype.applyWebTemplate = function (template) {
        var q = this.clone(Web_1, "applywebtemplate");
        q.concat("(@t)");
        q.query.set("@t", template);
        return q.postCore();
    };
    /**
     * Checks whether the specified login name belongs to a valid user in the web. If the user doesn't exist, adds the user to the web.
     *
     * @param loginName The login name of the user (ex: i:0#.f|membership|user@domain.onmicrosoft.com)
     */
    Web.prototype.ensureUser = function (loginName) {
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            logonName: loginName,
        });
        return this.clone(Web_1, "ensureuser").postCore({ body: postBody }).then(function (data) {
            return {
                data: data,
                user: new SiteUser(odataUrlFrom(data)),
            };
        });
    };
    /**
     * Returns a collection of site templates available for the site
     *
     * @param language The locale id of the site templates to retrieve (default = 1033 [English, US])
     * @param includeCrossLanguage When true, includes language-neutral site templates; otherwise false (default = true)
     */
    Web.prototype.availableWebTemplates = function (language, includeCrossLanugage) {
        if (language === void 0) { language = 1033; }
        if (includeCrossLanugage === void 0) { includeCrossLanugage = true; }
        return new SharePointQueryableCollection(this, "getavailablewebtemplates(lcid=" + language + ", doincludecrosslanguage=" + includeCrossLanugage + ")");
    };
    /**
     * Returns the list gallery on the site
     *
     * @param type The gallery type - WebTemplateCatalog = 111, WebPartCatalog = 113 ListTemplateCatalog = 114,
     * MasterPageCatalog = 116, SolutionCatalog = 121, ThemeCatalog = 123, DesignCatalog = 124, AppDataCatalog = 125
     */
    Web.prototype.getCatalog = function (type) {
        return this.clone(Web_1, "getcatalog(" + type + ")").select("Id").get().then(function (data) {
            return new List(odataUrlFrom(data));
        });
    };
    /**
     * Returns the collection of changes from the change log that have occurred within the list, based on the specified query
     *
     * @param query The change query
     */
    Web.prototype.getChanges = function (query) {
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ "query": Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])({ "__metadata": { "type": "SP.ChangeQuery" } }, query) });
        return this.clone(Web_1, "getchanges").postCore({ body: postBody });
    };
    Object.defineProperty(Web.prototype, "customListTemplate", {
        /**
         * Gets the custom list templates for the site
         *
         */
        get: function () {
            return new SharePointQueryableCollection(this, "getcustomlisttemplates");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Returns the user corresponding to the specified member identifier for the current site
     *
     * @param id The id of the user
     */
    Web.prototype.getUserById = function (id) {
        return new SiteUser(this, "getUserById(" + id + ")");
    };
    /**
     * Returns the name of the image file for the icon that is used to represent the specified file
     *
     * @param filename The file name. If this parameter is empty, the server returns an empty string
     * @param size The size of the icon: 16x16 pixels = 0, 32x32 pixels = 1 (default = 0)
     * @param progId The ProgID of the application that was used to create the file, in the form OLEServerName.ObjectName
     */
    Web.prototype.mapToIcon = function (filename, size, progId) {
        if (size === void 0) { size = 0; }
        if (progId === void 0) { progId = ""; }
        return this.clone(Web_1, "maptoicon(filename='" + filename + "', progid='" + progId + "', size=" + size + ")").get();
    };
    /**
     * Returns the tenant property corresponding to the specified key in the app catalog site
     *
     * @param key Id of storage entity to be set
     */
    Web.prototype.getStorageEntity = function (key) {
        return this.clone(Web_1, "getStorageEntity('" + key + "')").get();
    };
    /**
     * This will set the storage entity identified by the given key (MUST be called in the context of the app catalog)
     *
     * @param key Id of storage entity to be set
     * @param value Value of storage entity to be set
     * @param description Description of storage entity to be set
     * @param comments Comments of storage entity to be set
     */
    Web.prototype.setStorageEntity = function (key, value, description, comments) {
        if (description === void 0) { description = ""; }
        if (comments === void 0) { comments = ""; }
        return this.clone(Web_1, "setStorageEntity").postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
                comments: comments,
                description: description,
                key: key,
                value: value,
            }),
        });
    };
    /**
     * This will remove the storage entity identified by the given key
     *
     * @param key Id of storage entity to be removed
     */
    Web.prototype.removeStorageEntity = function (key) {
        return this.clone(Web_1, "removeStorageEntity('" + key + "')").postCore();
    };
    /**
     * Gets the app catalog for this web
     *
     * @param url Optional url or web containing the app catalog (default: current web)
     */
    Web.prototype.getAppCatalog = function (url) {
        return new AppCatalog(url || this);
    };
    /**
     * Gets the collection of available client side web parts for this web instance
     */
    Web.prototype.getClientSideWebParts = function () {
        return this.clone(SharePointQueryableCollection, "GetClientSideWebParts").get();
    };
    /**
     * Creates a new client side page
     *
     * @param pageName Name of the new page
     * @param title Display title of the new page
     * @param libraryTitle Title of the library in which to create the new page. Default: "Site Pages"
     */
    Web.prototype.addClientSidePage = function (pageName, title, libraryTitle) {
        if (title === void 0) { title = pageName.replace(/\.[^/.]+$/, ""); }
        if (libraryTitle === void 0) { libraryTitle = "Site Pages"; }
        return ClientSidePage.create(this.lists.getByTitle(libraryTitle), pageName, title);
    };
    /**
     * Creates a new client side page using the library path
     *
     * @param pageName Name of the new page
     * @param listRelativePath The server relative path to the list's root folder (including /sites/ if applicable)
     * @param title Display title of the new page
     */
    Web.prototype.addClientSidePageByPath = function (pageName, listRelativePath, title) {
        if (title === void 0) { title = pageName.replace(/\.[^/.]+$/, ""); }
        return ClientSidePage.create(this.getList(listRelativePath), pageName, title);
    };
    var Web_1;
    Web = Web_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/web")
    ], Web);
    return Web;
}(SharePointQueryableShareableWeb));

/**
 * Describes a site collection
 *
 */
var Site = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(Site, _super);
    function Site() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Site_1 = Site;
    Object.defineProperty(Site.prototype, "rootWeb", {
        /**
         * Gets the root web of the site collection
         *
         */
        get: function () {
            return new Web(this, "rootweb");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Site.prototype, "features", {
        /**
         * Gets the active features for this site collection
         *
         */
        get: function () {
            return new Features(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Site.prototype, "userCustomActions", {
        /**
         * Gets all custom actions for this site collection
         *
         */
        get: function () {
            return new UserCustomActions(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets a Web instance representing the root web of the site collection
     * correctly setup for chaining within the library
     */
    Site.prototype.getRootWeb = function () {
        return this.rootWeb.select("Url").get().then(function (web) { return new Web(web.Url); });
    };
    /**
     * Gets the context information for this site collection
     */
    Site.prototype.getContextInfo = function () {
        var q = new Site_1(this.parentUrl, "_api/contextinfo");
        return q.postCore().then(function (data) {
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "GetContextWebInformation")) {
                var info = data.GetContextWebInformation;
                info.SupportedSchemaVersions = info.SupportedSchemaVersions.results;
                return info;
            }
            else {
                return data;
            }
        });
    };
    /**
     * Gets the document libraries on a site. Static method. (SharePoint Online only)
     *
     * @param absoluteWebUrl The absolute url of the web whose document libraries should be returned
     */
    Site.prototype.getDocumentLibraries = function (absoluteWebUrl) {
        var q = new SharePointQueryable("", "_api/sp.web.getdocumentlibraries(@v)");
        q.query.set("@v", "'" + absoluteWebUrl + "'");
        return q.get().then(function (data) {
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "GetDocumentLibraries")) {
                return data.GetDocumentLibraries;
            }
            else {
                return data;
            }
        });
    };
    /**
     * Gets the site url from a page url
     *
     * @param absolutePageUrl The absolute url of the page
     */
    Site.prototype.getWebUrlFromPageUrl = function (absolutePageUrl) {
        var q = new SharePointQueryable("", "_api/sp.web.getweburlfrompageurl(@v)");
        q.query.set("@v", "'" + absolutePageUrl + "'");
        return q.get().then(function (data) {
            if (Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(data, "GetWebUrlFromPageUrl")) {
                return data.GetWebUrlFromPageUrl;
            }
            else {
                return data;
            }
        });
    };
    /**
     * Creates a new batch for requests within the context of this site collection
     *
     */
    Site.prototype.createBatch = function () {
        return new SPBatch(this.parentUrl);
    };
    /**
     * Opens a web by id (using POST)
     *
     * @param webId The GUID id of the web to open
     */
    Site.prototype.openWebById = function (webId) {
        return this.clone(Site_1, "openWebById('" + webId + "')").postCore().then(function (d) { return ({
            data: d,
            web: Web.fromUrl(d["odata.id"] || d.__metadata.uri),
        }); });
    };
    var Site_1;
    Site = Site_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/site")
    ], Site);
    return Site;
}(SharePointQueryableInstance));

var UserProfileQuery = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(UserProfileQuery, _super);
    /**
     * Creates a new instance of the UserProfileQuery class
     *
     * @param baseUrl The url or SharePointQueryable which forms the parent of this user profile query
     */
    function UserProfileQuery(baseUrl, path) {
        if (path === void 0) { path = "_api/sp.userprofiles.peoplemanager"; }
        var _this = _super.call(this, baseUrl, path) || this;
        _this.clientPeoplePickerQuery = (new ClientPeoplePickerQuery(baseUrl)).configureFrom(_this);
        _this.profileLoader = (new ProfileLoader(baseUrl)).configureFrom(_this);
        return _this;
    }
    Object.defineProperty(UserProfileQuery.prototype, "editProfileLink", {
        /**
         * The url of the edit profile page for the current user
         */
        get: function () {
            return this.clone(UserProfileQuery, "EditProfileLink").get();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(UserProfileQuery.prototype, "isMyPeopleListPublic", {
        /**
         * A boolean value that indicates whether the current user's "People I'm Following" list is public
         */
        get: function () {
            return this.clone(UserProfileQuery, "IsMyPeopleListPublic").get();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * A boolean value that indicates whether the current user is being followed by the specified user
     *
     * @param loginName The account name of the user
     */
    UserProfileQuery.prototype.amIFollowedBy = function (loginName) {
        var q = this.clone(UserProfileQuery, "amifollowedby(@v)");
        q.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return q.get();
    };
    /**
     * A boolean value that indicates whether the current user is following the specified user
     *
     * @param loginName The account name of the user
     */
    UserProfileQuery.prototype.amIFollowing = function (loginName) {
        var q = this.clone(UserProfileQuery, "amifollowing(@v)");
        q.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return q.get();
    };
    /**
     * Gets tags that the current user is following
     *
     * @param maxCount The maximum number of tags to retrieve (default is 20)
     */
    UserProfileQuery.prototype.getFollowedTags = function (maxCount) {
        if (maxCount === void 0) { maxCount = 20; }
        return this.clone(UserProfileQuery, "getfollowedtags(" + maxCount + ")").get();
    };
    /**
     * Gets the people who are following the specified user
     *
     * @param loginName The account name of the user
     */
    UserProfileQuery.prototype.getFollowersFor = function (loginName) {
        var q = this.clone(UserProfileQuery, "getfollowersfor(@v)");
        q.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return q.get();
    };
    Object.defineProperty(UserProfileQuery.prototype, "myFollowers", {
        /**
         * Gets the people who are following the current user
         *
         */
        get: function () {
            return new SharePointQueryableCollection(this, "getmyfollowers");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(UserProfileQuery.prototype, "myProperties", {
        /**
         * Gets user properties for the current user
         *
         */
        get: function () {
            return new UserProfileQuery(this, "getmyproperties");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets the people who the specified user is following
     *
     * @param loginName The account name of the user.
     */
    UserProfileQuery.prototype.getPeopleFollowedBy = function (loginName) {
        var q = this.clone(UserProfileQuery, "getpeoplefollowedby(@v)");
        q.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return q.get();
    };
    /**
     * Gets user properties for the specified user.
     *
     * @param loginName The account name of the user.
     */
    UserProfileQuery.prototype.getPropertiesFor = function (loginName) {
        var q = this.clone(UserProfileQuery, "getpropertiesfor(@v)");
        q.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return q.get();
    };
    Object.defineProperty(UserProfileQuery.prototype, "trendingTags", {
        /**
         * Gets the 20 most popular hash tags over the past week, sorted so that the most popular tag appears first
         *
         */
        get: function () {
            var q = this.clone(UserProfileQuery, null);
            q.concat(".gettrendingtags");
            return q.get();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets the specified user profile property for the specified user
     *
     * @param loginName The account name of the user
     * @param propertyName The case-sensitive name of the property to get
     */
    UserProfileQuery.prototype.getUserProfilePropertyFor = function (loginName, propertyName) {
        var q = this.clone(UserProfileQuery, "getuserprofilepropertyfor(accountname=@v, propertyname='" + propertyName + "')");
        q.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return q.get();
    };
    /**
     * Removes the specified user from the user's list of suggested people to follow
     *
     * @param loginName The account name of the user
     */
    UserProfileQuery.prototype.hideSuggestion = function (loginName) {
        var q = this.clone(UserProfileQuery, "hidesuggestion(@v)");
        q.query.set("@v", "'" + encodeURIComponent(loginName) + "'");
        return q.postCore();
    };
    /**
     * A boolean values that indicates whether the first user is following the second user
     *
     * @param follower The account name of the user who might be following the followee
     * @param followee The account name of the user who might be followed by the follower
     */
    UserProfileQuery.prototype.isFollowing = function (follower, followee) {
        var q = this.clone(UserProfileQuery, null);
        q.concat(".isfollowing(possiblefolloweraccountname=@v, possiblefolloweeaccountname=@y)");
        q.query.set("@v", "'" + encodeURIComponent(follower) + "'");
        q.query.set("@y", "'" + encodeURIComponent(followee) + "'");
        return q.get();
    };
    /**
     * Uploads and sets the user profile picture (Users can upload a picture to their own profile only). Not supported for batching.
     *
     * @param profilePicSource Blob data representing the user's picture in BMP, JPEG, or PNG format of up to 4.76MB
     */
    UserProfileQuery.prototype.setMyProfilePic = function (profilePicSource) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var buffer = null;
            var reader = new FileReader();
            reader.onload = function (e) { return buffer = e.target.result; };
            reader.readAsArrayBuffer(profilePicSource);
            var request = new UserProfileQuery(_this, "setmyprofilepicture");
            request.postCore({
                body: String.fromCharCode.apply(null, new Uint16Array(buffer)),
            }).then(function (_) { return resolve(); }).catch(function (e) { return reject(e); });
        });
    };
    /**
     * Sets single value User Profile property
     *
     * @param accountName The account name of the user
     * @param propertyName Property name
     * @param propertyValue Property value
     */
    UserProfileQuery.prototype.setSingleValueProfileProperty = function (accountName, propertyName, propertyValue) {
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            accountName: accountName,
            propertyName: propertyName,
            propertyValue: propertyValue,
        });
        return this.clone(UserProfileQuery, "SetSingleValueProfileProperty")
            .postCore({ body: postBody });
    };
    /**
     * Sets multi valued User Profile property
     *
     * @param accountName The account name of the user
     * @param propertyName Property name
     * @param propertyValues Property values
     */
    UserProfileQuery.prototype.setMultiValuedProfileProperty = function (accountName, propertyName, propertyValues) {
        var postBody = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            accountName: accountName,
            propertyName: propertyName,
            propertyValues: propertyValues,
        });
        return this.clone(UserProfileQuery, "SetMultiValuedProfileProperty")
            .postCore({ body: postBody });
    };
    /**
     * Provisions one or more users' personal sites. (My Site administrator on SharePoint Online only)
     *
     * @param emails The email addresses of the users to provision sites for
     */
    UserProfileQuery.prototype.createPersonalSiteEnqueueBulk = function () {
        var emails = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            emails[_i] = arguments[_i];
        }
        return this.profileLoader.createPersonalSiteEnqueueBulk(emails);
    };
    Object.defineProperty(UserProfileQuery.prototype, "ownerUserProfile", {
        /**
         * Gets the user profile of the site owner
         *
         */
        get: function () {
            return this.profileLoader.ownerUserProfile;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(UserProfileQuery.prototype, "userProfile", {
        /**
         * Gets the user profile for the current user
         */
        get: function () {
            return this.profileLoader.userProfile;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Enqueues creating a personal site for this user, which can be used to share documents, web pages, and other files
     *
     * @param interactiveRequest true if interactively (web) initiated request, or false (default) if non-interactively (client) initiated request
     */
    UserProfileQuery.prototype.createPersonalSite = function (interactiveRequest) {
        if (interactiveRequest === void 0) { interactiveRequest = false; }
        return this.profileLoader.createPersonalSite(interactiveRequest);
    };
    /**
     * Sets the privacy settings for this profile
     *
     * @param share true to make all social data public; false to make all social data private
     */
    UserProfileQuery.prototype.shareAllSocialData = function (share) {
        return this.profileLoader.shareAllSocialData(share);
    };
    /**
     * Resolves user or group using specified query parameters
     *
     * @param queryParams The query parameters used to perform resolve
     */
    UserProfileQuery.prototype.clientPeoplePickerResolveUser = function (queryParams) {
        return this.clientPeoplePickerQuery.clientPeoplePickerResolveUser(queryParams);
    };
    /**
     * Searches for users or groups using specified query parameters
     *
     * @param queryParams The query parameters used to perform search
     */
    UserProfileQuery.prototype.clientPeoplePickerSearchUser = function (queryParams) {
        return this.clientPeoplePickerQuery.clientPeoplePickerSearchUser(queryParams);
    };
    return UserProfileQuery;
}(SharePointQueryableInstance));
var ProfileLoader = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ProfileLoader, _super);
    function ProfileLoader() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ProfileLoader_1 = ProfileLoader;
    /**
     * Provisions one or more users' personal sites. (My Site administrator on SharePoint Online only) Doesn't support batching
     *
     * @param emails The email addresses of the users to provision sites for
     */
    ProfileLoader.prototype.createPersonalSiteEnqueueBulk = function (emails) {
        return this.clone(ProfileLoader_1, "createpersonalsiteenqueuebulk", false).postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({ "emailIDs": emails }),
        });
    };
    Object.defineProperty(ProfileLoader.prototype, "ownerUserProfile", {
        /**
         * Gets the user profile of the site owner.
         *
         */
        get: function () {
            var q = this.getParent(ProfileLoader_1, this.parentUrl, "_api/sp.userprofiles.profileloader.getowneruserprofile");
            if (this.hasBatch) {
                q = q.inBatch(this.batch);
            }
            return q.postCore();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ProfileLoader.prototype, "userProfile", {
        /**
         * Gets the user profile of the current user.
         *
         */
        get: function () {
            return this.clone(ProfileLoader_1, "getuserprofile").postCore();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Enqueues creating a personal site for this user, which can be used to share documents, web pages, and other files.
     *
     * @param interactiveRequest true if interactively (web) initiated request, or false (default) if non-interactively (client) initiated request
     */
    ProfileLoader.prototype.createPersonalSite = function (interactiveRequest) {
        if (interactiveRequest === void 0) { interactiveRequest = false; }
        return this.clone(ProfileLoader_1, "getuserprofile/createpersonalsiteenque(" + interactiveRequest + ")").postCore();
    };
    /**
     * Sets the privacy settings for this profile
     *
     * @param share true to make all social data public; false to make all social data private.
     */
    ProfileLoader.prototype.shareAllSocialData = function (share) {
        return this.clone(ProfileLoader_1, "getuserprofile/shareallsocialdata(" + share + ")").postCore();
    };
    var ProfileLoader_1;
    ProfileLoader = ProfileLoader_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/sp.userprofiles.profileloader.getprofileloader")
    ], ProfileLoader);
    return ProfileLoader;
}(SharePointQueryable));
var ClientPeoplePickerQuery = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(ClientPeoplePickerQuery, _super);
    function ClientPeoplePickerQuery() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ClientPeoplePickerQuery_1 = ClientPeoplePickerQuery;
    /**
     * Resolves user or group using specified query parameters
     *
     * @param queryParams The query parameters used to perform resolve
     */
    ClientPeoplePickerQuery.prototype.clientPeoplePickerResolveUser = function (queryParams) {
        var q = this.clone(ClientPeoplePickerQuery_1, null);
        q.concat(".clientpeoplepickerresolveuser");
        return q.postCore({
            body: this.createClientPeoplePickerQueryParametersRequestBody(queryParams),
        })
            .then(function (res) {
            if (typeof res === "object") {
                return res.ClientPeoplePickerResolveUser;
            }
            return res;
        })
            .then(JSON.parse);
    };
    /**
     * Searches for users or groups using specified query parameters
     *
     * @param queryParams The query parameters used to perform search
     */
    ClientPeoplePickerQuery.prototype.clientPeoplePickerSearchUser = function (queryParams) {
        var q = this.clone(ClientPeoplePickerQuery_1, null);
        q.concat(".clientpeoplepickersearchuser");
        return q.postCore({
            body: this.createClientPeoplePickerQueryParametersRequestBody(queryParams),
        })
            .then(function (res) {
            if (typeof res === "object") {
                return res.ClientPeoplePickerSearchUser;
            }
            return res;
        })
            .then(JSON.parse);
    };
    /**
     * Creates ClientPeoplePickerQueryParameters request body
     *
     * @param queryParams The query parameters to create request body
     */
    ClientPeoplePickerQuery.prototype.createClientPeoplePickerQueryParametersRequestBody = function (queryParams) {
        return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            "queryParams": Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.UI.ApplicationPages.ClientPeoplePickerQueryParameters"), queryParams),
        });
    };
    var ClientPeoplePickerQuery_1;
    ClientPeoplePickerQuery = ClientPeoplePickerQuery_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/sp.ui.applicationpages.clientpeoplepickerwebserviceinterface")
    ], ClientPeoplePickerQuery);
    return ClientPeoplePickerQuery;
}(SharePointQueryable));

/**
 * Exposes social following methods
 */
var SocialQuery = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(SocialQuery, _super);
    function SocialQuery() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SocialQuery_1 = SocialQuery;
    Object.defineProperty(SocialQuery.prototype, "my", {
        get: function () {
            return new MySocialQuery(this);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Gets a URI to a site that lists the current user's followed sites.
     */
    SocialQuery.prototype.getFollowedSitesUri = function () {
        return this.clone(SocialQuery_1, "FollowedSitesUri").get().then(function (r) {
            return r.FollowedSitesUri || r;
        });
    };
    /**
     * Gets a URI to a site that lists the current user's followed documents.
     */
    SocialQuery.prototype.getFollowedDocumentsUri = function () {
        return this.clone(SocialQuery_1, "FollowedDocumentsUri").get().then(function (r) {
            return r.FollowedDocumentsUri || r;
        });
    };
    /**
     * Makes the current user start following a user, document, site, or tag
     *
     * @param actorInfo The actor to start following
     */
    SocialQuery.prototype.follow = function (actorInfo) {
        return this.clone(SocialQuery_1, "follow").postCore({ body: this.createSocialActorInfoRequestBody(actorInfo) });
    };
    /**
     * Indicates whether the current user is following a specified user, document, site, or tag
     *
     * @param actorInfo The actor to find the following status for
     */
    SocialQuery.prototype.isFollowed = function (actorInfo) {
        return this.clone(SocialQuery_1, "isfollowed").postCore({ body: this.createSocialActorInfoRequestBody(actorInfo) });
    };
    /**
     * Makes the current user stop following a user, document, site, or tag
     *
     * @param actorInfo The actor to stop following
     */
    SocialQuery.prototype.stopFollowing = function (actorInfo) {
        return this.clone(SocialQuery_1, "stopfollowing").postCore({ body: this.createSocialActorInfoRequestBody(actorInfo) });
    };
    /**
     * Creates SocialActorInfo request body
     *
     * @param actorInfo The actor to create request body
     */
    SocialQuery.prototype.createSocialActorInfoRequestBody = function (actorInfo) {
        return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])({
            "actor": Object.assign(metadata("SP.Social.SocialActorInfo"), {
                Id: null,
            }, actorInfo),
        });
    };
    var SocialQuery_1;
    SocialQuery = SocialQuery_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("_api/social.following")
    ], SocialQuery);
    return SocialQuery;
}(SharePointQueryableInstance));
var MySocialQuery = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(MySocialQuery, _super);
    function MySocialQuery() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    MySocialQuery_1 = MySocialQuery;
    /**
     * Gets users, documents, sites, and tags that the current user is following.
     *
     * @param types Bitwise set of SocialActorTypes to retrieve
     */
    MySocialQuery.prototype.followed = function (types) {
        return this.clone(MySocialQuery_1, "followed(types=" + types + ")").get().then(function (r) {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(r, "Followed") ? r.Followed.results : r;
        });
    };
    /**
     * Gets the count of users, documents, sites, and tags that the current user is following.
     *
     * @param types Bitwise set of SocialActorTypes to retrieve
     */
    MySocialQuery.prototype.followedCount = function (types) {
        return this.clone(MySocialQuery_1, "followedcount(types=" + types + ")").get().then(function (r) {
            return r.FollowedCount || r;
        });
    };
    /**
     * Gets the users who are following the current user.
     */
    MySocialQuery.prototype.followers = function () {
        return this.clone(MySocialQuery_1, "followers").get().then(function (r) {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(r, "Followers") ? r.Followers.results : r;
        });
    };
    /**
     * Gets users who the current user might want to follow.
     */
    MySocialQuery.prototype.suggestions = function () {
        return this.clone(MySocialQuery_1, "suggestions").get().then(function (r) {
            return Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["hOP"])(r, "Suggestions") ? r.Suggestions.results : r;
        });
    };
    var MySocialQuery_1;
    MySocialQuery = MySocialQuery_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__decorate"])([
        defaultPath("my")
    ], MySocialQuery);
    return MySocialQuery;
}(SharePointQueryableInstance));
/**
 * Social actor type
 *
 */
var SocialActorType;
(function (SocialActorType) {
    SocialActorType[SocialActorType["User"] = 0] = "User";
    SocialActorType[SocialActorType["Document"] = 1] = "Document";
    SocialActorType[SocialActorType["Site"] = 2] = "Site";
    SocialActorType[SocialActorType["Tag"] = 3] = "Tag";
})(SocialActorType || (SocialActorType = {}));
/**
 * Social actor type
 *
 */
/* tslint:disable:no-bitwise */
var SocialActorTypes;
(function (SocialActorTypes) {
    SocialActorTypes[SocialActorTypes["None"] = 0] = "None";
    SocialActorTypes[SocialActorTypes["User"] = 1] = "User";
    SocialActorTypes[SocialActorTypes["Document"] = 2] = "Document";
    SocialActorTypes[SocialActorTypes["Site"] = 4] = "Site";
    SocialActorTypes[SocialActorTypes["Tag"] = 8] = "Tag";
    /**
     * The set excludes documents and sites that do not have feeds.
     */
    SocialActorTypes[SocialActorTypes["ExcludeContentWithoutFeeds"] = 268435456] = "ExcludeContentWithoutFeeds";
    /**
     * The set includes group sites
     */
    SocialActorTypes[SocialActorTypes["IncludeGroupsSites"] = 536870912] = "IncludeGroupsSites";
    /**
     * The set includes only items created within the last 24 hours
     */
    SocialActorTypes[SocialActorTypes["WithinLast24Hours"] = 1073741824] = "WithinLast24Hours";
})(SocialActorTypes || (SocialActorTypes = {}));
/* tslint:enable */
/**
 * Result from following
 *
 */
var SocialFollowResult;
(function (SocialFollowResult) {
    SocialFollowResult[SocialFollowResult["Ok"] = 0] = "Ok";
    SocialFollowResult[SocialFollowResult["AlreadyFollowing"] = 1] = "AlreadyFollowing";
    SocialFollowResult[SocialFollowResult["LimitReached"] = 2] = "LimitReached";
    SocialFollowResult[SocialFollowResult["InternalError"] = 3] = "InternalError";
})(SocialFollowResult || (SocialFollowResult = {}));
/**
 * Specifies an exception or status code.
 */
var SocialStatusCode;
(function (SocialStatusCode) {
    /**
     * The operation completed successfully
     */
    SocialStatusCode[SocialStatusCode["OK"] = 0] = "OK";
    /**
     * The request is invalid.
     */
    SocialStatusCode[SocialStatusCode["InvalidRequest"] = 1] = "InvalidRequest";
    /**
     *  The current user is not authorized to perform the operation.
     */
    SocialStatusCode[SocialStatusCode["AccessDenied"] = 2] = "AccessDenied";
    /**
     * The target of the operation was not found.
     */
    SocialStatusCode[SocialStatusCode["ItemNotFound"] = 3] = "ItemNotFound";
    /**
     * The operation is invalid for the target's current state.
     */
    SocialStatusCode[SocialStatusCode["InvalidOperation"] = 4] = "InvalidOperation";
    /**
     * The operation completed without modifying the target.
     */
    SocialStatusCode[SocialStatusCode["ItemNotModified"] = 5] = "ItemNotModified";
    /**
     * The operation failed because an internal error occurred.
     */
    SocialStatusCode[SocialStatusCode["InternalError"] = 6] = "InternalError";
    /**
     * The operation failed because the server could not access the distributed cache.
     */
    SocialStatusCode[SocialStatusCode["CacheReadError"] = 7] = "CacheReadError";
    /**
     * The operation succeeded but the server could not update the distributed cache.
     */
    SocialStatusCode[SocialStatusCode["CacheUpdateError"] = 8] = "CacheUpdateError";
    /**
     * No personal site exists for the current user, and no further information is available.
     */
    SocialStatusCode[SocialStatusCode["PersonalSiteNotFound"] = 9] = "PersonalSiteNotFound";
    /**
     * No personal site exists for the current user, and a previous attempt to create one failed.
     */
    SocialStatusCode[SocialStatusCode["FailedToCreatePersonalSite"] = 10] = "FailedToCreatePersonalSite";
    /**
     * No personal site exists for the current user, and a previous attempt to create one was not authorized.
     */
    SocialStatusCode[SocialStatusCode["NotAuthorizedToCreatePersonalSite"] = 11] = "NotAuthorizedToCreatePersonalSite";
    /**
     * No personal site exists for the current user, and no attempt should be made to create one.
     */
    SocialStatusCode[SocialStatusCode["CannotCreatePersonalSite"] = 12] = "CannotCreatePersonalSite";
    /**
     * The operation was rejected because an internal limit had been reached.
     */
    SocialStatusCode[SocialStatusCode["LimitReached"] = 13] = "LimitReached";
    /**
     * The operation failed because an error occurred during the processing of the specified attachment.
     */
    SocialStatusCode[SocialStatusCode["AttachmentError"] = 14] = "AttachmentError";
    /**
     * The operation succeeded with recoverable errors; the returned data is incomplete.
     */
    SocialStatusCode[SocialStatusCode["PartialData"] = 15] = "PartialData";
    /**
     * A required SharePoint feature is not enabled.
     */
    SocialStatusCode[SocialStatusCode["FeatureDisabled"] = 16] = "FeatureDisabled";
    /**
     * The site's storage quota has been exceeded.
     */
    SocialStatusCode[SocialStatusCode["StorageQuotaExceeded"] = 17] = "StorageQuotaExceeded";
    /**
     * The operation failed because the server could not access the database.
     */
    SocialStatusCode[SocialStatusCode["DatabaseError"] = 18] = "DatabaseError";
})(SocialStatusCode || (SocialStatusCode = {}));

/**
 * Allows for calling of the static SP.Utilities.Utility methods by supplying the method name
 */
var UtilityMethod = /** @class */ (function (_super) {
    Object(tslib__WEBPACK_IMPORTED_MODULE_1__["__extends"])(UtilityMethod, _super);
    /**
     * Creates a new instance of the Utility method class
     *
     * @param baseUrl The parent url provider
     * @param methodName The static method name to call on the utility class
     */
    function UtilityMethod(baseUrl, methodName) {
        return _super.call(this, UtilityMethod.getBaseUrl(baseUrl), "_api/SP.Utilities.Utility." + methodName) || this;
    }
    UtilityMethod.getBaseUrl = function (candidate) {
        if (typeof candidate === "string") {
            return candidate;
        }
        var c = candidate;
        var url = c.toUrl();
        var index = url.indexOf("_api/");
        if (index < 0) {
            return url;
        }
        return url.substr(0, index);
    };
    UtilityMethod.prototype.excute = function (props) {
        return this.postCore({
            body: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["jsS"])(props),
        });
    };
    /**
     * Sends an email based on the supplied properties
     *
     * @param props The properties of the email to send
     */
    UtilityMethod.prototype.sendEmail = function (props) {
        var params = {
            properties: Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(metadata("SP.Utilities.EmailProperties"), {
                Body: props.Body,
                From: props.From,
                Subject: props.Subject,
            }),
        };
        if (props.To && props.To.length > 0) {
            params.properties = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(params.properties, {
                To: { results: props.To },
            });
        }
        if (props.CC && props.CC.length > 0) {
            params.properties = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(params.properties, {
                CC: { results: props.CC },
            });
        }
        if (props.BCC && props.BCC.length > 0) {
            params.properties = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(params.properties, {
                BCC: { results: props.BCC },
            });
        }
        if (props.AdditionalHeaders) {
            params.properties = Object(_pnp_common__WEBPACK_IMPORTED_MODULE_0__["extend"])(params.properties, {
                AdditionalHeaders: props.AdditionalHeaders,
            });
        }
        return this.clone(UtilityMethod, "SendEmail", true).excute(params);
    };
    UtilityMethod.prototype.getCurrentUserEmailAddresses = function () {
        return this.clone(UtilityMethod, "GetCurrentUserEmailAddresses", true).excute({});
    };
    UtilityMethod.prototype.resolvePrincipal = function (input, scopes, sources, inputIsEmailOnly, addToUserInfoList, matchUserInfoList) {
        if (matchUserInfoList === void 0) { matchUserInfoList = false; }
        var params = {
            addToUserInfoList: addToUserInfoList,
            input: input,
            inputIsEmailOnly: inputIsEmailOnly,
            matchUserInfoList: matchUserInfoList,
            scopes: scopes,
            sources: sources,
        };
        return this.clone(UtilityMethod, "ResolvePrincipalInCurrentContext", true).excute(params);
    };
    UtilityMethod.prototype.searchPrincipals = function (input, scopes, sources, groupName, maxCount) {
        var params = {
            groupName: groupName,
            input: input,
            maxCount: maxCount,
            scopes: scopes,
            sources: sources,
        };
        return this.clone(UtilityMethod, "SearchPrincipalsUsingContextWeb", true).excute(params);
    };
    UtilityMethod.prototype.createEmailBodyForInvitation = function (pageAddress) {
        var params = {
            pageAddress: pageAddress,
        };
        return this.clone(UtilityMethod, "CreateEmailBodyForInvitation", true).excute(params);
    };
    UtilityMethod.prototype.expandGroupsToPrincipals = function (inputs, maxCount) {
        if (maxCount === void 0) { maxCount = 30; }
        var params = {
            inputs: inputs,
            maxCount: maxCount,
        };
        return this.clone(UtilityMethod, "ExpandGroupsToPrincipals", true).excute(params);
    };
    UtilityMethod.prototype.createWikiPage = function (info) {
        return this.clone(UtilityMethod, "CreateWikiPageInContextWeb", true).excute({
            parameters: info,
        }).then(function (r) {
            return {
                data: r,
                file: new File(odataUrlFrom(r)),
            };
        });
    };
    return UtilityMethod;
}(SharePointQueryable));

/**
 * Root of the SharePoint REST module
 */
var SPRest = /** @class */ (function () {
    /**
     * Creates a new instance of the SPRest class
     *
     * @param options Additional options
     * @param baseUrl A string that should form the base part of the url
     */
    function SPRest(_options, _baseUrl) {
        if (_options === void 0) { _options = {}; }
        if (_baseUrl === void 0) { _baseUrl = ""; }
        this._options = _options;
        this._baseUrl = _baseUrl;
    }
    /**
     * Configures instance with additional options and baseUrl.
     * Provided configuration used by other objects in a chain
     *
     * @param options Additional options
     * @param baseUrl A string that should form the base part of the url
     */
    SPRest.prototype.configure = function (options, baseUrl) {
        if (baseUrl === void 0) { baseUrl = ""; }
        return new SPRest(options, baseUrl);
    };
    /**
     * Global SharePoint configuration options
     *
     * @param config The SharePoint configuration to apply
     */
    SPRest.prototype.setup = function (config) {
        setup(config);
    };
    /**
     * Executes a search against this web context
     *
     * @param query The SearchQuery definition
     */
    SPRest.prototype.searchSuggest = function (query) {
        var finalQuery;
        if (typeof query === "string") {
            finalQuery = { querytext: query };
        }
        else {
            finalQuery = query;
        }
        return this.create(SearchSuggest).execute(finalQuery);
    };
    /**
     * Executes a search against this web context
     *
     * @param query The SearchQuery definition
     */
    SPRest.prototype.search = function (query) {
        return this.create(Search).execute(query);
    };
    /**
     * Executes the provided search query, caching the results
     *
     * @param query The SearchQuery definition
     * @param options The set of caching options used to store the results
     */
    SPRest.prototype.searchWithCaching = function (query, options) {
        return this.create(Search).usingCaching(options).execute(query);
    };
    Object.defineProperty(SPRest.prototype, "site", {
        /**
         * Begins a site collection scoped REST request
         *
         */
        get: function () {
            return this.create(Site);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SPRest.prototype, "web", {
        /**
         * Begins a web scoped REST request
         *
         */
        get: function () {
            return this.create(Web);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SPRest.prototype, "profiles", {
        /**
         * Access to user profile methods
         *
         */
        get: function () {
            return this.create(UserProfileQuery);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SPRest.prototype, "social", {
        /**
         * Access to social methods
         */
        get: function () {
            return this.create(SocialQuery);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SPRest.prototype, "navigation", {
        /**
         * Access to the site collection level navigation service
         */
        get: function () {
            return new NavigationService();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Creates a new batch object for use with the SharePointQueryable.addToBatch method
     *
     */
    SPRest.prototype.createBatch = function () {
        return this.web.createBatch();
    };
    Object.defineProperty(SPRest.prototype, "utility", {
        /**
         * Static utilities methods from SP.Utilities.Utility
         */
        get: function () {
            return this.create(UtilityMethod, "");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Handles creating and configuring the objects returned from this class
     *
     * @param fm The factory method used to create the instance
     * @param path Optional additional path information to pass to the factory method
     */
    SPRest.prototype.create = function (fm, path) {
        return new fm(this._baseUrl, path).configure(this._options);
    };
    return SPRest;
}());
var sp = new SPRest();


//# sourceMappingURL=sp.es5.js.map

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! (webpack)/buildin/global.js */ "C:\\Users\\Administrator\\AppData\\Roaming\\npm\\node_modules\\webpack\\buildin\\global.js")))

/***/ }),

/***/ "./node_modules/adal-angular/dist/adal.min.js":
/*!****************************************************!*\
  !*** ./node_modules/adal-angular/dist/adal.min.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

/*! adal-angular v1.0.17 2018-02-27 */
var AuthenticationContext=function(){"use strict";return AuthenticationContext=function(a){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.RESPONSE_TYPE={ID_TOKEN_TOKEN:"id_token token",TOKEN:"token"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",ERROR:"error",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status",ANGULAR_LOGIN_REQUEST:"adal.angular.login.request"},RESOURCE_DELIMETER:"|",CACHE_DELIMETER:"||",LOADFRAME_TIMEOUT:6e3,TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600},AuthenticationContext.prototype._singletonInstance)return AuthenticationContext.prototype._singletonInstance;if(AuthenticationContext.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this.isAngular=!1,this._user=null,this._activeRenewals={},this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._callBackMappedToRenewStates={},this._callBacksMappedToRenewStates={},this._openedWindows=[],this._requestType=this.REQUEST_TYPE.LOGIN,window._adalInstance=this,a.displayCall&&"function"!=typeof a.displayCall)throw new Error("displayCall is not a function");if(!a.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(a),void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0),this.config.popUp&&(this.popUp=!0),this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]),this.config.isAngular&&(this.isAngular=this.config.isAngular),this.config.loadFrameTimeout&&(this.CONSTANTS.LOADFRAME_TIMEOUT=this.config.loadFrameTimeout)},"undefined"!=typeof window&&(window.Logging={piiLoggingEnabled:!1,level:0,log:function(a){}}),AuthenticationContext.prototype.login=function(){if(this._loginInProgress)return void this.info("Login in progress");this._loginInProgress=!0;var a=this._guid();this.config.state=a,this._idTokenNonce=this._guid();var b=this._getItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST);b&&""!==b?this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""):b=window.location.href,this.verbose("Expected state: "+a+" startPage:"+b),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,b),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,a,!0),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var c=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.config.displayCall?this.config.displayCall(c):this.popUp?(this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates.push(a),this.registerCallback(a,this.config.clientId,this.callback),this._loginPopup(c)):this.promptUser(c)},AuthenticationContext.prototype._openPopup=function(a,b,c,d){try{var e=window.screenLeft?window.screenLeft:window.screenX,f=window.screenTop?window.screenTop:window.screenY,g=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=g/2-c/2+e,j=h/2-d/2+f,k=window.open(a,b,"width="+c+", height="+d+", top="+j+", left="+i);return k.focus&&k.focus(),k}catch(a){return this.warn("Error opening popup, "+a.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},AuthenticationContext.prototype._handlePopupError=function(a,b,c,d,e){this.warn(d),this._saveItem(this.CONSTANTS.STORAGE.ERROR,c),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,d),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,e),b&&this._activeRenewals[b]&&(this._activeRenewals[b]=null),this._loginInProgress=!1,this._acquireTokenInProgress=!1,a&&a(d,null,c)},AuthenticationContext.prototype._loginPopup=function(a,b,c){var d=this._openPopup(a,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT),e=c||this.callback;if(null==d){var f="Popup Window is null. This can happen if you are using IE";return void this._handlePopupError(e,b,"Error opening popup",f,f)}if(this._openedWindows.push(d),-1!=this.config.redirectUri.indexOf("#"))var g=this.config.redirectUri.split("#")[0];else var g=this.config.redirectUri;var h=this,i=window.setInterval(function(){if(!d||d.closed||void 0===d.closed){var a="Popup Window closed",c="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return h.isAngular&&h._broadcast("adal:popUpClosed",c+h.CONSTANTS.RESOURCE_DELIMETER+a),h._handlePopupError(e,b,a,c,c),void window.clearInterval(i)}try{var f=d.location;if(-1!=encodeURI(f.href).indexOf(encodeURI(g)))return h.isAngular?h._broadcast("adal:popUpHashChanged",f.hash):h.handleWindowCallback(f.hash),window.clearInterval(i),h._loginInProgress=!1,h._acquireTokenInProgress=!1,h.info("Closing popup window"),h._openedWindows=[],void d.close()}catch(a){}},1)},AuthenticationContext.prototype._broadcast=function(a,b){!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}if("function"==typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype,window.CustomEvent=a}();var c=new CustomEvent(a,{detail:b});window.dispatchEvent(c)},AuthenticationContext.prototype.loginInProgress=function(){return this._loginInProgress},AuthenticationContext.prototype._hasResource=function(a){var b=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return b&&!this._isEmpty(b)&&b.indexOf(a+this.CONSTANTS.RESOURCE_DELIMETER)>-1},AuthenticationContext.prototype.getCachedToken=function(a){if(!this._hasResource(a))return null;var b=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a),c=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a),d=this.config.expireOffsetSeconds||300;return c&&c>this._now()+d?b:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a,0),null)},AuthenticationContext.prototype.getCachedUser=function(){if(this._user)return this._user;var a=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(a),this._user},AuthenticationContext.prototype.registerCallback=function(a,b,c){this._activeRenewals[b]=a,this._callBacksMappedToRenewStates[a]||(this._callBacksMappedToRenewStates[a]=[]);var d=this;this._callBacksMappedToRenewStates[a].push(c),this._callBackMappedToRenewStates[a]||(this._callBackMappedToRenewStates[a]=function(c,e,f,g){d._activeRenewals[b]=null;for(var h=0;h<d._callBacksMappedToRenewStates[a].length;++h)try{d._callBacksMappedToRenewStates[a][h](c,e,f,g)}catch(f){d.warn(f)}d._callBacksMappedToRenewStates[a]=null,d._callBackMappedToRenewStates[a]=null})},AuthenticationContext.prototype._renewToken=function(a,b,c){this.info("renewToken is called for resource:"+a);var d=this._addAdalFrame("adalRenewFrame"+a),e=this._guid()+"|"+a;this.config.state=e,this._renewStates.push(e),this.verbose("Renew token Expected state: "+e),c=c||"token";var f=this._urlRemoveQueryStringParameter(this._getNavigateUrl(c,a),"prompt");c===this.RESPONSE_TYPE.ID_TOKEN_TOKEN&&(this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),f+="&nonce="+encodeURIComponent(this._idTokenNonce)),f+="&prompt=none",f=this._addHintParameters(f),this.registerCallback(e,a,b),this.verbosePii("Navigate to:"+f),d.src="about:blank",this._loadFrameTimeout(f,"adalRenewFrame"+a,a)},AuthenticationContext.prototype._renewIdToken=function(a,b){this.info("renewIdToken is called");var c=this._addAdalFrame("adalIdTokenFrame"),d=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this.config.state=d,this._renewStates.push(d),this.verbose("Renew Idtoken Expected state: "+d);var e=null===b||void 0===b?null:this.config.clientId,b=b||"id_token",f=this._urlRemoveQueryStringParameter(this._getNavigateUrl(b,e),"prompt");f+="&prompt=none",f=this._addHintParameters(f),f+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(d,this.config.clientId,a),this.verbosePii("Navigate to:"+f),c.src="about:blank",this._loadFrameTimeout(f,"adalIdTokenFrame",this.config.clientId)},AuthenticationContext.prototype._urlContainsQueryStringParameter=function(a,b){return new RegExp("[\\?&]"+a+"=").test(b)},AuthenticationContext.prototype._urlRemoveQueryStringParameter=function(a,b){var c=new RegExp("(\\&"+b+"=)[^&]+");return a=a.replace(c,""),c=new RegExp("("+b+"=)[^&]+&"),a=a.replace(c,""),c=new RegExp("("+b+"=)[^&]+"),a=a.replace(c,"")},AuthenticationContext.prototype._loadFrameTimeout=function(a,b,c){this.verbose("Set loading state to pending for: "+c),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+c,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS),this._loadFrame(a,b);var d=this;setTimeout(function(){if(d._getItem(d.CONSTANTS.STORAGE.RENEW_STATUS+c)===d.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){d.verbose("Loading frame has timed out after: "+d.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+c);var a=d._activeRenewals[c];a&&d._callBackMappedToRenewStates[a]&&d._callBackMappedToRenewStates[a]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),d._saveItem(d.CONSTANTS.STORAGE.RENEW_STATUS+c,d.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},d.CONSTANTS.LOADFRAME_TIMEOUT)},AuthenticationContext.prototype._loadFrame=function(a,b){var c=this;c.info("LoadFrame: "+b);var d=b;setTimeout(function(){var b=c._addAdalFrame(d);""!==b.src&&"about:blank"!==b.src||(b.src=a,c._loadFrame(a,d))},500)},AuthenticationContext.prototype.acquireToken=function(a,b){if(this._isEmpty(a))return this.warn("resource is required"),void b("resource is required",null,"resource is required");var c=this.getCachedToken(a);return c?(this.info("Token is already in cache for resource:"+a),void b(null,c,null)):this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("login_hint")?void(this._activeRenewals[a]?this.registerCallback(this._activeRenewals[a],a,b):(this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,a===this.config.clientId?this._user?(this.verbose("renewing idtoken"),this._renewIdToken(b)):(this.verbose("renewing idtoken and access_token"),this._renewIdToken(b,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)):this._user?(this.verbose("renewing access_token"),this._renewToken(a,b)):(this.verbose("renewing idtoken and access_token"),this._renewToken(a,b,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)))):(this.warn("User login is required"),void b("User login is required",null,"login required"))},AuthenticationContext.prototype.acquireTokenPopup=function(a,b,c,d){if(this._isEmpty(a))return this.warn("resource is required"),void d("resource is required",null,"resource is required");if(!this._user)return this.warn("User login is required"),void d("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void d("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var e=this._guid()+"|"+a;this.config.state=e,this._renewStates.push(e),this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,this.verbose("Renew token Expected state: "+e);var f=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",a),"prompt");if(f+="&prompt=select_account",b&&(f+=b),c&&-1===f.indexOf("&claims"))f+="&claims="+encodeURIComponent(c);else if(c&&-1!==f.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");f=this._addHintParameters(f),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+a),this.registerCallback(e,a,d),this._loginPopup(f,a,d)},AuthenticationContext.prototype.acquireTokenRedirect=function(a,b,c){if(this._isEmpty(a))return this.warn("resource is required"),void d("resource is required",null,"resource is required");var d=this.callback;if(!this._user)return this.warn("User login is required"),void d("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void d("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var e=this._guid()+"|"+a;this.config.state=e,this.verbose("Renew token Expected state: "+e);var f=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",a),"prompt");if(f+="&prompt=select_account",b&&(f+=b),c&&-1===f.indexOf("&claims"))f+="&claims="+encodeURIComponent(c);else if(c&&-1!==f.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");f=this._addHintParameters(f),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+a),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,e,!0),this.promptUser(f)},AuthenticationContext.prototype.promptUser=function(a){a?(this.infoPii("Navigate to:"+a),window.location.replace(a)):this.info("Navigate url is empty")},AuthenticationContext.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");var a=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(a)){a=a.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var b=0;b<a.length&&""!==a[b];b++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a[b],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a[b],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},AuthenticationContext.prototype.clearCacheForResource=function(a){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(a)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+a,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+a,0))},AuthenticationContext.prototype.logOut=function(){this.clearCache(),this._user=null;var a;if(this.config.logOutUri)a=this.config.logOutUri;else{var b="common",c="";this.config.tenant&&(b=this.config.tenant),this.config.postLogoutRedirectUri&&(c="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri)),a=this.instance+b+"/oauth2/logout?"+c}this.infoPii("Logout navigate to: "+a),this.promptUser(a)},AuthenticationContext.prototype._isEmpty=function(a){return void 0===a||!a||0===a.length},AuthenticationContext.prototype.getUser=function(a){if("function"!=typeof a)throw new Error("callback is not a function");if(this._user)return void a(null,this._user);var b=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(b)?(this.warn("User information is not available"),a("User information is not available",null)):(this.info("User exists in cache: "),this._user=this._createUser(b),a(null,this._user))},AuthenticationContext.prototype._addHintParameters=function(a){if(this._user&&this._user.profile)if(this._user.profile.sid&&-1!==a.indexOf("&prompt=none"))this._urlContainsQueryStringParameter("sid",a)||(a+="&sid="+encodeURIComponent(this._user.profile.sid));else if(this._user.profile.upn&&(this._urlContainsQueryStringParameter("login_hint",a)||(a+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",a)&&this._user.profile.upn.indexOf("@")>-1)){var b=this._user.profile.upn.split("@");a+="&domain_hint="+encodeURIComponent(b[b.length-1])}return a},AuthenticationContext.prototype._createUser=function(a){var b=null,c=this._extractIdToken(a);return c&&c.hasOwnProperty("aud")&&(c.aud.toLowerCase()===this.config.clientId.toLowerCase()?(b={userName:"",profile:c},c.hasOwnProperty("upn")?b.userName=c.upn:c.hasOwnProperty("email")&&(b.userName=c.email)):this.warn("IdToken has invalid aud field")),b},AuthenticationContext.prototype._getHash=function(a){return a.indexOf("#/")>-1?a=a.substring(a.indexOf("#/")+2):a.indexOf("#")>-1&&(a=a.substring(1)),a},AuthenticationContext.prototype.isCallback=function(a){a=this._getHash(a);var b=this._deserialize(a);return b.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||b.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||b.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},AuthenticationContext.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},AuthenticationContext.prototype.getRequestInfo=function(a){a=this._getHash(a);var b=this._deserialize(a),c={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(b&&(c.parameters=b,b.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||b.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||b.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){c.valid=!0;var d="";if(!b.hasOwnProperty("state"))return this.warn("No state returned"),c;if(this.verbose("State: "+b.state),d=b.state,c.stateResponse=d,this._matchState(c))return c;if(!c.stateMatch&&window.parent){c.requestType=this._requestType;for(var e=this._renewStates,f=0;f<e.length;f++)if(e[f]===c.stateResponse){c.stateMatch=!0;break}}}return c},AuthenticationContext.prototype._matchNonce=function(a){var b=this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN);if(b){b=b.split(this.CONSTANTS.CACHE_DELIMETER);for(var c=0;c<b.length;c++)if(b[c]===a.profile.nonce)return!0}return!1},AuthenticationContext.prototype._matchState=function(a){var b=this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN);if(b){b=b.split(this.CONSTANTS.CACHE_DELIMETER);for(var c=0;c<b.length;c++)if(b[c]===a.stateResponse)return a.requestType=this.REQUEST_TYPE.LOGIN,a.stateMatch=!0,!0}var d=this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW);if(d){d=d.split(this.CONSTANTS.CACHE_DELIMETER);for(var c=0;c<d.length;c++)if(d[c]===a.stateResponse)return a.requestType=this.REQUEST_TYPE.RENEW_TOKEN,a.stateMatch=!0,!0}return!1},AuthenticationContext.prototype._getResourceFromState=function(a){if(a){var b=a.indexOf("|");if(b>-1&&b+1<a.length)return a.substring(b+1)}return""},AuthenticationContext.prototype.saveTokenFromHash=function(a){this.info("State status:"+a.stateMatch+"; Request type:"+a.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var b=this._getResourceFromState(a.stateResponse);if(a.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION))this.infoPii("Error :"+a.parameters.error+"; Error description:"+a.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,a.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,a.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),a.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,a.parameters.error_description));else if(a.stateMatch){this.info("State is right"),a.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,a.parameters[this.CONSTANTS.SESSION_STATE]);var c;a.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(b)||(c=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,c+b+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+b,a.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+b,this._expiresIn(a.parameters[this.CONSTANTS.EXPIRES_IN]))),a.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(a.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile?this._matchNonce(this._user)?(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,a.parameters[this.CONSTANTS.ID_TOKEN]),b=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(b)||(c=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,c+b+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+b,a.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+b,this._user.profile.exp)):(this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)),this._user=null):(a.parameters.error="invalid id_token",a.parameters.error_description="Invalid id_token. id_token: "+a.parameters[this.CONSTANTS.ID_TOKEN],this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+a.parameters[this.CONSTANTS.ID_TOKEN])))}else a.parameters.error="Invalid_state",a.parameters.error_description="Invalid_state. state: "+a.stateResponse,this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+a.stateResponse);this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+b,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)},AuthenticationContext.prototype.getResourceForEndpoint=function(a){if(this.config&&this.config.anonymousEndpoints)for(var b=0;b<this.config.anonymousEndpoints.length;b++)if(a.indexOf(this.config.anonymousEndpoints[b])>-1)return null;if(this.config&&this.config.endpoints)for(var c in this.config.endpoints)if(a.indexOf(c)>-1)return this.config.endpoints[c];return a.indexOf("http://")>-1||a.indexOf("https://")>-1?this._getHostFromUri(a)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource},AuthenticationContext.prototype._getHostFromUri=function(a){var b=String(a).replace(/^(https?:)\/\//,"");return b=b.split("/")[0]},AuthenticationContext.prototype.handleWindowCallback=function(a){if(null==a&&(a=window.location.hash),this.isCallback(a)){var b=null,c=!1;this._openedWindows.length>0&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance?(b=this._openedWindows[this._openedWindows.length-1].opener._adalInstance,c=!0):window.parent&&window.parent._adalInstance&&(b=window.parent._adalInstance);var d,e,f=b.getRequestInfo(a),g=null;e=c||window.parent!==window?b._callBackMappedToRenewStates[f.stateResponse]:b.callback,b.info("Returned from redirect url"),b.saveTokenFromHash(f),f.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(window.parent!==window?b.verbose("Window is in iframe, acquiring token silently"):b.verbose("acquiring token interactive in progress"),d=f.parameters[b.CONSTANTS.ACCESS_TOKEN]||f.parameters[b.CONSTANTS.ID_TOKEN],g=b.CONSTANTS.ACCESS_TOKEN):f.requestType===this.REQUEST_TYPE.LOGIN&&(d=f.parameters[b.CONSTANTS.ID_TOKEN],g=b.CONSTANTS.ID_TOKEN);var h=f.parameters[b.CONSTANTS.ERROR_DESCRIPTION],i=f.parameters[b.CONSTANTS.ERROR];try{e&&e(h,d,i,g)}catch(a){b.error("Error occurred in user defined callback function: "+a)}window.parent!==window||c||(b.config.navigateToLoginRequestUrl?window.location.href=b._getItem(b.CONSTANTS.STORAGE.LOGIN_REQUEST):window.location.hash="")}},AuthenticationContext.prototype._getNavigateUrl=function(a,b){var c="common";this.config.tenant&&(c=this.config.tenant);var d=this.instance+c+"/oauth2/authorize"+this._serialize(a,this.config,b)+this._addLibMetadata();return this.info("Navigate url:"+d),d},AuthenticationContext.prototype._extractIdToken=function(a){var b=this._decodeJwt(a);if(!b)return null;try{var c=b.JWSPayload,d=this._base64DecodeStringUrlSafe(c);return d?JSON.parse(d):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(a){this.error("The returned id_token could not be decoded",a)}return null},AuthenticationContext.prototype._base64DecodeStringUrlSafe=function(a){return a=a.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(a))):decodeURIComponent(escape(this._decode(a)))},AuthenticationContext.prototype._decode=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a=String(a).replace(/=+$/,"");var c=a.length;if(c%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var d,e,f,g,h,i,j,k,l="",m=0;m<c;m+=4){if(d=b.indexOf(a.charAt(m)),e=b.indexOf(a.charAt(m+1)),f=b.indexOf(a.charAt(m+2)),g=b.indexOf(a.charAt(m+3)),m+2===c-1){h=d<<18|e<<12|f<<6,i=h>>16&255,j=h>>8&255,l+=String.fromCharCode(i,j);break}if(m+1===c-1){h=d<<18|e<<12,i=h>>16&255,l+=String.fromCharCode(i);break}h=d<<18|e<<12|f<<6|g,i=h>>16&255,j=h>>8&255,k=255&h,l+=String.fromCharCode(i,j,k)}return l},AuthenticationContext.prototype._decodeJwt=function(a){if(this._isEmpty(a))return null;var b=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/,c=b.exec(a);return!c||c.length<4?(this.warn("The returned id_token is not parseable."),null):{header:c[1],JWSPayload:c[2],JWSSig:c[3]}},AuthenticationContext.prototype._convertUrlSafeToRegularBase64EncodedString=function(a){return a.replace("-","+").replace("_","/")},AuthenticationContext.prototype._serialize=function(a,b,c){var d=[];if(null!==b){d.push("?response_type="+a),d.push("client_id="+encodeURIComponent(b.clientId)),c&&d.push("resource="+encodeURIComponent(c)),d.push("redirect_uri="+encodeURIComponent(b.redirectUri)),d.push("state="+encodeURIComponent(b.state)),b.hasOwnProperty("slice")&&d.push("slice="+encodeURIComponent(b.slice)),b.hasOwnProperty("extraQueryParameter")&&d.push(b.extraQueryParameter);var e=b.correlationId?b.correlationId:this._guid();d.push("client-request-id="+encodeURIComponent(e))}return d.join("&")},AuthenticationContext.prototype._deserialize=function(a){var b,c=/\+/g,d=/([^&=]+)=([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f={};for(b=d.exec(a);b;)f[e(b[1])]=e(b[2]),b=d.exec(a);return f},AuthenticationContext.prototype._decimalToHex=function(a){for(var b=a.toString(16);b.length<2;)b="0"+b;return b},AuthenticationContext.prototype._guid=function(){var a=window.crypto||window.msCrypto;if(a&&a.getRandomValues){var b=new Uint8Array(16);return a.getRandomValues(b),b[6]|=64,b[6]&=79,b[8]|=128,b[8]&=191,this._decimalToHex(b[0])+this._decimalToHex(b[1])+this._decimalToHex(b[2])+this._decimalToHex(b[3])+"-"+this._decimalToHex(b[4])+this._decimalToHex(b[5])+"-"+this._decimalToHex(b[6])+this._decimalToHex(b[7])+"-"+this._decimalToHex(b[8])+this._decimalToHex(b[9])+"-"+this._decimalToHex(b[10])+this._decimalToHex(b[11])+this._decimalToHex(b[12])+this._decimalToHex(b[13])+this._decimalToHex(b[14])+this._decimalToHex(b[15])}for(var c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",d="0123456789abcdef",e=0,f="",g=0;g<36;g++)"-"!==c[g]&&"4"!==c[g]&&(e=16*Math.random()|0),"x"===c[g]?f+=d[e]:"y"===c[g]?(e&=3,e|=8,f+=d[e]):f+=c[g];return f},AuthenticationContext.prototype._expiresIn=function(a){return a||(a=3599),this._now()+parseInt(a,10)},AuthenticationContext.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},AuthenticationContext.prototype._addAdalFrame=function(a){if(void 0!==a){this.info("Add adal frame to document:"+a);var b=document.getElementById(a);if(!b){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var c=document.createElement("iframe");c.setAttribute("id",a),c.setAttribute("aria-hidden","true"),c.style.visibility="hidden",c.style.position="absolute",c.style.width=c.style.height=c.borderWidth="0px",b=document.getElementsByTagName("body")[0].appendChild(c)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+a+'" id="'+a+'" style="display:none"></iframe>');window.frames&&window.frames[a]&&(b=window.frames[a])}return b}},AuthenticationContext.prototype._saveItem=function(a,b,c){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage())return this.info("Local storage is not supported"),!1;if(c){var d=this._getItem(a)||"";localStorage.setItem(a,d+b+this.CONSTANTS.CACHE_DELIMETER)}else localStorage.setItem(a,b);return!0}return this._supportsSessionStorage()?(sessionStorage.setItem(a,b),!0):(this.info("Session storage is not supported"),!1)},AuthenticationContext.prototype._getItem=function(a){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(a):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(a):(this.info("Session storage is not supported"),null)},AuthenticationContext.prototype._supportsLocalStorage=function(){try{return!!window.localStorage&&(window.localStorage.setItem("storageTest","A"),"A"==window.localStorage.getItem("storageTest")&&(window.localStorage.removeItem("storageTest"),!window.localStorage.getItem("storageTest")))}catch(a){return!1}},AuthenticationContext.prototype._supportsSessionStorage=function(){try{return!!window.sessionStorage&&(window.sessionStorage.setItem("storageTest","A"),"A"==window.sessionStorage.getItem("storageTest")&&(window.sessionStorage.removeItem("storageTest"),!window.sessionStorage.getItem("storageTest")))}catch(a){return!1}},AuthenticationContext.prototype._cloneConfig=function(a){if(null===a||"object"!=typeof a)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},AuthenticationContext.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},AuthenticationContext.prototype.log=function(a,b,c,d){if(a<=Logging.level){if(!Logging.piiLoggingEnabled&&d)return;var e=(new Date).toUTCString(),f="";f=this.config.correlationId?e+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[a]+" "+b:e+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[a]+" "+b,c&&(f+="\nstack:\n"+c.stack),Logging.log(f)}},AuthenticationContext.prototype.error=function(a,b){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,a,b)},AuthenticationContext.prototype.warn=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,a,null)},AuthenticationContext.prototype.info=function(a){
this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,a,null)},AuthenticationContext.prototype.verbose=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,a,null)},AuthenticationContext.prototype.errorPii=function(a,b){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,a,b,!0)},AuthenticationContext.prototype.warnPii=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,a,null,!0)},AuthenticationContext.prototype.infoPii=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,a,null,!0)},AuthenticationContext.prototype.verbosePii=function(a){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,a,null,!0)},AuthenticationContext.prototype._libVersion=function(){return"1.0.17"},"undefined"!=typeof module&&module.exports&&(module.exports=AuthenticationContext,module.exports.inject=function(a){return new AuthenticationContext(a)}),AuthenticationContext}();

/***/ }),

/***/ "./node_modules/tslib/tslib.es6.js":
/*!*****************************************!*\
  !*** ./node_modules/tslib/tslib.es6.js ***!
  \*****************************************/
/*! exports provided: __extends, __assign, __rest, __decorate, __param, __metadata, __awaiter, __generator, __exportStar, __values, __read, __spread, __await, __asyncGenerator, __asyncDelegator, __asyncValues, __makeTemplateObject, __importStar, __importDefault */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__extends", function() { return __extends; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__assign", function() { return __assign; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__rest", function() { return __rest; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__decorate", function() { return __decorate; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__param", function() { return __param; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__metadata", function() { return __metadata; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__awaiter", function() { return __awaiter; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__generator", function() { return __generator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__exportStar", function() { return __exportStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__values", function() { return __values; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__read", function() { return __read; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__spread", function() { return __spread; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__await", function() { return __await; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncGenerator", function() { return __asyncGenerator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncDelegator", function() { return __asyncDelegator; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__asyncValues", function() { return __asyncValues; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__makeTemplateObject", function() { return __makeTemplateObject; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importStar", function() { return __importStar; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__importDefault", function() { return __importDefault; });
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    }
    return __assign.apply(this, arguments);
}

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __param(paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function __awaiter(thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

function __exportStar(m, exports) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}

function __values(o) {
    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
    if (m) return m.call(o);
    return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

function __await(v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
}

function __asyncGenerator(thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
}

function __asyncDelegator(o) {
    var i, p;
    return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
}

function __asyncValues(o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};

function __importStar(mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result.default = mod;
    return result;
}

function __importDefault(mod) {
    return (mod && mod.__esModule) ? mod : { default: mod };
}


/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var sputil_1 = __webpack_require__(/*! ./sputil */ "./src/sputil.ts");
window.spUtil = new sputil_1.SPUtil();


/***/ }),

/***/ "./src/sputil.ts":
/*!***********************!*\
  !*** ./src/sputil.ts ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var sp_1 = __webpack_require__(/*! @pnp/sp */ "./node_modules/@pnp/sp/dist/sp.es5.js");
var SPUtil = /** @class */ (function () {
    function SPUtil() {
        console.log("Initializing SPUtil");
    }
    SPUtil.setResult = function (val) {
        document.querySelector(".workbench").innerHTML = val;
    };
    SPUtil.prototype.getWebTitle = function () {
        sp_1.sp.web
            .select()
            .get()
            .then(function (w) {
            SPUtil.setResult(w.Title);
        });
    };
    SPUtil.prototype.getListForWeb = function () {
        sp_1.sp.web.lists
            .select("Id", "Title")
            .orderBy("Title")
            .get()
            .then(function (listIds) {
            for (var index in listIds) {
                var l = sp_1.sp.web.lists.getById(listIds[index].Id);
                l.get()
                    .then(function (list) {
                    for (var key in list) {
                        console.log(key + ": " + list[key]);
                    }
                })
                    .catch(function (error) {
                    console.log(error);
                });
            }
        })
            .catch(function (error) {
            console.log(error);
        });
    };
    SPUtil.prototype.getListItems = function () {
        var list = sp_1.sp.web.lists.getByTitle("News");
        list.items
            .get()
            .then(function (items) {
            for (var i = 0; i < items.length; i++) {
                for (var key in items[i]) {
                    console.log(key + ": " + items[i][key]);
                }
            }
        })
            .catch(function (error) {
            console.log(error);
        });
    };
    SPUtil.prototype.addListItem = function () {
        var list = sp_1.sp.web.lists.getByTitle("News");
        list.items
            .add({
            Title: "Title",
            Body: "Body for PnP Core JS List Item"
        })
            .then(function (iar) {
            console.log(iar);
        });
    };
    SPUtil.prototype.updateListItem = function () {
        var list = sp_1.sp.web.lists.getByTitle("News");
        list.items
            .getById(1)
            .update({
            Title: "My New Title",
            Body: "Here is a new body"
        })
            .then(function (i) {
            console.log(i);
        });
    };
    SPUtil.prototype.deleteListItem = function () {
        var list = sp_1.sp.web.lists.getByTitle("News");
        list.items
            .getById(1)
            .delete()
            .then(function () { return console.log("item deleted"); });
    };
    return SPUtil;
}());
exports.SPUtil = SPUtil;


/***/ }),

/***/ "C:\\Users\\Administrator\\AppData\\Roaming\\npm\\node_modules\\webpack\\buildin\\global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

var g;

// This works in non-strict mode
g = (function() {
	return this;
})();

try {
	// This works if eval is allowed (see CSP)
	g = g || Function("return this")() || (1, eval)("this");
} catch (e) {
	// This works if the window reference is available
	if (typeof window === "object") g = window;
}

// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}

module.exports = g;


/***/ })

/******/ });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BwbnAvY29tbW9uL2Rpc3QvY29tbW9uLmVzNS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQHBucC9sb2dnaW5nL2Rpc3QvbG9nZ2luZy5lczUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BwbnAvb2RhdGEvZGlzdC9vZGF0YS5lczUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BwbnAvc3AvZGlzdC9zcC5lczUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2FkYWwtYW5ndWxhci9kaXN0L2FkYWwubWluLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy90c2xpYi90c2xpYi5lczYuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovLy8uL3NyYy9zcHV0aWwudHMiLCJ3ZWJwYWNrOi8vLyh3ZWJwYWNrKS9idWlsZGluL2dsb2JhbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxrREFBMEMsZ0NBQWdDO0FBQzFFO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZ0VBQXdELGtCQUFrQjtBQUMxRTtBQUNBLHlEQUFpRCxjQUFjO0FBQy9EOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBeUMsaUNBQWlDO0FBQzFFLHdIQUFnSCxtQkFBbUIsRUFBRTtBQUNySTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG1DQUEyQiwwQkFBMEIs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Q0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLGVBQWU7QUFDdEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwyRUFBMkUsMEJBQTBCLEVBQUU7QUFDdkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDBCQUEwQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLHFCQUFxQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGlCQUFpQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlGQUFxQyxjQUFjLDZCQUE2QixFQUFFO0FBQ2xGO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qiw4QkFBOEI7QUFDdkQsU0FBUztBQUNULDhCQUE4QixpQkFBaUI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkZBQXVDLGNBQWMscUJBQXFCLEVBQUU7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsa0NBQWtDO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsZ0NBQWdDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQywwREFBMEQ7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQywwQ0FBMEM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsb0NBQW9DO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxnREFBZ0Q7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsd0NBQXdDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsMENBQTBDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQywwQ0FBMEM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyw0QkFBNEI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyw0QkFBNEI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQywwQ0FBMEM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxrQ0FBa0M7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGdFQUFnRTtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGdEQUFnRDtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxvRUFBb0U7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHNEQUFzRDtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsd0RBQXdEO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxzREFBc0Q7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxD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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1FQUFtRSxVQUFVLDRCQUE0QixFQUFFLEVBQUU7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxL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QUFrRTtBQUN6RixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLGdCQUFnQixFQUFFO0FBQzNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLHdCQUF3QjtBQUNqRTtBQUNBO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELEdBQUc7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixpQkFBaUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxnQkFBZ0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsMkRBQTJELGlCQUFpQjtBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULGtFQUFrRSxpQkFBaUI7QUFDbkY7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGFBQWE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxvQkFBb0I7QUFDekQsK0JBQStCLFlBQVk7QUFDM0MseUNBQXlDLHdCQUF3QjtBQUNqRSwwQ0FBMEMseUJBQXlCO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5Qyx3QkFBd0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGtIQUE4RCxFQUFFO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGtIQUE4RCxFQUFFO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUVBQXlFO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMseUJBQXlCLEVBQUU7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixnQkFBZ0I7QUFDL0MsNEJBQTRCLGFBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsbUJBQW1CO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLHVCQUF1QjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixpQkFBaUIsd0JBQXdCLHNEQUFzRCxFQUFFO0FBQy9IO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0dBQThDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsYUFBYTtBQUMzQyxrQ0FBa0MsaUJBQWlCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFELDJCQUEyQjtBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsYUFBYSxJQUFJO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHNDQUFzQztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQywwREFBMEQ7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsd0RBQXdEO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0hBQWtFLG9DQUFvQyxFQUFFLGlCQUFpQixvQkFBb0I7QUFDN0k7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsOEJBQThCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBLFVBQVUsR0FBRztBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixlQUFlO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixlQUFlO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLGVBQWU7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQSwyQ0FBMkMsMkJBQTJCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLDJCQUEyQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQywyQkFBMkI7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLDhDQUE4Qyw4QkFBOEI7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsa0JBQWtCO0FBQ3ZELGtDQUFrQyxrQkFBa0I7QUFDcEQsa0NBQWtDLGlCQUFpQjtBQUNuRCw0Q0FBNEMsMkJBQTJCO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHNDQUFzQztBQUNyRSxhQUFhO0FBQ2IsU0FBUztBQUNULG1EQUFtRCxpQkFBaUI7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMseUJBQXlCO0FBQ3JFLDhDQUE4QywyQkFBMkI7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUVBQXFFLHlCQUF5QixFQUFFO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0dBQWdHO0FBQ2hHO0FBQ0E7QUFDQSxTQUFTLEVBQUUsRUFBRTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qiw2Q0FBNkM7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsZUFBZTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsaUNBQWlDO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxxQkFBcUIsa0JBQWtCLEVBQUUsc0JBQXNCLGtCQUFrQixFQUFFO0FBQ2hHLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSx1QkFBdUIsaUJBQWlCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsNEJBQTRCO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0Q7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkVBQXVCLHFCQUFxQjtBQUM1QyxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsNEJBQTRCO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0Q7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQseURBQXlEO0FBQ3RIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLHlEQUF5RDtBQUMxSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9FQUFvRSx5REFBeUQ7QUFDN0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDBDQUEwQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDRDQUE0QztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxnREFBZ0Q7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVEO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDRDQUE0Qzs7QUFFN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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SyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUUzQyxJQUFJLENBQUMsS0FBSzthQUNQLE9BQU8sQ0FBQyxDQUFDLENBQUM7YUFDVixNQUFNLENBQUM7WUFDTixLQUFLLEVBQUUsY0FBYztZQUNyQixJQUFJLEVBQUUsb0JBQW9CO1NBQzNCLENBQUM7YUFDRCxJQUFJLENBQUMsV0FBQztZQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsK0JBQWMsR0FBZDtRQUNFLElBQUksSUFBSSxHQUFHLE9BQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUUzQyxJQUFJLENBQUMsS0FBSzthQUNQLE9BQU8sQ0FBQyxDQUFDLENBQUM7YUFDVixNQUFNLEVBQUU7YUFDUixJQUFJLENBQUMsY0FBTSxjQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxFQUEzQixDQUEyQixDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUNILGFBQUM7QUFBRCxDQUFDO0FBaEdZLHdCQUFNOzs7Ozs7Ozs7Ozs7QUNGbkI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw0Q0FBNEM7O0FBRTVDIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSBcIi4vc3JjL2luZGV4LnRzXCIpO1xuIiwiLyoqXG5AbGljZW5zZVxuICogQHBucC9jb21tb24gdjEuMi4xIC0gcG5wIC0gcHJvdmlkZXMgc2hhcmVkIGZ1bmN0aW9uYWxpdHkgYWNyb3NzIGFsbCBwbnAgbGlicmFyaWVzXG4gKiBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS9wbnAvcG5wanMvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqIENvcHlyaWdodCAoYykgMjAxOCBNaWNyb3NvZnRcbiAqIGRvY3M6IGh0dHBzOi8vcG5wLmdpdGh1Yi5pby9wbnBqcy9cbiAqIHNvdXJjZTogaHR0cHM6Z2l0aHViLmNvbS9wbnAvcG5wanNcbiAqIGJ1Z3M6IGh0dHBzOi8vZ2l0aHViLmNvbS9wbnAvcG5wanMvaXNzdWVzXG4gKi9cbmltcG9ydCB7IF9fZXh0ZW5kcyB9IGZyb20gJ3RzbGliJztcbmltcG9ydCB7IGluamVjdCB9IGZyb20gJ2FkYWwtYW5ndWxhci9kaXN0L2FkYWwubWluLmpzJztcblxudmFyIGdsb2JhbCQxID0gKHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOlxuICAgICAgICAgICAgdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDpcbiAgICAgICAgICAgIHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSk7XG5cbi8qKlxyXG4gKiBHZXRzIGEgY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggd2lsbCBtYWludGFpbiBjb250ZXh0IGFjcm9zcyBhc3luYyBjYWxscy5cclxuICogQWxsb3dzIGZvciB0aGUgY2FsbGluZyBwYXR0ZXJuIGdldEN0eENhbGxiYWNrKHRoaXNvYmosIG1ldGhvZCwgbWV0aG9kYXJnMSwgbWV0aG9kYXJnMiwgLi4uKVxyXG4gKlxyXG4gKiBAcGFyYW0gY29udGV4dCBUaGUgb2JqZWN0IHRoYXQgd2lsbCBiZSB0aGUgJ3RoaXMnIHZhbHVlIGluIHRoZSBjYWxsYmFja1xyXG4gKiBAcGFyYW0gbWV0aG9kIFRoZSBtZXRob2QgdG8gd2hpY2ggd2Ugd2lsbCBhcHBseSB0aGUgY29udGV4dCBhbmQgcGFyYW1ldGVyc1xyXG4gKiBAcGFyYW0gcGFyYW1zIE9wdGlvbmFsLCBhZGRpdGlvbmFsIGFyZ3VtZW50cyB0byBzdXBwbHkgdG8gdGhlIHdyYXBwZWQgbWV0aG9kIHdoZW4gaXQgaXMgaW52b2tlZFxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0Q3R4Q2FsbGJhY2soY29udGV4dCwgbWV0aG9kKSB7XHJcbiAgICB2YXIgcGFyYW1zID0gW107XHJcbiAgICBmb3IgKHZhciBfaSA9IDI7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIHBhcmFtc1tfaSAtIDJdID0gYXJndW1lbnRzW19pXTtcclxuICAgIH1cclxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbWV0aG9kLmFwcGx5KGNvbnRleHQsIHBhcmFtcyk7XHJcbiAgICB9O1xyXG59XHJcbi8qKlxyXG4gKiBBZGRzIGEgdmFsdWUgdG8gYSBkYXRlXHJcbiAqXHJcbiAqIEBwYXJhbSBkYXRlIFRoZSBkYXRlIHRvIHdoaWNoIHdlIHdpbGwgYWRkIHVuaXRzLCBkb25lIGluIGxvY2FsIHRpbWVcclxuICogQHBhcmFtIGludGVydmFsIFRoZSBuYW1lIG9mIHRoZSBpbnRlcnZhbCB0byBhZGQsIG9uZSBvZjogWyd5ZWFyJywgJ3F1YXJ0ZXInLCAnbW9udGgnLCAnd2VlaycsICdkYXknLCAnaG91cicsICdtaW51dGUnLCAnc2Vjb25kJ11cclxuICogQHBhcmFtIHVuaXRzIFRoZSBhbW91bnQgdG8gYWRkIHRvIGRhdGUgb2YgdGhlIGdpdmVuIGludGVydmFsXHJcbiAqXHJcbiAqIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTE5NzkyOC9ob3ctdG8tYWRkLTMwLW1pbnV0ZXMtdG8tYS1qYXZhc2NyaXB0LWRhdGUtb2JqZWN0XHJcbiAqL1xyXG5mdW5jdGlvbiBkYXRlQWRkKGRhdGUsIGludGVydmFsLCB1bml0cykge1xyXG4gICAgdmFyIHJldCA9IG5ldyBEYXRlKGRhdGUpOyAvLyBkb24ndCBjaGFuZ2Ugb3JpZ2luYWwgZGF0ZVxyXG4gICAgc3dpdGNoIChpbnRlcnZhbC50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgY2FzZSBcInllYXJcIjpcclxuICAgICAgICAgICAgcmV0LnNldEZ1bGxZZWFyKHJldC5nZXRGdWxsWWVhcigpICsgdW5pdHMpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwicXVhcnRlclwiOlxyXG4gICAgICAgICAgICByZXQuc2V0TW9udGgocmV0LmdldE1vbnRoKCkgKyAzICogdW5pdHMpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwibW9udGhcIjpcclxuICAgICAgICAgICAgcmV0LnNldE1vbnRoKHJldC5nZXRNb250aCgpICsgdW5pdHMpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwid2Vla1wiOlxyXG4gICAgICAgICAgICByZXQuc2V0RGF0ZShyZXQuZ2V0RGF0ZSgpICsgNyAqIHVuaXRzKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcImRheVwiOlxyXG4gICAgICAgICAgICByZXQuc2V0RGF0ZShyZXQuZ2V0RGF0ZSgpICsgdW5pdHMpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiaG91clwiOlxyXG4gICAgICAgICAgICByZXQuc2V0VGltZShyZXQuZ2V0VGltZSgpICsgdW5pdHMgKiAzNjAwMDAwKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcIm1pbnV0ZVwiOlxyXG4gICAgICAgICAgICByZXQuc2V0VGltZShyZXQuZ2V0VGltZSgpICsgdW5pdHMgKiA2MDAwMCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJzZWNvbmRcIjpcclxuICAgICAgICAgICAgcmV0LnNldFRpbWUocmV0LmdldFRpbWUoKSArIHVuaXRzICogMTAwMCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmV0O1xyXG59XHJcbi8qKlxyXG4gKiBDb21iaW5lcyBhbiBhcmJpdHJhcnkgc2V0IG9mIHBhdGhzIGVuc3VyaW5nIGFuZCBub3JtYWxpemVzIHRoZSBzbGFzaGVzXHJcbiAqXHJcbiAqIEBwYXJhbSBwYXRocyAwIHRvIG4gcGF0aCBwYXJ0cyB0byBjb21iaW5lXHJcbiAqL1xyXG5mdW5jdGlvbiBjb21iaW5lKCkge1xyXG4gICAgdmFyIHBhdGhzID0gW107XHJcbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIHBhdGhzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGF0aHNcclxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChwYXRoKSB7IHJldHVybiAhc3RyaW5nSXNOdWxsT3JFbXB0eShwYXRoKTsgfSlcclxuICAgICAgICAubWFwKGZ1bmN0aW9uIChwYXRoKSB7IHJldHVybiBwYXRoLnJlcGxhY2UoL15bXFxcXHxcXC9dLywgXCJcIikucmVwbGFjZSgvW1xcXFx8XFwvXSQvLCBcIlwiKTsgfSlcclxuICAgICAgICAuam9pbihcIi9cIilcclxuICAgICAgICAucmVwbGFjZSgvXFxcXC9nLCBcIi9cIik7XHJcbn1cclxuLyoqXHJcbiAqIEdldHMgYSByYW5kb20gc3RyaW5nIG9mIGNoYXJzIGxlbmd0aFxyXG4gKlxyXG4gKiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMzQ5NDA0L2dlbmVyYXRlLXJhbmRvbS1zdHJpbmctY2hhcmFjdGVycy1pbi1qYXZhc2NyaXB0XHJcbiAqXHJcbiAqIEBwYXJhbSBjaGFycyBUaGUgbGVuZ3RoIG9mIHRoZSByYW5kb20gc3RyaW5nIHRvIGdlbmVyYXRlXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRSYW5kb21TdHJpbmcoY2hhcnMpIHtcclxuICAgIHZhciB0ZXh0ID0gbmV3IEFycmF5KGNoYXJzKTtcclxuICAgIHZhciBwb3NzaWJsZSA9IFwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODlcIjtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhcnM7IGkrKykge1xyXG4gICAgICAgIHRleHRbaV0gPSBwb3NzaWJsZS5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcG9zc2libGUubGVuZ3RoKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGV4dC5qb2luKFwiXCIpO1xyXG59XHJcbi8qKlxyXG4gKiBHZXRzIGEgcmFuZG9tIEdVSUQgdmFsdWVcclxuICpcclxuICogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDUwMzQvY3JlYXRlLWd1aWQtdXVpZC1pbi1qYXZhc2NyaXB0XHJcbiAqL1xyXG4vKiB0c2xpbnQ6ZGlzYWJsZSBuby1iaXR3aXNlICovXHJcbmZ1bmN0aW9uIGdldEdVSUQoKSB7XHJcbiAgICB2YXIgZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgdmFyIGd1aWQgPSBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHtcclxuICAgICAgICB2YXIgciA9IChkICsgTWF0aC5yYW5kb20oKSAqIDE2KSAlIDE2IHwgMDtcclxuICAgICAgICBkID0gTWF0aC5mbG9vcihkIC8gMTYpO1xyXG4gICAgICAgIHJldHVybiAoYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMgfCAweDgpKS50b1N0cmluZygxNik7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBndWlkO1xyXG59XHJcbi8qIHRzbGludDplbmFibGUgKi9cclxuLyoqXHJcbiAqIERldGVybWluZXMgaWYgYSBnaXZlbiB2YWx1ZSBpcyBhIGZ1bmN0aW9uXHJcbiAqXHJcbiAqIEBwYXJhbSBjZiBUaGUgdGhpbmcgdG8gdGVzdCBmb3IgZnVuY3Rpb25uZXNzXHJcbiAqL1xyXG5mdW5jdGlvbiBpc0Z1bmMoY2YpIHtcclxuICAgIHJldHVybiB0eXBlb2YgY2YgPT09IFwiZnVuY3Rpb25cIjtcclxufVxyXG4vKipcclxuICogRGV0ZXJtaW5lcyBpZiBhbiBvYmplY3QgaXMgYm90aCBkZWZpbmVkIGFuZCBub3QgbnVsbFxyXG4gKiBAcGFyYW0gb2JqIE9iamVjdCB0byB0ZXN0XHJcbiAqL1xyXG5mdW5jdGlvbiBvYmplY3REZWZpbmVkTm90TnVsbChvYmopIHtcclxuICAgIHJldHVybiB0eXBlb2Ygb2JqICE9PSBcInVuZGVmaW5lZFwiICYmIG9iaiAhPT0gbnVsbDtcclxufVxyXG4vKipcclxuICogQHJldHVybnMgd2hldGhlciB0aGUgcHJvdmlkZWQgcGFyYW1ldGVyIGlzIGEgSmF2YVNjcmlwdCBBcnJheSBvciBub3QuXHJcbiovXHJcbmZ1bmN0aW9uIGlzQXJyYXkoYXJyYXkpIHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KSB7XHJcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoYXJyYXkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycmF5ICYmIHR5cGVvZiBhcnJheS5sZW5ndGggPT09IFwibnVtYmVyXCIgJiYgYXJyYXkuY29uc3RydWN0b3IgPT09IEFycmF5O1xyXG59XHJcbi8qKlxyXG4gKiBQcm92aWRlcyBmdW5jdGlvbmFsaXR5IHRvIGV4dGVuZCB0aGUgZ2l2ZW4gb2JqZWN0IGJ5IGRvaW5nIGEgc2hhbGxvdyBjb3B5XHJcbiAqXHJcbiAqIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0byB3aGljaCBwcm9wZXJ0aWVzIHdpbGwgYmUgY29waWVkXHJcbiAqIEBwYXJhbSBzb3VyY2UgVGhlIHNvdXJjZSBvYmplY3QgZnJvbSB3aGljaCBwcm9wZXJ0aWVzIHdpbGwgYmUgY29waWVkXHJcbiAqIEBwYXJhbSBub092ZXJ3cml0ZSBJZiB0cnVlIGV4aXN0aW5nIHByb3BlcnRpZXMgb24gdGhlIHRhcmdldCBhcmUgbm90IG92ZXJ3cml0dGVuIGZyb20gdGhlIHNvdXJjZVxyXG4gKiBAcGFyYW0gZmlsdGVyIElmIHByb3ZpZGVkIGFsbG93cyBhZGRpdGlvbmFsIGZpbHRlcmluZyBvbiB3aGF0IHByb3BlcnRpZXMgYXJlIGNvcGllZCAocHJvcE5hbWU6IHN0cmluZykgPT4gYm9vbGVhblxyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gZXh0ZW5kKHRhcmdldCwgc291cmNlLCBub092ZXJ3cml0ZSwgZmlsdGVyKSB7XHJcbiAgICBpZiAobm9PdmVyd3JpdGUgPT09IHZvaWQgMCkgeyBub092ZXJ3cml0ZSA9IGZhbHNlOyB9XHJcbiAgICBpZiAoZmlsdGVyID09PSB2b2lkIDApIHsgZmlsdGVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdHJ1ZTsgfTsgfVxyXG4gICAgaWYgKCFvYmplY3REZWZpbmVkTm90TnVsbChzb3VyY2UpKSB7XHJcbiAgICAgICAgcmV0dXJuIHRhcmdldDtcclxuICAgIH1cclxuICAgIC8vIGVuc3VyZSB3ZSBkb24ndCBvdmVyd3JpdGUgdGhpbmdzIHdlIGRvbid0IHdhbnQgb3ZlcndyaXR0ZW5cclxuICAgIHZhciBjaGVjayA9IG5vT3ZlcndyaXRlID8gZnVuY3Rpb24gKG8sIGkpIHsgcmV0dXJuICEoaSBpbiBvKTsgfSA6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH07XHJcbiAgICAvLyBmaW5hbCBmaWx0ZXIgd2Ugd2lsbCB1c2VcclxuICAgIHZhciBmID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIGNoZWNrKHRhcmdldCwgdikgJiYgZmlsdGVyKHYpOyB9O1xyXG4gICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHNvdXJjZSlcclxuICAgICAgICAuZmlsdGVyKGYpXHJcbiAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAodCwgdikge1xyXG4gICAgICAgIHRbdl0gPSBzb3VyY2Vbdl07XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9LCB0YXJnZXQpO1xyXG59XHJcbi8qKlxyXG4gKiBEZXRlcm1pbmVzIGlmIGEgZ2l2ZW4gdXJsIGlzIGFic29sdXRlXHJcbiAqXHJcbiAqIEBwYXJhbSB1cmwgVGhlIHVybCB0byBjaGVjayB0byBzZWUgaWYgaXQgaXMgYWJzb2x1dGVcclxuICovXHJcbmZ1bmN0aW9uIGlzVXJsQWJzb2x1dGUodXJsKSB7XHJcbiAgICByZXR1cm4gL15odHRwcz86XFwvXFwvfF5cXC9cXC8vaS50ZXN0KHVybCk7XHJcbn1cclxuLyoqXHJcbiAqIERldGVybWluZXMgaWYgYSBzdHJpbmcgaXMgbnVsbCBvciBlbXB0eSBvciB1bmRlZmluZWRcclxuICpcclxuICogQHBhcmFtIHMgVGhlIHN0cmluZyB0byB0ZXN0XHJcbiAqL1xyXG5mdW5jdGlvbiBzdHJpbmdJc051bGxPckVtcHR5KHMpIHtcclxuICAgIHJldHVybiBzID09PSB1bmRlZmluZWQgfHwgcyA9PT0gbnVsbCB8fCBzLmxlbmd0aCA8IDE7XHJcbn1cclxuLyoqXHJcbiAqIEdldHMgYW4gYXR0cmlidXRlIHZhbHVlIGZyb20gYW4gaHRtbC94bWwgc3RyaW5nIGJsb2NrLiBOT1RFOiBpZiB0aGUgaW5wdXQgYXR0cmlidXRlIHZhbHVlIGhhc1xyXG4gKiBSZWdFeCBzcGVjaWFsIGNoYXJhY3RlcnMgdGhleSB3aWxsIGJlIGVzY2FwZWQgaW4gdGhlIHJldHVybmVkIHN0cmluZ1xyXG4gKlxyXG4gKiBAcGFyYW0gaHRtbCBIVE1MIHRvIHNlYXJjaFxyXG4gKiBAcGFyYW0gYXR0ck5hbWUgVGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZSB0byBmaW5kXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRBdHRyVmFsdWVGcm9tU3RyaW5nKGh0bWwsIGF0dHJOYW1lKSB7XHJcbiAgICAvLyBtYWtlIHRoZSBpbnB1dCBzYWZlIGZvciByZWdleFxyXG4gICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCIpO1xyXG4gICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoYXR0ck5hbWUgKyBcIlxcXFxzKj89XFxcXHMqPyhcXFwifCcpKFteXFxcXDFdKj8pXFxcXDFcIiwgXCJpXCIpO1xyXG4gICAgdmFyIG1hdGNoID0gcmVnLmV4ZWMoaHRtbCk7XHJcbiAgICByZXR1cm4gbWF0Y2ggIT09IG51bGwgJiYgbWF0Y2gubGVuZ3RoID4gMCA/IG1hdGNoWzJdIDogbnVsbDtcclxufVxyXG4vKipcclxuICogRW5zdXJlcyBndWlkIHZhbHVlcyBhcmUgcmVwcmVzZW50ZWQgY29uc2lzdGVudGx5IGFzIFwiZWExMjM0NjMtMTM3ZC00YWUzLTg5YjgtY2YzZmM1NzhjYTA1XCJcclxuICpcclxuICogQHBhcmFtIGd1aWQgVGhlIGNhbmRpZGF0ZSBndWlkXHJcbiAqL1xyXG5mdW5jdGlvbiBzYW5pdGl6ZUd1aWQoZ3VpZCkge1xyXG4gICAgaWYgKHN0cmluZ0lzTnVsbE9yRW1wdHkoZ3VpZCkpIHtcclxuICAgICAgICByZXR1cm4gZ3VpZDtcclxuICAgIH1cclxuICAgIHZhciBtYXRjaGVzID0gLyhbMC05QS1GXXs4fS1bMC05QS1GXXs0fS1bMC05QS1GXXs0fS1bMC05QS1GXXs0fS1bMC05QS1GXXsxMn0pL2kuZXhlYyhndWlkKTtcclxuICAgIHJldHVybiBtYXRjaGVzID09PSBudWxsID8gZ3VpZCA6IG1hdGNoZXNbMV07XHJcbn1cclxuLyoqXHJcbiAqIFNob3J0aGFuZCBmb3Igb1RvU1xyXG4gKlxyXG4gKiBAcGFyYW0gbyBBbnkgdHlwZSBvZiBvYmplY3RcclxuICovXHJcbmZ1bmN0aW9uIGpzUyhvKSB7XHJcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobyk7XHJcbn1cclxuLyoqXHJcbiAqIFNob3J0aGFuZCBmb3IgT2JqZWN0Lmhhc093blByb3BlcnR5XHJcbiAqXHJcbiAqIEBwYXJhbSBvIE9iamVjdCB0byBjaGVjayBmb3JcclxuICogQHBhcmFtIHAgTmFtZSBvZiB0aGUgcHJvcGVydHlcclxuICovXHJcbmZ1bmN0aW9uIGhPUChvLCBwKSB7XHJcbiAgICByZXR1cm4gT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobywgcCk7XHJcbn1cclxuLyoqXHJcbiAqIEdlbmVyYXRlcyBhIH51bmlxdWUgaGFzaCBjb2RlIGZvciB0aGlzIE9iamVjdFBhdGhRdWV1ZVxyXG4gKlxyXG4gKiBGcm9tOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy82MTIyNTcxL3NpbXBsZS1ub24tc2VjdXJlLWhhc2gtZnVuY3Rpb24tZm9yLWphdmFzY3JpcHRcclxuICovXHJcbi8vIHRzbGludDpkaXNhYmxlOm5vLWJpdHdpc2VcclxuZnVuY3Rpb24gZ2V0SGFzaENvZGUocykge1xyXG4gICAgdmFyIGhhc2ggPSAwO1xyXG4gICAgaWYgKHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIGhhc2g7XHJcbiAgICB9XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIgY2hyID0gcy5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNocjtcclxuICAgICAgICBoYXNoIHw9IDA7IC8vIENvbnZlcnQgdG8gMzJiaXQgaW50ZWdlclxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhhc2g7XHJcbn1cclxuLy8gdHNsaW50OmVuYWJsZTpuby1iaXR3aXNlXG5cbmZ1bmN0aW9uIG1lcmdlSGVhZGVycyh0YXJnZXQsIHNvdXJjZSkge1xyXG4gICAgaWYgKHNvdXJjZSAhPT0gdW5kZWZpbmVkICYmIHNvdXJjZSAhPT0gbnVsbCkge1xyXG4gICAgICAgIHZhciB0ZW1wID0gbmV3IFJlcXVlc3QoXCJcIiwgeyBoZWFkZXJzOiBzb3VyY2UgfSk7XHJcbiAgICAgICAgdGVtcC5oZWFkZXJzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBuYW1lKSB7XHJcbiAgICAgICAgICAgIHRhcmdldC5hcHBlbmQobmFtZSwgdmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1lcmdlT3B0aW9ucyh0YXJnZXQsIHNvdXJjZSkge1xyXG4gICAgaWYgKG9iamVjdERlZmluZWROb3ROdWxsKHNvdXJjZSkpIHtcclxuICAgICAgICB2YXIgaGVhZGVycyA9IGV4dGVuZCh0YXJnZXQuaGVhZGVycyB8fCB7fSwgc291cmNlLmhlYWRlcnMpO1xyXG4gICAgICAgIHRhcmdldCA9IGV4dGVuZCh0YXJnZXQsIHNvdXJjZSk7XHJcbiAgICAgICAgdGFyZ2V0LmhlYWRlcnMgPSBoZWFkZXJzO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBNYWtlcyByZXF1ZXN0cyB1c2luZyB0aGUgZ2xvYmFsL3dpbmRvdyBmZXRjaCBBUElcclxuICovXHJcbnZhciBGZXRjaENsaWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEZldGNoQ2xpZW50KCkge1xyXG4gICAgfVxyXG4gICAgRmV0Y2hDbGllbnQucHJvdG90eXBlLmZldGNoID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBnbG9iYWwkMS5mZXRjaCh1cmwsIG9wdGlvbnMpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBGZXRjaENsaWVudDtcclxufSgpKTtcclxuLyoqXHJcbiAqIE1ha2VzIHJlcXVlc3RzIHVzaW5nIHRoZSBmZXRjaCBBUEkgYWRkaW5nIHRoZSBzdXBwbGllZCB0b2tlbiB0byB0aGUgQXV0aG9yaXphdGlvbiBoZWFkZXJcclxuICovXHJcbnZhciBCZWFyZXJUb2tlbkZldGNoQ2xpZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEJlYXJlclRva2VuRmV0Y2hDbGllbnQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBCZWFyZXJUb2tlbkZldGNoQ2xpZW50KF90b2tlbikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX3Rva2VuID0gX3Rva2VuO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCZWFyZXJUb2tlbkZldGNoQ2xpZW50LnByb3RvdHlwZSwgXCJ0b2tlblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90b2tlbjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Rva2VuID0gdG9rZW47XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBCZWFyZXJUb2tlbkZldGNoQ2xpZW50LnByb3RvdHlwZS5mZXRjaCA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcclxuICAgICAgICBtZXJnZUhlYWRlcnMoaGVhZGVycywgb3B0aW9ucy5oZWFkZXJzKTtcclxuICAgICAgICBoZWFkZXJzLnNldChcIkF1dGhvcml6YXRpb25cIiwgXCJCZWFyZXIgXCIgKyB0aGlzLl90b2tlbik7XHJcbiAgICAgICAgb3B0aW9ucy5oZWFkZXJzID0gaGVhZGVycztcclxuICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5mZXRjaC5jYWxsKHRoaXMsIHVybCwgb3B0aW9ucyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEJlYXJlclRva2VuRmV0Y2hDbGllbnQ7XHJcbn0oRmV0Y2hDbGllbnQpKTtcblxuLyoqXHJcbiAqIEF6dXJlIEFEIENsaWVudCBmb3IgdXNlIGluIHRoZSBicm93c2VyXHJcbiAqL1xyXG52YXIgQWRhbENsaWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhBZGFsQ2xpZW50LCBfc3VwZXIpO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIEFkYWxDbGllbnRcclxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBBenVyZSBBcHAgSWRcclxuICAgICAqIEBwYXJhbSB0ZW5hbnQgT2ZmaWNlIDM2NSB0ZW5hbnQgKEV4OiB7dGVuYW50fS5vbm1pY3Jvc29mdC5jb20pXHJcbiAgICAgKiBAcGFyYW0gcmVkaXJlY3RVcmkgVGhlIHJlZGlyZWN0IHVybCB1c2VkIHRvIGF1dGhlbnRpY2F0ZSB0aGVcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gQWRhbENsaWVudChjbGllbnRJZCwgdGVuYW50LCByZWRpcmVjdFVyaSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG51bGwpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuY2xpZW50SWQgPSBjbGllbnRJZDtcclxuICAgICAgICBfdGhpcy50ZW5hbnQgPSB0ZW5hbnQ7XHJcbiAgICAgICAgX3RoaXMucmVkaXJlY3RVcmkgPSByZWRpcmVjdFVyaTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgQWRhbENsaWVudCB1c2luZyB0aGUgdmFsdWVzIG9mIHRoZSBzdXBwbGllZCBTUEZ4IGNvbnRleHRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc3BmeENvbnRleHQgQ3VycmVudCBTUEZ4IGNvbnRleHRcclxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBPcHRpb25hbCBjbGllbnQgaWQgdG8gdXNlIGluc3RlYWQgb2YgdGhlIGJ1aWx0LWluIFNQRnggaWRcclxuICAgICAqIEBkZXNjcmlwdGlvbiBVc2luZyB0aGlzIG1ldGhvZCBhbmQgdGhlIGRlZmF1bHQgY2xpZW50SWQgcmVxdWlyZXMgdGhhdCB0aGUgZmVhdHVyZXMgZGVzY3JpYmVkIGluXHJcbiAgICAgKiB0aGlzIGFydGljbGUgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvc2hhcmVwb2ludC9kZXYvc3BmeC91c2UtYWFkaHR0cGNsaWVudCBhcmUgYWN0aXZhdGVkIGluIHRoZSB0ZW5hbnQuIElmIG5vdCB5b3UgY2FuXHJcbiAgICAgKiBjcmVhdCB5b3VyIG93biBhcHAsIGdyYW50IHBlcm1pc3Npb25zIGFuZCB1c2UgdGhhdCBjbGllbnRJZCBoZXJlIGFsb25nIHdpdGggdGhlIFNQRnggY29udGV4dFxyXG4gICAgICovXHJcbiAgICBBZGFsQ2xpZW50LmZyb21TUEZ4Q29udGV4dCA9IGZ1bmN0aW9uIChzcGZ4Q29udGV4dCwgY2xpZW5kSWQpIHtcclxuICAgICAgICBpZiAoY2xpZW5kSWQgPT09IHZvaWQgMCkgeyBjbGllbmRJZCA9IFwiYzU4NjM3YmItZTJlMS00MzEyLThhMDAtMDRiNWZmY2QzNDAzXCI7IH1cclxuICAgICAgICAvLyB0aGlzIFwibWFnaWNcIiBjbGllbnQgaWQgaXMgdGhlIG9uZSB0byB3aGljaCBwZXJtaXNzaW9ucyBhcmUgZ3JhbnRlZCBiZWhpbmQgdGhlIHNjZW5lc1xyXG4gICAgICAgIC8vIHRoaXMgcmVkaXJlY3RVcmwgaXMgdGhlIHBhZ2UgYXMgdXNlZCBieSBzcGZ4XHJcbiAgICAgICAgcmV0dXJuIG5ldyBBZGFsQ2xpZW50KGNsaWVuZElkLCBzcGZ4Q29udGV4dC5wYWdlQ29udGV4dC5hYWRJbmZvLnRlbmFudElkLnRvU3RyaW5nKCksIGNvbWJpbmUod2luZG93LmxvY2F0aW9uLm9yaWdpbiwgXCIvX2Zvcm1zL3NwZnhzaW5nbGVzaWdub24uYXNweFwiKSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDb25kdWN0cyB0aGUgZmV0Y2ggb3BlcnRhdGlvbiBhZ2FpbnN0IHRoZSBBQUQgc2VjdXJlZCByZXNvdXJjZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cmwgQWJzb2x1dGUgVVJMIGZvciB0aGUgcmVxdWVzdFxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgQW55IGZldGNoIG9wdGlvbnMgcGFzc2VkIHRvIHRoZSB1bmRlcmx5aW5nIGZldGNoIGltcGxlbWVudGF0aW9uXHJcbiAgICAgKi9cclxuICAgIEFkYWxDbGllbnQucHJvdG90eXBlLmZldGNoID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKCFpc1VybEFic29sdXRlKHVybCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IG11c3Qgc3VwcGx5IGFic29sdXRlIHVybHMgdG8gQWRhbENsaWVudC5mZXRjaC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoZSB1cmwgd2UgYXJlIGNhbGxpbmcgaXMgdGhlIHJlc291cmNlXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VG9rZW4odGhpcy5nZXRSZXNvdXJjZSh1cmwpKS50aGVuKGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgICBfdGhpcy50b2tlbiA9IHRva2VuO1xyXG4gICAgICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5mZXRjaC5jYWxsKF90aGlzLCB1cmwsIG9wdGlvbnMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIHRva2VuIGJhc2VkIG9uIHRoZSBjdXJyZW50IHVzZXJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcmVzb3VyY2UgVGhlIHJlc291cmNlIGZvciB3aGljaCB3ZSBhcmUgcmVxdWVzdGluZyBhIHRva2VuXHJcbiAgICAgKi9cclxuICAgIEFkYWxDbGllbnQucHJvdG90eXBlLmdldFRva2VuID0gZnVuY3Rpb24gKHJlc291cmNlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICBfdGhpcy5lbnN1cmVBdXRoQ29udGV4dCgpLnRoZW4oZnVuY3Rpb24gKF8pIHsgcmV0dXJuIF90aGlzLmxvZ2luKCk7IH0pLnRoZW4oZnVuY3Rpb24gKF8pIHtcclxuICAgICAgICAgICAgICAgIEFkYWxDbGllbnQuX2F1dGhDb250ZXh0LmFjcXVpcmVUb2tlbihyZXNvdXJjZSwgZnVuY3Rpb24gKG1lc3NhZ2UsIHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IobWVzc2FnZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRva2VuKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChyZWplY3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRW5zdXJlcyB3ZSBoYXZlIGNyZWF0ZWQgYW5kIHNldHVwIHRoZSBhZGFsIEF1dGhlbnRpY2F0aW9uQ29udGV4dCBpbnN0YW5jZVxyXG4gICAgICovXHJcbiAgICBBZGFsQ2xpZW50LnByb3RvdHlwZS5lbnN1cmVBdXRoQ29udGV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG4gICAgICAgICAgICBpZiAoQWRhbENsaWVudC5fYXV0aENvbnRleHQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIEFkYWxDbGllbnQuX2F1dGhDb250ZXh0ID0gaW5qZWN0KHtcclxuICAgICAgICAgICAgICAgICAgICBjbGllbnRJZDogX3RoaXMuY2xpZW50SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUNhbGw6IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLl9kaXNwbGF5Q2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9kaXNwbGF5Q2FsbGJhY2sodXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVUb0xvZ2luUmVxdWVzdFVybDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RVcmk6IF90aGlzLnJlZGlyZWN0VXJpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbmFudDogX3RoaXMudGVuYW50LFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRW5zdXJlcyB0aGUgY3VycmVudCB1c2VyIGlzIGxvZ2dlZCBpblxyXG4gICAgICovXHJcbiAgICBBZGFsQ2xpZW50LnByb3RvdHlwZS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLl9sb2dpblByb21pc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvZ2luUHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fbG9naW5Qcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICBpZiAoQWRhbENsaWVudC5fYXV0aENvbnRleHQuZ2V0Q2FjaGVkVXNlcigpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF90aGlzLl9kaXNwbGF5Q2FsbGJhY2sgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9wdXBXaW5kb3cgPSB3aW5kb3cub3Blbih1cmwsIFwibG9naW5cIiwgXCJ3aWR0aD00ODMsIGhlaWdodD02MDBcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXBvcHVwV2luZG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoXCJDb3VsZCBub3Qgb3BlbiBwb3AtdXAgd2luZG93IGZvciBhdXRoLiBMaWtlbHkgcG9wLXVwcyBhcmUgYmxvY2tlZCBieSB0aGUgYnJvd3Nlci5cIikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHBvcHVwV2luZG93ICYmIHBvcHVwV2luZG93LmZvY3VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9wdXBXaW5kb3cuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBwb2xsVGltZXIgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghcG9wdXBXaW5kb3cgfHwgcG9wdXBXaW5kb3cuY2xvc2VkIHx8IHBvcHVwV2luZG93LmNsb3NlZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHBvbGxUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3B1cFdpbmRvdy5kb2N1bWVudC5VUkwuaW5kZXhPZihfdGhpcy5yZWRpcmVjdFVyaSkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChwb2xsVGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRhbENsaWVudC5fYXV0aENvbnRleHQuaGFuZGxlV2luZG93Q2FsbGJhY2socG9wdXBXaW5kb3cubG9jYXRpb24uaGFzaCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3B1cFdpbmRvdy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCAzMCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIHRoaXMgdHJpZ2dlcnMgdGhlIGxvZ2luIHByb2Nlc3NcclxuICAgICAgICAgICAgX3RoaXMuZW5zdXJlQXV0aENvbnRleHQoKS50aGVuKGZ1bmN0aW9uIChfKSB7XHJcbiAgICAgICAgICAgICAgICBBZGFsQ2xpZW50Ll9hdXRoQ29udGV4dC5fbG9naW5JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBBZGFsQ2xpZW50Ll9hdXRoQ29udGV4dC5sb2dpbigpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX2Rpc3BsYXlDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9sb2dpblByb21pc2U7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBQYXJzZXMgb3V0IHRoZSByb290IG9mIHRoZSByZXF1ZXN0IHVybCB0byB1c2UgYXMgdGhlIHJlc291cmNlIHdoZW4gZ2V0dGluZyB0aGUgdG9rZW5cclxuICAgICAqXHJcbiAgICAgKiBBZnRlcjogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vamxvbmcvMjQyODU2MVxyXG4gICAgICogQHBhcmFtIHVybCBUaGUgdXJsIHRvIHBhcnNlXHJcbiAgICAgKi9cclxuICAgIEFkYWxDbGllbnQucHJvdG90eXBlLmdldFJlc291cmNlID0gZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgIHZhciBwYXJzZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICAgICAgICBwYXJzZXIuaHJlZiA9IHVybDtcclxuICAgICAgICByZXR1cm4gcGFyc2VyLnByb3RvY29sICsgXCIvL1wiICsgcGFyc2VyLmhvc3RuYW1lO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogT3VyIGF1dGggY29udGV4dFxyXG4gICAgICovXHJcbiAgICBBZGFsQ2xpZW50Ll9hdXRoQ29udGV4dCA9IG51bGw7XHJcbiAgICByZXR1cm4gQWRhbENsaWVudDtcclxufShCZWFyZXJUb2tlbkZldGNoQ2xpZW50KSk7XG5cbi8qKlxyXG4gKiBVc2VkIHRvIGNhbGN1bGF0ZSB0aGUgb2JqZWN0IHByb3BlcnRpZXMsIHdpdGggcG9seWZpbGwgaWYgbmVlZGVkXHJcbiAqL1xyXG52YXIgb2JqZWN0RW50cmllcyA9IGlzRnVuYyhPYmplY3QuZW50cmllcykgPyBPYmplY3QuZW50cmllcyA6IGZ1bmN0aW9uIChvKSB7IHJldHVybiBPYmplY3Qua2V5cyhvKS5tYXAoZnVuY3Rpb24gKGspIHsgcmV0dXJuIFtrLCBvW2tdXTsgfSk7IH07XHJcbi8qKlxyXG4gKiBDb252ZXJ0cyB0aGUgc3VwcGxpZWQgb2JqZWN0IHRvIGEgbWFwXHJcbiAqXHJcbiAqIEBwYXJhbSBvIFRoZSBvYmplY3QgdG8gbWFwXHJcbiAqL1xyXG5mdW5jdGlvbiBvYmplY3RUb01hcChvKSB7XHJcbiAgICBpZiAobyAhPT0gdW5kZWZpbmVkICYmIG8gIT09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gbmV3IE1hcChvYmplY3RFbnRyaWVzKG8pKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgTWFwKCk7XHJcbn1cclxuLyoqXHJcbiAqIE1lcmdlcyB0byBNYXAgaW5zdGFuY2VzIHRvZ2V0aGVyLCBvdmVyd3JpdGluZyB2YWx1ZXMgaW4gdGFyZ2V0IHdpdGggbWF0Y2hpbmcga2V5cywgbGFzdCBpbiB3aW5zXHJcbiAqXHJcbiAqIEBwYXJhbSB0YXJnZXQgbWFwIGludG8gd2hpY2ggdGhlIG90aGVyIG1hcHMgYXJlIG1lcmdlZFxyXG4gKiBAcGFyYW0gbWFwcyBPbmUgb3IgbW9yZSBtYXBzIHRvIG1lcmdlIGludG8gdGhlIHRhcmdldFxyXG4gKi9cclxuZnVuY3Rpb24gbWVyZ2VNYXBzKHRhcmdldCkge1xyXG4gICAgdmFyIG1hcHMgPSBbXTtcclxuICAgIGZvciAodmFyIF9pID0gMTsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgbWFwc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcclxuICAgIH1cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIG1hcHNbaV0uZm9yRWFjaChmdW5jdGlvbiAodiwgaykge1xyXG4gICAgICAgICAgICB0YXJnZXQuc2V0KGssIHYpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRhcmdldDtcclxufVxuXG5mdW5jdGlvbiBzZXR1cChjb25maWcpIHtcclxuICAgIFJ1bnRpbWVDb25maWcuZXh0ZW5kKGNvbmZpZyk7XHJcbn1cclxuLy8gbGFibGUgbWFwcGluZyBmb3Iga25vd24gY29uZmlnIHZhbHVlc1xyXG52YXIgcyA9IFtcclxuICAgIFwiZGVmYXVsdENhY2hpbmdTdG9yZVwiLFxyXG4gICAgXCJkZWZhdWx0Q2FjaGluZ1RpbWVvdXRTZWNvbmRzXCIsXHJcbiAgICBcImdsb2JhbENhY2hlRGlzYWJsZVwiLFxyXG4gICAgXCJlbmFibGVDYWNoZUV4cGlyYXRpb25cIixcclxuICAgIFwiY2FjaGVFeHBpcmF0aW9uSW50ZXJ2YWxNaWxsaXNlY29uZHNcIixcclxuICAgIFwic3BmeENvbnRleHRcIixcclxuXTtcclxudmFyIFJ1bnRpbWVDb25maWdJbXBsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUnVudGltZUNvbmZpZ0ltcGwoX3YpIHtcclxuICAgICAgICBpZiAoX3YgPT09IHZvaWQgMCkgeyBfdiA9IG5ldyBNYXAoKTsgfVxyXG4gICAgICAgIHRoaXMuX3YgPSBfdjtcclxuICAgICAgICAvLyBzZXR1cCBkZWZhdWx0c1xyXG4gICAgICAgIHRoaXMuX3Yuc2V0KHNbMF0sIFwic2Vzc2lvblwiKTtcclxuICAgICAgICB0aGlzLl92LnNldChzWzFdLCA2MCk7XHJcbiAgICAgICAgdGhpcy5fdi5zZXQoc1syXSwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuX3Yuc2V0KHNbM10sIGZhbHNlKTtcclxuICAgICAgICB0aGlzLl92LnNldChzWzRdLCA3NTApO1xyXG4gICAgICAgIHRoaXMuX3Yuc2V0KHNbNV0sIG51bGwpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbmZpZyBUaGUgc2V0IG9mIHByb3BlcnRpZXMgdG8gYWRkIHRvIHRoZSBnbG9iYSBjb25maWd1cmF0aW9uIGluc3RhbmNlXHJcbiAgICAgKi9cclxuICAgIFJ1bnRpbWVDb25maWdJbXBsLnByb3RvdHlwZS5leHRlbmQgPSBmdW5jdGlvbiAoY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5fdiA9IG1lcmdlTWFwcyh0aGlzLl92LCBvYmplY3RUb01hcChjb25maWcpKTtcclxuICAgIH07XHJcbiAgICBSdW50aW1lQ29uZmlnSW1wbC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92LmdldChrZXkpO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSdW50aW1lQ29uZmlnSW1wbC5wcm90b3R5cGUsIFwiZGVmYXVsdENhY2hpbmdTdG9yZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChzWzBdKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSdW50aW1lQ29uZmlnSW1wbC5wcm90b3R5cGUsIFwiZGVmYXVsdENhY2hpbmdUaW1lb3V0U2Vjb25kc1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChzWzFdKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSdW50aW1lQ29uZmlnSW1wbC5wcm90b3R5cGUsIFwiZ2xvYmFsQ2FjaGVEaXNhYmxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KHNbMl0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJ1bnRpbWVDb25maWdJbXBsLnByb3RvdHlwZSwgXCJlbmFibGVDYWNoZUV4cGlyYXRpb25cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoc1szXSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUnVudGltZUNvbmZpZ0ltcGwucHJvdG90eXBlLCBcImNhY2hlRXhwaXJhdGlvbkludGVydmFsTWlsbGlzZWNvbmRzXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KHNbNF0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJ1bnRpbWVDb25maWdJbXBsLnByb3RvdHlwZSwgXCJzcGZ4Q29udGV4dFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChzWzVdKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBSdW50aW1lQ29uZmlnSW1wbDtcclxufSgpKTtcclxudmFyIF9ydW50aW1lQ29uZmlnID0gbmV3IFJ1bnRpbWVDb25maWdJbXBsKCk7XHJcbnZhciBSdW50aW1lQ29uZmlnID0gX3J1bnRpbWVDb25maWc7XG5cbi8qKlxyXG4gKiBBIHdyYXBwZXIgY2xhc3MgdG8gcHJvdmlkZSBhIGNvbnNpc3RlbnQgaW50ZXJmYWNlIHRvIGJyb3dzZXIgYmFzZWQgc3RvcmFnZVxyXG4gKlxyXG4gKi9cclxudmFyIFBuUENsaWVudFN0b3JhZ2VXcmFwcGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBQblBDbGllbnRTdG9yYWdlV3JhcHBlciBjbGFzc1xyXG4gICAgICpcclxuICAgICAqIEBjb25zdHJ1Y3RvclxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBQblBDbGllbnRTdG9yYWdlV3JhcHBlcihzdG9yZSwgZGVmYXVsdFRpbWVvdXRNaW51dGVzKSB7XHJcbiAgICAgICAgaWYgKGRlZmF1bHRUaW1lb3V0TWludXRlcyA9PT0gdm9pZCAwKSB7IGRlZmF1bHRUaW1lb3V0TWludXRlcyA9IC0xOyB9XHJcbiAgICAgICAgdGhpcy5zdG9yZSA9IHN0b3JlO1xyXG4gICAgICAgIHRoaXMuZGVmYXVsdFRpbWVvdXRNaW51dGVzID0gZGVmYXVsdFRpbWVvdXRNaW51dGVzO1xyXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IHRoaXMudGVzdCgpO1xyXG4gICAgICAgIC8vIGlmIHRoZSBjYWNoZSB0aW1lb3V0IGlzIGVuYWJsZWQgY2FsbCB0aGUgaGFuZGxlclxyXG4gICAgICAgIC8vIHRoaXMgd2lsbCBjbGVhciBhbnkgZXhwaXJlZCBpdGVtcyBhbmQgc2V0IHRoZSB0aW1lb3V0IGZ1bmN0aW9uXHJcbiAgICAgICAgaWYgKFJ1bnRpbWVDb25maWcuZW5hYmxlQ2FjaGVFeHBpcmF0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVFeHBpcmF0aW9uSGFuZGxlcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGEgdmFsdWUgZnJvbSBzdG9yYWdlLCBvciBudWxsIGlmIHRoYXQgdmFsdWUgZG9lcyBub3QgZXhpc3RcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2V5IFRoZSBrZXkgd2hvc2UgdmFsdWUgd2Ugd2FudCB0byByZXRyaWV2ZVxyXG4gICAgICovXHJcbiAgICBQblBDbGllbnRTdG9yYWdlV3JhcHBlci5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbyA9IHRoaXMuc3RvcmUuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgIGlmICghb2JqZWN0RGVmaW5lZE5vdE51bGwobykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwZXJzaXN0YWJsZSA9IEpTT04ucGFyc2Uobyk7XHJcbiAgICAgICAgaWYgKG5ldyBEYXRlKHBlcnNpc3RhYmxlLmV4cGlyYXRpb24pIDw9IG5ldyBEYXRlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWxldGUoa2V5KTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcGVyc2lzdGFibGUudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHZhbHVlIHRvIHRoZSB1bmRlcmx5aW5nIHN0b3JhZ2VcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2V5IFRoZSBrZXkgdG8gdXNlIHdoZW4gc3RvcmluZyB0aGUgcHJvdmlkZWQgdmFsdWVcclxuICAgICAqIEBwYXJhbSBvIFRoZSB2YWx1ZSB0byBzdG9yZVxyXG4gICAgICogQHBhcmFtIGV4cGlyZSBPcHRpb25hbCwgaWYgcHJvdmlkZWQgdGhlIGV4cGlyYXRpb24gb2YgdGhlIGl0ZW0sIG90aGVyd2lzZSB0aGUgZGVmYXVsdCBpcyB1c2VkXHJcbiAgICAgKi9cclxuICAgIFBuUENsaWVudFN0b3JhZ2VXcmFwcGVyLnByb3RvdHlwZS5wdXQgPSBmdW5jdGlvbiAoa2V5LCBvLCBleHBpcmUpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuc2V0SXRlbShrZXksIHRoaXMuY3JlYXRlUGVyc2lzdGFibGUobywgZXhwaXJlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlcyBhIHZhbHVlIGZyb20gdGhlIHVuZGVybHlpbmcgc3RvcmFnZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBrZXkgVGhlIGtleSBvZiB0aGUgcGFpciB3ZSB3YW50IHRvIHJlbW92ZSBmcm9tIHN0b3JhZ2VcclxuICAgICAqL1xyXG4gICAgUG5QQ2xpZW50U3RvcmFnZVdyYXBwZXIucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmUucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYW4gaXRlbSBmcm9tIHRoZSB1bmRlcmx5aW5nIHN0b3JhZ2UsIG9yIGFkZHMgaXQgaWYgaXQgZG9lcyBub3QgZXhpc3QgdXNpbmcgdGhlIHN1cHBsaWVkIGdldHRlciBmdW5jdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBrZXkgVGhlIGtleSB0byB1c2Ugd2hlbiBzdG9yaW5nIHRoZSBwcm92aWRlZCB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGdldHRlciBBIGZ1bmN0aW9uIHdoaWNoIHdpbGwgdXBvbiBleGVjdXRpb24gcHJvdmlkZSB0aGUgZGVzaXJlZCB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGV4cGlyZSBPcHRpb25hbCwgaWYgcHJvdmlkZWQgdGhlIGV4cGlyYXRpb24gb2YgdGhlIGl0ZW0sIG90aGVyd2lzZSB0aGUgZGVmYXVsdCBpcyB1c2VkXHJcbiAgICAgKi9cclxuICAgIFBuUENsaWVudFN0b3JhZ2VXcmFwcGVyLnByb3RvdHlwZS5nZXRPclB1dCA9IGZ1bmN0aW9uIChrZXksIGdldHRlciwgZXhwaXJlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0dGVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG4gICAgICAgICAgICB2YXIgbyA9IF90aGlzLmdldChrZXkpO1xyXG4gICAgICAgICAgICBpZiAobyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBnZXR0ZXIoKS50aGVuKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucHV0KGtleSwgZCwgZXhwaXJlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWxldGVzIGFueSBleHBpcmVkIGl0ZW1zIHBsYWNlZCBpbiB0aGUgc3RvcmUgYnkgdGhlIHBucCBsaWJyYXJ5LCBsZWF2ZXMgb3RoZXIgaXRlbXMgdW50b3VjaGVkXHJcbiAgICAgKi9cclxuICAgIFBuUENsaWVudFN0b3JhZ2VXcmFwcGVyLnByb3RvdHlwZS5kZWxldGVFeHBpcmVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgaWYgKCFfdGhpcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXMuc3RvcmUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gX3RoaXMuc3RvcmUua2V5KGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGVzdCB0aGUgc3RvcmVkIGl0ZW0gdG8gc2VlIGlmIHdlIHN0b3JlZCBpdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoL1tcInwnXT9wbnBbXCJ8J10/ID86ID8xL2kudGVzdChfdGhpcy5zdG9yZS5nZXRJdGVtKGtleSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhvc2UgaXRlbXMgYXMgZ2V0IHdpbGwgZGVsZXRlIGZyb20gY2FjaGUgaWYgdGhleSBhcmUgZXhwaXJlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0KGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBkZXRlcm1pbmUgaWYgdGhlIHdyYXBwZWQgc3RvcmFnZSBpcyBhdmFpbGFibGUgY3VycmVudGx5XHJcbiAgICAgKi9cclxuICAgIFBuUENsaWVudFN0b3JhZ2VXcmFwcGVyLnByb3RvdHlwZS50ZXN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzdHIgPSBcInRcIjtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3JlLnNldEl0ZW0oc3RyLCBzdHIpO1xyXG4gICAgICAgICAgICB0aGlzLnN0b3JlLnJlbW92ZUl0ZW0oc3RyKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIHRoZSBwZXJzaXN0YWJsZSB0byBzdG9yZVxyXG4gICAgICovXHJcbiAgICBQblBDbGllbnRTdG9yYWdlV3JhcHBlci5wcm90b3R5cGUuY3JlYXRlUGVyc2lzdGFibGUgPSBmdW5jdGlvbiAobywgZXhwaXJlKSB7XHJcbiAgICAgICAgaWYgKGV4cGlyZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIC8vIGVuc3VyZSB3ZSBhcmUgYnkgZGVmYXVsdCBpbmxpbmUgd2l0aCB0aGUgZ2xvYmFsIGxpYnJhcnkgc2V0dGluZ1xyXG4gICAgICAgICAgICB2YXIgZGVmYXVsdFRpbWVvdXQgPSBSdW50aW1lQ29uZmlnLmRlZmF1bHRDYWNoaW5nVGltZW91dFNlY29uZHM7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRlZmF1bHRUaW1lb3V0TWludXRlcyA+IDApIHtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHRUaW1lb3V0ID0gdGhpcy5kZWZhdWx0VGltZW91dE1pbnV0ZXMgKiA2MDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBleHBpcmUgPSBkYXRlQWRkKG5ldyBEYXRlKCksIFwic2Vjb25kXCIsIGRlZmF1bHRUaW1lb3V0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGpzUyh7IHBucDogMSwgZXhwaXJhdGlvbjogZXhwaXJlLCB2YWx1ZTogbyB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZXMgZXhwaXJlZCBpdGVtcyBhZGRlZCBieSB0aGlzIGxpYnJhcnkgaW4gdGhpcy5zdG9yZSBhbmQgc2V0cyBhIHRpbWVvdXQgdG8gY2FsbCBpdHNlbGZcclxuICAgICAqL1xyXG4gICAgUG5QQ2xpZW50U3RvcmFnZVdyYXBwZXIucHJvdG90eXBlLmNhY2hlRXhwaXJhdGlvbkhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmRlbGV0ZUV4cGlyZWQoKS50aGVuKGZ1bmN0aW9uIChfKSB7XHJcbiAgICAgICAgICAgIC8vIGNhbGwgb3Vyc2VsZiBpbiB0aGUgZnV0dXJlXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZ2V0Q3R4Q2FsbGJhY2soX3RoaXMsIF90aGlzLmNhY2hlRXhwaXJhdGlvbkhhbmRsZXIpLCBSdW50aW1lQ29uZmlnLmNhY2hlRXhwaXJhdGlvbkludGVydmFsTWlsbGlzZWNvbmRzKTtcclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBQblBDbGllbnRTdG9yYWdlV3JhcHBlcjtcclxufSgpKTtcclxuLyoqXHJcbiAqIEEgdGhpbiBpbXBsZW1lbnRhdGlvbiBvZiBpbi1tZW1vcnkgc3RvcmFnZSBmb3IgdXNlIGluIG5vZGVqc1xyXG4gKi9cclxudmFyIE1lbW9yeVN0b3JhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBNZW1vcnlTdG9yYWdlKF9zdG9yZSkge1xyXG4gICAgICAgIGlmIChfc3RvcmUgPT09IHZvaWQgMCkgeyBfc3RvcmUgPSBuZXcgTWFwKCk7IH1cclxuICAgICAgICB0aGlzLl9zdG9yZSA9IF9zdG9yZTtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZW1vcnlTdG9yYWdlLnByb3RvdHlwZSwgXCJsZW5ndGhcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmUuc2l6ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE1lbW9yeVN0b3JhZ2UucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuX3N0b3JlLmNsZWFyKCk7XHJcbiAgICB9O1xyXG4gICAgTWVtb3J5U3RvcmFnZS5wcm90b3R5cGUuZ2V0SXRlbSA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmUuZ2V0KGtleSk7XHJcbiAgICB9O1xyXG4gICAgTWVtb3J5U3RvcmFnZS5wcm90b3R5cGUua2V5ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5fc3RvcmUpW2luZGV4XVswXTtcclxuICAgIH07XHJcbiAgICBNZW1vcnlTdG9yYWdlLnByb3RvdHlwZS5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHRoaXMuX3N0b3JlLmRlbGV0ZShrZXkpO1xyXG4gICAgfTtcclxuICAgIE1lbW9yeVN0b3JhZ2UucHJvdG90eXBlLnNldEl0ZW0gPSBmdW5jdGlvbiAoa2V5LCBkYXRhKSB7XHJcbiAgICAgICAgdGhpcy5fc3RvcmUuc2V0KGtleSwgZGF0YSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE1lbW9yeVN0b3JhZ2U7XHJcbn0oKSk7XHJcbi8qKlxyXG4gKiBBIGNsYXNzIHRoYXQgd2lsbCBlc3RhYmxpc2ggd3JhcHBlcnMgZm9yIGJvdGggbG9jYWwgYW5kIHNlc3Npb24gc3RvcmFnZVxyXG4gKi9cclxudmFyIFBuUENsaWVudFN0b3JhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFBuUENsaWVudFN0b3JhZ2UgY2xhc3NcclxuICAgICAqXHJcbiAgICAgKiBAY29uc3RydWN0b3JcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gUG5QQ2xpZW50U3RvcmFnZShfbG9jYWwsIF9zZXNzaW9uKSB7XHJcbiAgICAgICAgaWYgKF9sb2NhbCA9PT0gdm9pZCAwKSB7IF9sb2NhbCA9IG51bGw7IH1cclxuICAgICAgICBpZiAoX3Nlc3Npb24gPT09IHZvaWQgMCkgeyBfc2Vzc2lvbiA9IG51bGw7IH1cclxuICAgICAgICB0aGlzLl9sb2NhbCA9IF9sb2NhbDtcclxuICAgICAgICB0aGlzLl9zZXNzaW9uID0gX3Nlc3Npb247XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUG5QQ2xpZW50U3RvcmFnZS5wcm90b3R5cGUsIFwibG9jYWxcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFByb3ZpZGVzIGFjY2VzcyB0byB0aGUgbG9jYWwgc3RvcmFnZSBvZiB0aGUgYnJvd3NlclxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fbG9jYWwgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2xvY2FsID0gdGhpcy5nZXRTdG9yZShcImxvY2FsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2NhbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQblBDbGllbnRTdG9yYWdlLnByb3RvdHlwZSwgXCJzZXNzaW9uXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQcm92aWRlcyBhY2Nlc3MgdG8gdGhlIHNlc3Npb24gc3RvcmFnZSBvZiB0aGUgYnJvd3NlclxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fc2Vzc2lvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2Vzc2lvbiA9IHRoaXMuZ2V0U3RvcmUoXCJzZXNzaW9uXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZXNzaW9uO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgUG5QQ2xpZW50U3RvcmFnZS5wcm90b3R5cGUuZ2V0U3RvcmUgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgIGlmIChuYW1lID09PSBcImxvY2FsXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQblBDbGllbnRTdG9yYWdlV3JhcHBlcih0eXBlb2YgKGxvY2FsU3RvcmFnZSkgPT09IFwidW5kZWZpbmVkXCIgPyBuZXcgTWVtb3J5U3RvcmFnZSgpIDogbG9jYWxTdG9yYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQblBDbGllbnRTdG9yYWdlV3JhcHBlcih0eXBlb2YgKHNlc3Npb25TdG9yYWdlKSA9PT0gXCJ1bmRlZmluZWRcIiA/IG5ldyBNZW1vcnlTdG9yYWdlKCkgOiBzZXNzaW9uU3RvcmFnZSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFBuUENsaWVudFN0b3JhZ2U7XHJcbn0oKSk7XG5cbmV4cG9ydCB7IEFkYWxDbGllbnQsIG9iamVjdFRvTWFwLCBtZXJnZU1hcHMsIHNldHVwLCBSdW50aW1lQ29uZmlnSW1wbCwgUnVudGltZUNvbmZpZywgbWVyZ2VIZWFkZXJzLCBtZXJnZU9wdGlvbnMsIEZldGNoQ2xpZW50LCBCZWFyZXJUb2tlbkZldGNoQ2xpZW50LCBQblBDbGllbnRTdG9yYWdlV3JhcHBlciwgUG5QQ2xpZW50U3RvcmFnZSwgZ2V0Q3R4Q2FsbGJhY2ssIGRhdGVBZGQsIGNvbWJpbmUsIGdldFJhbmRvbVN0cmluZywgZ2V0R1VJRCwgaXNGdW5jLCBvYmplY3REZWZpbmVkTm90TnVsbCwgaXNBcnJheSwgZXh0ZW5kLCBpc1VybEFic29sdXRlLCBzdHJpbmdJc051bGxPckVtcHR5LCBnZXRBdHRyVmFsdWVGcm9tU3RyaW5nLCBzYW5pdGl6ZUd1aWQsIGpzUywgaE9QLCBnZXRIYXNoQ29kZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbW9uLmVzNS5qcy5tYXBcbiIsIi8qKlxuQGxpY2Vuc2VcbiAqIEBwbnAvbG9nZ2luZyB2MS4yLjEgLSBwbnAgLSBsaWdodC13ZWlnaHQsIHN1YnNjcmliYWJsZSBsb2dnaW5nIGZyYW1ld29ya1xuICogTUlUIChodHRwczovL2dpdGh1Yi5jb20vcG5wL3BucGpzL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTggTWljcm9zb2Z0XG4gKiBkb2NzOiBodHRwczovL3BucC5naXRodWIuaW8vcG5wanMvXG4gKiBzb3VyY2U6IGh0dHBzOmdpdGh1Yi5jb20vcG5wL3BucGpzXG4gKiBidWdzOiBodHRwczovL2dpdGh1Yi5jb20vcG5wL3BucGpzL2lzc3Vlc1xuICovXG4vKipcclxuICogQ2xhc3MgdXNlZCB0byBzdWJzY3JpYmUgSUxvZ0xpc3RlbmVyIGFuZCBsb2cgbWVzc2FnZXMgdGhyb3VnaG91dCBhbiBhcHBsaWNhdGlvblxyXG4gKlxyXG4gKi9cclxudmFyIExvZ2dlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIExvZ2dlcigpIHtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMb2dnZXIsIFwiYWN0aXZlTG9nTGV2ZWxcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgb3Igc2V0cyB0aGUgYWN0aXZlIGxvZyBsZXZlbCB0byBhcHBseSBmb3IgbG9nIGZpbHRlcmluZ1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gTG9nZ2VyLmluc3RhbmNlLmFjdGl2ZUxvZ0xldmVsO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgTG9nZ2VyLmluc3RhbmNlLmFjdGl2ZUxvZ0xldmVsID0gdmFsdWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTG9nZ2VyLCBcImluc3RhbmNlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKExvZ2dlci5faW5zdGFuY2UgPT09IHVuZGVmaW5lZCB8fCBMb2dnZXIuX2luc3RhbmNlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIuX2luc3RhbmNlID0gbmV3IExvZ2dlckltcGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTG9nZ2VyLl9pbnN0YW5jZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBJTG9nTGlzdGVuZXIgaW5zdGFuY2VzIHRvIHRoZSBzZXQgb2Ygc3Vic2NyaWJlZCBsaXN0ZW5lcnNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbGlzdGVuZXJzIE9uZSBvciBtb3JlIGxpc3RlbmVycyB0byBzdWJzY3JpYmUgdG8gdGhpcyBsb2dcclxuICAgICAqL1xyXG4gICAgTG9nZ2VyLnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgbGlzdGVuZXJzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgbGlzdGVuZXJzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxpc3RlbmVycy5tYXAoZnVuY3Rpb24gKGxpc3RlbmVyKSB7IHJldHVybiBMb2dnZXIuaW5zdGFuY2Uuc3Vic2NyaWJlKGxpc3RlbmVyKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhcnMgdGhlIHN1YnNjcmliZXJzIGNvbGxlY3Rpb24sIHJldHVybmluZyB0aGUgY29sbGVjdGlvbiBiZWZvcmUgbW9kaWZpY3Rpb25cclxuICAgICAqL1xyXG4gICAgTG9nZ2VyLmNsZWFyU3Vic2NyaWJlcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIExvZ2dlci5pbnN0YW5jZS5jbGVhclN1YnNjcmliZXJzKCk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KExvZ2dlciwgXCJjb3VudFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgY3VycmVudCBzdWJzY3JpYmVyIGNvdW50XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBMb2dnZXIuaW5zdGFuY2UuY291bnQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIFdyaXRlcyB0aGUgc3VwcGxpZWQgc3RyaW5nIHRvIHRoZSBzdWJzY3JpYmVkIGxpc3RlbmVyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIHdyaXRlXHJcbiAgICAgKiBAcGFyYW0gbGV2ZWwgW09wdGlvbmFsXSBpZiBzdXBwbGllZCB3aWxsIGJlIHVzZWQgYXMgdGhlIGxldmVsIG9mIHRoZSBlbnRyeSAoRGVmYXVsdDogTG9nTGV2ZWwuSW5mbylcclxuICAgICAqL1xyXG4gICAgTG9nZ2VyLndyaXRlID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGxldmVsKSB7XHJcbiAgICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsgbGV2ZWwgPSAxIC8qIEluZm8gKi87IH1cclxuICAgICAgICBMb2dnZXIuaW5zdGFuY2UubG9nKHsgbGV2ZWw6IGxldmVsLCBtZXNzYWdlOiBtZXNzYWdlIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogV3JpdGVzIHRoZSBzdXBwbGllZCBzdHJpbmcgdG8gdGhlIHN1YnNjcmliZWQgbGlzdGVuZXJzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGpzb24gVGhlIGpzb24gb2JqZWN0IHRvIHN0cmluZ2lmeSBhbmQgd3JpdGVcclxuICAgICAqIEBwYXJhbSBsZXZlbCBbT3B0aW9uYWxdIGlmIHN1cHBsaWVkIHdpbGwgYmUgdXNlZCBhcyB0aGUgbGV2ZWwgb2YgdGhlIGVudHJ5IChEZWZhdWx0OiBMb2dMZXZlbC5JbmZvKVxyXG4gICAgICovXHJcbiAgICBMb2dnZXIud3JpdGVKU09OID0gZnVuY3Rpb24gKGpzb24sIGxldmVsKSB7XHJcbiAgICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsgbGV2ZWwgPSAxIC8qIEluZm8gKi87IH1cclxuICAgICAgICB0aGlzLndyaXRlKEpTT04uc3RyaW5naWZ5KGpzb24pLCBsZXZlbCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBMb2dzIHRoZSBzdXBwbGllZCBlbnRyeSB0byB0aGUgc3Vic2NyaWJlZCBsaXN0ZW5lcnNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZW50cnkgVGhlIG1lc3NhZ2UgdG8gbG9nXHJcbiAgICAgKi9cclxuICAgIExvZ2dlci5sb2cgPSBmdW5jdGlvbiAoZW50cnkpIHtcclxuICAgICAgICBMb2dnZXIuaW5zdGFuY2UubG9nKGVudHJ5KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIExvZ3MgYW4gZXJyb3Igb2JqZWN0IHRvIHRoZSBzdWJzY3JpYmVkIGxpc3RlbmVyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBlcnIgVGhlIGVycm9yIG9iamVjdFxyXG4gICAgICovXHJcbiAgICBMb2dnZXIuZXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgTG9nZ2VyLmluc3RhbmNlLmxvZyh7IGRhdGE6IGVyciwgbGV2ZWw6IDMgLyogRXJyb3IgKi8sIG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBMb2dnZXI7XHJcbn0oKSk7XHJcbnZhciBMb2dnZXJJbXBsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTG9nZ2VySW1wbChhY3RpdmVMb2dMZXZlbCwgc3Vic2NyaWJlcnMpIHtcclxuICAgICAgICBpZiAoYWN0aXZlTG9nTGV2ZWwgPT09IHZvaWQgMCkgeyBhY3RpdmVMb2dMZXZlbCA9IDIgLyogV2FybmluZyAqLzsgfVxyXG4gICAgICAgIGlmIChzdWJzY3JpYmVycyA9PT0gdm9pZCAwKSB7IHN1YnNjcmliZXJzID0gW107IH1cclxuICAgICAgICB0aGlzLmFjdGl2ZUxvZ0xldmVsID0gYWN0aXZlTG9nTGV2ZWw7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVycyA9IHN1YnNjcmliZXJzO1xyXG4gICAgfVxyXG4gICAgTG9nZ2VySW1wbC5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGxpc3RlbmVyKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVycy5wdXNoKGxpc3RlbmVyKTtcclxuICAgIH07XHJcbiAgICBMb2dnZXJJbXBsLnByb3RvdHlwZS5jbGVhclN1YnNjcmliZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzID0gdGhpcy5zdWJzY3JpYmVycy5zbGljZSgwKTtcclxuICAgICAgICB0aGlzLnN1YnNjcmliZXJzLmxlbmd0aCA9IDA7XHJcbiAgICAgICAgcmV0dXJuIHM7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KExvZ2dlckltcGwucHJvdG90eXBlLCBcImNvdW50XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3Vic2NyaWJlcnMubGVuZ3RoO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgTG9nZ2VySW1wbC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAobWVzc2FnZSwgbGV2ZWwpIHtcclxuICAgICAgICBpZiAobGV2ZWwgPT09IHZvaWQgMCkgeyBsZXZlbCA9IDEgLyogSW5mbyAqLzsgfVxyXG4gICAgICAgIHRoaXMubG9nKHsgbGV2ZWw6IGxldmVsLCBtZXNzYWdlOiBtZXNzYWdlIH0pO1xyXG4gICAgfTtcclxuICAgIExvZ2dlckltcGwucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgIGlmIChlbnRyeSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuYWN0aXZlTG9nTGV2ZWwgPD0gZW50cnkubGV2ZWwpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVycy5tYXAoZnVuY3Rpb24gKHN1YnNjcmliZXIpIHsgcmV0dXJuIHN1YnNjcmliZXIubG9nKGVudHJ5KTsgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBMb2dnZXJJbXBsO1xyXG59KCkpO1xuXG4vKipcclxuICogQSBzZXQgb2YgbG9nZ2luZyBsZXZlbHNcclxuICovXHJcbnZhciBMb2dMZXZlbDtcclxuKGZ1bmN0aW9uIChMb2dMZXZlbCkge1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJWZXJib3NlXCJdID0gMF0gPSBcIlZlcmJvc2VcIjtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiSW5mb1wiXSA9IDFdID0gXCJJbmZvXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIldhcm5pbmdcIl0gPSAyXSA9IFwiV2FybmluZ1wiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJFcnJvclwiXSA9IDNdID0gXCJFcnJvclwiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJPZmZcIl0gPSA5OV0gPSBcIk9mZlwiO1xyXG59KShMb2dMZXZlbCB8fCAoTG9nTGV2ZWwgPSB7fSkpO1xuXG4vKipcclxuICogSW1wbGVtZW50YXRpb24gb2YgTG9nTGlzdGVuZXIgd2hpY2ggbG9ncyB0byB0aGUgY29uc29sZVxyXG4gKlxyXG4gKi9cclxudmFyIENvbnNvbGVMaXN0ZW5lciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbnNvbGVMaXN0ZW5lcigpIHtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQW55IGFzc29jaWF0ZWQgZGF0YSB0aGF0IGEgZ2l2ZW4gbG9nZ2luZyBsaXN0ZW5lciBtYXkgY2hvb3NlIHRvIGxvZyBvciBpZ25vcmVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZW50cnkgVGhlIGluZm9ybWF0aW9uIHRvIGJlIGxvZ2dlZFxyXG4gICAgICovXHJcbiAgICBDb25zb2xlTGlzdGVuZXIucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgIHZhciBtc2cgPSB0aGlzLmZvcm1hdChlbnRyeSk7XHJcbiAgICAgICAgc3dpdGNoIChlbnRyeS5sZXZlbCkge1xyXG4gICAgICAgICAgICBjYXNlIDAgLyogVmVyYm9zZSAqLzpcclxuICAgICAgICAgICAgY2FzZSAxIC8qIEluZm8gKi86XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMiAvKiBXYXJuaW5nICovOlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKG1zZyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAzIC8qIEVycm9yICovOlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihtc2cpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRm9ybWF0cyB0aGUgbWVzc2FnZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBlbnRyeSBUaGUgaW5mb3JtYXRpb24gdG8gZm9ybWF0IGludG8gYSBzdHJpbmdcclxuICAgICAqL1xyXG4gICAgQ29uc29sZUxpc3RlbmVyLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiAoZW50cnkpIHtcclxuICAgICAgICB2YXIgbXNnID0gW107XHJcbiAgICAgICAgbXNnLnB1c2goXCJNZXNzYWdlOiBcIiArIGVudHJ5Lm1lc3NhZ2UpO1xyXG4gICAgICAgIGlmIChlbnRyeS5kYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbXNnLnB1c2goXCIgRGF0YTogXCIgKyBKU09OLnN0cmluZ2lmeShlbnRyeS5kYXRhKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtc2cuam9pbihcIlwiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ29uc29sZUxpc3RlbmVyO1xyXG59KCkpO1xyXG4vKipcclxuICogSW1wbGVtZW50YXRpb24gb2YgTG9nTGlzdGVuZXIgd2hpY2ggbG9ncyB0byB0aGUgc3VwcGxpZWQgZnVuY3Rpb25cclxuICpcclxuICovXHJcbnZhciBGdW5jdGlvbkxpc3RlbmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBGdW5jdGlvbkxpc3RlbmVyIGNsYXNzXHJcbiAgICAgKlxyXG4gICAgICogQGNvbnN0cnVjdG9yXHJcbiAgICAgKiBAcGFyYW0gIG1ldGhvZCBUaGUgbWV0aG9kIHRvIHdoaWNoIGFueSBsb2dnaW5nIGRhdGEgd2lsbCBiZSBwYXNzZWRcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gRnVuY3Rpb25MaXN0ZW5lcihtZXRob2QpIHtcclxuICAgICAgICB0aGlzLm1ldGhvZCA9IG1ldGhvZDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQW55IGFzc29jaWF0ZWQgZGF0YSB0aGF0IGEgZ2l2ZW4gbG9nZ2luZyBsaXN0ZW5lciBtYXkgY2hvb3NlIHRvIGxvZyBvciBpZ25vcmVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZW50cnkgVGhlIGluZm9ybWF0aW9uIHRvIGJlIGxvZ2dlZFxyXG4gICAgICovXHJcbiAgICBGdW5jdGlvbkxpc3RlbmVyLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiAoZW50cnkpIHtcclxuICAgICAgICB0aGlzLm1ldGhvZChlbnRyeSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEZ1bmN0aW9uTGlzdGVuZXI7XHJcbn0oKSk7XG5cbmV4cG9ydCB7IExvZ2dlciwgTG9nTGV2ZWwsIENvbnNvbGVMaXN0ZW5lciwgRnVuY3Rpb25MaXN0ZW5lciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bG9nZ2luZy5lczUuanMubWFwXG4iLCIvKipcbkBsaWNlbnNlXG4gKiBAcG5wL29kYXRhIHYxLjIuMSAtIHBucCAtIHByb3ZpZGVzIHNoYXJlZCBvZGF0YSBmdW5jdGlvbmFsaXR5IGFuZCBiYXNlIGNsYXNzZXNcbiAqIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3BucC9wbnBqcy9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogQ29weXJpZ2h0IChjKSAyMDE4IE1pY3Jvc29mdFxuICogZG9jczogaHR0cHM6Ly9wbnAuZ2l0aHViLmlvL3BucGpzL1xuICogc291cmNlOiBodHRwczpnaXRodWIuY29tL3BucC9wbnBqc1xuICogYnVnczogaHR0cHM6Ly9naXRodWIuY29tL3BucC9wbnBqcy9pc3N1ZXNcbiAqL1xuaW1wb3J0IHsgUnVudGltZUNvbmZpZywgZGF0ZUFkZCwgUG5QQ2xpZW50U3RvcmFnZSwgaXNGdW5jLCBoT1AsIGV4dGVuZCwgY29tYmluZSwgbWVyZ2VPcHRpb25zLCBvYmplY3REZWZpbmVkTm90TnVsbCwgZ2V0R1VJRCB9IGZyb20gJ0BwbnAvY29tbW9uJztcbmltcG9ydCB7IF9fZXh0ZW5kcywgX19kZWNvcmF0ZSB9IGZyb20gJ3RzbGliJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJ0BwbnAvbG9nZ2luZyc7XG5cbnZhciBDYWNoaW5nT3B0aW9ucyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENhY2hpbmdPcHRpb25zKGtleSkge1xyXG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xyXG4gICAgICAgIHRoaXMuZXhwaXJhdGlvbiA9IGRhdGVBZGQobmV3IERhdGUoKSwgXCJzZWNvbmRcIiwgUnVudGltZUNvbmZpZy5kZWZhdWx0Q2FjaGluZ1RpbWVvdXRTZWNvbmRzKTtcclxuICAgICAgICB0aGlzLnN0b3JlTmFtZSA9IFJ1bnRpbWVDb25maWcuZGVmYXVsdENhY2hpbmdTdG9yZTtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYWNoaW5nT3B0aW9ucy5wcm90b3R5cGUsIFwic3RvcmVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zdG9yZU5hbWUgPT09IFwibG9jYWxcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIENhY2hpbmdPcHRpb25zLnN0b3JhZ2UubG9jYWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gQ2FjaGluZ09wdGlvbnMuc3RvcmFnZS5zZXNzaW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBDYWNoaW5nT3B0aW9ucy5zdG9yYWdlID0gbmV3IFBuUENsaWVudFN0b3JhZ2UoKTtcclxuICAgIHJldHVybiBDYWNoaW5nT3B0aW9ucztcclxufSgpKTtcclxudmFyIENhY2hpbmdQYXJzZXJXcmFwcGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ2FjaGluZ1BhcnNlcldyYXBwZXIocGFyc2VyLCBjYWNoZU9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLnBhcnNlciA9IHBhcnNlcjtcclxuICAgICAgICB0aGlzLmNhY2hlT3B0aW9ucyA9IGNhY2hlT3B0aW9ucztcclxuICAgIH1cclxuICAgIENhY2hpbmdQYXJzZXJXcmFwcGVyLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VyLnBhcnNlKHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uIChyKSB7IHJldHVybiBfdGhpcy5jYWNoZURhdGEocik7IH0pO1xyXG4gICAgfTtcclxuICAgIENhY2hpbmdQYXJzZXJXcmFwcGVyLnByb3RvdHlwZS5jYWNoZURhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNhY2hlT3B0aW9ucy5zdG9yZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlT3B0aW9ucy5zdG9yZS5wdXQodGhpcy5jYWNoZU9wdGlvbnMua2V5LCBkYXRhLCB0aGlzLmNhY2hlT3B0aW9ucy5leHBpcmF0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENhY2hpbmdQYXJzZXJXcmFwcGVyO1xyXG59KCkpO1xuXG52YXIgT0RhdGFQYXJzZXJCYXNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gT0RhdGFQYXJzZXJCYXNlKCkge1xyXG4gICAgfVxyXG4gICAgT0RhdGFQYXJzZXJCYXNlLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFuZGxlRXJyb3IociwgcmVqZWN0KSkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucGFyc2VJbXBsKHIsIHJlc29sdmUsIHJlamVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBPRGF0YVBhcnNlckJhc2UucHJvdG90eXBlLnBhcnNlSW1wbCA9IGZ1bmN0aW9uIChyLCByZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICgoci5oZWFkZXJzLmhhcyhcIkNvbnRlbnQtTGVuZ3RoXCIpICYmIHBhcnNlRmxvYXQoci5oZWFkZXJzLmdldChcIkNvbnRlbnQtTGVuZ3RoXCIpKSA9PT0gMCkgfHwgci5zdGF0dXMgPT09IDIwNCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHBhdGNoIHRvIGhhbmRsZSBjYXNlcyBvZiAyMDAgcmVzcG9uc2Ugd2l0aCBubyBvciB3aGl0ZXNwYWNlIG9ubHkgYm9kaWVzICgjNDg3ICYgIzU0NSlcclxuICAgICAgICAgICAgci50ZXh0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh0eHQpIHsgcmV0dXJuIHR4dC5yZXBsYWNlKC9cXHMvaWcsIFwiXCIpLmxlbmd0aCA+IDAgPyBKU09OLnBhcnNlKHR4dCkgOiB7fTsgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChqc29uKSB7IHJldHVybiByZXNvbHZlKF90aGlzLnBhcnNlT0RhdGFKU09OKGpzb24pKTsgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gcmVqZWN0KGUpOyB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBIYW5kbGVzIGEgcmVzcG9uc2Ugd2l0aCBvayA9PT0gZmFsc2UgYnkgcGFyc2luZyB0aGUgYm9keSBhbmQgY3JlYXRpbmcgYSBQcm9jZXNzSHR0cENsaWVudFJlc3BvbnNlRXhjZXB0aW9uXHJcbiAgICAgKiB3aGljaCBpcyBwYXNzZWQgdG8gdGhlIHJlamVjdCBkZWxlZ2F0ZS4gVGhpcyBtZXRob2QgcmV0dXJucyB0cnVlIGlmIHRoZXJlIGlzIG5vIGVycm9yLCBvdGhlcndpc2UgZmFsc2VcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gciBDdXJyZW50IHJlc3BvbnNlIG9iamVjdFxyXG4gICAgICogQHBhcmFtIHJlamVjdCByZWplY3QgZGVsZWdhdGUgZm9yIHRoZSBzdXJyb3VuZGluZyBwcm9taXNlXHJcbiAgICAgKi9cclxuICAgIE9EYXRhUGFyc2VyQmFzZS5wcm90b3R5cGUuaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAociwgcmVqZWN0KSB7XHJcbiAgICAgICAgaWYgKCFyLm9rKSB7XHJcbiAgICAgICAgICAgIC8vIHJlYWQgdGhlIHJlc3BvbnNlIGFzIHRleHQsIGl0IG1heSBub3QgYmUgdmFsaWQganNvblxyXG4gICAgICAgICAgICByLmpzb24oKS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmNsdWRlIHRoZSBoZWFkZXJzIGFzIHRoZXkgY29udGFpbiBkaWFnbm9zdGljIGluZm9ybWF0aW9uXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZUJvZHk6IGpzb24sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VIZWFkZXJzOiByLmhlYWRlcnMsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihcIkVycm9yIG1ha2luZyBIdHRwQ2xpZW50IHJlcXVlc3QgaW4gcXVlcnlhYmxlOiBbXCIgKyByLnN0YXR1cyArIFwiXSBcIiArIHIuc3RhdHVzVGV4dCArIFwiIDo6PiBcIiArIEpTT04uc3RyaW5naWZ5KGRhdGEpKSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKFwiRXJyb3IgbWFraW5nIEh0dHBDbGllbnQgcmVxdWVzdCBpbiBxdWVyeWFibGU6IFtcIiArIHIuc3RhdHVzICsgXCJdIFwiICsgci5zdGF0dXNUZXh0ICsgXCIgOjo+IFwiICsgZSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHIub2s7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBOb3JtYWxpemVzIHRoZSBqc29uIHJlc3BvbnNlIGJ5IHJlbW92aW5nIHRoZSB2YXJpb3VzIG5lc3RlZCBsZXZlbHNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ganNvbiBqc29uIG9iamVjdCB0byBwYXJzZVxyXG4gICAgICovXHJcbiAgICBPRGF0YVBhcnNlckJhc2UucHJvdG90eXBlLnBhcnNlT0RhdGFKU09OID0gZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0ganNvbjtcclxuICAgICAgICBpZiAoaE9QKGpzb24sIFwiZFwiKSkge1xyXG4gICAgICAgICAgICBpZiAoaE9QKGpzb24uZCwgXCJyZXN1bHRzXCIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBqc29uLmQucmVzdWx0cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpzb24uZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChoT1AoanNvbiwgXCJ2YWx1ZVwiKSkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBqc29uLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBPRGF0YVBhcnNlckJhc2U7XHJcbn0oKSk7XHJcbnZhciBPRGF0YURlZmF1bHRQYXJzZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoT0RhdGFEZWZhdWx0UGFyc2VyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gT0RhdGFEZWZhdWx0UGFyc2VyKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIHJldHVybiBPRGF0YURlZmF1bHRQYXJzZXI7XHJcbn0oT0RhdGFQYXJzZXJCYXNlKSk7XHJcbnZhciBUZXh0UGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFRleHRQYXJzZXIsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUZXh0UGFyc2VyKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFRleHRQYXJzZXIucHJvdG90eXBlLnBhcnNlSW1wbCA9IGZ1bmN0aW9uIChyLCByZXNvbHZlKSB7XHJcbiAgICAgICAgci50ZXh0KCkudGhlbihyZXNvbHZlKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVGV4dFBhcnNlcjtcclxufShPRGF0YVBhcnNlckJhc2UpKTtcclxudmFyIEJsb2JQYXJzZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQmxvYlBhcnNlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEJsb2JQYXJzZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgQmxvYlBhcnNlci5wcm90b3R5cGUucGFyc2VJbXBsID0gZnVuY3Rpb24gKHIsIHJlc29sdmUpIHtcclxuICAgICAgICByLmJsb2IoKS50aGVuKHJlc29sdmUpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBCbG9iUGFyc2VyO1xyXG59KE9EYXRhUGFyc2VyQmFzZSkpO1xyXG52YXIgSlNPTlBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhKU09OUGFyc2VyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gSlNPTlBhcnNlcigpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBKU09OUGFyc2VyLnByb3RvdHlwZS5wYXJzZUltcGwgPSBmdW5jdGlvbiAociwgcmVzb2x2ZSkge1xyXG4gICAgICAgIHIuanNvbigpLnRoZW4ocmVzb2x2ZSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEpTT05QYXJzZXI7XHJcbn0oT0RhdGFQYXJzZXJCYXNlKSk7XHJcbnZhciBCdWZmZXJQYXJzZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQnVmZmVyUGFyc2VyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQnVmZmVyUGFyc2VyKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIEJ1ZmZlclBhcnNlci5wcm90b3R5cGUucGFyc2VJbXBsID0gZnVuY3Rpb24gKHIsIHJlc29sdmUpIHtcclxuICAgICAgICBpZiAoaXNGdW5jKHIuYXJyYXlCdWZmZXIpKSB7XHJcbiAgICAgICAgICAgIHIuYXJyYXlCdWZmZXIoKS50aGVuKHJlc29sdmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgci5idWZmZXIoKS50aGVuKHJlc29sdmUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gQnVmZmVyUGFyc2VyO1xyXG59KE9EYXRhUGFyc2VyQmFzZSkpO1xyXG52YXIgTGFtYmRhUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTGFtYmRhUGFyc2VyKHBhcnNlcikge1xyXG4gICAgICAgIHRoaXMucGFyc2VyID0gcGFyc2VyO1xyXG4gICAgfVxyXG4gICAgTGFtYmRhUGFyc2VyLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VyKHIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBMYW1iZGFQYXJzZXI7XHJcbn0oKSk7XG5cbi8qKlxyXG4gKiBSZXNvbHZlcyB0aGUgY29udGV4dCdzIHJlc3VsdCB2YWx1ZVxyXG4gKlxyXG4gKiBAcGFyYW0gY29udGV4dCBUaGUgY3VycmVudCBjb250ZXh0XHJcbiAqL1xyXG5mdW5jdGlvbiByZXR1cm5SZXN1bHQoY29udGV4dCkge1xyXG4gICAgTG9nZ2VyLmxvZyh7XHJcbiAgICAgICAgZGF0YTogTG9nZ2VyLmFjdGl2ZUxvZ0xldmVsID09PSAwIC8qIFZlcmJvc2UgKi8gPyBjb250ZXh0LnJlc3VsdCA6IHt9LFxyXG4gICAgICAgIGxldmVsOiAxIC8qIEluZm8gKi8sXHJcbiAgICAgICAgbWVzc2FnZTogXCJbXCIgKyBjb250ZXh0LnJlcXVlc3RJZCArIFwiXSAoXCIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgXCIpIFJldHVybmluZyByZXN1bHQgZnJvbSBwaXBlbGluZS4gU2V0IGxvZ2dpbmcgdG8gdmVyYm9zZSB0byBzZWUgZGF0YS5cIixcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb250ZXh0LnJlc3VsdCB8fCBudWxsKTtcclxufVxyXG4vKipcclxuICogU2V0cyB0aGUgcmVzdWx0IG9uIHRoZSBjb250ZXh0XHJcbiAqL1xyXG5mdW5jdGlvbiBzZXRSZXN1bHQoY29udGV4dCwgdmFsdWUpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG4gICAgICAgIGNvbnRleHQucmVzdWx0ID0gdmFsdWU7XHJcbiAgICAgICAgY29udGV4dC5oYXNSZXN1bHQgPSB0cnVlO1xyXG4gICAgICAgIHJlc29sdmUoY29udGV4dCk7XHJcbiAgICB9KTtcclxufVxyXG4vKipcclxuICogSW52b2tlcyB0aGUgbmV4dCBtZXRob2QgaW4gdGhlIHByb3ZpZGVkIGNvbnRleHQncyBwaXBlbGluZVxyXG4gKlxyXG4gKiBAcGFyYW0gYyBUaGUgY3VycmVudCByZXF1ZXN0IGNvbnRleHRcclxuICovXHJcbmZ1bmN0aW9uIG5leHQoYykge1xyXG4gICAgaWYgKGMucGlwZWxpbmUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiBjLnBpcGVsaW5lLnNoaWZ0KCkoYyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGMpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBFeGVjdXRlcyB0aGUgY3VycmVudCByZXF1ZXN0IGNvbnRleHQncyBwaXBlbGluZVxyXG4gKlxyXG4gKiBAcGFyYW0gY29udGV4dCBDdXJyZW50IGNvbnRleHRcclxuICovXHJcbmZ1bmN0aW9uIHBpcGUoY29udGV4dCkge1xyXG4gICAgaWYgKGNvbnRleHQucGlwZWxpbmUubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIExvZ2dlci53cml0ZShcIltcIiArIGNvbnRleHQucmVxdWVzdElkICsgXCJdIChcIiArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyBcIikgUmVxdWVzdCBwaXBlbGluZSBjb250YWlucyBubyBtZXRob2RzIVwiLCAyIC8qIFdhcm5pbmcgKi8pO1xyXG4gICAgfVxyXG4gICAgdmFyIHByb21pc2UgPSBuZXh0KGNvbnRleHQpLnRoZW4oZnVuY3Rpb24gKGN0eCkgeyByZXR1cm4gcmV0dXJuUmVzdWx0KGN0eCk7IH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgTG9nZ2VyLmVycm9yKGUpO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9KTtcclxuICAgIGlmIChjb250ZXh0LmlzQmF0Y2hlZCkge1xyXG4gICAgICAgIC8vIHRoaXMgd2lsbCBibG9jayB0aGUgYmF0Y2gncyBleGVjdXRlIG1ldGhvZCBmcm9tIHJldHVybmluZyB1bnRpbCB0aGUgY2hpbGQgcmVxdWV0cyBoYXZlIGJlZW4gcmVzb2x2ZWRcclxuICAgICAgICBjb250ZXh0LmJhdGNoLmFkZFJlc29sdmVCYXRjaERlcGVuZGVuY3kocHJvbWlzZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxufVxyXG4vKipcclxuICogZGVjb3JhdG9yIGZhY3RvcnkgYXBwbGllZCB0byBtZXRob2RzIGluIHRoZSBwaXBlbGluZSB0byBjb250cm9sIGJlaGF2aW9yXHJcbiAqL1xyXG5mdW5jdGlvbiByZXF1ZXN0UGlwZWxpbmVNZXRob2QoYWx3YXlzUnVuKSB7XHJcbiAgICBpZiAoYWx3YXlzUnVuID09PSB2b2lkIDApIHsgYWx3YXlzUnVuID0gZmFsc2U7IH1cclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBwcm9wZXJ0eUtleSwgZGVzY3JpcHRvcikge1xyXG4gICAgICAgIHZhciBtZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xyXG4gICAgICAgIGRlc2NyaXB0b3IudmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBhIHJlc3VsdCBhbHJlYWR5IGluIHRoZSBwaXBlbGluZSwgcGFzcyBpdCBhbG9uZyBhbmQgZG9uJ3QgY2FsbCB0aGUgdGFnZ2VkIG1ldGhvZFxyXG4gICAgICAgICAgICBpZiAoIWFsd2F5c1J1biAmJiBhcmdzLmxlbmd0aCA+IDAgJiYgaE9QKGFyZ3NbMF0sIFwiaGFzUmVzdWx0XCIpICYmIGFyZ3NbMF0uaGFzUmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIud3JpdGUoXCJbXCIgKyBhcmdzWzBdLnJlcXVlc3RJZCArIFwiXSAoXCIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgXCIpIFNraXBwaW5nIHJlcXVlc3QgcGlwZWxpbmUgbWV0aG9kIFwiICsgcHJvcGVydHlLZXkgKyBcIiwgZXhpc3RpbmcgcmVzdWx0IGluIHBpcGVsaW5lLlwiLCAwIC8qIFZlcmJvc2UgKi8pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShhcmdzWzBdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBhcHBseSB0aGUgdGFnZ2VkIG1ldGhvZFxyXG4gICAgICAgICAgICBMb2dnZXIud3JpdGUoXCJbXCIgKyBhcmdzWzBdLnJlcXVlc3RJZCArIFwiXSAoXCIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgXCIpIENhbGxpbmcgcmVxdWVzdCBwaXBlbGluZSBtZXRob2QgXCIgKyBwcm9wZXJ0eUtleSArIFwiLlwiLCAwIC8qIFZlcmJvc2UgKi8pO1xyXG4gICAgICAgICAgICAvLyB0aGVuIGNoYWluIHRoZSBuZXh0IG1ldGhvZCBpbiB0aGUgY29udGV4dCdzIHBpcGVsaW5lIC0gYWxsb3dzIGZvciBkeW5hbWljIHBpcGVsaW5lXHJcbiAgICAgICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmdzKS50aGVuKGZ1bmN0aW9uIChjdHgpIHsgcmV0dXJuIG5leHQoY3R4KTsgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn1cclxuLyoqXHJcbiAqIENvbnRhaW5zIHRoZSBtZXRob2RzIHVzZWQgd2l0aGluIHRoZSByZXF1ZXN0IHBpcGVsaW5lXHJcbiAqL1xyXG52YXIgUGlwZWxpbmVNZXRob2RzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUGlwZWxpbmVNZXRob2RzKCkge1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBMb2dzIHRoZSBzdGFydCBvZiB0aGUgcmVxdWVzdFxyXG4gICAgICovXHJcbiAgICBQaXBlbGluZU1ldGhvZHMubG9nU3RhcnQgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG4gICAgICAgICAgICBMb2dnZXIubG9nKHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IExvZ2dlci5hY3RpdmVMb2dMZXZlbCA9PT0gMSAvKiBJbmZvICovID8ge30gOiBjb250ZXh0LFxyXG4gICAgICAgICAgICAgICAgbGV2ZWw6IDEgLyogSW5mbyAqLyxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiW1wiICsgY29udGV4dC5yZXF1ZXN0SWQgKyBcIl0gKFwiICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIFwiKSBCZWdpbm5pbmcgXCIgKyBjb250ZXh0LnZlcmIgKyBcIiByZXF1ZXN0IChcIiArIGNvbnRleHQucmVxdWVzdEFic29sdXRlVXJsICsgXCIpXCIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXNvbHZlKGNvbnRleHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogSGFuZGxlcyBjYWNoaW5nIG9mIHRoZSByZXF1ZXN0XHJcbiAgICAgKi9cclxuICAgIFBpcGVsaW5lTWV0aG9kcy5jYWNoaW5nID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcclxuICAgICAgICAgICAgLy8gaGFuZGxlIGNhY2hpbmcsIGlmIGFwcGxpY2FibGVcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQuaXNDYWNoZWQpIHtcclxuICAgICAgICAgICAgICAgIExvZ2dlci53cml0ZShcIltcIiArIGNvbnRleHQucmVxdWVzdElkICsgXCJdIChcIiArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyBcIikgQ2FjaGluZyBpcyBlbmFibGVkIGZvciByZXF1ZXN0LCBjaGVja2luZyBjYWNoZS4uLlwiLCAxIC8qIEluZm8gKi8pO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhY2hlT3B0aW9ucyA9IG5ldyBDYWNoaW5nT3B0aW9ucyhjb250ZXh0LnJlcXVlc3RBYnNvbHV0ZVVybC50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LmNhY2hpbmdPcHRpb25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWNoZU9wdGlvbnMgPSBleHRlbmQoY2FjaGVPcHRpb25zLCBjb250ZXh0LmNhY2hpbmdPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHdlIG1heSBub3QgaGF2ZSBhIHZhbGlkIHN0b3JlXHJcbiAgICAgICAgICAgICAgICBpZiAoY2FjaGVPcHRpb25zLnN0b3JlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgd2UgaGF2ZSB0aGUgZGF0YSBpbiBjYWNoZSBhbmQgaWYgc28gcmVzb2x2ZSB0aGUgcHJvbWlzZSBhbmQgcmV0dXJuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBjYWNoZU9wdGlvbnMuc3RvcmUuZ2V0KGNhY2hlT3B0aW9ucy5rZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuc3VyZSB3ZSBjbGVhciBhbnkgaGVsZCBiYXRjaCBkZXBlbmRlbmN5IHdlIGFyZSByZXNvbHZpbmcgZnJvbSB0aGUgY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgTG9nZ2VyLmxvZyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBMb2dnZXIuYWN0aXZlTG9nTGV2ZWwgPT09IDEgLyogSW5mbyAqLyA/IHt9IDogZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsOiAxIC8qIEluZm8gKi8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIltcIiArIGNvbnRleHQucmVxdWVzdElkICsgXCJdIChcIiArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyBcIikgVmFsdWUgcmV0dXJuZWQgZnJvbSBjYWNoZS5cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0Z1bmMoY29udGV4dC5iYXRjaERlcGVuZGVuY3kpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSBhIHBhcnNlciBuZWVkcyB0byB0YWtlIHNwZWNpYWwgYWN0aW9ucyB3aXRoIGEgY2FjaGVkIHJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaE9QKGNvbnRleHQucGFyc2VyLCBcImh5ZHJhdGVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjb250ZXh0LnBhcnNlci5oeWRyYXRlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXRSZXN1bHQoY29udGV4dCwgZGF0YSkudGhlbihmdW5jdGlvbiAoY3R4KSB7IHJldHVybiByZXNvbHZlKGN0eCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIExvZ2dlci53cml0ZShcIltcIiArIGNvbnRleHQucmVxdWVzdElkICsgXCJdIChcIiArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyBcIikgVmFsdWUgbm90IGZvdW5kIGluIGNhY2hlLlwiLCAxIC8qIEluZm8gKi8pO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgd2UgZG9uJ3QgdGhlbiB3cmFwIHRoZSBzdXBwbGllZCBwYXJzZXIgaW4gdGhlIGNhY2hpbmcgcGFyc2VyIHdyYXBwZXJcclxuICAgICAgICAgICAgICAgIC8vIGFuZCBzZW5kIHRoaW5ncyBvbiB0aGVpciB3YXlcclxuICAgICAgICAgICAgICAgIGNvbnRleHQucGFyc2VyID0gbmV3IENhY2hpbmdQYXJzZXJXcmFwcGVyKGNvbnRleHQucGFyc2VyLCBjYWNoZU9wdGlvbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGNvbnRleHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2VuZHMgdGhlIHJlcXVlc3RcclxuICAgICAqL1xyXG4gICAgUGlwZWxpbmVNZXRob2RzLnNlbmQgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIC8vIHNlbmQgb3IgYmF0Y2ggdGhlIHJlcXVlc3RcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQuaXNCYXRjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB3ZSBhcmUgaW4gYSBiYXRjaCwgc28gYWRkIHRvIGJhdGNoLCByZW1vdmUgZGVwZW5kZW5jeSwgYW5kIHJlc29sdmUgd2l0aCB0aGUgYmF0Y2gncyBwcm9taXNlXHJcbiAgICAgICAgICAgICAgICB2YXIgcCA9IGNvbnRleHQuYmF0Y2guYWRkKGNvbnRleHQucmVxdWVzdEFic29sdXRlVXJsLCBjb250ZXh0LnZlcmIsIGNvbnRleHQub3B0aW9ucywgY29udGV4dC5wYXJzZXIsIGNvbnRleHQucmVxdWVzdElkKTtcclxuICAgICAgICAgICAgICAgIC8vIHdlIHJlbGVhc2UgdGhlIGRlcGVuZGVuY3kgaGVyZSB0byBlbnN1cmUgdGhlIGJhdGNoIGRvZXMgbm90IGV4ZWN1dGUgdW50aWwgdGhlIHJlcXVlc3QgaXMgYWRkZWQgdG8gdGhlIGJhdGNoXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNGdW5jKGNvbnRleHQuYmF0Y2hEZXBlbmRlbmN5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuYmF0Y2hEZXBlbmRlbmN5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIud3JpdGUoXCJbXCIgKyBjb250ZXh0LnJlcXVlc3RJZCArIFwiXSAoXCIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgXCIpIEJhdGNoaW5nIHJlcXVlc3QgaW4gYmF0Y2ggXCIgKyBjb250ZXh0LmJhdGNoLmJhdGNoSWQgKyBcIi5cIiwgMSAvKiBJbmZvICovKTtcclxuICAgICAgICAgICAgICAgIC8vIHdlIHNldCB0aGUgcmVzdWx0IGFzIHRoZSBwcm9taXNlIHdoaWNoIHdpbGwgYmUgcmVzb2x2ZWQgYnkgdGhlIGJhdGNoJ3MgZXhlY3V0aW9uXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHNldFJlc3VsdChjb250ZXh0LCBwKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIud3JpdGUoXCJbXCIgKyBjb250ZXh0LnJlcXVlc3RJZCArIFwiXSAoXCIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgXCIpIFNlbmRpbmcgcmVxdWVzdC5cIiwgMSAvKiBJbmZvICovKTtcclxuICAgICAgICAgICAgICAgIC8vIHdlIGFyZSBub3QgcGFydCBvZiBhIGJhdGNoLCBzbyBwcm9jZWVkIGFzIG5vcm1hbFxyXG4gICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IGNvbnRleHQuY2xpZW50RmFjdG9yeSgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdHMgPSBleHRlbmQoY29udGV4dC5vcHRpb25zIHx8IHt9LCB7IG1ldGhvZDogY29udGV4dC52ZXJiIH0pO1xyXG4gICAgICAgICAgICAgICAgY2xpZW50LmZldGNoKGNvbnRleHQucmVxdWVzdEFic29sdXRlVXJsLCBvcHRzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgeyByZXR1cm4gY29udGV4dC5wYXJzZXIucGFyc2UocmVzcG9uc2UpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsgcmV0dXJuIHNldFJlc3VsdChjb250ZXh0LCByZXN1bHQpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChjdHgpIHsgcmV0dXJuIHJlc29sdmUoY3R4KTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHJlamVjdChlKTsgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIExvZ3MgdGhlIGVuZCBvZiB0aGUgcmVxdWVzdFxyXG4gICAgICovXHJcbiAgICBQaXBlbGluZU1ldGhvZHMubG9nRW5kID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQuaXNCYXRjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBMb2dnZXIuYWN0aXZlTG9nTGV2ZWwgPT09IDEgLyogSW5mbyAqLyA/IHt9IDogY29udGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBsZXZlbDogMSAvKiBJbmZvICovLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiW1wiICsgY29udGV4dC5yZXF1ZXN0SWQgKyBcIl0gKFwiICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIFwiKSBcIiArIGNvbnRleHQudmVyYiArIFwiIHJlcXVlc3Qgd2lsbCBjb21wbGV0ZSBpbiBiYXRjaCBcIiArIGNvbnRleHQuYmF0Y2guYmF0Y2hJZCArIFwiLlwiLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBMb2dnZXIuYWN0aXZlTG9nTGV2ZWwgPT09IDEgLyogSW5mbyAqLyA/IHt9IDogY29udGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBsZXZlbDogMSAvKiBJbmZvICovLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiW1wiICsgY29udGV4dC5yZXF1ZXN0SWQgKyBcIl0gKFwiICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIFwiKSBDb21wbGV0aW5nIFwiICsgY29udGV4dC52ZXJiICsgXCIgcmVxdWVzdC5cIixcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc29sdmUoY29udGV4dCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgcmVxdWVzdFBpcGVsaW5lTWV0aG9kKHRydWUpXHJcbiAgICBdLCBQaXBlbGluZU1ldGhvZHMsIFwibG9nU3RhcnRcIiwgbnVsbCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXF1ZXN0UGlwZWxpbmVNZXRob2QoKVxyXG4gICAgXSwgUGlwZWxpbmVNZXRob2RzLCBcImNhY2hpbmdcIiwgbnVsbCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXF1ZXN0UGlwZWxpbmVNZXRob2QoKVxyXG4gICAgXSwgUGlwZWxpbmVNZXRob2RzLCBcInNlbmRcIiwgbnVsbCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXF1ZXN0UGlwZWxpbmVNZXRob2QodHJ1ZSlcclxuICAgIF0sIFBpcGVsaW5lTWV0aG9kcywgXCJsb2dFbmRcIiwgbnVsbCk7XHJcbiAgICByZXR1cm4gUGlwZWxpbmVNZXRob2RzO1xyXG59KCkpO1xyXG5mdW5jdGlvbiBnZXREZWZhdWx0UGlwZWxpbmUoKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICAgIFBpcGVsaW5lTWV0aG9kcy5sb2dTdGFydCxcclxuICAgICAgICBQaXBlbGluZU1ldGhvZHMuY2FjaGluZyxcclxuICAgICAgICBQaXBlbGluZU1ldGhvZHMuc2VuZCxcclxuICAgICAgICBQaXBlbGluZU1ldGhvZHMubG9nRW5kLFxyXG4gICAgXS5zbGljZSgwKTtcclxufVxuXG52YXIgUXVlcnlhYmxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUXVlcnlhYmxlKCkge1xyXG4gICAgICAgIHRoaXMuX3F1ZXJ5ID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSB7fTtcclxuICAgICAgICB0aGlzLl91cmwgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuX3BhcmVudFVybCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5fdXNlQ2FjaGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX2NhY2hpbmdPcHRpb25zID0gbnVsbDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgKiBHZXRzIHRoZSBjdXJyZW50bCB1cmxcclxuICAgICpcclxuICAgICovXHJcbiAgICBRdWVyeWFibGUucHJvdG90eXBlLnRvVXJsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91cmw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEaXJlY3RseSBjb25jYXRvbmF0ZXMgdGhlIHN1cHBsaWVkIHN0cmluZyB0byB0aGUgY3VycmVudCB1cmwsIG5vdCBub3JtYWxpemluZyBcIi9cIiBjaGFyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwYXRoUGFydCBUaGUgc3RyaW5nIHRvIGNvbmNhdG9uYXRlIHRvIHRoZSB1cmxcclxuICAgICAqL1xyXG4gICAgUXVlcnlhYmxlLnByb3RvdHlwZS5jb25jYXQgPSBmdW5jdGlvbiAocGF0aFBhcnQpIHtcclxuICAgICAgICB0aGlzLl91cmwgKz0gcGF0aFBhcnQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFF1ZXJ5YWJsZS5wcm90b3R5cGUsIFwicXVlcnlcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFByb3ZpZGVzIGFjY2VzcyB0byB0aGUgcXVlcnkgYnVpbGRlciBmb3IgdGhpcyB1cmxcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIFNldHMgY3VzdG9tIG9wdGlvbnMgZm9yIGN1cnJlbnQgb2JqZWN0IGFuZCBhbGwgZGVyaXZlZCBvYmplY3RzIGFjY2Vzc2libGUgdmlhIGNoYWluaW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgY3VzdG9tIG9wdGlvbnNcclxuICAgICAqL1xyXG4gICAgUXVlcnlhYmxlLnByb3RvdHlwZS5jb25maWd1cmUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIG1lcmdlT3B0aW9ucyh0aGlzLl9vcHRpb25zLCBvcHRpb25zKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENvbmZpZ3VyZXMgdGhpcyBpbnN0YW5jZSBmcm9tIHRoZSBjb25maWd1cmUgb3B0aW9ucyBvZiB0aGUgc3VwcGxpZWQgaW5zdGFuY2VcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbyBJbnN0YW5jZSBmcm9tIHdoaWNoIG9wdGlvbnMgc2hvdWxkIGJlIHRha2VuXHJcbiAgICAgKi9cclxuICAgIFF1ZXJ5YWJsZS5wcm90b3R5cGUuY29uZmlndXJlRnJvbSA9IGZ1bmN0aW9uIChvKSB7XHJcbiAgICAgICAgbWVyZ2VPcHRpb25zKHRoaXMuX29wdGlvbnMsIG8uX29wdGlvbnMpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRW5hYmxlcyBjYWNoaW5nIGZvciB0aGlzIHJlcXVlc3RcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBEZWZpbmVzIHRoZSBvcHRpb25zIHVzZWQgd2hlbiBjYWNoaW5nIHRoaXMgcmVxdWVzdFxyXG4gICAgICovXHJcbiAgICBRdWVyeWFibGUucHJvdG90eXBlLnVzaW5nQ2FjaGluZyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKCFSdW50aW1lQ29uZmlnLmdsb2JhbENhY2hlRGlzYWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLl91c2VDYWNoaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2FjaGluZ09wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIFF1ZXJ5YWJsZS5wcm90b3R5cGUuZ2V0Q29yZSA9IGZ1bmN0aW9uIChwYXJzZXIsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAocGFyc2VyID09PSB2b2lkIDApIHsgcGFyc2VyID0gbmV3IEpTT05QYXJzZXIoKTsgfVxyXG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudG9SZXF1ZXN0Q29udGV4dChcIkdFVFwiLCBvcHRpb25zLCBwYXJzZXIsIGdldERlZmF1bHRQaXBlbGluZSgpKS50aGVuKGZ1bmN0aW9uIChjb250ZXh0KSB7IHJldHVybiBwaXBlKGNvbnRleHQpOyB9KTtcclxuICAgIH07XHJcbiAgICBRdWVyeWFibGUucHJvdG90eXBlLnBvc3RDb3JlID0gZnVuY3Rpb24gKG9wdGlvbnMsIHBhcnNlcikge1xyXG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XHJcbiAgICAgICAgaWYgKHBhcnNlciA9PT0gdm9pZCAwKSB7IHBhcnNlciA9IG5ldyBKU09OUGFyc2VyKCk7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy50b1JlcXVlc3RDb250ZXh0KFwiUE9TVFwiLCBvcHRpb25zLCBwYXJzZXIsIGdldERlZmF1bHRQaXBlbGluZSgpKS50aGVuKGZ1bmN0aW9uIChjb250ZXh0KSB7IHJldHVybiBwaXBlKGNvbnRleHQpOyB9KTtcclxuICAgIH07XHJcbiAgICBRdWVyeWFibGUucHJvdG90eXBlLnBhdGNoQ29yZSA9IGZ1bmN0aW9uIChvcHRpb25zLCBwYXJzZXIpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIGlmIChwYXJzZXIgPT09IHZvaWQgMCkgeyBwYXJzZXIgPSBuZXcgSlNPTlBhcnNlcigpOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudG9SZXF1ZXN0Q29udGV4dChcIlBBVENIXCIsIG9wdGlvbnMsIHBhcnNlciwgZ2V0RGVmYXVsdFBpcGVsaW5lKCkpLnRoZW4oZnVuY3Rpb24gKGNvbnRleHQpIHsgcmV0dXJuIHBpcGUoY29udGV4dCk7IH0pO1xyXG4gICAgfTtcclxuICAgIFF1ZXJ5YWJsZS5wcm90b3R5cGUuZGVsZXRlQ29yZSA9IGZ1bmN0aW9uIChvcHRpb25zLCBwYXJzZXIpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIGlmIChwYXJzZXIgPT09IHZvaWQgMCkgeyBwYXJzZXIgPSBuZXcgSlNPTlBhcnNlcigpOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudG9SZXF1ZXN0Q29udGV4dChcIkRFTEVURVwiLCBvcHRpb25zLCBwYXJzZXIsIGdldERlZmF1bHRQaXBlbGluZSgpKS50aGVuKGZ1bmN0aW9uIChjb250ZXh0KSB7IHJldHVybiBwaXBlKGNvbnRleHQpOyB9KTtcclxuICAgIH07XHJcbiAgICBRdWVyeWFibGUucHJvdG90eXBlLnB1dENvcmUgPSBmdW5jdGlvbiAob3B0aW9ucywgcGFyc2VyKSB7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cclxuICAgICAgICBpZiAocGFyc2VyID09PSB2b2lkIDApIHsgcGFyc2VyID0gbmV3IEpTT05QYXJzZXIoKTsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRvUmVxdWVzdENvbnRleHQoXCJQVVRcIiwgb3B0aW9ucywgcGFyc2VyLCBnZXREZWZhdWx0UGlwZWxpbmUoKSkudGhlbihmdW5jdGlvbiAoY29udGV4dCkgeyByZXR1cm4gcGlwZShjb250ZXh0KTsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBcHBlbmRzIHRoZSBnaXZlbiBzdHJpbmcgYW5kIG5vcm1hbGl6ZXMgXCIvXCIgY2hhcnNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcGF0aFBhcnQgVGhlIHN0cmluZyB0byBhcHBlbmRcclxuICAgICAqL1xyXG4gICAgUXVlcnlhYmxlLnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbiAocGF0aFBhcnQpIHtcclxuICAgICAgICB0aGlzLl91cmwgPSBjb21iaW5lKHRoaXMuX3VybCwgcGF0aFBhcnQpO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShRdWVyeWFibGUucHJvdG90eXBlLCBcInBhcmVudFVybFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgcGFyZW50IHVybCB1c2VkIHdoZW4gY3JlYXRpbmcgdGhpcyBpbnN0YW5jZVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnRVcmw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEV4dGVuZHMgdGhpcyBxdWVyeWFibGUgZnJvbSB0aGUgcHJvdmlkZWQgcGFyZW50XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBhcmVudCBQYXJlbnQgcXVlcnlhYmxlIGZyb20gd2hpY2ggd2Ugd2lsbCBkZXJpdmUgYSBiYXNlIHVybFxyXG4gICAgICogQHBhcmFtIHBhdGggQWRkaXRpb25hbCBwYXRoXHJcbiAgICAgKi9cclxuICAgIFF1ZXJ5YWJsZS5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24gKHBhcmVudCwgcGF0aCkge1xyXG4gICAgICAgIHRoaXMuX3BhcmVudFVybCA9IHBhcmVudC5fdXJsO1xyXG4gICAgICAgIHRoaXMuX3VybCA9IGNvbWJpbmUodGhpcy5fcGFyZW50VXJsLCBwYXRoKTtcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyZUZyb20ocGFyZW50KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUXVlcnlhYmxlO1xyXG59KCkpO1xyXG52YXIgT0RhdGFRdWVyeWFibGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoT0RhdGFRdWVyeWFibGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBPRGF0YVF1ZXJ5YWJsZSgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9iYXRjaCA9IG51bGw7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIHRoaXMgcXVlcnkgdG8gdGhlIHN1cHBsaWVkIGJhdGNoXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIGxldCBiID0gcG5wLnNwLmNyZWF0ZUJhdGNoKCk7XHJcbiAgICAgKiBwbnAuc3Aud2ViLmluQmF0Y2goYikuZ2V0KCkudGhlbiguLi4pO1xyXG4gICAgICogYi5leGVjdXRlKCkudGhlbiguLi4pXHJcbiAgICAgKiBgYGBcclxuICAgICAqL1xyXG4gICAgT0RhdGFRdWVyeWFibGUucHJvdG90eXBlLmluQmF0Y2ggPSBmdW5jdGlvbiAoYmF0Y2gpIHtcclxuICAgICAgICBpZiAodGhpcy5iYXRjaCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGlzIHF1ZXJ5IGlzIGFscmVhZHkgcGFydCBvZiBhIGJhdGNoLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fYmF0Y2ggPSBiYXRjaDtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIGN1cnJlbnRsIHVybFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgT0RhdGFRdWVyeWFibGUucHJvdG90eXBlLnRvVXJsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91cmw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBFeGVjdXRlcyB0aGUgY3VycmVudGx5IGJ1aWx0IHJlcXVlc3RcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcGFyc2VyIEFsbG93cyB5b3UgdG8gc3BlY2lmeSBhIHBhcnNlciB0byBoYW5kbGUgdGhlIHJlc3VsdFxyXG4gICAgICogQHBhcmFtIGdldE9wdGlvbnMgVGhlIG9wdGlvbnMgdXNlZCBmb3IgdGhpcyByZXF1ZXN0XHJcbiAgICAgKi9cclxuICAgIE9EYXRhUXVlcnlhYmxlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAocGFyc2VyLCBvcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKHBhcnNlciA9PT0gdm9pZCAwKSB7IHBhcnNlciA9IG5ldyBPRGF0YURlZmF1bHRQYXJzZXIoKTsgfVxyXG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29yZShwYXJzZXIsIG9wdGlvbnMpO1xyXG4gICAgfTtcclxuICAgIE9EYXRhUXVlcnlhYmxlLnByb3RvdHlwZS5nZXRDb3JlID0gZnVuY3Rpb24gKHBhcnNlciwgb3B0aW9ucykge1xyXG4gICAgICAgIGlmIChwYXJzZXIgPT09IHZvaWQgMCkgeyBwYXJzZXIgPSBuZXcgT0RhdGFEZWZhdWx0UGFyc2VyKCk7IH1cclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRvUmVxdWVzdENvbnRleHQoXCJHRVRcIiwgb3B0aW9ucywgcGFyc2VyLCBnZXREZWZhdWx0UGlwZWxpbmUoKSkudGhlbihmdW5jdGlvbiAoY29udGV4dCkgeyByZXR1cm4gcGlwZShjb250ZXh0KTsgfSk7XHJcbiAgICB9O1xyXG4gICAgT0RhdGFRdWVyeWFibGUucHJvdG90eXBlLnBvc3RDb3JlID0gZnVuY3Rpb24gKG9wdGlvbnMsIHBhcnNlcikge1xyXG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XHJcbiAgICAgICAgaWYgKHBhcnNlciA9PT0gdm9pZCAwKSB7IHBhcnNlciA9IG5ldyBPRGF0YURlZmF1bHRQYXJzZXIoKTsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRvUmVxdWVzdENvbnRleHQoXCJQT1NUXCIsIG9wdGlvbnMsIHBhcnNlciwgZ2V0RGVmYXVsdFBpcGVsaW5lKCkpLnRoZW4oZnVuY3Rpb24gKGNvbnRleHQpIHsgcmV0dXJuIHBpcGUoY29udGV4dCk7IH0pO1xyXG4gICAgfTtcclxuICAgIE9EYXRhUXVlcnlhYmxlLnByb3RvdHlwZS5wYXRjaENvcmUgPSBmdW5jdGlvbiAob3B0aW9ucywgcGFyc2VyKSB7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cclxuICAgICAgICBpZiAocGFyc2VyID09PSB2b2lkIDApIHsgcGFyc2VyID0gbmV3IE9EYXRhRGVmYXVsdFBhcnNlcigpOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudG9SZXF1ZXN0Q29udGV4dChcIlBBVENIXCIsIG9wdGlvbnMsIHBhcnNlciwgZ2V0RGVmYXVsdFBpcGVsaW5lKCkpLnRoZW4oZnVuY3Rpb24gKGNvbnRleHQpIHsgcmV0dXJuIHBpcGUoY29udGV4dCk7IH0pO1xyXG4gICAgfTtcclxuICAgIE9EYXRhUXVlcnlhYmxlLnByb3RvdHlwZS5kZWxldGVDb3JlID0gZnVuY3Rpb24gKG9wdGlvbnMsIHBhcnNlcikge1xyXG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XHJcbiAgICAgICAgaWYgKHBhcnNlciA9PT0gdm9pZCAwKSB7IHBhcnNlciA9IG5ldyBPRGF0YURlZmF1bHRQYXJzZXIoKTsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRvUmVxdWVzdENvbnRleHQoXCJERUxFVEVcIiwgb3B0aW9ucywgcGFyc2VyLCBnZXREZWZhdWx0UGlwZWxpbmUoKSkudGhlbihmdW5jdGlvbiAoY29udGV4dCkgeyByZXR1cm4gcGlwZShjb250ZXh0KTsgfSk7XHJcbiAgICB9O1xyXG4gICAgT0RhdGFRdWVyeWFibGUucHJvdG90eXBlLnB1dENvcmUgPSBmdW5jdGlvbiAob3B0aW9ucywgcGFyc2VyKSB7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cclxuICAgICAgICBpZiAocGFyc2VyID09PSB2b2lkIDApIHsgcGFyc2VyID0gbmV3IE9EYXRhRGVmYXVsdFBhcnNlcigpOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudG9SZXF1ZXN0Q29udGV4dChcIlBVVFwiLCBvcHRpb25zLCBwYXJzZXIsIGdldERlZmF1bHRQaXBlbGluZSgpKS50aGVuKGZ1bmN0aW9uIChjb250ZXh0KSB7IHJldHVybiBwaXBlKGNvbnRleHQpOyB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEJsb2NrcyBhIGJhdGNoIGNhbGwgZnJvbSBvY2N1cmluZywgTVVTVCBiZSBjbGVhcmVkIGJ5IGNhbGxpbmcgdGhlIHJldHVybmVkIGZ1bmN0aW9uXHJcbiAgICAqL1xyXG4gICAgT0RhdGFRdWVyeWFibGUucHJvdG90eXBlLmFkZEJhdGNoRGVwZW5kZW5jeSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5fYmF0Y2ggIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JhdGNoLmFkZERlcGVuZGVuY3koKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIG51bGw7IH07XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE9EYXRhUXVlcnlhYmxlLnByb3RvdHlwZSwgXCJoYXNCYXRjaFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5kaWNhdGVzIGlmIHRoZSBjdXJyZW50IHF1ZXJ5IGhhcyBhIGJhdGNoIGFzc29jaWF0ZWRcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0RGVmaW5lZE5vdE51bGwodGhpcy5fYmF0Y2gpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE9EYXRhUXVlcnlhYmxlLnByb3RvdHlwZSwgXCJiYXRjaFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIGJhdGNoIGN1cnJlbnRseSBhc3NvY2lhdGVkIHdpdGggdGhpcyBxdWVyeSBvciBudWxsXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzQmF0Y2ggPyB0aGlzLl9iYXRjaCA6IG51bGw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gT0RhdGFRdWVyeWFibGU7XHJcbn0oUXVlcnlhYmxlKSk7XG5cbnZhciBPRGF0YUJhdGNoID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gT0RhdGFCYXRjaChfYmF0Y2hJZCkge1xyXG4gICAgICAgIGlmIChfYmF0Y2hJZCA9PT0gdm9pZCAwKSB7IF9iYXRjaElkID0gZ2V0R1VJRCgpOyB9XHJcbiAgICAgICAgdGhpcy5fYmF0Y2hJZCA9IF9iYXRjaElkO1xyXG4gICAgICAgIHRoaXMuX3JlcXMgPSBbXTtcclxuICAgICAgICB0aGlzLl9kZXBzID0gW107XHJcbiAgICAgICAgdGhpcy5fckRlcHMgPSBbXTtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPRGF0YUJhdGNoLnByb3RvdHlwZSwgXCJiYXRjaElkXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JhdGNoSWQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT0RhdGFCYXRjaC5wcm90b3R5cGUsIFwicmVxdWVzdHNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSByZXF1ZXN0cyBjb250YWluZWQgaW4gdGhpcyBiYXRjaFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVxcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cmwgUmVxdWVzdCB1cmxcclxuICAgICAqIEBwYXJhbSBtZXRob2QgUmVxdWVzdCBtZXRob2QgKEdFVCwgUE9TVCwgZXRjKVxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgQW55IHJlcXVlc3Qgb3B0aW9uc1xyXG4gICAgICogQHBhcmFtIHBhcnNlciBUaGUgcGFyc2VyIHVzZWQgdG8gaGFuZGxlIHRoZSBldmVudHVhbCByZXR1cm4gZnJvbSB0aGUgcXVlcnlcclxuICAgICAqIEBwYXJhbSBpZCBBbiBpZGVudGlmaWVyIHVzZWQgdG8gdHJhY2sgYSByZXF1ZXN0IHdpdGhpbiBhIGJhdGNoXHJcbiAgICAgKi9cclxuICAgIE9EYXRhQmF0Y2gucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh1cmwsIG1ldGhvZCwgb3B0aW9ucywgcGFyc2VyLCBpZCkge1xyXG4gICAgICAgIHZhciBpbmZvID0ge1xyXG4gICAgICAgICAgICBpZDogaWQsXHJcbiAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXHJcbiAgICAgICAgICAgIHBhcnNlcjogcGFyc2VyLFxyXG4gICAgICAgICAgICByZWplY3Q6IG51bGwsXHJcbiAgICAgICAgICAgIHJlc29sdmU6IG51bGwsXHJcbiAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIGluZm8ucmVzb2x2ZSA9IHJlc29sdmU7XHJcbiAgICAgICAgICAgIGluZm8ucmVqZWN0ID0gcmVqZWN0O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuX3JlcXMucHVzaChpbmZvKTtcclxuICAgICAgICByZXR1cm4gcDtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBkZXBlbmRlbmN5IGluc3VyaW5nIHRoYXQgc29tZSBzZXQgb2YgYWN0aW9ucyB3aWxsIG9jY3VyIGJlZm9yZSBhIGJhdGNoIGlzIHByb2Nlc3NlZC5cclxuICAgICAqIE1VU1QgYmUgY2xlYXJlZCB1c2luZyB0aGUgcmV0dXJuZWQgcmVzb2x2ZSBkZWxlZ2F0ZSB0byBhbGxvdyBiYXRjaGVzIHRvIHJ1blxyXG4gICAgICovXHJcbiAgICBPRGF0YUJhdGNoLnByb3RvdHlwZS5hZGREZXBlbmRlbmN5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZXNvbHZlciA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZvaWQgKDApOyB9O1xyXG4gICAgICAgIHRoaXMuX2RlcHMucHVzaChuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG4gICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmU7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHJldHVybiByZXNvbHZlcjtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBiYXRjaCdzIGV4ZWN1dGUgbWV0aG9kIHdpbGwgbm90IHJlc29sdmUgdXRpbCBhbnkgcHJvbWlzZXMgYWRkZWQgaGVyZSByZXNvbHZlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHAgVGhlIGRlcGVuZGVudCBwcm9taXNlXHJcbiAgICAgKi9cclxuICAgIE9EYXRhQmF0Y2gucHJvdG90eXBlLmFkZFJlc29sdmVCYXRjaERlcGVuZGVuY3kgPSBmdW5jdGlvbiAocCkge1xyXG4gICAgICAgIHRoaXMuX3JEZXBzLnB1c2gocCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBFeGVjdXRlIHRoZSBjdXJyZW50IGJhdGNoIGFuZCByZXNvbHZlIHRoZSBhc3NvY2lhdGVkIHByb21pc2VzXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMgQSBwcm9taXNlIHdoaWNoIHdpbGwgYmUgcmVzb2x2ZWQgb25jZSBhbGwgb2YgdGhlIGJhdGNoJ3MgY2hpbGQgcHJvbWlzZXMgaGF2ZSByZXNvbHZlZFxyXG4gICAgICovXHJcbiAgICBPRGF0YUJhdGNoLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgLy8gd2UgbmVlZCB0byBjaGVjayB0aGUgZGVwZW5kZW5jaWVzIHR3aWNlIGR1ZSB0byBob3cgZGlmZmVyZW50IGVuZ2luZXMgaGFuZGxlIHRoaW5ncy5cclxuICAgICAgICAvLyBXZSBjYW4gZ2V0IGEgc2Vjb25kIHNldCBvZiBwcm9taXNlcyBhZGRlZCBkdXJpbmcgdGhlIGZpcnN0IHNldCByZXNvbHZpbmdcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5fZGVwcylcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gUHJvbWlzZS5hbGwoX3RoaXMuX2RlcHMpOyB9KVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5leGVjdXRlSW1wbCgpOyB9KVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBQcm9taXNlLmFsbChfdGhpcy5fckRlcHMpOyB9KVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiB2b2lkICgwKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE9EYXRhQmF0Y2g7XHJcbn0oKSk7XG5cbmV4cG9ydCB7IENhY2hpbmdPcHRpb25zLCBDYWNoaW5nUGFyc2VyV3JhcHBlciwgT0RhdGFQYXJzZXJCYXNlLCBPRGF0YURlZmF1bHRQYXJzZXIsIFRleHRQYXJzZXIsIEJsb2JQYXJzZXIsIEpTT05QYXJzZXIsIEJ1ZmZlclBhcnNlciwgTGFtYmRhUGFyc2VyLCBzZXRSZXN1bHQsIHBpcGUsIHJlcXVlc3RQaXBlbGluZU1ldGhvZCwgUGlwZWxpbmVNZXRob2RzLCBnZXREZWZhdWx0UGlwZWxpbmUsIFF1ZXJ5YWJsZSwgT0RhdGFRdWVyeWFibGUsIE9EYXRhQmF0Y2ggfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW9kYXRhLmVzNS5qcy5tYXBcbiIsIi8qKlxuQGxpY2Vuc2VcbiAqIEBwbnAvc3AgdjEuMi4xIC0gcG5wIC0gcHJvdmlkZXMgYSBmbHVlbnQgYXBpIGZvciB3b3JraW5nIHdpdGggU2hhcmVQb2ludCBSRVNUXG4gKiBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS9wbnAvcG5wanMvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqIENvcHlyaWdodCAoYykgMjAxOCBNaWNyb3NvZnRcbiAqIGRvY3M6IGh0dHBzOi8vcG5wLmdpdGh1Yi5pby9wbnBqcy9cbiAqIHNvdXJjZTogaHR0cHM6Z2l0aHViLmNvbS9wbnAvcG5wanNcbiAqIGJ1Z3M6IGh0dHBzOi8vZ2l0aHViLmNvbS9wbnAvcG5wanMvaXNzdWVzXG4gKi9cbmltcG9ydCB7IHN0cmluZ0lzTnVsbE9yRW1wdHksIGV4dGVuZCwgY29tYmluZSwgaE9QLCBSdW50aW1lQ29uZmlnLCBGZXRjaENsaWVudCwgbWVyZ2VIZWFkZXJzLCBnZXRDdHhDYWxsYmFjaywgaXNVcmxBYnNvbHV0ZSwgbWVyZ2VPcHRpb25zLCBnZXRHVUlELCBqc1MsIGdldEF0dHJWYWx1ZUZyb21TdHJpbmcsIGRhdGVBZGQsIGdldEhhc2hDb2RlLCBvYmplY3REZWZpbmVkTm90TnVsbCB9IGZyb20gJ0BwbnAvY29tbW9uJztcbmltcG9ydCB7IF9fZXh0ZW5kcywgX19kZWNvcmF0ZSB9IGZyb20gJ3RzbGliJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJ0BwbnAvbG9nZ2luZyc7XG5pbXBvcnQgeyBPRGF0YVBhcnNlckJhc2UsIE9EYXRhRGVmYXVsdFBhcnNlciwgT0RhdGFRdWVyeWFibGUsIFRleHRQYXJzZXIsIEJsb2JQYXJzZXIsIEpTT05QYXJzZXIsIEJ1ZmZlclBhcnNlciwgT0RhdGFCYXRjaCwgQ2FjaGluZ09wdGlvbnMgfSBmcm9tICdAcG5wL29kYXRhJztcblxuZnVuY3Rpb24gZXh0cmFjdFdlYlVybChjYW5kaWRhdGVVcmwpIHtcclxuICAgIGlmIChzdHJpbmdJc051bGxPckVtcHR5KGNhbmRpZGF0ZVVybCkpIHtcclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH1cclxuICAgIHZhciBpbmRleCA9IGNhbmRpZGF0ZVVybC5pbmRleE9mKFwiX2FwaS9cIik7XHJcbiAgICBpZiAoaW5kZXggPCAwKSB7XHJcbiAgICAgICAgaW5kZXggPSBjYW5kaWRhdGVVcmwuaW5kZXhPZihcIl92dGlfYmluL1wiKTtcclxuICAgIH1cclxuICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgcmV0dXJuIGNhbmRpZGF0ZVVybC5zdWJzdHIoMCwgaW5kZXgpO1xyXG4gICAgfVxyXG4gICAgLy8gaWYgYWxsIGVsc2UgZmFpbHMganVzdCBnaXZlIHRoZW0gd2hhdCB0aGV5IGdhdmUgdXMgYmFja1xyXG4gICAgcmV0dXJuIGNhbmRpZGF0ZVVybDtcclxufVxuXG5mdW5jdGlvbiBvZGF0YVVybEZyb20oY2FuZGlkYXRlKSB7XHJcbiAgICB2YXIgcGFydHMgPSBbXTtcclxuICAgIHZhciBzID0gW1wib2RhdGEudHlwZVwiLCBcIm9kYXRhLmVkaXRMaW5rXCIsIFwiX19tZXRhZGF0YVwiLCBcIm9kYXRhLm1ldGFkYXRhXCJdO1xyXG4gICAgaWYgKGhPUChjYW5kaWRhdGUsIHNbMF0pICYmIGNhbmRpZGF0ZVtzWzBdXSA9PT0gXCJTUC5XZWJcIikge1xyXG4gICAgICAgIC8vIHdlYnMgcmV0dXJuIGFuIGFic29sdXRlIHVybCBpbiB0aGUgZWRpdExpbmtcclxuICAgICAgICBpZiAoaE9QKGNhbmRpZGF0ZSwgc1sxXSkpIHtcclxuICAgICAgICAgICAgcGFydHMucHVzaChjYW5kaWRhdGVbc1sxXV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChoT1AoY2FuZGlkYXRlLCBzWzJdKSkge1xyXG4gICAgICAgICAgICAvLyB3ZSBhcmUgZGVhbGluZyB3aXRoIHZlcmJvc2UsIHdoaWNoIGhhcyBhbiBhYnNvbHV0ZSB1cmlcclxuICAgICAgICAgICAgcGFydHMucHVzaChjYW5kaWRhdGUuX19tZXRhZGF0YS51cmkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChoT1AoY2FuZGlkYXRlLCBzWzNdKSAmJiBoT1AoY2FuZGlkYXRlLCBzWzFdKSkge1xyXG4gICAgICAgICAgICAvLyB3ZSBhcmUgZGVhbGlnbiB3aXRoIG1pbmltYWwgbWV0YWRhdGEgKGRlZmF1bHQpXHJcbiAgICAgICAgICAgIHBhcnRzLnB1c2goZXh0cmFjdFdlYlVybChjYW5kaWRhdGVbc1szXV0pLCBcIl9hcGlcIiwgY2FuZGlkYXRlW3NbMV1dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaE9QKGNhbmRpZGF0ZSwgc1sxXSkpIHtcclxuICAgICAgICAgICAgcGFydHMucHVzaChcIl9hcGlcIiwgY2FuZGlkYXRlW3NbMV1dKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaE9QKGNhbmRpZGF0ZSwgc1syXSkpIHtcclxuICAgICAgICAgICAgLy8gd2UgYXJlIGRlYWxpbmcgd2l0aCB2ZXJib3NlLCB3aGljaCBoYXMgYW4gYWJzb2x1dGUgdXJpXHJcbiAgICAgICAgICAgIHBhcnRzLnB1c2goY2FuZGlkYXRlLl9fbWV0YWRhdGEudXJpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAocGFydHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIExvZ2dlci53cml0ZShcIk5vIHVyaSBpbmZvcm1hdGlvbiBmb3VuZCBpbiBPRGF0YUVudGl0eSBwYXJzaW5nLCBjaGFpbmluZyB3aWxsIGZhaWwgZm9yIHRoaXMgb2JqZWN0LlwiLCAyIC8qIFdhcm5pbmcgKi8pO1xyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbWJpbmUuYXBwbHkodm9pZCAwLCBwYXJ0cyk7XHJcbn1cclxudmFyIFNQT0RhdGFFbnRpdHlQYXJzZXJJbXBsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNQT0RhdGFFbnRpdHlQYXJzZXJJbXBsLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU1BPRGF0YUVudGl0eVBhcnNlckltcGwoZmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuZmFjdG9yeSA9IGZhY3Rvcnk7XHJcbiAgICAgICAgX3RoaXMuaHlkcmF0ZSA9IGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgIHZhciBvID0gbmV3IF90aGlzLmZhY3Rvcnkob2RhdGFVcmxGcm9tKGQpLCBudWxsKTtcclxuICAgICAgICAgICAgcmV0dXJuIGV4dGVuZChvLCBkKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFNQT0RhdGFFbnRpdHlQYXJzZXJJbXBsLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5wYXJzZS5jYWxsKHRoaXMsIHIpLnRoZW4oZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgdmFyIG8gPSBuZXcgX3RoaXMuZmFjdG9yeShvZGF0YVVybEZyb20oZCksIG51bGwpO1xyXG4gICAgICAgICAgICByZXR1cm4gZXh0ZW5kKG8sIGQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTUE9EYXRhRW50aXR5UGFyc2VySW1wbDtcclxufShPRGF0YVBhcnNlckJhc2UpKTtcclxudmFyIFNQT0RhdGFFbnRpdHlBcnJheVBhcnNlckltcGwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU1BPRGF0YUVudGl0eUFycmF5UGFyc2VySW1wbCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNQT0RhdGFFbnRpdHlBcnJheVBhcnNlckltcGwoZmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuZmFjdG9yeSA9IGZhY3Rvcnk7XHJcbiAgICAgICAgX3RoaXMuaHlkcmF0ZSA9IGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkLm1hcChmdW5jdGlvbiAodikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG8gPSBuZXcgX3RoaXMuZmFjdG9yeShvZGF0YVVybEZyb20odiksIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4dGVuZChvLCB2KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBTUE9EYXRhRW50aXR5QXJyYXlQYXJzZXJJbXBsLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5wYXJzZS5jYWxsKHRoaXMsIHIpLnRoZW4oZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGQubWFwKGZ1bmN0aW9uICh2KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbyA9IG5ldyBfdGhpcy5mYWN0b3J5KG9kYXRhVXJsRnJvbSh2KSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXh0ZW5kKG8sIHYpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU1BPRGF0YUVudGl0eUFycmF5UGFyc2VySW1wbDtcclxufShPRGF0YVBhcnNlckJhc2UpKTtcclxuZnVuY3Rpb24gc3BPRGF0YUVudGl0eShmYWN0b3J5KSB7XHJcbiAgICByZXR1cm4gbmV3IFNQT0RhdGFFbnRpdHlQYXJzZXJJbXBsKGZhY3RvcnkpO1xyXG59XHJcbmZ1bmN0aW9uIHNwT0RhdGFFbnRpdHlBcnJheShmYWN0b3J5KSB7XHJcbiAgICByZXR1cm4gbmV3IFNQT0RhdGFFbnRpdHlBcnJheVBhcnNlckltcGwoZmFjdG9yeSk7XHJcbn1cblxuZnVuY3Rpb24gc2V0dXAoY29uZmlnKSB7XHJcbiAgICBSdW50aW1lQ29uZmlnLmV4dGVuZChjb25maWcpO1xyXG59XHJcbnZhciBTUFJ1bnRpbWVDb25maWdJbXBsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU1BSdW50aW1lQ29uZmlnSW1wbCgpIHtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTUFJ1bnRpbWVDb25maWdJbXBsLnByb3RvdHlwZSwgXCJoZWFkZXJzXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHNwUGFydCA9IFJ1bnRpbWVDb25maWcuZ2V0KFwic3BcIik7XHJcbiAgICAgICAgICAgIGlmIChzcFBhcnQgIT09IHVuZGVmaW5lZCAmJiBzcFBhcnQuaGVhZGVycyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3BQYXJ0LmhlYWRlcnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNQUnVudGltZUNvbmZpZ0ltcGwucHJvdG90eXBlLCBcImJhc2VVcmxcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgc3BQYXJ0ID0gUnVudGltZUNvbmZpZy5nZXQoXCJzcFwiKTtcclxuICAgICAgICAgICAgaWYgKHNwUGFydCAhPT0gdW5kZWZpbmVkICYmIHNwUGFydC5iYXNlVXJsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzcFBhcnQuYmFzZVVybDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoUnVudGltZUNvbmZpZy5zcGZ4Q29udGV4dCAhPT0gdW5kZWZpbmVkICYmIFJ1bnRpbWVDb25maWcuc3BmeENvbnRleHQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBSdW50aW1lQ29uZmlnLnNwZnhDb250ZXh0LnBhZ2VDb250ZXh0LndlYi5hYnNvbHV0ZVVybDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTUFJ1bnRpbWVDb25maWdJbXBsLnByb3RvdHlwZSwgXCJmZXRjaENsaWVudEZhY3RvcnlcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgc3BQYXJ0ID0gUnVudGltZUNvbmZpZy5nZXQoXCJzcFwiKTtcclxuICAgICAgICAgICAgLy8gdXNlIGEgY29uZmlndXJlZCBmYWN0b3J5IGZpcnRcclxuICAgICAgICAgICAgaWYgKHNwUGFydCAhPT0gdW5kZWZpbmVkICYmIHNwUGFydC5mZXRjaENsaWVudEZhY3RvcnkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNwUGFydC5mZXRjaENsaWVudEZhY3Rvcnk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IEZldGNoQ2xpZW50KCk7IH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBTUFJ1bnRpbWVDb25maWdJbXBsO1xyXG59KCkpO1xyXG52YXIgU1BSdW50aW1lQ29uZmlnID0gbmV3IFNQUnVudGltZUNvbmZpZ0ltcGwoKTtcblxudmFyIENhY2hlZERpZ2VzdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENhY2hlZERpZ2VzdCgpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBDYWNoZWREaWdlc3Q7XHJcbn0oKSk7XHJcbi8vIGFsbG93cyBmb3IgdGhlIGNhY2hpbmcgb2YgZGlnZXN0cyBhY3Jvc3MgYWxsIEh0dHBDbGllbnQncyB3aGljaCBlYWNoIGhhdmUgdGhlaXIgb3duIERpZ2VzdENhY2hlIHdyYXBwZXIuXHJcbnZhciBkaWdlc3RzID0gbmV3IE1hcCgpO1xyXG52YXIgRGlnZXN0Q2FjaGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBEaWdlc3RDYWNoZShfaHR0cENsaWVudCwgX2RpZ2VzdHMpIHtcclxuICAgICAgICBpZiAoX2RpZ2VzdHMgPT09IHZvaWQgMCkgeyBfZGlnZXN0cyA9IGRpZ2VzdHM7IH1cclxuICAgICAgICB0aGlzLl9odHRwQ2xpZW50ID0gX2h0dHBDbGllbnQ7XHJcbiAgICAgICAgdGhpcy5fZGlnZXN0cyA9IF9kaWdlc3RzO1xyXG4gICAgfVxyXG4gICAgRGlnZXN0Q2FjaGUucHJvdG90eXBlLmdldERpZ2VzdCA9IGZ1bmN0aW9uICh3ZWJVcmwpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBjYWNoZWREaWdlc3QgPSB0aGlzLl9kaWdlc3RzLmdldCh3ZWJVcmwpO1xyXG4gICAgICAgIGlmIChjYWNoZWREaWdlc3QgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgaWYgKG5vdyA8IGNhY2hlZERpZ2VzdC5leHBpcmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNhY2hlZERpZ2VzdC52YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbWJpbmUod2ViVXJsLCBcIi9fYXBpL2NvbnRleHRpbmZvXCIpO1xyXG4gICAgICAgIHZhciBoZWFkZXJzID0ge1xyXG4gICAgICAgICAgICBcIkFjY2VwdFwiOiBcImFwcGxpY2F0aW9uL2pzb247b2RhdGE9dmVyYm9zZVwiLFxyXG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb247b2RhdGE9dmVyYm9zZTtjaGFyc2V0PXV0Zi04XCIsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5faHR0cENsaWVudC5mZXRjaFJhdyh1cmwsIHtcclxuICAgICAgICAgICAgY2FjaGU6IFwibm8tY2FjaGVcIixcclxuICAgICAgICAgICAgY3JlZGVudGlhbHM6IFwic2FtZS1vcmlnaW5cIixcclxuICAgICAgICAgICAgaGVhZGVyczogZXh0ZW5kKGhlYWRlcnMsIFNQUnVudGltZUNvbmZpZy5oZWFkZXJzLCB0cnVlKSxcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IE9EYXRhRGVmYXVsdFBhcnNlcigpO1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VyLnBhcnNlKHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLkdldENvbnRleHRXZWJJbmZvcm1hdGlvbjsgfSk7XHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgbmV3Q2FjaGVkRGlnZXN0ID0gbmV3IENhY2hlZERpZ2VzdCgpO1xyXG4gICAgICAgICAgICBuZXdDYWNoZWREaWdlc3QudmFsdWUgPSBkYXRhLkZvcm1EaWdlc3RWYWx1ZTtcclxuICAgICAgICAgICAgdmFyIHNlY29uZHMgPSBkYXRhLkZvcm1EaWdlc3RUaW1lb3V0U2Vjb25kcztcclxuICAgICAgICAgICAgdmFyIGV4cGlyYXRpb24gPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBleHBpcmF0aW9uLnNldFRpbWUoZXhwaXJhdGlvbi5nZXRUaW1lKCkgKyAxMDAwICogc2Vjb25kcyk7XHJcbiAgICAgICAgICAgIG5ld0NhY2hlZERpZ2VzdC5leHBpcmF0aW9uID0gZXhwaXJhdGlvbjtcclxuICAgICAgICAgICAgX3RoaXMuX2RpZ2VzdHMuc2V0KHdlYlVybCwgbmV3Q2FjaGVkRGlnZXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ld0NhY2hlZERpZ2VzdC52YWx1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBEaWdlc3RDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5fZGlnZXN0cy5jbGVhcigpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBEaWdlc3RDYWNoZTtcclxufSgpKTtcblxudmFyIFNQSHR0cENsaWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNQSHR0cENsaWVudChfaW1wbCkge1xyXG4gICAgICAgIGlmIChfaW1wbCA9PT0gdm9pZCAwKSB7IF9pbXBsID0gU1BSdW50aW1lQ29uZmlnLmZldGNoQ2xpZW50RmFjdG9yeSgpOyB9XHJcbiAgICAgICAgdGhpcy5faW1wbCA9IF9pbXBsO1xyXG4gICAgICAgIHRoaXMuX2RpZ2VzdENhY2hlID0gbmV3IERpZ2VzdENhY2hlKHRoaXMpO1xyXG4gICAgfVxyXG4gICAgU1BIdHRwQ2xpZW50LnByb3RvdHlwZS5mZXRjaCA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XHJcbiAgICAgICAgdmFyIG9wdHMgPSBleHRlbmQob3B0aW9ucywgeyBjYWNoZTogXCJuby1jYWNoZVwiLCBjcmVkZW50aWFsczogXCJzYW1lLW9yaWdpblwiIH0sIHRydWUpO1xyXG4gICAgICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcclxuICAgICAgICAvLyBmaXJzdCB3ZSBhZGQgdGhlIGdsb2JhbCBoZWFkZXJzIHNvIHRoZXkgY2FuIGJlIG92ZXJ3cml0dGVuIGJ5IGFueSBwYXNzZWQgaW4gbG9jYWxseSB0byB0aGlzIGNhbGxcclxuICAgICAgICBtZXJnZUhlYWRlcnMoaGVhZGVycywgU1BSdW50aW1lQ29uZmlnLmhlYWRlcnMpO1xyXG4gICAgICAgIC8vIHNlY29uZCB3ZSBhZGQgdGhlIGxvY2FsIG9wdGlvbnMgc28gd2UgY2FuIG92ZXJ3cml0ZSB0aGUgZ2xvYmFsc1xyXG4gICAgICAgIG1lcmdlSGVhZGVycyhoZWFkZXJzLCBvcHRpb25zLmhlYWRlcnMpO1xyXG4gICAgICAgIC8vIGxhc3RseSB3ZSBhcHBseSBhbnkgZGVmYXVsdCBoZWFkZXJzIHdlIG5lZWQgdGhhdCBtYXkgbm90IGV4aXN0XHJcbiAgICAgICAgaWYgKCFoZWFkZXJzLmhhcyhcIkFjY2VwdFwiKSkge1xyXG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkFjY2VwdFwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaGVhZGVycy5oYXMoXCJDb250ZW50LVR5cGVcIikpIHtcclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uO29kYXRhPXZlcmJvc2U7Y2hhcnNldD11dGYtOFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFoZWFkZXJzLmhhcyhcIlgtQ2xpZW50U2VydmljZS1DbGllbnRUYWdcIikpIHtcclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoXCJYLUNsaWVudFNlcnZpY2UtQ2xpZW50VGFnXCIsIFwiUG5QQ29yZUpTOkBwbnAtMS4yLjFcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaGVhZGVycy5oYXMoXCJVc2VyLUFnZW50XCIpKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMgbWFya3MgdGhlIHJlcXVlc3RzIGZvciB1bmRlcnN0YW5kaW5nIGJ5IHRoZSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiVXNlci1BZ2VudFwiLCBcIk5PTklTVnxTaGFyZVBvaW50UG5QfFBuUENvcmVKUy8xLjIuMVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb3B0cyA9IGV4dGVuZChvcHRzLCB7IGhlYWRlcnM6IGhlYWRlcnMgfSk7XHJcbiAgICAgICAgaWYgKG9wdHMubWV0aG9kICYmIG9wdHMubWV0aG9kLnRvVXBwZXJDYXNlKCkgIT09IFwiR0VUXCIpIHtcclxuICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBlaXRoZXIgYSByZXF1ZXN0IGRpZ2VzdCBvciBhbiBhdXRob3JpemF0aW9uIGhlYWRlciB3ZSBkb24ndCBuZWVkIGEgZGlnZXN0XHJcbiAgICAgICAgICAgIGlmICghaGVhZGVycy5oYXMoXCJYLVJlcXVlc3REaWdlc3RcIikgJiYgIWhlYWRlcnMuaGFzKFwiQXV0aG9yaXphdGlvblwiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RpZ2VzdENhY2hlLmdldERpZ2VzdChleHRyYWN0V2ViVXJsKHVybCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRpZ2VzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiWC1SZXF1ZXN0RGlnZXN0XCIsIGRpZ2VzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmZldGNoUmF3KHVybCwgb3B0cyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5mZXRjaFJhdyh1cmwsIG9wdHMpO1xyXG4gICAgfTtcclxuICAgIFNQSHR0cENsaWVudC5wcm90b3R5cGUuZmV0Y2hSYXcgPSBmdW5jdGlvbiAodXJsLCBvcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIC8vIGhlcmUgd2UgbmVlZCB0byBub3JtYWxpemUgdGhlIGhlYWRlcnNcclxuICAgICAgICB2YXIgcmF3SGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcbiAgICAgICAgbWVyZ2VIZWFkZXJzKHJhd0hlYWRlcnMsIG9wdGlvbnMuaGVhZGVycyk7XHJcbiAgICAgICAgb3B0aW9ucyA9IGV4dGVuZChvcHRpb25zLCB7IGhlYWRlcnM6IHJhd0hlYWRlcnMgfSk7XHJcbiAgICAgICAgdmFyIHJldHJ5ID0gZnVuY3Rpb24gKGN0eCkge1xyXG4gICAgICAgICAgICAvLyBoYW5kbGVzIHNldHRpbmcgdGhlIHByb3BlciB0aW1lb3V0IGZvciBhIHJldHJ5XHJcbiAgICAgICAgICAgIHZhciBzZXRSZXRyeSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlbGF5O1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhlYWRlcnMuaGFzKFwiUmV0cnktQWZ0ZXJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIGdvdHRlbiBhIGhlYWRlciwgdXNlIHRoYXQgdmFsdWUgYXMgdGhlIGRlbGF5IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgZGVsYXkgPSBwYXJzZUludChyZXNwb25zZS5oZWFkZXJzLmdldChcIlJldHJ5LUFmdGVyXCIpLCAxMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBncmFiIG91ciBjdXJyZW50IGRlbGF5XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsYXkgPSBjdHguZGVsYXk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IG91ciBjb3VudGVycy5cclxuICAgICAgICAgICAgICAgICAgICBjdHguZGVsYXkgKj0gMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGN0eC5hdHRlbXB0cysrO1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBleGNlZWRlZCB0aGUgcmV0cnkgY291bnQsIHJlamVjdC5cclxuICAgICAgICAgICAgICAgIGlmIChjdHgucmV0cnlDb3VudCA8PSBjdHguYXR0ZW1wdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdHgucmVqZWN0KG5ldyBFcnJvcihcIlJldHJ5IGNvdW50IGV4Y2VlZGVkIChcIiArIGN0eC5yZXRyeUNvdW50ICsgXCIpIGZvciByZXF1ZXN0LiBSZXNwb25zZSBzdGF0dXM6IFtcIiArIHJlc3BvbnNlLnN0YXR1cyArIFwiXSBcIiArIHJlc3BvbnNlLnN0YXR1c1RleHQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCBvdXIgcmV0cnkgdGltZW91dCBmb3Ige2RlbGF5fSBtaWxsaXNlY29uZHMuXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChnZXRDdHhDYWxsYmFjayhfdGhpcywgcmV0cnksIGN0eCksIGRlbGF5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy8gc2VuZCB0aGUgYWN0dWFsIHJlcXVlc3RcclxuICAgICAgICAgICAgX3RoaXMuX2ltcGwuZmV0Y2godXJsLCBvcHRpb25zKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDI5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgaGF2ZSBiZWVuIHRocm90dGxlZFxyXG4gICAgICAgICAgICAgICAgICAgIHNldFJldHJ5KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA1MDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBodHRwIHN0YXR1cyBjb2RlIDUwMywgd2UgY2FuIHJldHJ5IHRoaXNcclxuICAgICAgICAgICAgICAgICAgICBzZXRSZXRyeShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjdHgucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICB2YXIgcmV0cnlDb250ZXh0ID0ge1xyXG4gICAgICAgICAgICAgICAgYXR0ZW1wdHM6IDAsXHJcbiAgICAgICAgICAgICAgICBkZWxheTogMTAwLFxyXG4gICAgICAgICAgICAgICAgcmVqZWN0OiByZWplY3QsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiByZXNvbHZlLFxyXG4gICAgICAgICAgICAgICAgcmV0cnlDb3VudDogNyxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0cnkuY2FsbChfdGhpcywgcmV0cnlDb250ZXh0KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBTUEh0dHBDbGllbnQucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIHZhciBvcHRzID0gZXh0ZW5kKG9wdGlvbnMsIHsgbWV0aG9kOiBcIkdFVFwiIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZldGNoKHVybCwgb3B0cyk7XHJcbiAgICB9O1xyXG4gICAgU1BIdHRwQ2xpZW50LnByb3RvdHlwZS5wb3N0ID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykge1xyXG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XHJcbiAgICAgICAgdmFyIG9wdHMgPSBleHRlbmQob3B0aW9ucywgeyBtZXRob2Q6IFwiUE9TVFwiIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZldGNoKHVybCwgb3B0cyk7XHJcbiAgICB9O1xyXG4gICAgU1BIdHRwQ2xpZW50LnByb3RvdHlwZS5wYXRjaCA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIHZhciBvcHRzID0gZXh0ZW5kKG9wdGlvbnMsIHsgbWV0aG9kOiBcIlBBVENIXCIgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2godXJsLCBvcHRzKTtcclxuICAgIH07XHJcbiAgICBTUEh0dHBDbGllbnQucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIHZhciBvcHRzID0gZXh0ZW5kKG9wdGlvbnMsIHsgbWV0aG9kOiBcIkRFTEVURVwiIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZldGNoKHVybCwgb3B0cyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFNQSHR0cENsaWVudDtcclxufSgpKTtcblxudmFyIGdsb2JhbCQxID0gKHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOlxuICAgICAgICAgICAgdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDpcbiAgICAgICAgICAgIHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSk7XG5cbi8qKlxyXG4gKiBFbnN1cmVzIHRoYXQgYSBnaXZlbiB1cmwgaXMgYWJzb2x1dGUgZm9yIHRoZSBjdXJyZW50IHdlYiBiYXNlZCBvbiBjb250ZXh0XHJcbiAqXHJcbiAqIEBwYXJhbSBjYW5kaWRhdGVVcmwgVGhlIHVybCB0byBtYWtlIGFic29sdXRlXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiB0b0Fic29sdXRlVXJsKGNhbmRpZGF0ZVVybCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XHJcbiAgICAgICAgaWYgKGlzVXJsQWJzb2x1dGUoY2FuZGlkYXRlVXJsKSkge1xyXG4gICAgICAgICAgICAvLyBpZiB3ZSBhcmUgYWxyZWFkeSBhYnNvbHV0ZSwgdGhlbiBqdXN0IHJldHVybiB0aGUgdXJsXHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGNhbmRpZGF0ZVVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChTUFJ1bnRpbWVDb25maWcuYmFzZVVybCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyBiYXNlIHVybCBzcGVjaWZpZWQgZWl0aGVyIHdpdGggYmFzZVVybCBvZiBzcGZ4Q29udGV4dCBjb25maWcgcHJvcGVydHlcclxuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoY29tYmluZShTUFJ1bnRpbWVDb25maWcuYmFzZVVybCwgY2FuZGlkYXRlVXJsKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChnbG9iYWwkMS5fc3BQYWdlQ29udGV4dEluZm8gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAvLyBvcGVyYXRpbmcgaW4gY2xhc3NpYyBwYWdlc1xyXG4gICAgICAgICAgICBpZiAoaE9QKGdsb2JhbCQxLl9zcFBhZ2VDb250ZXh0SW5mbywgXCJ3ZWJBYnNvbHV0ZVVybFwiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoY29tYmluZShnbG9iYWwkMS5fc3BQYWdlQ29udGV4dEluZm8ud2ViQWJzb2x1dGVVcmwsIGNhbmRpZGF0ZVVybCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGhPUChnbG9iYWwkMS5fc3BQYWdlQ29udGV4dEluZm8sIFwid2ViU2VydmVyUmVsYXRpdmVVcmxcIikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGNvbWJpbmUoZ2xvYmFsJDEuX3NwUGFnZUNvbnRleHRJbmZvLndlYlNlcnZlclJlbGF0aXZlVXJsLCBjYW5kaWRhdGVVcmwpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBkb2VzIHdpbmRvdy5sb2NhdGlvbiBleGlzdCBhbmQgaGF2ZSBhIGNlcnRhaW4gcGF0aCBwYXJ0IGluIGl0P1xyXG4gICAgICAgIGlmIChnbG9iYWwkMS5sb2NhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHZhciBiYXNlVXJsXzEgPSBnbG9iYWwkMS5sb2NhdGlvbi50b1N0cmluZygpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIFtcIi9fbGF5b3V0cy9cIiwgXCIvc2l0ZWFzc2V0cy9cIl0uZm9yRWFjaChmdW5jdGlvbiAocykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gYmFzZVVybF8xLmluZGV4T2Yocyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoY29tYmluZShiYXNlVXJsXzEuc3Vic3RyKDAsIGluZGV4KSwgY2FuZGlkYXRlVXJsKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzb2x2ZShjYW5kaWRhdGVVcmwpO1xyXG4gICAgfSk7XHJcbn1cblxuZnVuY3Rpb24gbWV0YWRhdGEodHlwZSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBcIl9fbWV0YWRhdGFcIjogeyBcInR5cGVcIjogdHlwZSB9LFxyXG4gICAgfTtcclxufVxuXG4vKipcclxuICogU2hhcmVQb2ludFF1ZXJ5YWJsZSBCYXNlIENsYXNzXHJcbiAqXHJcbiAqL1xyXG52YXIgU2hhcmVQb2ludFF1ZXJ5YWJsZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhTaGFyZVBvaW50UXVlcnlhYmxlLCBfc3VwZXIpO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBTaGFyZVBvaW50UXVlcnlhYmxlIGNsYXNzXHJcbiAgICAgKlxyXG4gICAgICogQGNvbnN0cnVjdG9yXHJcbiAgICAgKiBAcGFyYW0gYmFzZVVybCBBIHN0cmluZyBvciBTaGFyZVBvaW50UXVlcnlhYmxlIHRoYXQgc2hvdWxkIGZvcm0gdGhlIGJhc2UgcGFydCBvZiB0aGUgdXJsXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBTaGFyZVBvaW50UXVlcnlhYmxlKGJhc2VVcmwsIHBhdGgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9mb3JjZUNhY2hpbmcgPSBmYWxzZTtcclxuICAgICAgICBpZiAodHlwZW9mIGJhc2VVcmwgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBkbyBzb21lIGV4dHJhIHBhcnNpbmcgdG8gZ2V0IHRoZSBwYXJlbnQgdXJsIGNvcnJlY3QgaWYgd2UgYXJlXHJcbiAgICAgICAgICAgIC8vIGJlaW5nIGNyZWF0ZWQgZnJvbSBqdXN0IGEgc3RyaW5nLlxyXG4gICAgICAgICAgICBpZiAoaXNVcmxBYnNvbHV0ZShiYXNlVXJsKSB8fCBiYXNlVXJsLmxhc3RJbmRleE9mKFwiL1wiKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLl9wYXJlbnRVcmwgPSBiYXNlVXJsO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX3VybCA9IGNvbWJpbmUoYmFzZVVybCwgcGF0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoYmFzZVVybC5sYXN0SW5kZXhPZihcIi9cIikgPiBiYXNlVXJsLmxhc3RJbmRleE9mKFwiKFwiKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gLi4uL2l0ZW1zKDE5KS9maWVsZHNcclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGJhc2VVcmwubGFzdEluZGV4T2YoXCIvXCIpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX3BhcmVudFVybCA9IGJhc2VVcmwuc2xpY2UoMCwgaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgcGF0aCA9IGNvbWJpbmUoYmFzZVVybC5zbGljZShpbmRleCksIHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX3VybCA9IGNvbWJpbmUoX3RoaXMuX3BhcmVudFVybCwgcGF0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyAuLi4vaXRlbXMoMTkpXHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBiYXNlVXJsLmxhc3RJbmRleE9mKFwiKFwiKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLl9wYXJlbnRVcmwgPSBiYXNlVXJsLnNsaWNlKDAsIGluZGV4KTtcclxuICAgICAgICAgICAgICAgIF90aGlzLl91cmwgPSBjb21iaW5lKGJhc2VVcmwsIHBhdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBfdGhpcy5leHRlbmQoYmFzZVVybCwgcGF0aCk7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBiYXNlVXJsLnF1ZXJ5LmdldChcIkB0YXJnZXRcIik7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucXVlcnkuc2V0KFwiQHRhcmdldFwiLCB0YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgc3VwcGxpZWQgZmFjdG9yeSBhbmQgZXh0ZW5kcyB0aGlzIGludG8gdGhhdCBuZXcgaW5zdGFuY2VcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZmFjdG9yeSBjb25zdHJ1Y3RvciBmb3IgdGhlIG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGUucHJvdG90eXBlLmFzID0gZnVuY3Rpb24gKGZhY3RvcnkpIHtcclxuICAgICAgICB2YXIgbyA9IG5ldyBmYWN0b3J5KHRoaXMuX3VybCwgbnVsbCk7XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZChvLCB0aGlzLCB0cnVlKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIGZ1bGwgdXJsIHdpdGggcXVlcnkgaW5mb3JtYXRpb25cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGUucHJvdG90eXBlLnRvVXJsQW5kUXVlcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGFsaWFzZWRQYXJhbXMgPSBuZXcgTWFwKHRoaXMucXVlcnkpO1xyXG4gICAgICAgIHZhciB1cmwgPSB0aGlzLnRvVXJsKCkucmVwbGFjZSgvJyEoQC4qPyk6OiguKj8pJy9pZywgZnVuY3Rpb24gKG1hdGNoLCBsYWJlbE5hbWUsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIExvZ2dlci53cml0ZShcIlJld3JpdGluZyBhbGlhc2VkIHBhcmFtZXRlciBmcm9tIG1hdGNoIFwiICsgbWF0Y2ggKyBcIiB0byBsYWJlbDogXCIgKyBsYWJlbE5hbWUgKyBcIiB2YWx1ZTogXCIgKyB2YWx1ZSwgMCAvKiBWZXJib3NlICovKTtcclxuICAgICAgICAgICAgYWxpYXNlZFBhcmFtcy5zZXQobGFiZWxOYW1lLCBcIidcIiArIHZhbHVlICsgXCInXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gbGFiZWxOYW1lO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChhbGlhc2VkUGFyYW1zLnNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBjaGFyID0gdXJsLmluZGV4T2YoXCI/XCIpID4gLTEgPyBcIiZcIiA6IFwiP1wiO1xyXG4gICAgICAgICAgICB1cmwgKz0gXCJcIiArIGNoYXIgKyBBcnJheS5mcm9tKGFsaWFzZWRQYXJhbXMpLm1hcChmdW5jdGlvbiAodikgeyByZXR1cm4gdlswXSArIFwiPVwiICsgdlsxXTsgfSkuam9pbihcIiZcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1cmw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDaG9vc2Ugd2hpY2ggZmllbGRzIHRvIHJldHVyblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzZWxlY3RzIE9uZSBvciBtb3JlIGZpZWxkcyB0byByZXR1cm5cclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZS5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzZWxlY3RzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgc2VsZWN0c1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2VsZWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMucXVlcnkuc2V0KFwiJHNlbGVjdFwiLCBzZWxlY3RzLmpvaW4oXCIsXCIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBFeHBhbmRzIGZpZWxkcyBzdWNoIGFzIGxvb2t1cHMgdG8gZ2V0IGFkZGl0aW9uYWwgZGF0YVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBleHBhbmRzIFRoZSBGaWVsZHMgZm9yIHdoaWNoIHRvIGV4cGFuZCB0aGUgdmFsdWVzXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGUucHJvdG90eXBlLmV4cGFuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZXhwYW5kcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIGV4cGFuZHNbX2ldID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV4cGFuZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXJ5LnNldChcIiRleHBhbmRcIiwgZXhwYW5kcy5qb2luKFwiLFwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIHBhcmVudCBmb3IgdGhpcyBpbnN0YW5jZSBhcyBzcGVjaWZpZWRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZmFjdG9yeSBUaGUgY29udHJ1Y3RvciBmb3IgdGhlIGNsYXNzIHRvIGNyZWF0ZVxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlLnByb3RvdHlwZS5nZXRQYXJlbnQgPSBmdW5jdGlvbiAoZmFjdG9yeSwgYmFzZVVybCwgcGF0aCwgYmF0Y2gpIHtcclxuICAgICAgICBpZiAoYmFzZVVybCA9PT0gdm9pZCAwKSB7IGJhc2VVcmwgPSB0aGlzLnBhcmVudFVybDsgfVxyXG4gICAgICAgIHZhciBwYXJlbnQgPSBuZXcgZmFjdG9yeShiYXNlVXJsLCBwYXRoKS5jb25maWd1cmVGcm9tKHRoaXMpO1xyXG4gICAgICAgIHZhciB0ID0gXCJAdGFyZ2V0XCI7XHJcbiAgICAgICAgaWYgKHRoaXMucXVlcnkuaGFzKHQpKSB7XHJcbiAgICAgICAgICAgIHBhcmVudC5xdWVyeS5zZXQodCwgdGhpcy5xdWVyeS5nZXQodCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYmF0Y2ggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQuaW5CYXRjaChiYXRjaCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXJlbnQ7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDbG9uZXMgdGhpcyBTaGFyZVBvaW50UXVlcnlhYmxlIGludG8gYSBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZSBpbnN0YW5jZSBvZiBUXHJcbiAgICAgKiBAcGFyYW0gZmFjdG9yeSBDb25zdHJ1Y3RvciB1c2VkIHRvIGNyZWF0ZSB0aGUgbmV3IGluc3RhbmNlXHJcbiAgICAgKiBAcGFyYW0gYWRkaXRpb25hbFBhdGggQW55IGFkZGl0aW9uYWwgcGF0aCB0byBpbmNsdWRlIGluIHRoZSBjbG9uZVxyXG4gICAgICogQHBhcmFtIGluY2x1ZGVCYXRjaCBJZiB0cnVlIHRoaXMgaW5zdGFuY2UncyBiYXRjaCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBjbG9uZWQgaW5zdGFuY2VcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoZmFjdG9yeSwgYWRkaXRpb25hbFBhdGgsIGluY2x1ZGVCYXRjaCkge1xyXG4gICAgICAgIGlmIChpbmNsdWRlQmF0Y2ggPT09IHZvaWQgMCkgeyBpbmNsdWRlQmF0Y2ggPSB0cnVlOyB9XHJcbiAgICAgICAgdmFyIGNsb25lID0gbmV3IGZhY3RvcnkodGhpcywgYWRkaXRpb25hbFBhdGgpLmNvbmZpZ3VyZUZyb20odGhpcyk7XHJcbiAgICAgICAgdmFyIHQgPSBcIkB0YXJnZXRcIjtcclxuICAgICAgICBpZiAodGhpcy5xdWVyeS5oYXModCkpIHtcclxuICAgICAgICAgICAgY2xvbmUucXVlcnkuc2V0KHQsIHRoaXMucXVlcnkuZ2V0KHQpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGluY2x1ZGVCYXRjaCAmJiB0aGlzLmhhc0JhdGNoKSB7XHJcbiAgICAgICAgICAgIGNsb25lID0gY2xvbmUuaW5CYXRjaCh0aGlzLmJhdGNoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNsb25lO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ29udmVydHMgdGhlIGN1cnJlbnQgaW5zdGFuY2UgdG8gYSByZXF1ZXN0IGNvbnRleHRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdmVyYiBUaGUgcmVxdWVzdCB2ZXJiXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgc2V0IG9mIHN1cHBsaWVkIHJlcXVlc3Qgb3B0aW9uc1xyXG4gICAgICogQHBhcmFtIHBhcnNlciBUaGUgc3VwcGxpZWQgT0RhdGFQYXJzZXIgaW5zdGFuY2VcclxuICAgICAqIEBwYXJhbSBwaXBlbGluZSBPcHRpb25hbCByZXF1ZXN0IHByb2Nlc3NpbmcgcGlwZWxpbmVcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZS5wcm90b3R5cGUudG9SZXF1ZXN0Q29udGV4dCA9IGZ1bmN0aW9uICh2ZXJiLCBvcHRpb25zLCBwYXJzZXIsIHBpcGVsaW5lKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIHZhciBkZXBlbmRlbmN5RGlzcG9zZSA9IHRoaXMuaGFzQmF0Y2ggPyB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpIDogZnVuY3Rpb24gKCkgeyByZXR1cm47IH07XHJcbiAgICAgICAgcmV0dXJuIHRvQWJzb2x1dGVVcmwodGhpcy50b1VybEFuZFF1ZXJ5KCkpLnRoZW4oZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgICAgICBtZXJnZU9wdGlvbnMob3B0aW9ucywgX3RoaXMuX29wdGlvbnMpO1xyXG4gICAgICAgICAgICAvLyBidWlsZCBvdXIgcmVxdWVzdCBjb250ZXh0XHJcbiAgICAgICAgICAgIHZhciBjb250ZXh0ID0ge1xyXG4gICAgICAgICAgICAgICAgYmF0Y2g6IF90aGlzLmJhdGNoLFxyXG4gICAgICAgICAgICAgICAgYmF0Y2hEZXBlbmRlbmN5OiBkZXBlbmRlbmN5RGlzcG9zZSxcclxuICAgICAgICAgICAgICAgIGNhY2hpbmdPcHRpb25zOiBfdGhpcy5fY2FjaGluZ09wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICBjbGllbnRGYWN0b3J5OiBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgU1BIdHRwQ2xpZW50KCk7IH0sXHJcbiAgICAgICAgICAgICAgICBpc0JhdGNoZWQ6IF90aGlzLmhhc0JhdGNoLFxyXG4gICAgICAgICAgICAgICAgaXNDYWNoZWQ6IF90aGlzLl9mb3JjZUNhY2hpbmcgfHwgKF90aGlzLl91c2VDYWNoaW5nICYmIC9eZ2V0JC9pLnRlc3QodmVyYikpLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIHBhcnNlcjogcGFyc2VyLFxyXG4gICAgICAgICAgICAgICAgcGlwZWxpbmU6IHBpcGVsaW5lLFxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdEFic29sdXRlVXJsOiB1cmwsXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IGdldEdVSUQoKSxcclxuICAgICAgICAgICAgICAgIHZlcmI6IHZlcmIsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTaGFyZVBvaW50UXVlcnlhYmxlO1xyXG59KE9EYXRhUXVlcnlhYmxlKSk7XHJcbi8qKlxyXG4gKiBSZXByZXNlbnRzIGEgUkVTVCBjb2xsZWN0aW9uIHdoaWNoIGNhbiBiZSBmaWx0ZXJlZCwgcGFnZWQsIGFuZCBzZWxlY3RlZFxyXG4gKlxyXG4gKi9cclxudmFyIFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBGaWx0ZXJzIHRoZSByZXR1cm5lZCBjb2xsZWN0aW9uIChodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L29mZmljZS9mcDE0MjM4NS5hc3B4I2JrX3N1cHBvcnRlZClcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZmlsdGVyIFRoZSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBmaWx0ZXIgcXVlcnlcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24ucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uIChmaWx0ZXIpIHtcclxuICAgICAgICB0aGlzLnF1ZXJ5LnNldChcIiRmaWx0ZXJcIiwgZmlsdGVyKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIE9yZGVycyBiYXNlZCBvbiB0aGUgc3VwcGxpZWQgZmllbGRzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG9yZGVyYnkgVGhlIG5hbWUgb2YgdGhlIGZpZWxkIG9uIHdoaWNoIHRvIHNvcnRcclxuICAgICAqIEBwYXJhbSBhc2NlbmRpbmcgSWYgZmFsc2UgREVTQyBpcyBhcHBlbmRlZCwgb3RoZXJ3aXNlIEFTQyAoZGVmYXVsdClcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24ucHJvdG90eXBlLm9yZGVyQnkgPSBmdW5jdGlvbiAob3JkZXJCeSwgYXNjZW5kaW5nKSB7XHJcbiAgICAgICAgaWYgKGFzY2VuZGluZyA9PT0gdm9pZCAwKSB7IGFzY2VuZGluZyA9IHRydWU7IH1cclxuICAgICAgICB2YXIgbyA9IFwiJG9yZGVyYnlcIjtcclxuICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLnF1ZXJ5LmhhcyhvKSA/IHRoaXMucXVlcnkuZ2V0KG8pLnNwbGl0KFwiLFwiKSA6IFtdO1xyXG4gICAgICAgIHF1ZXJ5LnB1c2gob3JkZXJCeSArIFwiIFwiICsgKGFzY2VuZGluZyA/IFwiYXNjXCIgOiBcImRlc2NcIikpO1xyXG4gICAgICAgIHRoaXMucXVlcnkuc2V0KG8sIHF1ZXJ5LmpvaW4oXCIsXCIpKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNraXBzIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIGl0ZW1zXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNraXAgVGhlIG51bWJlciBvZiBpdGVtcyB0byBza2lwXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uLnByb3RvdHlwZS5za2lwID0gZnVuY3Rpb24gKHNraXApIHtcclxuICAgICAgICB0aGlzLnF1ZXJ5LnNldChcIiRza2lwXCIsIHNraXAudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBMaW1pdHMgdGhlIHF1ZXJ5IHRvIG9ubHkgcmV0dXJuIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIGl0ZW1zXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRvcCBUaGUgcXVlcnkgcm93IGxpbWl0XHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uLnByb3RvdHlwZS50b3AgPSBmdW5jdGlvbiAodG9wKSB7XHJcbiAgICAgICAgdGhpcy5xdWVyeS5zZXQoXCIkdG9wXCIsIHRvcC50b1N0cmluZygpKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb247XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZSkpO1xyXG4vKipcclxuICogUmVwcmVzZW50cyBhbiBpbnN0YW5jZSB0aGF0IGNhbiBiZSBzZWxlY3RlZFxyXG4gKlxyXG4gKi9cclxudmFyIFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDdXJyaWVzIHRoZSB1cGRhdGUgZnVuY3Rpb24gaW50byB0aGUgY29tbW9uIHBpZWNlc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0eXBlXHJcbiAgICAgKiBAcGFyYW0gbWFwcGVyXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZS5wcm90b3R5cGUuX3VwZGF0ZSA9IGZ1bmN0aW9uICh0eXBlLCBtYXBwZXIpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAocHJvcHMpIHsgcmV0dXJuIF90aGlzLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKGV4dGVuZChtZXRhZGF0YSh0eXBlKSwgcHJvcHMpKSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgXCJYLUhUVFAtTWV0aG9kXCI6IFwiTUVSR0VcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkKSB7IHJldHVybiBtYXBwZXIoZCwgcHJvcHMpOyB9KTsgfTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICogRGVsZXRlcyB0aGlzIGluc3RhbmNlXHJcbiAgICAqXHJcbiAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlLnByb3RvdHlwZS5fZGVsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgXCJYLUhUVFAtTWV0aG9kXCI6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWxldGVzIHRoaXMgaW5zdGFuY2Ugd2l0aCBhbiBldGFnIHZhbHVlIGluIHRoZSBoZWFkZXJzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGVUYWcgZVRhZyB0byBkZWxldGVcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlLnByb3RvdHlwZS5fZGVsZXRlV2l0aEVUYWcgPSBmdW5jdGlvbiAoZVRhZykge1xyXG4gICAgICAgIGlmIChlVGFnID09PSB2b2lkIDApIHsgZVRhZyA9IFwiKlwiOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBcIklGLU1hdGNoXCI6IGVUYWcsXHJcbiAgICAgICAgICAgICAgICBcIlgtSFRUUC1NZXRob2RcIjogXCJERUxFVEVcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGUpKTtcclxuLyoqXHJcbiAqIERlY29yYXRvciB1c2VkIHRvIHNwZWNpZnkgdGhlIGRlZmF1bHQgcGF0aCBmb3IgU2hhcmVQb2ludFF1ZXJ5YWJsZSBvYmplY3RzXHJcbiAqXHJcbiAqIEBwYXJhbSBwYXRoXHJcbiAqL1xyXG5mdW5jdGlvbiBkZWZhdWx0UGF0aChwYXRoKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIHJldHVybiAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICAgICAgICAgIF9fZXh0ZW5kcyhjbGFzc18xLCBfc3VwZXIpO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBjbGFzc18xKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIGFyZ3NbMF0sIGFyZ3MubGVuZ3RoID4gMSAmJiBhcmdzWzFdICE9PSB1bmRlZmluZWQgPyBhcmdzWzFdIDogcGF0aCkgfHwgdGhpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY2xhc3NfMTtcclxuICAgICAgICB9KHRhcmdldCkpO1xyXG4gICAgfTtcclxufVxuXG4vKipcclxuICogRGVzY3JpYmVzIGEgY29sbGVjdGlvbiBvZiBhbGwgc2l0ZSBjb2xsZWN0aW9uIHVzZXJzXHJcbiAqXHJcbiAqL1xyXG52YXIgU2l0ZVVzZXJzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNpdGVVc2VycywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNpdGVVc2VycygpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBTaXRlVXNlcnNfMSA9IFNpdGVVc2VycztcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIHVzZXIgZnJvbSB0aGUgY29sbGVjdGlvbiBieSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgaWQgb2YgdGhlIHVzZXIgdG8gcmV0cmlldmVcclxuICAgICAqL1xyXG4gICAgU2l0ZVVzZXJzLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTaXRlVXNlcih0aGlzLCBcImdldEJ5SWQoXCIgKyBpZCArIFwiKVwiKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSB1c2VyIGZyb20gdGhlIGNvbGxlY3Rpb24gYnkgZW1haWxcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZW1haWwgVGhlIGVtYWlsIGFkZHJlc3Mgb2YgdGhlIHVzZXIgdG8gcmV0cmlldmVcclxuICAgICAqL1xyXG4gICAgU2l0ZVVzZXJzLnByb3RvdHlwZS5nZXRCeUVtYWlsID0gZnVuY3Rpb24gKGVtYWlsKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTaXRlVXNlcih0aGlzLCBcImdldEJ5RW1haWwoJ1wiICsgZW1haWwgKyBcIicpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIHVzZXIgZnJvbSB0aGUgY29sbGVjdGlvbiBieSBsb2dpbiBuYW1lXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgbG9naW4gbmFtZSBvZiB0aGUgdXNlciB0byByZXRyaWV2ZVxyXG4gICAgICovXHJcbiAgICBTaXRlVXNlcnMucHJvdG90eXBlLmdldEJ5TG9naW5OYW1lID0gZnVuY3Rpb24gKGxvZ2luTmFtZSkge1xyXG4gICAgICAgIHZhciBzdSA9IG5ldyBTaXRlVXNlcih0aGlzKTtcclxuICAgICAgICBzdS5jb25jYXQoXCIoQHYpXCIpO1xyXG4gICAgICAgIHN1LnF1ZXJ5LnNldChcIkB2XCIsIFwiJ1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KGxvZ2luTmFtZSkgKyBcIidcIik7XHJcbiAgICAgICAgcmV0dXJuIHN1O1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyBhIHVzZXIgZnJvbSB0aGUgY29sbGVjdGlvbiBieSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgaWQgb2YgdGhlIHVzZXIgdG8gcmVtb3ZlXHJcbiAgICAgKi9cclxuICAgIFNpdGVVc2Vycy5wcm90b3R5cGUucmVtb3ZlQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNpdGVVc2Vyc18xLCBcInJlbW92ZUJ5SWQoXCIgKyBpZCArIFwiKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyBhIHVzZXIgZnJvbSB0aGUgY29sbGVjdGlvbiBieSBsb2dpbiBuYW1lXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgbG9naW4gbmFtZSBvZiB0aGUgdXNlciB0byByZW1vdmVcclxuICAgICAqL1xyXG4gICAgU2l0ZVVzZXJzLnByb3RvdHlwZS5yZW1vdmVCeUxvZ2luTmFtZSA9IGZ1bmN0aW9uIChsb2dpbk5hbWUpIHtcclxuICAgICAgICB2YXIgbyA9IHRoaXMuY2xvbmUoU2l0ZVVzZXJzXzEsIFwicmVtb3ZlQnlMb2dpbk5hbWUoQHYpXCIpO1xyXG4gICAgICAgIG8ucXVlcnkuc2V0KFwiQHZcIiwgXCInXCIgKyBlbmNvZGVVUklDb21wb25lbnQobG9naW5OYW1lKSArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gby5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHVzZXIgdG8gYSBncm91cFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsb2dpbk5hbWUgVGhlIGxvZ2luIG5hbWUgb2YgdGhlIHVzZXIgdG8gYWRkIHRvIHRoZSBncm91cFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgU2l0ZVVzZXJzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAobG9naW5OYW1lKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaXRlVXNlcnNfMSwgbnVsbCkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1MoZXh0ZW5kKG1ldGFkYXRhKFwiU1AuVXNlclwiKSwgeyBMb2dpbk5hbWU6IGxvZ2luTmFtZSB9KSksXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5nZXRCeUxvZ2luTmFtZShsb2dpbk5hbWUpOyB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgU2l0ZVVzZXJzXzE7XHJcbiAgICBTaXRlVXNlcnMgPSBTaXRlVXNlcnNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwic2l0ZXVzZXJzXCIpXHJcbiAgICBdLCBTaXRlVXNlcnMpO1xyXG4gICAgcmV0dXJuIFNpdGVVc2VycztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIHVzZXJcclxuICpcclxuICovXHJcbnZhciBTaXRlVXNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhTaXRlVXNlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNpdGVVc2VyKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogVXBkYXRlcyB0aGlzIHVzZXIgaW5zdGFuY2Ugd2l0aCB0aGUgc3VwcGxpZWQgcHJvcGVydGllc1xyXG4gICAgICAgICpcclxuICAgICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzIEEgcGxhaW4gb2JqZWN0IG9mIHByb3BlcnR5IG5hbWVzIGFuZCB2YWx1ZXMgdG8gdXBkYXRlIGZvciB0aGUgdXNlclxyXG4gICAgICAgICovXHJcbiAgICAgICAgX3RoaXMudXBkYXRlID0gX3RoaXMuX3VwZGF0ZShcIlNQLlVzZXJcIiwgZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuICh7IGRhdGE6IGRhdGEsIHVzZXI6IF90aGlzIH0pOyB9KTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZWxldGUgdGhpcyB1c2VyXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBfdGhpcy5kZWxldGUgPSBfdGhpcy5fZGVsZXRlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTaXRlVXNlci5wcm90b3R5cGUsIFwiZ3JvdXBzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBncm91cHMgZm9yIHRoaXMgdXNlclxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZUdyb3Vwcyh0aGlzLCBcImdyb3Vwc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBTaXRlVXNlcjtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcclxuLyoqXHJcbiAqIFJlcHJlc2VudHMgdGhlIGN1cnJlbnQgdXNlclxyXG4gKi9cclxudmFyIEN1cnJlbnRVc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEN1cnJlbnRVc2VyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ3VycmVudFVzZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgQ3VycmVudFVzZXIgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcImN1cnJlbnR1c2VyXCIpXHJcbiAgICBdLCBDdXJyZW50VXNlcik7XHJcbiAgICByZXR1cm4gQ3VycmVudFVzZXI7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XG5cbi8qKlxyXG4gKiBQcmluY2lwYWwgVHlwZSBlbnVtXHJcbiAqXHJcbiAqL1xyXG52YXIgUHJpbmNpcGFsVHlwZTtcclxuKGZ1bmN0aW9uIChQcmluY2lwYWxUeXBlKSB7XHJcbiAgICBQcmluY2lwYWxUeXBlW1ByaW5jaXBhbFR5cGVbXCJOb25lXCJdID0gMF0gPSBcIk5vbmVcIjtcclxuICAgIFByaW5jaXBhbFR5cGVbUHJpbmNpcGFsVHlwZVtcIlVzZXJcIl0gPSAxXSA9IFwiVXNlclwiO1xyXG4gICAgUHJpbmNpcGFsVHlwZVtQcmluY2lwYWxUeXBlW1wiRGlzdHJpYnV0aW9uTGlzdFwiXSA9IDJdID0gXCJEaXN0cmlidXRpb25MaXN0XCI7XHJcbiAgICBQcmluY2lwYWxUeXBlW1ByaW5jaXBhbFR5cGVbXCJTZWN1cml0eUdyb3VwXCJdID0gNF0gPSBcIlNlY3VyaXR5R3JvdXBcIjtcclxuICAgIFByaW5jaXBhbFR5cGVbUHJpbmNpcGFsVHlwZVtcIlNoYXJlUG9pbnRHcm91cFwiXSA9IDhdID0gXCJTaGFyZVBvaW50R3JvdXBcIjtcclxuICAgIFByaW5jaXBhbFR5cGVbUHJpbmNpcGFsVHlwZVtcIkFsbFwiXSA9IDE1XSA9IFwiQWxsXCI7XHJcbn0pKFByaW5jaXBhbFR5cGUgfHwgKFByaW5jaXBhbFR5cGUgPSB7fSkpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgY29sbGVjdGlvbiBvZiBzaXRlIGdyb3Vwc1xyXG4gKlxyXG4gKi9cclxudmFyIFNpdGVHcm91cHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2l0ZUdyb3VwcywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNpdGVHcm91cHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgU2l0ZUdyb3Vwc18xID0gU2l0ZUdyb3VwcztcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGdyb3VwIGZyb20gdGhlIGNvbGxlY3Rpb24gYnkgaWRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaWQgVGhlIGlkIG9mIHRoZSBncm91cCB0byByZXRyaWV2ZVxyXG4gICAgICovXHJcbiAgICBTaXRlR3JvdXBzLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgdmFyIHNnID0gbmV3IFNpdGVHcm91cCh0aGlzKTtcclxuICAgICAgICBzZy5jb25jYXQoXCIoXCIgKyBpZCArIFwiKVwiKTtcclxuICAgICAgICByZXR1cm4gc2c7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IGdyb3VwIHRvIHRoZSBzaXRlIGNvbGxlY3Rpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcHJvcHMgVGhlIGdyb3VwIHByb3BlcnRpZXMgb2JqZWN0IG9mIHByb3BlcnR5IG5hbWVzIGFuZCB2YWx1ZXMgdG8gYmUgc2V0IGZvciB0aGUgZ3JvdXBcclxuICAgICAqL1xyXG4gICAgU2l0ZUdyb3Vwcy5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHByb3BlcnRpZXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyhleHRlbmQobWV0YWRhdGEoXCJTUC5Hcm91cFwiKSwgcHJvcGVydGllcykpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHkgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGdyb3VwOiBfdGhpcy5nZXRCeUlkKGRhdGEuSWQpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGdyb3VwIGZyb20gdGhlIGNvbGxlY3Rpb24gYnkgbmFtZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBncm91cE5hbWUgVGhlIG5hbWUgb2YgdGhlIGdyb3VwIHRvIHJldHJpZXZlXHJcbiAgICAgKi9cclxuICAgIFNpdGVHcm91cHMucHJvdG90eXBlLmdldEJ5TmFtZSA9IGZ1bmN0aW9uIChncm91cE5hbWUpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFNpdGVHcm91cCh0aGlzLCBcImdldEJ5TmFtZSgnXCIgKyBncm91cE5hbWUgKyBcIicpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyB0aGUgZ3JvdXAgd2l0aCB0aGUgc3BlY2lmaWVkIG1lbWJlciBpZCBmcm9tIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBpZCBvZiB0aGUgZ3JvdXAgdG8gcmVtb3ZlXHJcbiAgICAgKi9cclxuICAgIFNpdGVHcm91cHMucHJvdG90eXBlLnJlbW92ZUJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaXRlR3JvdXBzXzEsIFwicmVtb3ZlQnlJZCgnXCIgKyBpZCArIFwiJylcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhlIGNyb3NzLXNpdGUgZ3JvdXAgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgZnJvbSB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsb2dpbk5hbWUgVGhlIG5hbWUgb2YgdGhlIGdyb3VwIHRvIHJlbW92ZVxyXG4gICAgICovXHJcbiAgICBTaXRlR3JvdXBzLnByb3RvdHlwZS5yZW1vdmVCeUxvZ2luTmFtZSA9IGZ1bmN0aW9uIChsb2dpbk5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaXRlR3JvdXBzXzEsIFwicmVtb3ZlQnlMb2dpbk5hbWUoJ1wiICsgbG9naW5OYW1lICsgXCInKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIHZhciBTaXRlR3JvdXBzXzE7XHJcbiAgICBTaXRlR3JvdXBzID0gU2l0ZUdyb3Vwc18xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJzaXRlZ3JvdXBzXCIpXHJcbiAgICBdLCBTaXRlR3JvdXBzKTtcclxuICAgIHJldHVybiBTaXRlR3JvdXBzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBzaW5nbGUgZ3JvdXBcclxuICpcclxuICovXHJcbnZhciBTaXRlR3JvdXAgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2l0ZUdyb3VwLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU2l0ZUdyb3VwKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnVwZGF0ZSA9IF90aGlzLl91cGRhdGUoXCJTUC5Hcm91cFwiLCBmdW5jdGlvbiAoZCwgcCkge1xyXG4gICAgICAgICAgICB2YXIgcmV0R3JvdXAgPSBfdGhpcztcclxuICAgICAgICAgICAgaWYgKGhPUChwLCBcIlRpdGxlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmUgbm8tc3RyaW5nLWxpdGVyYWwgKi9cclxuICAgICAgICAgICAgICAgIHJldEdyb3VwID0gX3RoaXMuZ2V0UGFyZW50KFNpdGVHcm91cCwgX3RoaXMucGFyZW50VXJsLCBcImdldEJ5TmFtZSgnXCIgKyBwW1wiVGl0bGVcIl0gKyBcIicpXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkLFxyXG4gICAgICAgICAgICAgICAgZ3JvdXA6IHJldEdyb3VwLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTaXRlR3JvdXAucHJvdG90eXBlLCBcInVzZXJzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSB1c2VycyBmb3IgdGhpcyBncm91cFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZVVzZXJzKHRoaXMsIFwidXNlcnNcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gU2l0ZUdyb3VwO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xuXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2V0IG9mIHJvbGUgYXNzaWdubWVudHMgZm9yIHRoZSBjdXJyZW50IHNjb3BlXHJcbiAqXHJcbiAqL1xyXG52YXIgUm9sZUFzc2lnbm1lbnRzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFJvbGVBc3NpZ25tZW50cywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFJvbGVBc3NpZ25tZW50cygpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBSb2xlQXNzaWdubWVudHNfMSA9IFJvbGVBc3NpZ25tZW50cztcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgcm9sZSBhc3NpZ25tZW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIHByaW5jaXBhbCBpZCBmcm9tIHRoZSBjb2xsZWN0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgaWQgb2YgdGhlIHJvbGUgYXNzaWdubWVudFxyXG4gICAgICovXHJcbiAgICBSb2xlQXNzaWdubWVudHMucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgcmEgPSBuZXcgUm9sZUFzc2lnbm1lbnQodGhpcyk7XHJcbiAgICAgICAgcmEuY29uY2F0KFwiKFwiICsgaWQgKyBcIilcIik7XHJcbiAgICAgICAgcmV0dXJuIHJhO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyByb2xlIGFzc2lnbm1lbnQgd2l0aCB0aGUgc3BlY2lmaWVkIHByaW5jaXBhbCBhbmQgcm9sZSBkZWZpbml0aW9ucyB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwcmluY2lwYWxJZCBUaGUgaWQgb2YgdGhlIHVzZXIgb3IgZ3JvdXAgdG8gYXNzaWduIHBlcm1pc3Npb25zIHRvXHJcbiAgICAgKiBAcGFyYW0gcm9sZURlZklkIFRoZSBpZCBvZiB0aGUgcm9sZSBkZWZpbml0aW9uIHRoYXQgZGVmaW5lcyB0aGUgcGVybWlzc2lvbnMgdG8gYXNzaWduXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBSb2xlQXNzaWdubWVudHMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChwcmluY2lwYWxJZCwgcm9sZURlZklkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoUm9sZUFzc2lnbm1lbnRzXzEsIFwiYWRkcm9sZWFzc2lnbm1lbnQocHJpbmNpcGFsaWQ9XCIgKyBwcmluY2lwYWxJZCArIFwiLCByb2xlZGVmaWQ9XCIgKyByb2xlRGVmSWQgKyBcIilcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhlIHJvbGUgYXNzaWdubWVudCB3aXRoIHRoZSBzcGVjaWZpZWQgcHJpbmNpcGFsIGFuZCByb2xlIGRlZmluaXRpb24gZnJvbSB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwcmluY2lwYWxJZCBUaGUgaWQgb2YgdGhlIHVzZXIgb3IgZ3JvdXAgaW4gdGhlIHJvbGUgYXNzaWdubWVudFxyXG4gICAgICogQHBhcmFtIHJvbGVEZWZJZCBUaGUgaWQgb2YgdGhlIHJvbGUgZGVmaW5pdGlvbiBpbiB0aGUgcm9sZSBhc3NpZ25tZW50XHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBSb2xlQXNzaWdubWVudHMucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChwcmluY2lwYWxJZCwgcm9sZURlZklkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoUm9sZUFzc2lnbm1lbnRzXzEsIFwicmVtb3Zlcm9sZWFzc2lnbm1lbnQocHJpbmNpcGFsaWQ9XCIgKyBwcmluY2lwYWxJZCArIFwiLCByb2xlZGVmaWQ9XCIgKyByb2xlRGVmSWQgKyBcIilcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICB2YXIgUm9sZUFzc2lnbm1lbnRzXzE7XHJcbiAgICBSb2xlQXNzaWdubWVudHMgPSBSb2xlQXNzaWdubWVudHNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwicm9sZWFzc2lnbm1lbnRzXCIpXHJcbiAgICBdLCBSb2xlQXNzaWdubWVudHMpO1xyXG4gICAgcmV0dXJuIFJvbGVBc3NpZ25tZW50cztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgcm9sZSBhc3NpZ25tZW50XHJcbiAqXHJcbiAqL1xyXG52YXIgUm9sZUFzc2lnbm1lbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoUm9sZUFzc2lnbm1lbnQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBSb2xlQXNzaWdubWVudCgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZWxldGVzIHRoaXMgcm9sZSBhc3NpZ25tZW50XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBfdGhpcy5kZWxldGUgPSBfdGhpcy5fZGVsZXRlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSb2xlQXNzaWdubWVudC5wcm90b3R5cGUsIFwiZ3JvdXBzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBncm91cHMgdGhhdCBkaXJlY3RseSBiZWxvbmcgdG8gdGhlIGFjY2VzcyBjb250cm9sIGxpc3QgKEFDTCkgZm9yIHRoaXMgc2VjdXJhYmxlIG9iamVjdFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZUdyb3Vwcyh0aGlzLCBcImdyb3Vwc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSb2xlQXNzaWdubWVudC5wcm90b3R5cGUsIFwiYmluZGluZ3NcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIHJvbGUgZGVmaW5pdGlvbiBiaW5kaW5ncyBmb3IgdGhpcyByb2xlIGFzc2lnbm1lbnRcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJvbGVEZWZpbml0aW9uQmluZGluZ3ModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gUm9sZUFzc2lnbm1lbnQ7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIHJvbGUgZGVmaW5pdGlvbnNcclxuICpcclxuICovXHJcbnZhciBSb2xlRGVmaW5pdGlvbnMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoUm9sZURlZmluaXRpb25zLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gUm9sZURlZmluaXRpb25zKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgcm9sZSBkZWZpbml0aW9uIHdpdGggdGhlIHNwZWNpZmllZCBpZCBmcm9tIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBpZCBvZiB0aGUgcm9sZSBkZWZpbml0aW9uXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBSb2xlRGVmaW5pdGlvbnMucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFJvbGVEZWZpbml0aW9uKHRoaXMsIFwiZ2V0QnlJZChcIiArIGlkICsgXCIpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgcm9sZSBkZWZpbml0aW9uIHdpdGggdGhlIHNwZWNpZmllZCBuYW1lXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIHJvbGUgZGVmaW5pdGlvblxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgUm9sZURlZmluaXRpb25zLnByb3RvdHlwZS5nZXRCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUm9sZURlZmluaXRpb24odGhpcywgXCJnZXRieW5hbWUoJ1wiICsgbmFtZSArIFwiJylcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSByb2xlIGRlZmluaXRpb24gd2l0aCB0aGUgc3BlY2lmaWVkIHJvbGUgdHlwZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb2xlVHlwZUtpbmQgVGhlIHJvbGV0eXBla2luZCBvZiB0aGUgcm9sZSBkZWZpbml0aW9uIChOb25lPTAsIEd1ZXN0PTEsIFJlYWRlcj0yLCBDb250cmlidXRvcj0zLCBXZWJEZXNpZ25lcj00LCBBZG1pbmlzdHJhdG9yPTUsIEVkaXRvcj02LCBTeXN0ZW09NylcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIFJvbGVEZWZpbml0aW9ucy5wcm90b3R5cGUuZ2V0QnlUeXBlID0gZnVuY3Rpb24gKHJvbGVUeXBlS2luZCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUm9sZURlZmluaXRpb24odGhpcywgXCJnZXRieXR5cGUoXCIgKyByb2xlVHlwZUtpbmQgKyBcIilcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgcm9sZSBkZWZpbml0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIG5ldyByb2xlIGRlZmluaXRpb24ncyBuYW1lXHJcbiAgICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gVGhlIG5ldyByb2xlIGRlZmluaXRpb24ncyBkZXNjcmlwdGlvblxyXG4gICAgICogQHBhcmFtIG9yZGVyIFRoZSBvcmRlciBpbiB3aGljaCB0aGUgcm9sZSBkZWZpbml0aW9uIGFwcGVhcnNcclxuICAgICAqIEBwYXJhbSBiYXNlUGVybWlzc2lvbnMgVGhlIHBlcm1pc3Npb25zIG1hc2sgZm9yIHRoaXMgcm9sZSBkZWZpbml0aW9uXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBSb2xlRGVmaW5pdGlvbnMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChuYW1lLCBkZXNjcmlwdGlvbiwgb3JkZXIsIGJhc2VQZXJtaXNzaW9ucykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKHtcclxuICAgICAgICAgICAgQmFzZVBlcm1pc3Npb25zOiBleHRlbmQoeyBfX21ldGFkYXRhOiB7IHR5cGU6IFwiU1AuQmFzZVBlcm1pc3Npb25zXCIgfSB9LCBiYXNlUGVybWlzc2lvbnMpLFxyXG4gICAgICAgICAgICBEZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIE5hbWU6IG5hbWUsXHJcbiAgICAgICAgICAgIE9yZGVyOiBvcmRlcixcclxuICAgICAgICAgICAgX19tZXRhZGF0YTogeyBcInR5cGVcIjogXCJTUC5Sb2xlRGVmaW5pdGlvblwiIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdENvcmUoeyBib2R5OiBwb3N0Qm9keSB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICAgICAgZGVmaW5pdGlvbjogX3RoaXMuZ2V0QnlJZChkYXRhLklkKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBSb2xlRGVmaW5pdGlvbnMgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcInJvbGVkZWZpbml0aW9uc1wiKVxyXG4gICAgXSwgUm9sZURlZmluaXRpb25zKTtcclxuICAgIHJldHVybiBSb2xlRGVmaW5pdGlvbnM7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24pKTtcclxuLyoqXHJcbiAqIERlc2NyaWJlcyBhIHJvbGUgZGVmaW5pdGlvblxyXG4gKlxyXG4gKi9cclxudmFyIFJvbGVEZWZpbml0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFJvbGVEZWZpbml0aW9uLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gUm9sZURlZmluaXRpb24oKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRGVsZXRlcyB0aGlzIHJvbGUgZGVmaW5pdGlvblxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgX3RoaXMuZGVsZXRlID0gX3RoaXMuX2RlbGV0ZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICAgICAgLyogdHNsaW50OmVuYWJsZSAqL1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVcGRhdGVzIHRoaXMgcm9sZSBkZWZpbml0aW9uIHdpdGggdGhlIHN1cHBsaWVkIHByb3BlcnRpZXNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBBIHBsYWluIG9iamVjdCBoYXNoIG9mIHZhbHVlcyB0byB1cGRhdGUgZm9yIHRoZSByb2xlIGRlZmluaXRpb25cclxuICAgICAqL1xyXG4gICAgLyogdHNsaW50OmRpc2FibGUgbm8tc3RyaW5nLWxpdGVyYWwgKi9cclxuICAgIFJvbGVEZWZpbml0aW9uLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAocHJvcGVydGllcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHMgPSBbXCJCYXNlUGVybWlzc2lvbnNcIl07XHJcbiAgICAgICAgaWYgKGhPUChwcm9wZXJ0aWVzLCBzWzBdKSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHByb3BlcnRpZXNbc1swXV0gPSBleHRlbmQoeyBfX21ldGFkYXRhOiB7IHR5cGU6IFwiU1AuXCIgKyBzWzBdIH0gfSwgcHJvcGVydGllc1tzWzBdXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyhleHRlbmQobWV0YWRhdGEoXCJTUC5Sb2xlRGVmaW5pdGlvblwiKSwgcHJvcGVydGllcykpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keTogcG9zdEJvZHksXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgIFwiWC1IVFRQLU1ldGhvZFwiOiBcIk1FUkdFXCIsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0RGVmID0gX3RoaXM7XHJcbiAgICAgICAgICAgIGlmIChoT1AocHJvcGVydGllcywgXCJOYW1lXCIpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50XzEgPSBfdGhpcy5nZXRQYXJlbnQoUm9sZURlZmluaXRpb25zLCBfdGhpcy5wYXJlbnRVcmwsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0RGVmID0gcGFyZW50XzEuZ2V0QnlOYW1lKHByb3BlcnRpZXNbXCJOYW1lXCJdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGRlZmluaXRpb246IHJldERlZixcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUm9sZURlZmluaXRpb247XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgdGhlIHJvbGUgZGVmaW5pdG9ucyBib3VuZCB0byBhIHJvbGUgYXNzaWdubWVudCBvYmplY3RcclxuICpcclxuICovXHJcbnZhciBSb2xlRGVmaW5pdGlvbkJpbmRpbmdzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFJvbGVEZWZpbml0aW9uQmluZGluZ3MsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBSb2xlRGVmaW5pdGlvbkJpbmRpbmdzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFJvbGVEZWZpbml0aW9uQmluZGluZ3MgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcInJvbGVkZWZpbml0aW9uYmluZGluZ3NcIilcclxuICAgIF0sIFJvbGVEZWZpbml0aW9uQmluZGluZ3MpO1xyXG4gICAgcmV0dXJuIFJvbGVEZWZpbml0aW9uQmluZGluZ3M7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24pKTtcblxuLyoqXHJcbiAqIERldGVybWluZXMgdGhlIGRpc3BsYXkgbW9kZSBvZiB0aGUgZ2l2ZW4gY29udHJvbCBvciB2aWV3XHJcbiAqL1xyXG52YXIgQ29udHJvbE1vZGU7XHJcbihmdW5jdGlvbiAoQ29udHJvbE1vZGUpIHtcclxuICAgIENvbnRyb2xNb2RlW0NvbnRyb2xNb2RlW1wiRGlzcGxheVwiXSA9IDFdID0gXCJEaXNwbGF5XCI7XHJcbiAgICBDb250cm9sTW9kZVtDb250cm9sTW9kZVtcIkVkaXRcIl0gPSAyXSA9IFwiRWRpdFwiO1xyXG4gICAgQ29udHJvbE1vZGVbQ29udHJvbE1vZGVbXCJOZXdcIl0gPSAzXSA9IFwiTmV3XCI7XHJcbn0pKENvbnRyb2xNb2RlIHx8IChDb250cm9sTW9kZSA9IHt9KSk7XHJcbi8qKlxyXG4gKiBTcGVjaWZpZXMgdGhlIHR5cGUgb2YgdGhlIGZpZWxkLlxyXG4gKi9cclxudmFyIEZpZWxkVHlwZXM7XHJcbihmdW5jdGlvbiAoRmllbGRUeXBlcykge1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiSW52YWxpZFwiXSA9IDBdID0gXCJJbnZhbGlkXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJJbnRlZ2VyXCJdID0gMV0gPSBcIkludGVnZXJcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIlRleHRcIl0gPSAyXSA9IFwiVGV4dFwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiTm90ZVwiXSA9IDNdID0gXCJOb3RlXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJEYXRlVGltZVwiXSA9IDRdID0gXCJEYXRlVGltZVwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiQ291bnRlclwiXSA9IDVdID0gXCJDb3VudGVyXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJDaG9pY2VcIl0gPSA2XSA9IFwiQ2hvaWNlXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJMb29rdXBcIl0gPSA3XSA9IFwiTG9va3VwXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJCb29sZWFuXCJdID0gOF0gPSBcIkJvb2xlYW5cIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIk51bWJlclwiXSA9IDldID0gXCJOdW1iZXJcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIkN1cnJlbmN5XCJdID0gMTBdID0gXCJDdXJyZW5jeVwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiVVJMXCJdID0gMTFdID0gXCJVUkxcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIkNvbXB1dGVkXCJdID0gMTJdID0gXCJDb21wdXRlZFwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiVGhyZWFkaW5nXCJdID0gMTNdID0gXCJUaHJlYWRpbmdcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIkd1aWRcIl0gPSAxNF0gPSBcIkd1aWRcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIk11bHRpQ2hvaWNlXCJdID0gMTVdID0gXCJNdWx0aUNob2ljZVwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiR3JpZENob2ljZVwiXSA9IDE2XSA9IFwiR3JpZENob2ljZVwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiQ2FsY3VsYXRlZFwiXSA9IDE3XSA9IFwiQ2FsY3VsYXRlZFwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiRmlsZVwiXSA9IDE4XSA9IFwiRmlsZVwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiQXR0YWNobWVudHNcIl0gPSAxOV0gPSBcIkF0dGFjaG1lbnRzXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJVc2VyXCJdID0gMjBdID0gXCJVc2VyXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJSZWN1cnJlbmNlXCJdID0gMjFdID0gXCJSZWN1cnJlbmNlXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJDcm9zc1Byb2plY3RMaW5rXCJdID0gMjJdID0gXCJDcm9zc1Byb2plY3RMaW5rXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJNb2RTdGF0XCJdID0gMjNdID0gXCJNb2RTdGF0XCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJFcnJvclwiXSA9IDI0XSA9IFwiRXJyb3JcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIkNvbnRlbnRUeXBlSWRcIl0gPSAyNV0gPSBcIkNvbnRlbnRUeXBlSWRcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIlBhZ2VTZXBhcmF0b3JcIl0gPSAyNl0gPSBcIlBhZ2VTZXBhcmF0b3JcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIlRocmVhZEluZGV4XCJdID0gMjddID0gXCJUaHJlYWRJbmRleFwiO1xyXG4gICAgRmllbGRUeXBlc1tGaWVsZFR5cGVzW1wiV29ya2Zsb3dTdGF0dXNcIl0gPSAyOF0gPSBcIldvcmtmbG93U3RhdHVzXCI7XHJcbiAgICBGaWVsZFR5cGVzW0ZpZWxkVHlwZXNbXCJBbGxEYXlFdmVudFwiXSA9IDI5XSA9IFwiQWxsRGF5RXZlbnRcIjtcclxuICAgIEZpZWxkVHlwZXNbRmllbGRUeXBlc1tcIldvcmtmbG93RXZlbnRUeXBlXCJdID0gMzBdID0gXCJXb3JrZmxvd0V2ZW50VHlwZVwiO1xyXG59KShGaWVsZFR5cGVzIHx8IChGaWVsZFR5cGVzID0ge30pKTtcclxudmFyIERhdGVUaW1lRmllbGRGb3JtYXRUeXBlO1xyXG4oZnVuY3Rpb24gKERhdGVUaW1lRmllbGRGb3JtYXRUeXBlKSB7XHJcbiAgICBEYXRlVGltZUZpZWxkRm9ybWF0VHlwZVtEYXRlVGltZUZpZWxkRm9ybWF0VHlwZVtcIkRhdGVPbmx5XCJdID0gMF0gPSBcIkRhdGVPbmx5XCI7XHJcbiAgICBEYXRlVGltZUZpZWxkRm9ybWF0VHlwZVtEYXRlVGltZUZpZWxkRm9ybWF0VHlwZVtcIkRhdGVUaW1lXCJdID0gMV0gPSBcIkRhdGVUaW1lXCI7XHJcbn0pKERhdGVUaW1lRmllbGRGb3JtYXRUeXBlIHx8IChEYXRlVGltZUZpZWxkRm9ybWF0VHlwZSA9IHt9KSk7XHJcbi8qKlxyXG4gKiBTcGVjaWZpZXMgdGhlIGNvbnRyb2wgc2V0dGluZ3Mgd2hpbGUgYWRkaW5nIGEgZmllbGQuXHJcbiAqL1xyXG52YXIgQWRkRmllbGRPcHRpb25zO1xyXG4oZnVuY3Rpb24gKEFkZEZpZWxkT3B0aW9ucykge1xyXG4gICAgLyoqXHJcbiAgICAgKiAgU3BlY2lmeSB0aGF0IGEgbmV3IGZpZWxkIGFkZGVkIHRvIHRoZSBsaXN0IG11c3QgYWxzbyBiZSBhZGRlZCB0byB0aGUgZGVmYXVsdCBjb250ZW50IHR5cGUgaW4gdGhlIHNpdGUgY29sbGVjdGlvblxyXG4gICAgICovXHJcbiAgICBBZGRGaWVsZE9wdGlvbnNbQWRkRmllbGRPcHRpb25zW1wiRGVmYXVsdFZhbHVlXCJdID0gMF0gPSBcIkRlZmF1bHRWYWx1ZVwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBTcGVjaWZ5IHRoYXQgYSBuZXcgZmllbGQgYWRkZWQgdG8gdGhlIGxpc3QgbXVzdCBhbHNvIGJlIGFkZGVkIHRvIHRoZSBkZWZhdWx0IGNvbnRlbnQgdHlwZSBpbiB0aGUgc2l0ZSBjb2xsZWN0aW9uLlxyXG4gICAgICovXHJcbiAgICBBZGRGaWVsZE9wdGlvbnNbQWRkRmllbGRPcHRpb25zW1wiQWRkVG9EZWZhdWx0Q29udGVudFR5cGVcIl0gPSAxXSA9IFwiQWRkVG9EZWZhdWx0Q29udGVudFR5cGVcIjtcclxuICAgIC8qKlxyXG4gICAgICogU3BlY2lmeSB0aGF0IGEgbmV3IGZpZWxkIG11c3Qgbm90IGJlIGFkZGVkIHRvIGFueSBvdGhlciBjb250ZW50IHR5cGVcclxuICAgICAqL1xyXG4gICAgQWRkRmllbGRPcHRpb25zW0FkZEZpZWxkT3B0aW9uc1tcIkFkZFRvTm9Db250ZW50VHlwZVwiXSA9IDJdID0gXCJBZGRUb05vQ29udGVudFR5cGVcIjtcclxuICAgIC8qKlxyXG4gICAgICogIFNwZWNpZnkgdGhhdCBhIG5ldyBmaWVsZCB0aGF0IGlzIGFkZGVkIHRvIHRoZSBzcGVjaWZpZWQgbGlzdCBtdXN0IGFsc28gYmUgYWRkZWQgdG8gYWxsIGNvbnRlbnQgdHlwZXMgaW4gdGhlIHNpdGUgY29sbGVjdGlvblxyXG4gICAgICovXHJcbiAgICBBZGRGaWVsZE9wdGlvbnNbQWRkRmllbGRPcHRpb25zW1wiQWRkVG9BbGxDb250ZW50VHlwZXNcIl0gPSA0XSA9IFwiQWRkVG9BbGxDb250ZW50VHlwZXNcIjtcclxuICAgIC8qKlxyXG4gICAgICogU3BlY2lmeSBhZGRpbmcgYW4gaW50ZXJuYWwgZmllbGQgbmFtZSBoaW50IGZvciB0aGUgcHVycG9zZSBvZiBhdm9pZGluZyBwb3NzaWJsZSBkYXRhYmFzZSBsb2NraW5nIG9yIGZpZWxkIHJlbmFtaW5nIG9wZXJhdGlvbnNcclxuICAgICAqL1xyXG4gICAgQWRkRmllbGRPcHRpb25zW0FkZEZpZWxkT3B0aW9uc1tcIkFkZEZpZWxkSW50ZXJuYWxOYW1lSGludFwiXSA9IDhdID0gXCJBZGRGaWVsZEludGVybmFsTmFtZUhpbnRcIjtcclxuICAgIC8qKlxyXG4gICAgICogU3BlY2lmeSB0aGF0IGEgbmV3IGZpZWxkIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHNwZWNpZmllZCBsaXN0IG11c3QgYWxzbyBiZSBhZGRlZCB0byB0aGUgZGVmYXVsdCBsaXN0IHZpZXdcclxuICAgICAqL1xyXG4gICAgQWRkRmllbGRPcHRpb25zW0FkZEZpZWxkT3B0aW9uc1tcIkFkZEZpZWxkVG9EZWZhdWx0Vmlld1wiXSA9IDE2XSA9IFwiQWRkRmllbGRUb0RlZmF1bHRWaWV3XCI7XHJcbiAgICAvKipcclxuICAgICAqIFNwZWNpZnkgdG8gY29uZmlybSB0aGF0IG5vIG90aGVyIGZpZWxkIGhhcyB0aGUgc2FtZSBkaXNwbGF5IG5hbWVcclxuICAgICAqL1xyXG4gICAgQWRkRmllbGRPcHRpb25zW0FkZEZpZWxkT3B0aW9uc1tcIkFkZEZpZWxkQ2hlY2tEaXNwbGF5TmFtZVwiXSA9IDMyXSA9IFwiQWRkRmllbGRDaGVja0Rpc3BsYXlOYW1lXCI7XHJcbn0pKEFkZEZpZWxkT3B0aW9ucyB8fCAoQWRkRmllbGRPcHRpb25zID0ge30pKTtcclxudmFyIENhbGVuZGFyVHlwZTtcclxuKGZ1bmN0aW9uIChDYWxlbmRhclR5cGUpIHtcclxuICAgIENhbGVuZGFyVHlwZVtDYWxlbmRhclR5cGVbXCJHcmVnb3JpYW5cIl0gPSAxXSA9IFwiR3JlZ29yaWFuXCI7XHJcbiAgICBDYWxlbmRhclR5cGVbQ2FsZW5kYXJUeXBlW1wiSmFwYW5cIl0gPSAzXSA9IFwiSmFwYW5cIjtcclxuICAgIENhbGVuZGFyVHlwZVtDYWxlbmRhclR5cGVbXCJUYWl3YW5cIl0gPSA0XSA9IFwiVGFpd2FuXCI7XHJcbiAgICBDYWxlbmRhclR5cGVbQ2FsZW5kYXJUeXBlW1wiS29yZWFcIl0gPSA1XSA9IFwiS29yZWFcIjtcclxuICAgIENhbGVuZGFyVHlwZVtDYWxlbmRhclR5cGVbXCJIaWpyaVwiXSA9IDZdID0gXCJIaWpyaVwiO1xyXG4gICAgQ2FsZW5kYXJUeXBlW0NhbGVuZGFyVHlwZVtcIlRoYWlcIl0gPSA3XSA9IFwiVGhhaVwiO1xyXG4gICAgQ2FsZW5kYXJUeXBlW0NhbGVuZGFyVHlwZVtcIkhlYnJld1wiXSA9IDhdID0gXCJIZWJyZXdcIjtcclxuICAgIENhbGVuZGFyVHlwZVtDYWxlbmRhclR5cGVbXCJHcmVnb3JpYW5NRUZyZW5jaFwiXSA9IDldID0gXCJHcmVnb3JpYW5NRUZyZW5jaFwiO1xyXG4gICAgQ2FsZW5kYXJUeXBlW0NhbGVuZGFyVHlwZVtcIkdyZWdvcmlhbkFyYWJpY1wiXSA9IDEwXSA9IFwiR3JlZ29yaWFuQXJhYmljXCI7XHJcbiAgICBDYWxlbmRhclR5cGVbQ2FsZW5kYXJUeXBlW1wiR3JlZ29yaWFuWExJVEVuZ2xpc2hcIl0gPSAxMV0gPSBcIkdyZWdvcmlhblhMSVRFbmdsaXNoXCI7XHJcbiAgICBDYWxlbmRhclR5cGVbQ2FsZW5kYXJUeXBlW1wiR3JlZ29yaWFuWExJVEZyZW5jaFwiXSA9IDEyXSA9IFwiR3JlZ29yaWFuWExJVEZyZW5jaFwiO1xyXG4gICAgQ2FsZW5kYXJUeXBlW0NhbGVuZGFyVHlwZVtcIktvcmVhSmFwYW5MdW5hclwiXSA9IDE0XSA9IFwiS29yZWFKYXBhbkx1bmFyXCI7XHJcbiAgICBDYWxlbmRhclR5cGVbQ2FsZW5kYXJUeXBlW1wiQ2hpbmVzZUx1bmFyXCJdID0gMTVdID0gXCJDaGluZXNlTHVuYXJcIjtcclxuICAgIENhbGVuZGFyVHlwZVtDYWxlbmRhclR5cGVbXCJTYWthRXJhXCJdID0gMTZdID0gXCJTYWthRXJhXCI7XHJcbiAgICBDYWxlbmRhclR5cGVbQ2FsZW5kYXJUeXBlW1wiVW1BbFF1cmFcIl0gPSAyM10gPSBcIlVtQWxRdXJhXCI7XHJcbn0pKENhbGVuZGFyVHlwZSB8fCAoQ2FsZW5kYXJUeXBlID0ge30pKTtcclxudmFyIFVybEZpZWxkRm9ybWF0VHlwZTtcclxuKGZ1bmN0aW9uIChVcmxGaWVsZEZvcm1hdFR5cGUpIHtcclxuICAgIFVybEZpZWxkRm9ybWF0VHlwZVtVcmxGaWVsZEZvcm1hdFR5cGVbXCJIeXBlcmxpbmtcIl0gPSAwXSA9IFwiSHlwZXJsaW5rXCI7XHJcbiAgICBVcmxGaWVsZEZvcm1hdFR5cGVbVXJsRmllbGRGb3JtYXRUeXBlW1wiSW1hZ2VcIl0gPSAxXSA9IFwiSW1hZ2VcIjtcclxufSkoVXJsRmllbGRGb3JtYXRUeXBlIHx8IChVcmxGaWVsZEZvcm1hdFR5cGUgPSB7fSkpO1xyXG52YXIgUGVybWlzc2lvbktpbmQ7XHJcbihmdW5jdGlvbiAoUGVybWlzc2lvbktpbmQpIHtcclxuICAgIC8qKlxyXG4gICAgICogSGFzIG5vIHBlcm1pc3Npb25zIG9uIHRoZSBTaXRlLiBOb3QgYXZhaWxhYmxlIHRocm91Z2ggdGhlIHVzZXIgaW50ZXJmYWNlLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIkVtcHR5TWFza1wiXSA9IDBdID0gXCJFbXB0eU1hc2tcIjtcclxuICAgIC8qKlxyXG4gICAgICogVmlldyBpdGVtcyBpbiBsaXN0cywgZG9jdW1lbnRzIGluIGRvY3VtZW50IGxpYnJhcmllcywgYW5kIFdlYiBkaXNjdXNzaW9uIGNvbW1lbnRzLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIlZpZXdMaXN0SXRlbXNcIl0gPSAxXSA9IFwiVmlld0xpc3RJdGVtc1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGQgaXRlbXMgdG8gbGlzdHMsIGRvY3VtZW50cyB0byBkb2N1bWVudCBsaWJyYXJpZXMsIGFuZCBXZWIgZGlzY3Vzc2lvbiBjb21tZW50cy5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJBZGRMaXN0SXRlbXNcIl0gPSAyXSA9IFwiQWRkTGlzdEl0ZW1zXCI7XHJcbiAgICAvKipcclxuICAgICAqIEVkaXQgaXRlbXMgaW4gbGlzdHMsIGVkaXQgZG9jdW1lbnRzIGluIGRvY3VtZW50IGxpYnJhcmllcywgZWRpdCBXZWIgZGlzY3Vzc2lvbiBjb21tZW50c1xyXG4gICAgICogaW4gZG9jdW1lbnRzLCBhbmQgY3VzdG9taXplIFdlYiBQYXJ0IFBhZ2VzIGluIGRvY3VtZW50IGxpYnJhcmllcy5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJFZGl0TGlzdEl0ZW1zXCJdID0gM10gPSBcIkVkaXRMaXN0SXRlbXNcIjtcclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlIGl0ZW1zIGZyb20gYSBsaXN0LCBkb2N1bWVudHMgZnJvbSBhIGRvY3VtZW50IGxpYnJhcnksIGFuZCBXZWIgZGlzY3Vzc2lvblxyXG4gICAgICogY29tbWVudHMgaW4gZG9jdW1lbnRzLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIkRlbGV0ZUxpc3RJdGVtc1wiXSA9IDRdID0gXCJEZWxldGVMaXN0SXRlbXNcIjtcclxuICAgIC8qKlxyXG4gICAgICogQXBwcm92ZSBhIG1pbm9yIHZlcnNpb24gb2YgYSBsaXN0IGl0ZW0gb3IgZG9jdW1lbnQuXHJcbiAgICAgKi9cclxuICAgIFBlcm1pc3Npb25LaW5kW1Blcm1pc3Npb25LaW5kW1wiQXBwcm92ZUl0ZW1zXCJdID0gNV0gPSBcIkFwcHJvdmVJdGVtc1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBWaWV3IHRoZSBzb3VyY2Ugb2YgZG9jdW1lbnRzIHdpdGggc2VydmVyLXNpZGUgZmlsZSBoYW5kbGVycy5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJPcGVuSXRlbXNcIl0gPSA2XSA9IFwiT3Blbkl0ZW1zXCI7XHJcbiAgICAvKipcclxuICAgICAqIFZpZXcgcGFzdCB2ZXJzaW9ucyBvZiBhIGxpc3QgaXRlbSBvciBkb2N1bWVudC5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJWaWV3VmVyc2lvbnNcIl0gPSA3XSA9IFwiVmlld1ZlcnNpb25zXCI7XHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZSBwYXN0IHZlcnNpb25zIG9mIGEgbGlzdCBpdGVtIG9yIGRvY3VtZW50LlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIkRlbGV0ZVZlcnNpb25zXCJdID0gOF0gPSBcIkRlbGV0ZVZlcnNpb25zXCI7XHJcbiAgICAvKipcclxuICAgICAqIERpc2NhcmQgb3IgY2hlY2sgaW4gYSBkb2N1bWVudCB3aGljaCBpcyBjaGVja2VkIG91dCB0byBhbm90aGVyIHVzZXIuXHJcbiAgICAgKi9cclxuICAgIFBlcm1pc3Npb25LaW5kW1Blcm1pc3Npb25LaW5kW1wiQ2FuY2VsQ2hlY2tvdXRcIl0gPSA5XSA9IFwiQ2FuY2VsQ2hlY2tvdXRcIjtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlLCBjaGFuZ2UsIGFuZCBkZWxldGUgcGVyc29uYWwgdmlld3Mgb2YgbGlzdHMuXHJcbiAgICAgKi9cclxuICAgIFBlcm1pc3Npb25LaW5kW1Blcm1pc3Npb25LaW5kW1wiTWFuYWdlUGVyc29uYWxWaWV3c1wiXSA9IDEwXSA9IFwiTWFuYWdlUGVyc29uYWxWaWV3c1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgYW5kIGRlbGV0ZSBsaXN0cywgYWRkIG9yIHJlbW92ZSBjb2x1bW5zIGluIGEgbGlzdCwgYW5kIGFkZCBvciByZW1vdmUgcHVibGljIHZpZXdzIG9mIGEgbGlzdC5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJNYW5hZ2VMaXN0c1wiXSA9IDEyXSA9IFwiTWFuYWdlTGlzdHNcIjtcclxuICAgIC8qKlxyXG4gICAgICogVmlldyBmb3Jtcywgdmlld3MsIGFuZCBhcHBsaWNhdGlvbiBwYWdlcywgYW5kIGVudW1lcmF0ZSBsaXN0cy5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJWaWV3Rm9ybVBhZ2VzXCJdID0gMTNdID0gXCJWaWV3Rm9ybVBhZ2VzXCI7XHJcbiAgICAvKipcclxuICAgICAqIE1ha2UgY29udGVudCBvZiBhIGxpc3Qgb3IgZG9jdW1lbnQgbGlicmFyeSByZXRyaWV2ZWFibGUgZm9yIGFub255bW91cyB1c2VycyB0aHJvdWdoIFNoYXJlUG9pbnQgc2VhcmNoLlxyXG4gICAgICogVGhlIGxpc3QgcGVybWlzc2lvbnMgaW4gdGhlIHNpdGUgZG8gbm90IGNoYW5nZS5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJBbm9ueW1vdXNTZWFyY2hBY2Nlc3NMaXN0XCJdID0gMTRdID0gXCJBbm9ueW1vdXNTZWFyY2hBY2Nlc3NMaXN0XCI7XHJcbiAgICAvKipcclxuICAgICAqIEFsbG93IHVzZXJzIHRvIG9wZW4gYSBTaXRlLCBsaXN0LCBvciBmb2xkZXIgdG8gYWNjZXNzIGl0ZW1zIGluc2lkZSB0aGF0IGNvbnRhaW5lci5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJPcGVuXCJdID0gMTddID0gXCJPcGVuXCI7XHJcbiAgICAvKipcclxuICAgICAqIFZpZXcgcGFnZXMgaW4gYSBTaXRlLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIlZpZXdQYWdlc1wiXSA9IDE4XSA9IFwiVmlld1BhZ2VzXCI7XHJcbiAgICAvKipcclxuICAgICAqIEFkZCwgY2hhbmdlLCBvciBkZWxldGUgSFRNTCBwYWdlcyBvciBXZWIgUGFydCBQYWdlcywgYW5kIGVkaXQgdGhlIFNpdGUgdXNpbmdcclxuICAgICAqIGEgV2luZG93cyBTaGFyZVBvaW50IFNlcnZpY2VzIGNvbXBhdGlibGUgZWRpdG9yLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIkFkZEFuZEN1c3RvbWl6ZVBhZ2VzXCJdID0gMTldID0gXCJBZGRBbmRDdXN0b21pemVQYWdlc1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBcHBseSBhIHRoZW1lIG9yIGJvcmRlcnMgdG8gdGhlIGVudGlyZSBTaXRlLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIkFwcGx5VGhlbWVBbmRCb3JkZXJcIl0gPSAyMF0gPSBcIkFwcGx5VGhlbWVBbmRCb3JkZXJcIjtcclxuICAgIC8qKlxyXG4gICAgICogQXBwbHkgYSBzdHlsZSBzaGVldCAoLmNzcyBmaWxlKSB0byB0aGUgU2l0ZS5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJBcHBseVN0eWxlU2hlZXRzXCJdID0gMjFdID0gXCJBcHBseVN0eWxlU2hlZXRzXCI7XHJcbiAgICAvKipcclxuICAgICAqIFZpZXcgcmVwb3J0cyBvbiBTaXRlIHVzYWdlLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIlZpZXdVc2FnZURhdGFcIl0gPSAyMl0gPSBcIlZpZXdVc2FnZURhdGFcIjtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIGEgU2l0ZSB1c2luZyBTZWxmLVNlcnZpY2UgU2l0ZSBDcmVhdGlvbi5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJDcmVhdGVTU0NTaXRlXCJdID0gMjNdID0gXCJDcmVhdGVTU0NTaXRlXCI7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBzdWJzaXRlcyBzdWNoIGFzIHRlYW0gc2l0ZXMsIE1lZXRpbmcgV29ya3NwYWNlIHNpdGVzLCBhbmQgRG9jdW1lbnQgV29ya3NwYWNlIHNpdGVzLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIk1hbmFnZVN1YndlYnNcIl0gPSAyNF0gPSBcIk1hbmFnZVN1YndlYnNcIjtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIGEgZ3JvdXAgb2YgdXNlcnMgdGhhdCBjYW4gYmUgdXNlZCBhbnl3aGVyZSB3aXRoaW4gdGhlIHNpdGUgY29sbGVjdGlvbi5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJDcmVhdGVHcm91cHNcIl0gPSAyNV0gPSBcIkNyZWF0ZUdyb3Vwc1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgYW5kIGNoYW5nZSBwZXJtaXNzaW9uIGxldmVscyBvbiB0aGUgU2l0ZSBhbmQgYXNzaWduIHBlcm1pc3Npb25zIHRvIHVzZXJzXHJcbiAgICAgKiBhbmQgZ3JvdXBzLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIk1hbmFnZVBlcm1pc3Npb25zXCJdID0gMjZdID0gXCJNYW5hZ2VQZXJtaXNzaW9uc1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBFbnVtZXJhdGUgZmlsZXMgYW5kIGZvbGRlcnMgaW4gYSBTaXRlIHVzaW5nIE1pY3Jvc29mdCBPZmZpY2UgU2hhcmVQb2ludCBEZXNpZ25lclxyXG4gICAgICogYW5kIFdlYkRBViBpbnRlcmZhY2VzLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIkJyb3dzZURpcmVjdG9yaWVzXCJdID0gMjddID0gXCJCcm93c2VEaXJlY3Rvcmllc1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBWaWV3IGluZm9ybWF0aW9uIGFib3V0IHVzZXJzIG9mIHRoZSBTaXRlLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIkJyb3dzZVVzZXJJbmZvXCJdID0gMjhdID0gXCJCcm93c2VVc2VySW5mb1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGQgb3IgcmVtb3ZlIHBlcnNvbmFsIFdlYiBQYXJ0cyBvbiBhIFdlYiBQYXJ0IFBhZ2UuXHJcbiAgICAgKi9cclxuICAgIFBlcm1pc3Npb25LaW5kW1Blcm1pc3Npb25LaW5kW1wiQWRkRGVsUHJpdmF0ZVdlYlBhcnRzXCJdID0gMjldID0gXCJBZGREZWxQcml2YXRlV2ViUGFydHNcIjtcclxuICAgIC8qKlxyXG4gICAgICogVXBkYXRlIFdlYiBQYXJ0cyB0byBkaXNwbGF5IHBlcnNvbmFsaXplZCBpbmZvcm1hdGlvbi5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJVcGRhdGVQZXJzb25hbFdlYlBhcnRzXCJdID0gMzBdID0gXCJVcGRhdGVQZXJzb25hbFdlYlBhcnRzXCI7XHJcbiAgICAvKipcclxuICAgICAqIEdyYW50IHRoZSBhYmlsaXR5IHRvIHBlcmZvcm0gYWxsIGFkbWluaXN0cmF0aW9uIHRhc2tzIGZvciB0aGUgU2l0ZSBhcyB3ZWxsIGFzXHJcbiAgICAgKiBtYW5hZ2UgY29udGVudCwgYWN0aXZhdGUsIGRlYWN0aXZhdGUsIG9yIGVkaXQgcHJvcGVydGllcyBvZiBTaXRlIHNjb3BlZCBGZWF0dXJlc1xyXG4gICAgICogdGhyb3VnaCB0aGUgb2JqZWN0IG1vZGVsIG9yIHRocm91Z2ggdGhlIHVzZXIgaW50ZXJmYWNlIChVSSkuIFdoZW4gZ3JhbnRlZCBvbiB0aGVcclxuICAgICAqIHJvb3QgU2l0ZSBvZiBhIFNpdGUgQ29sbGVjdGlvbiwgYWN0aXZhdGUsIGRlYWN0aXZhdGUsIG9yIGVkaXQgcHJvcGVydGllcyBvZlxyXG4gICAgICogc2l0ZSBjb2xsZWN0aW9uIHNjb3BlZCBGZWF0dXJlcyB0aHJvdWdoIHRoZSBvYmplY3QgbW9kZWwuIFRvIGJyb3dzZSB0byB0aGUgU2l0ZVxyXG4gICAgICogQ29sbGVjdGlvbiBGZWF0dXJlcyBwYWdlIGFuZCBhY3RpdmF0ZSBvciBkZWFjdGl2YXRlIFNpdGUgQ29sbGVjdGlvbiBzY29wZWQgRmVhdHVyZXNcclxuICAgICAqIHRocm91Z2ggdGhlIFVJLCB5b3UgbXVzdCBiZSBhIFNpdGUgQ29sbGVjdGlvbiBhZG1pbmlzdHJhdG9yLlxyXG4gICAgICovXHJcbiAgICBQZXJtaXNzaW9uS2luZFtQZXJtaXNzaW9uS2luZFtcIk1hbmFnZVdlYlwiXSA9IDMxXSA9IFwiTWFuYWdlV2ViXCI7XHJcbiAgICAvKipcclxuICAgICAqIENvbnRlbnQgb2YgbGlzdHMgYW5kIGRvY3VtZW50IGxpYnJhcmllcyBpbiB0aGUgV2ViIHNpdGUgd2lsbCBiZSByZXRyaWV2ZWFibGUgZm9yIGFub255bW91cyB1c2VycyB0aHJvdWdoXHJcbiAgICAgKiBTaGFyZVBvaW50IHNlYXJjaCBpZiB0aGUgbGlzdCBvciBkb2N1bWVudCBsaWJyYXJ5IGhhcyBBbm9ueW1vdXNTZWFyY2hBY2Nlc3NMaXN0IHNldC5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJBbm9ueW1vdXNTZWFyY2hBY2Nlc3NXZWJMaXN0c1wiXSA9IDMyXSA9IFwiQW5vbnltb3VzU2VhcmNoQWNjZXNzV2ViTGlzdHNcIjtcclxuICAgIC8qKlxyXG4gICAgICogVXNlIGZlYXR1cmVzIHRoYXQgbGF1bmNoIGNsaWVudCBhcHBsaWNhdGlvbnMuIE90aGVyd2lzZSwgdXNlcnMgbXVzdCB3b3JrIG9uIGRvY3VtZW50c1xyXG4gICAgICogbG9jYWxseSBhbmQgdXBsb2FkIGNoYW5nZXMuXHJcbiAgICAgKi9cclxuICAgIFBlcm1pc3Npb25LaW5kW1Blcm1pc3Npb25LaW5kW1wiVXNlQ2xpZW50SW50ZWdyYXRpb25cIl0gPSAzN10gPSBcIlVzZUNsaWVudEludGVncmF0aW9uXCI7XHJcbiAgICAvKipcclxuICAgICAqIFVzZSBTT0FQLCBXZWJEQVYsIG9yIE1pY3Jvc29mdCBPZmZpY2UgU2hhcmVQb2ludCBEZXNpZ25lciBpbnRlcmZhY2VzIHRvIGFjY2VzcyB0aGUgU2l0ZS5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJVc2VSZW1vdGVBUElzXCJdID0gMzhdID0gXCJVc2VSZW1vdGVBUElzXCI7XHJcbiAgICAvKipcclxuICAgICAqIE1hbmFnZSBhbGVydHMgZm9yIGFsbCB1c2VycyBvZiB0aGUgU2l0ZS5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJNYW5hZ2VBbGVydHNcIl0gPSAzOV0gPSBcIk1hbmFnZUFsZXJ0c1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgZS1tYWlsIGFsZXJ0cy5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJDcmVhdGVBbGVydHNcIl0gPSA0MF0gPSBcIkNyZWF0ZUFsZXJ0c1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBbGxvd3MgYSB1c2VyIHRvIGNoYW5nZSBoaXMgb3IgaGVyIHVzZXIgaW5mb3JtYXRpb24sIHN1Y2ggYXMgYWRkaW5nIGEgcGljdHVyZS5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJFZGl0TXlVc2VySW5mb1wiXSA9IDQxXSA9IFwiRWRpdE15VXNlckluZm9cIjtcclxuICAgIC8qKlxyXG4gICAgICogRW51bWVyYXRlIHBlcm1pc3Npb25zIG9uIFNpdGUsIGxpc3QsIGZvbGRlciwgZG9jdW1lbnQsIG9yIGxpc3QgaXRlbS5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJFbnVtZXJhdGVQZXJtaXNzaW9uc1wiXSA9IDYzXSA9IFwiRW51bWVyYXRlUGVybWlzc2lvbnNcIjtcclxuICAgIC8qKlxyXG4gICAgICogSGFzIGFsbCBwZXJtaXNzaW9ucyBvbiB0aGUgU2l0ZS4gTm90IGF2YWlsYWJsZSB0aHJvdWdoIHRoZSB1c2VyIGludGVyZmFjZS5cclxuICAgICAqL1xyXG4gICAgUGVybWlzc2lvbktpbmRbUGVybWlzc2lvbktpbmRbXCJGdWxsTWFza1wiXSA9IDY1XSA9IFwiRnVsbE1hc2tcIjtcclxufSkoUGVybWlzc2lvbktpbmQgfHwgKFBlcm1pc3Npb25LaW5kID0ge30pKTtcclxuLyoqXHJcbiAqIFNwZWNpZmllcyB0aGUgdHlwZSBvZiBhIHByaW5jaXBhbC5cclxuICovXHJcbi8qIHRzbGludDpkaXNhYmxlOm5vLWJpdHdpc2UgKi9cclxudmFyIFByaW5jaXBhbFR5cGUkMTtcclxuKGZ1bmN0aW9uIChQcmluY2lwYWxUeXBlKSB7XHJcbiAgICAvKipcclxuICAgICAqIEVudW1lcmF0aW9uIHdob3NlIHZhbHVlIHNwZWNpZmllcyBubyBwcmluY2lwYWwgdHlwZS5cclxuICAgICAqL1xyXG4gICAgUHJpbmNpcGFsVHlwZVtQcmluY2lwYWxUeXBlW1wiTm9uZVwiXSA9IDBdID0gXCJOb25lXCI7XHJcbiAgICAvKipcclxuICAgICAqIEVudW1lcmF0aW9uIHdob3NlIHZhbHVlIHNwZWNpZmllcyBhIHVzZXIgYXMgdGhlIHByaW5jaXBhbCB0eXBlLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxUeXBlW1ByaW5jaXBhbFR5cGVbXCJVc2VyXCJdID0gMV0gPSBcIlVzZXJcIjtcclxuICAgIC8qKlxyXG4gICAgICogRW51bWVyYXRpb24gd2hvc2UgdmFsdWUgc3BlY2lmaWVzIGEgZGlzdHJpYnV0aW9uIGxpc3QgYXMgdGhlIHByaW5jaXBhbCB0eXBlLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxUeXBlW1ByaW5jaXBhbFR5cGVbXCJEaXN0cmlidXRpb25MaXN0XCJdID0gMl0gPSBcIkRpc3RyaWJ1dGlvbkxpc3RcIjtcclxuICAgIC8qKlxyXG4gICAgICogRW51bWVyYXRpb24gd2hvc2UgdmFsdWUgc3BlY2lmaWVzIGEgc2VjdXJpdHkgZ3JvdXAgYXMgdGhlIHByaW5jaXBhbCB0eXBlLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxUeXBlW1ByaW5jaXBhbFR5cGVbXCJTZWN1cml0eUdyb3VwXCJdID0gNF0gPSBcIlNlY3VyaXR5R3JvdXBcIjtcclxuICAgIC8qKlxyXG4gICAgICogRW51bWVyYXRpb24gd2hvc2UgdmFsdWUgc3BlY2lmaWVzIGEgZ3JvdXAgYXMgdGhlIHByaW5jaXBhbCB0eXBlLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxUeXBlW1ByaW5jaXBhbFR5cGVbXCJTaGFyZVBvaW50R3JvdXBcIl0gPSA4XSA9IFwiU2hhcmVQb2ludEdyb3VwXCI7XHJcbiAgICAvKipcclxuICAgICAqIEVudW1lcmF0aW9uIHdob3NlIHZhbHVlIHNwZWNpZmllcyBhbGwgcHJpbmNpcGFsIHR5cGVzLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxUeXBlW1ByaW5jaXBhbFR5cGVbXCJBbGxcIl0gPSAxNV0gPSBcIkFsbFwiO1xyXG59KShQcmluY2lwYWxUeXBlJDEgfHwgKFByaW5jaXBhbFR5cGUkMSA9IHt9KSk7XHJcbi8qIHRzbGludDplbmFibGU6bm8tYml0d2lzZSAqL1xyXG4vKipcclxuICogU3BlY2lmaWVzIHRoZSBzb3VyY2Ugb2YgYSBwcmluY2lwYWwuXHJcbiAqL1xyXG4vKiB0c2xpbnQ6ZGlzYWJsZTpuby1iaXR3aXNlICovXHJcbnZhciBQcmluY2lwYWxTb3VyY2U7XHJcbihmdW5jdGlvbiAoUHJpbmNpcGFsU291cmNlKSB7XHJcbiAgICAvKipcclxuICAgICAqIEVudW1lcmF0aW9uIHdob3NlIHZhbHVlIHNwZWNpZmllcyBubyBwcmluY2lwYWwgc291cmNlLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxTb3VyY2VbUHJpbmNpcGFsU291cmNlW1wiTm9uZVwiXSA9IDBdID0gXCJOb25lXCI7XHJcbiAgICAvKipcclxuICAgICAqIEVudW1lcmF0aW9uIHdob3NlIHZhbHVlIHNwZWNpZmllcyB1c2VyIGluZm9ybWF0aW9uIGxpc3QgYXMgdGhlIHByaW5jaXBhbCBzb3VyY2UuXHJcbiAgICAgKi9cclxuICAgIFByaW5jaXBhbFNvdXJjZVtQcmluY2lwYWxTb3VyY2VbXCJVc2VySW5mb0xpc3RcIl0gPSAxXSA9IFwiVXNlckluZm9MaXN0XCI7XHJcbiAgICAvKipcclxuICAgICAqIEVudW1lcmF0aW9uIHdob3NlIHZhbHVlIHNwZWNpZmllcyBBY3RpdmUgRGlyZWN0b3J5IGFzIHRoZSBwcmluY2lwYWwgc291cmNlLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxTb3VyY2VbUHJpbmNpcGFsU291cmNlW1wiV2luZG93c1wiXSA9IDJdID0gXCJXaW5kb3dzXCI7XHJcbiAgICAvKipcclxuICAgICAqIEVudW1lcmF0aW9uIHdob3NlIHZhbHVlIHNwZWNpZmllcyB0aGUgY3VycmVudCBtZW1iZXJzaGlwIHByb3ZpZGVyIGFzIHRoZSBwcmluY2lwYWwgc291cmNlLlxyXG4gICAgICovXHJcbiAgICBQcmluY2lwYWxTb3VyY2VbUHJpbmNpcGFsU291cmNlW1wiTWVtYmVyc2hpcFByb3ZpZGVyXCJdID0gNF0gPSBcIk1lbWJlcnNoaXBQcm92aWRlclwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBFbnVtZXJhdGlvbiB3aG9zZSB2YWx1ZSBzcGVjaWZpZXMgdGhlIGN1cnJlbnQgcm9sZSBwcm92aWRlciBhcyB0aGUgcHJpbmNpcGFsIHNvdXJjZS5cclxuICAgICAqL1xyXG4gICAgUHJpbmNpcGFsU291cmNlW1ByaW5jaXBhbFNvdXJjZVtcIlJvbGVQcm92aWRlclwiXSA9IDhdID0gXCJSb2xlUHJvdmlkZXJcIjtcclxuICAgIC8qKlxyXG4gICAgICogRW51bWVyYXRpb24gd2hvc2UgdmFsdWUgc3BlY2lmaWVzIGFsbCBwcmluY2lwYWwgc291cmNlcy5cclxuICAgICAqL1xyXG4gICAgUHJpbmNpcGFsU291cmNlW1ByaW5jaXBhbFNvdXJjZVtcIkFsbFwiXSA9IDE1XSA9IFwiQWxsXCI7XHJcbn0pKFByaW5jaXBhbFNvdXJjZSB8fCAoUHJpbmNpcGFsU291cmNlID0ge30pKTtcclxuLyogdHNsaW50OmVuYWJsZTpuby1iaXR3aXNlICovXHJcbnZhciBSb2xlVHlwZTtcclxuKGZ1bmN0aW9uIChSb2xlVHlwZSkge1xyXG4gICAgUm9sZVR5cGVbUm9sZVR5cGVbXCJOb25lXCJdID0gMF0gPSBcIk5vbmVcIjtcclxuICAgIFJvbGVUeXBlW1JvbGVUeXBlW1wiR3Vlc3RcIl0gPSAxXSA9IFwiR3Vlc3RcIjtcclxuICAgIFJvbGVUeXBlW1JvbGVUeXBlW1wiUmVhZGVyXCJdID0gMl0gPSBcIlJlYWRlclwiO1xyXG4gICAgUm9sZVR5cGVbUm9sZVR5cGVbXCJDb250cmlidXRvclwiXSA9IDNdID0gXCJDb250cmlidXRvclwiO1xyXG4gICAgUm9sZVR5cGVbUm9sZVR5cGVbXCJXZWJEZXNpZ25lclwiXSA9IDRdID0gXCJXZWJEZXNpZ25lclwiO1xyXG4gICAgUm9sZVR5cGVbUm9sZVR5cGVbXCJBZG1pbmlzdHJhdG9yXCJdID0gNV0gPSBcIkFkbWluaXN0cmF0b3JcIjtcclxufSkoUm9sZVR5cGUgfHwgKFJvbGVUeXBlID0ge30pKTtcclxudmFyIFBhZ2VUeXBlO1xyXG4oZnVuY3Rpb24gKFBhZ2VUeXBlKSB7XHJcbiAgICBQYWdlVHlwZVtQYWdlVHlwZVtcIkludmFsaWRcIl0gPSAtMV0gPSBcIkludmFsaWRcIjtcclxuICAgIFBhZ2VUeXBlW1BhZ2VUeXBlW1wiRGVmYXVsdFZpZXdcIl0gPSAwXSA9IFwiRGVmYXVsdFZpZXdcIjtcclxuICAgIFBhZ2VUeXBlW1BhZ2VUeXBlW1wiTm9ybWFsVmlld1wiXSA9IDFdID0gXCJOb3JtYWxWaWV3XCI7XHJcbiAgICBQYWdlVHlwZVtQYWdlVHlwZVtcIkRpYWxvZ1ZpZXdcIl0gPSAyXSA9IFwiRGlhbG9nVmlld1wiO1xyXG4gICAgUGFnZVR5cGVbUGFnZVR5cGVbXCJWaWV3XCJdID0gM10gPSBcIlZpZXdcIjtcclxuICAgIFBhZ2VUeXBlW1BhZ2VUeXBlW1wiRGlzcGxheUZvcm1cIl0gPSA0XSA9IFwiRGlzcGxheUZvcm1cIjtcclxuICAgIFBhZ2VUeXBlW1BhZ2VUeXBlW1wiRGlzcGxheUZvcm1EaWFsb2dcIl0gPSA1XSA9IFwiRGlzcGxheUZvcm1EaWFsb2dcIjtcclxuICAgIFBhZ2VUeXBlW1BhZ2VUeXBlW1wiRWRpdEZvcm1cIl0gPSA2XSA9IFwiRWRpdEZvcm1cIjtcclxuICAgIFBhZ2VUeXBlW1BhZ2VUeXBlW1wiRWRpdEZvcm1EaWFsb2dcIl0gPSA3XSA9IFwiRWRpdEZvcm1EaWFsb2dcIjtcclxuICAgIFBhZ2VUeXBlW1BhZ2VUeXBlW1wiTmV3Rm9ybVwiXSA9IDhdID0gXCJOZXdGb3JtXCI7XHJcbiAgICBQYWdlVHlwZVtQYWdlVHlwZVtcIk5ld0Zvcm1EaWFsb2dcIl0gPSA5XSA9IFwiTmV3Rm9ybURpYWxvZ1wiO1xyXG4gICAgUGFnZVR5cGVbUGFnZVR5cGVbXCJTb2x1dGlvbkZvcm1cIl0gPSAxMF0gPSBcIlNvbHV0aW9uRm9ybVwiO1xyXG4gICAgUGFnZVR5cGVbUGFnZVR5cGVbXCJQQUdFX01BWElURU1TXCJdID0gMTFdID0gXCJQQUdFX01BWElURU1TXCI7XHJcbn0pKFBhZ2VUeXBlIHx8IChQYWdlVHlwZSA9IHt9KSk7XHJcbnZhciBTaGFyaW5nTGlua0tpbmQ7XHJcbihmdW5jdGlvbiAoU2hhcmluZ0xpbmtLaW5kKSB7XHJcbiAgICAvKipcclxuICAgICAqIFVuaW5pdGlhbGl6ZWQgbGlua1xyXG4gICAgICovXHJcbiAgICBTaGFyaW5nTGlua0tpbmRbU2hhcmluZ0xpbmtLaW5kW1wiVW5pbml0aWFsaXplZFwiXSA9IDBdID0gXCJVbmluaXRpYWxpemVkXCI7XHJcbiAgICAvKipcclxuICAgICAqIERpcmVjdCBsaW5rIHRvIHRoZSBvYmplY3QgYmVpbmcgc2hhcmVkXHJcbiAgICAgKi9cclxuICAgIFNoYXJpbmdMaW5rS2luZFtTaGFyaW5nTGlua0tpbmRbXCJEaXJlY3RcIl0gPSAxXSA9IFwiRGlyZWN0XCI7XHJcbiAgICAvKipcclxuICAgICAqIE9yZ2FuaXphdGlvbi1zaGFyZWFibGUgbGluayB0byB0aGUgb2JqZWN0IGJlaW5nIHNoYXJlZCB3aXRoIHZpZXcgcGVybWlzc2lvbnNcclxuICAgICAqL1xyXG4gICAgU2hhcmluZ0xpbmtLaW5kW1NoYXJpbmdMaW5rS2luZFtcIk9yZ2FuaXphdGlvblZpZXdcIl0gPSAyXSA9IFwiT3JnYW5pemF0aW9uVmlld1wiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBPcmdhbml6YXRpb24tc2hhcmVhYmxlIGxpbmsgdG8gdGhlIG9iamVjdCBiZWluZyBzaGFyZWQgd2l0aCBlZGl0IHBlcm1pc3Npb25zXHJcbiAgICAgKi9cclxuICAgIFNoYXJpbmdMaW5rS2luZFtTaGFyaW5nTGlua0tpbmRbXCJPcmdhbml6YXRpb25FZGl0XCJdID0gM10gPSBcIk9yZ2FuaXphdGlvbkVkaXRcIjtcclxuICAgIC8qKlxyXG4gICAgICogVmlldyBvbmx5IGFub255bW91cyBsaW5rXHJcbiAgICAgKi9cclxuICAgIFNoYXJpbmdMaW5rS2luZFtTaGFyaW5nTGlua0tpbmRbXCJBbm9ueW1vdXNWaWV3XCJdID0gNF0gPSBcIkFub255bW91c1ZpZXdcIjtcclxuICAgIC8qKlxyXG4gICAgICogUmVhZC9Xcml0ZSBhbm9ueW1vdXMgbGlua1xyXG4gICAgICovXHJcbiAgICBTaGFyaW5nTGlua0tpbmRbU2hhcmluZ0xpbmtLaW5kW1wiQW5vbnltb3VzRWRpdFwiXSA9IDVdID0gXCJBbm9ueW1vdXNFZGl0XCI7XHJcbiAgICAvKipcclxuICAgICAqIEZsZXhpYmxlIHNoYXJpbmcgTGluayB3aGVyZSBwcm9wZXJ0aWVzIGNhbiBjaGFuZ2Ugd2l0aG91dCBhZmZlY3RpbmcgbGluayBVUkxcclxuICAgICAqL1xyXG4gICAgU2hhcmluZ0xpbmtLaW5kW1NoYXJpbmdMaW5rS2luZFtcIkZsZXhpYmxlXCJdID0gNl0gPSBcIkZsZXhpYmxlXCI7XHJcbn0pKFNoYXJpbmdMaW5rS2luZCB8fCAoU2hhcmluZ0xpbmtLaW5kID0ge30pKTtcclxuLyoqXHJcbiAqIEluZGljYXRlcyB0aGUgcm9sZSBvZiB0aGUgc2hhcmluZyBsaW5rXHJcbiAqL1xyXG52YXIgU2hhcmluZ1JvbGU7XHJcbihmdW5jdGlvbiAoU2hhcmluZ1JvbGUpIHtcclxuICAgIFNoYXJpbmdSb2xlW1NoYXJpbmdSb2xlW1wiTm9uZVwiXSA9IDBdID0gXCJOb25lXCI7XHJcbiAgICBTaGFyaW5nUm9sZVtTaGFyaW5nUm9sZVtcIlZpZXdcIl0gPSAxXSA9IFwiVmlld1wiO1xyXG4gICAgU2hhcmluZ1JvbGVbU2hhcmluZ1JvbGVbXCJFZGl0XCJdID0gMl0gPSBcIkVkaXRcIjtcclxuICAgIFNoYXJpbmdSb2xlW1NoYXJpbmdSb2xlW1wiT3duZXJcIl0gPSAzXSA9IFwiT3duZXJcIjtcclxufSkoU2hhcmluZ1JvbGUgfHwgKFNoYXJpbmdSb2xlID0ge30pKTtcclxudmFyIFNoYXJpbmdPcGVyYXRpb25TdGF0dXNDb2RlO1xyXG4oZnVuY3Rpb24gKFNoYXJpbmdPcGVyYXRpb25TdGF0dXNDb2RlKSB7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBzaGFyZSBvcGVyYXRpb24gY29tcGxldGVkIHdpdGhvdXQgZXJyb3JzLlxyXG4gICAgICovXHJcbiAgICBTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtcIkNvbXBsZXRlZFN1Y2Nlc3NmdWxseVwiXSA9IDBdID0gXCJDb21wbGV0ZWRTdWNjZXNzZnVsbHlcIjtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIHNoYXJlIG9wZXJhdGlvbiBjb21wbGV0ZWQgYW5kIGdlbmVyYXRlZCByZXF1ZXN0cyBmb3IgYWNjZXNzLlxyXG4gICAgICovXHJcbiAgICBTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtcIkFjY2Vzc1JlcXVlc3RzUXVldWVkXCJdID0gMV0gPSBcIkFjY2Vzc1JlcXVlc3RzUXVldWVkXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBzaGFyZSBvcGVyYXRpb24gZmFpbGVkIGFzIHRoZXJlIHdlcmUgbm8gcmVzb2x2ZWQgdXNlcnMuXHJcbiAgICAgKi9cclxuICAgIFNoYXJpbmdPcGVyYXRpb25TdGF0dXNDb2RlW1NoYXJpbmdPcGVyYXRpb25TdGF0dXNDb2RlW1wiTm9SZXNvbHZlZFVzZXJzXCJdID0gLTFdID0gXCJOb1Jlc29sdmVkVXNlcnNcIjtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIHNoYXJlIG9wZXJhdGlvbiBmYWlsZWQgZHVlIHRvIGluc3VmZmljaWVudCBwZXJtaXNzaW9ucy5cclxuICAgICAqL1xyXG4gICAgU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbXCJBY2Nlc3NEZW5pZWRcIl0gPSAtMl0gPSBcIkFjY2Vzc0RlbmllZFwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgc2hhcmUgb3BlcmF0aW9uIGZhaWxlZCB3aGVuIGF0dGVtcHRpbmcgYSBjcm9zcyBzaXRlIHNoYXJlLCB3aGljaCBpcyBub3Qgc3VwcG9ydGVkLlxyXG4gICAgICovXHJcbiAgICBTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtcIkNyb3NzU2l0ZVJlcXVlc3ROb3RTdXBwb3J0ZWRcIl0gPSAtM10gPSBcIkNyb3NzU2l0ZVJlcXVlc3ROb3RTdXBwb3J0ZWRcIjtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIHNoYXJpbmcgb3BlcmF0aW9uIGZhaWxlZCBkdWUgdG8gYW4gdW5rbm93biBlcnJvci5cclxuICAgICAqL1xyXG4gICAgU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbXCJVbmtub3dFcnJvclwiXSA9IC00XSA9IFwiVW5rbm93RXJyb3JcIjtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIHRleHQgeW91IHR5cGVkIGlzIHRvbyBsb25nLiBQbGVhc2Ugc2hvcnRlbiBpdC5cclxuICAgICAqL1xyXG4gICAgU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbXCJFbWFpbEJvZHlUb29Mb25nXCJdID0gLTVdID0gXCJFbWFpbEJvZHlUb29Mb25nXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB1bmlxdWUgc2NvcGVzIGluIHRoZSBsaXN0IGhhcyBiZWVuIGV4Y2VlZGVkLlxyXG4gICAgICovXHJcbiAgICBTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtcIkxpc3RVbmlxdWVTY29wZXNFeGNlZWRlZFwiXSA9IC02XSA9IFwiTGlzdFVuaXF1ZVNjb3Blc0V4Y2VlZGVkXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBzaGFyZSBvcGVyYXRpb24gZmFpbGVkIGJlY2F1c2UgYSBzaGFyaW5nIGNhcGFiaWxpdHkgaXMgZGlzYWJsZWQgaW4gdGhlIHNpdGUuXHJcbiAgICAgKi9cclxuICAgIFNoYXJpbmdPcGVyYXRpb25TdGF0dXNDb2RlW1NoYXJpbmdPcGVyYXRpb25TdGF0dXNDb2RlW1wiQ2FwYWJpbGl0eURpc2FibGVkXCJdID0gLTddID0gXCJDYXBhYmlsaXR5RGlzYWJsZWRcIjtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIHNwZWNpZmllZCBvYmplY3QgZm9yIHRoZSBzaGFyZSBvcGVyYXRpb24gaXMgbm90IHN1cHBvcnRlZC5cclxuICAgICAqL1xyXG4gICAgU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbU2hhcmluZ09wZXJhdGlvblN0YXR1c0NvZGVbXCJPYmplY3ROb3RTdXBwb3J0ZWRcIl0gPSAtOF0gPSBcIk9iamVjdE5vdFN1cHBvcnRlZFwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBIFNoYXJlUG9pbnQgZ3JvdXAgY2Fubm90IGNvbnRhaW4gYW5vdGhlciBTaGFyZVBvaW50IGdyb3VwLlxyXG4gICAgICovXHJcbiAgICBTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZVtcIk5lc3RlZEdyb3Vwc05vdFN1cHBvcnRlZFwiXSA9IC05XSA9IFwiTmVzdGVkR3JvdXBzTm90U3VwcG9ydGVkXCI7XHJcbn0pKFNoYXJpbmdPcGVyYXRpb25TdGF0dXNDb2RlIHx8IChTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZSA9IHt9KSk7XHJcbnZhciBTUFNoYXJlZE9iamVjdFR5cGU7XHJcbihmdW5jdGlvbiAoU1BTaGFyZWRPYmplY3RUeXBlKSB7XHJcbiAgICBTUFNoYXJlZE9iamVjdFR5cGVbU1BTaGFyZWRPYmplY3RUeXBlW1wiVW5rbm93blwiXSA9IDBdID0gXCJVbmtub3duXCI7XHJcbiAgICBTUFNoYXJlZE9iamVjdFR5cGVbU1BTaGFyZWRPYmplY3RUeXBlW1wiRmlsZVwiXSA9IDFdID0gXCJGaWxlXCI7XHJcbiAgICBTUFNoYXJlZE9iamVjdFR5cGVbU1BTaGFyZWRPYmplY3RUeXBlW1wiRm9sZGVyXCJdID0gMl0gPSBcIkZvbGRlclwiO1xyXG4gICAgU1BTaGFyZWRPYmplY3RUeXBlW1NQU2hhcmVkT2JqZWN0VHlwZVtcIkl0ZW1cIl0gPSAzXSA9IFwiSXRlbVwiO1xyXG4gICAgU1BTaGFyZWRPYmplY3RUeXBlW1NQU2hhcmVkT2JqZWN0VHlwZVtcIkxpc3RcIl0gPSA0XSA9IFwiTGlzdFwiO1xyXG4gICAgU1BTaGFyZWRPYmplY3RUeXBlW1NQU2hhcmVkT2JqZWN0VHlwZVtcIldlYlwiXSA9IDVdID0gXCJXZWJcIjtcclxuICAgIFNQU2hhcmVkT2JqZWN0VHlwZVtTUFNoYXJlZE9iamVjdFR5cGVbXCJNYXhcIl0gPSA2XSA9IFwiTWF4XCI7XHJcbn0pKFNQU2hhcmVkT2JqZWN0VHlwZSB8fCAoU1BTaGFyZWRPYmplY3RUeXBlID0ge30pKTtcclxudmFyIFNoYXJpbmdEb21haW5SZXN0cmljdGlvbk1vZGU7XHJcbihmdW5jdGlvbiAoU2hhcmluZ0RvbWFpblJlc3RyaWN0aW9uTW9kZSkge1xyXG4gICAgU2hhcmluZ0RvbWFpblJlc3RyaWN0aW9uTW9kZVtTaGFyaW5nRG9tYWluUmVzdHJpY3Rpb25Nb2RlW1wiTm9uZVwiXSA9IDBdID0gXCJOb25lXCI7XHJcbiAgICBTaGFyaW5nRG9tYWluUmVzdHJpY3Rpb25Nb2RlW1NoYXJpbmdEb21haW5SZXN0cmljdGlvbk1vZGVbXCJBbGxvd0xpc3RcIl0gPSAxXSA9IFwiQWxsb3dMaXN0XCI7XHJcbiAgICBTaGFyaW5nRG9tYWluUmVzdHJpY3Rpb25Nb2RlW1NoYXJpbmdEb21haW5SZXN0cmljdGlvbk1vZGVbXCJCbG9ja0xpc3RcIl0gPSAyXSA9IFwiQmxvY2tMaXN0XCI7XHJcbn0pKFNoYXJpbmdEb21haW5SZXN0cmljdGlvbk1vZGUgfHwgKFNoYXJpbmdEb21haW5SZXN0cmljdGlvbk1vZGUgPSB7fSkpO1xyXG52YXIgUmVuZGVyTGlzdERhdGFPcHRpb25zO1xyXG4oZnVuY3Rpb24gKFJlbmRlckxpc3REYXRhT3B0aW9ucykge1xyXG4gICAgUmVuZGVyTGlzdERhdGFPcHRpb25zW1JlbmRlckxpc3REYXRhT3B0aW9uc1tcIk5vbmVcIl0gPSAwXSA9IFwiTm9uZVwiO1xyXG4gICAgUmVuZGVyTGlzdERhdGFPcHRpb25zW1JlbmRlckxpc3REYXRhT3B0aW9uc1tcIkNvbnRleHRJbmZvXCJdID0gMV0gPSBcIkNvbnRleHRJbmZvXCI7XHJcbiAgICBSZW5kZXJMaXN0RGF0YU9wdGlvbnNbUmVuZGVyTGlzdERhdGFPcHRpb25zW1wiTGlzdERhdGFcIl0gPSAyXSA9IFwiTGlzdERhdGFcIjtcclxuICAgIFJlbmRlckxpc3REYXRhT3B0aW9uc1tSZW5kZXJMaXN0RGF0YU9wdGlvbnNbXCJMaXN0U2NoZW1hXCJdID0gNF0gPSBcIkxpc3RTY2hlbWFcIjtcclxuICAgIFJlbmRlckxpc3REYXRhT3B0aW9uc1tSZW5kZXJMaXN0RGF0YU9wdGlvbnNbXCJNZW51Vmlld1wiXSA9IDhdID0gXCJNZW51Vmlld1wiO1xyXG4gICAgUmVuZGVyTGlzdERhdGFPcHRpb25zW1JlbmRlckxpc3REYXRhT3B0aW9uc1tcIkxpc3RDb250ZW50VHlwZVwiXSA9IDE2XSA9IFwiTGlzdENvbnRlbnRUeXBlXCI7XHJcbiAgICBSZW5kZXJMaXN0RGF0YU9wdGlvbnNbUmVuZGVyTGlzdERhdGFPcHRpb25zW1wiRmlsZVN5c3RlbUl0ZW1JZFwiXSA9IDMyXSA9IFwiRmlsZVN5c3RlbUl0ZW1JZFwiO1xyXG4gICAgUmVuZGVyTGlzdERhdGFPcHRpb25zW1JlbmRlckxpc3REYXRhT3B0aW9uc1tcIkNsaWVudEZvcm1TY2hlbWFcIl0gPSA2NF0gPSBcIkNsaWVudEZvcm1TY2hlbWFcIjtcclxuICAgIFJlbmRlckxpc3REYXRhT3B0aW9uc1tSZW5kZXJMaXN0RGF0YU9wdGlvbnNbXCJRdWlja0xhdW5jaFwiXSA9IDEyOF0gPSBcIlF1aWNrTGF1bmNoXCI7XHJcbiAgICBSZW5kZXJMaXN0RGF0YU9wdGlvbnNbUmVuZGVyTGlzdERhdGFPcHRpb25zW1wiU3BvdGxpZ2h0XCJdID0gMjU2XSA9IFwiU3BvdGxpZ2h0XCI7XHJcbiAgICBSZW5kZXJMaXN0RGF0YU9wdGlvbnNbUmVuZGVyTGlzdERhdGFPcHRpb25zW1wiVmlzdWFsaXphdGlvblwiXSA9IDUxMl0gPSBcIlZpc3VhbGl6YXRpb25cIjtcclxuICAgIFJlbmRlckxpc3REYXRhT3B0aW9uc1tSZW5kZXJMaXN0RGF0YU9wdGlvbnNbXCJWaWV3TWV0YWRhdGFcIl0gPSAxMDI0XSA9IFwiVmlld01ldGFkYXRhXCI7XHJcbiAgICBSZW5kZXJMaXN0RGF0YU9wdGlvbnNbUmVuZGVyTGlzdERhdGFPcHRpb25zW1wiRGlzYWJsZUF1dG9IeXBlcmxpbmtcIl0gPSAyMDQ4XSA9IFwiRGlzYWJsZUF1dG9IeXBlcmxpbmtcIjtcclxuICAgIFJlbmRlckxpc3REYXRhT3B0aW9uc1tSZW5kZXJMaXN0RGF0YU9wdGlvbnNbXCJFbmFibGVNZWRpYVRBVXJsc1wiXSA9IDQwOTZdID0gXCJFbmFibGVNZWRpYVRBVXJsc1wiO1xyXG4gICAgUmVuZGVyTGlzdERhdGFPcHRpb25zW1JlbmRlckxpc3REYXRhT3B0aW9uc1tcIlBhcmVudEluZm9cIl0gPSA4MTkyXSA9IFwiUGFyZW50SW5mb1wiO1xyXG4gICAgUmVuZGVyTGlzdERhdGFPcHRpb25zW1JlbmRlckxpc3REYXRhT3B0aW9uc1tcIlBhZ2VDb250ZXh0SW5mb1wiXSA9IDE2Mzg0XSA9IFwiUGFnZUNvbnRleHRJbmZvXCI7XHJcbiAgICBSZW5kZXJMaXN0RGF0YU9wdGlvbnNbUmVuZGVyTGlzdERhdGFPcHRpb25zW1wiQ2xpZW50U2lkZUNvbXBvbmVudE1hbmlmZXN0XCJdID0gMzI3NjhdID0gXCJDbGllbnRTaWRlQ29tcG9uZW50TWFuaWZlc3RcIjtcclxufSkoUmVuZGVyTGlzdERhdGFPcHRpb25zIHx8IChSZW5kZXJMaXN0RGF0YU9wdGlvbnMgPSB7fSkpO1xyXG52YXIgRmllbGRVc2VyU2VsZWN0aW9uTW9kZTtcclxuKGZ1bmN0aW9uIChGaWVsZFVzZXJTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICBGaWVsZFVzZXJTZWxlY3Rpb25Nb2RlW0ZpZWxkVXNlclNlbGVjdGlvbk1vZGVbXCJQZW9wbGVBbmRHcm91cHNcIl0gPSAxXSA9IFwiUGVvcGxlQW5kR3JvdXBzXCI7XHJcbiAgICBGaWVsZFVzZXJTZWxlY3Rpb25Nb2RlW0ZpZWxkVXNlclNlbGVjdGlvbk1vZGVbXCJQZW9wbGVPbmx5XCJdID0gMF0gPSBcIlBlb3BsZU9ubHlcIjtcclxufSkoRmllbGRVc2VyU2VsZWN0aW9uTW9kZSB8fCAoRmllbGRVc2VyU2VsZWN0aW9uTW9kZSA9IHt9KSk7XHJcbnZhciBDaG9pY2VGaWVsZEZvcm1hdFR5cGU7XHJcbihmdW5jdGlvbiAoQ2hvaWNlRmllbGRGb3JtYXRUeXBlKSB7XHJcbiAgICBDaG9pY2VGaWVsZEZvcm1hdFR5cGVbQ2hvaWNlRmllbGRGb3JtYXRUeXBlW1wiRHJvcGRvd25cIl0gPSAwXSA9IFwiRHJvcGRvd25cIjtcclxuICAgIENob2ljZUZpZWxkRm9ybWF0VHlwZVtDaG9pY2VGaWVsZEZvcm1hdFR5cGVbXCJSYWRpb0J1dHRvbnNcIl0gPSAxXSA9IFwiUmFkaW9CdXR0b25zXCI7XHJcbn0pKENob2ljZUZpZWxkRm9ybWF0VHlwZSB8fCAoQ2hvaWNlRmllbGRGb3JtYXRUeXBlID0ge30pKTtcclxuLyoqXHJcbiAqIFNwZWNpZmllcyB0aGUgb3JpZ2luYXRpbmcgem9uZSBvZiBhIHJlcXVlc3QgcmVjZWl2ZWQuXHJcbiAqL1xyXG52YXIgVXJsWm9uZTtcclxuKGZ1bmN0aW9uIChVcmxab25lKSB7XHJcbiAgICAvKipcclxuICAgICAqIFNwZWNpZmllcyB0aGUgZGVmYXVsdCB6b25lIHVzZWQgZm9yIHJlcXVlc3RzIHVubGVzcyBhbm90aGVyIHpvbmUgaXMgc3BlY2lmaWVkLlxyXG4gICAgICovXHJcbiAgICBVcmxab25lW1VybFpvbmVbXCJEZWZhdWx0Wm9uZVwiXSA9IDBdID0gXCJEZWZhdWx0Wm9uZVwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBTcGVjaWZpZXMgYW4gaW50cmFuZXQgem9uZS5cclxuICAgICAqL1xyXG4gICAgVXJsWm9uZVtVcmxab25lW1wiSW50cmFuZXRcIl0gPSAxXSA9IFwiSW50cmFuZXRcIjtcclxuICAgIC8qKlxyXG4gICAgICogU3BlY2lmaWVzIGFuIEludGVybmV0IHpvbmUuXHJcbiAgICAgKi9cclxuICAgIFVybFpvbmVbVXJsWm9uZVtcIkludGVybmV0XCJdID0gMl0gPSBcIkludGVybmV0XCI7XHJcbiAgICAvKipcclxuICAgICAqIFNwZWNpZmllcyBhIGN1c3RvbSB6b25lLlxyXG4gICAgICovXHJcbiAgICBVcmxab25lW1VybFpvbmVbXCJDdXN0b21cIl0gPSAzXSA9IFwiQ3VzdG9tXCI7XHJcbiAgICAvKipcclxuICAgICAqIFNwZWNpZmllcyBhbiBleHRyYW5ldCB6b25lLlxyXG4gICAgICovXHJcbiAgICBVcmxab25lW1VybFpvbmVbXCJFeHRyYW5ldFwiXSA9IDRdID0gXCJFeHRyYW5ldFwiO1xyXG59KShVcmxab25lIHx8IChVcmxab25lID0ge30pKTtcblxudmFyIFNoYXJlUG9pbnRRdWVyeWFibGVTZWN1cmFibGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNoYXJlUG9pbnRRdWVyeWFibGVTZWN1cmFibGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNoYXJlUG9pbnRRdWVyeWFibGVTZWN1cmFibGUucHJvdG90eXBlLCBcInJvbGVBc3NpZ25tZW50c1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgc2V0IG9mIHJvbGUgYXNzaWdubWVudHMgZm9yIHRoaXMgaXRlbVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUm9sZUFzc2lnbm1lbnRzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNoYXJlUG9pbnRRdWVyeWFibGVTZWN1cmFibGUucHJvdG90eXBlLCBcImZpcnN0VW5pcXVlQW5jZXN0b3JTZWN1cmFibGVPYmplY3RcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGNsb3Nlc3Qgc2VjdXJhYmxlIHVwIHRoZSBzZWN1cml0eSBoaWVyYXJjaHkgd2hvc2UgcGVybWlzc2lvbnMgYXJlIGFwcGxpZWQgdG8gdGhpcyBsaXN0IGl0ZW1cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSh0aGlzLCBcIkZpcnN0VW5pcXVlQW5jZXN0b3JTZWN1cmFibGVPYmplY3RcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIGVmZmVjdGl2ZSBwZXJtaXNzaW9ucyBmb3IgdGhlIHVzZXIgc3VwcGxpZWRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbG9naW5OYW1lIFRoZSBjbGFpbXMgdXNlcm5hbWUgZm9yIHRoZSB1c2VyIChleDogaTowIy5mfG1lbWJlcnNoaXB8dXNlckBkb21haW4uY29tKVxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2VjdXJhYmxlLnByb3RvdHlwZS5nZXRVc2VyRWZmZWN0aXZlUGVybWlzc2lvbnMgPSBmdW5jdGlvbiAobG9naW5OYW1lKSB7XHJcbiAgICAgICAgdmFyIHEgPSB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGUsIFwiZ2V0VXNlckVmZmVjdGl2ZVBlcm1pc3Npb25zKEB1c2VyKVwiKTtcclxuICAgICAgICBxLnF1ZXJ5LnNldChcIkB1c2VyXCIsIFwiJ1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KGxvZ2luTmFtZSkgKyBcIidcIik7XHJcbiAgICAgICAgcmV0dXJuIHEuZ2V0KCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAvLyBoYW5kbGUgdmVyYm9zZSBtb2RlXHJcbiAgICAgICAgICAgIHJldHVybiBoT1AociwgXCJHZXRVc2VyRWZmZWN0aXZlUGVybWlzc2lvbnNcIikgPyByLkdldFVzZXJFZmZlY3RpdmVQZXJtaXNzaW9ucyA6IHI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBlZmZlY3RpdmUgcGVybWlzc2lvbnMgZm9yIHRoZSBjdXJyZW50IHVzZXJcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZS5wcm90b3R5cGUuZ2V0Q3VycmVudFVzZXJFZmZlY3RpdmVQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIC8vIHJlbW92ZSBuZWVkIHRvIHJlZmVyZW5jZSBXZWIgaGVyZSwgd2hpY2ggY3JlYXRlZCBhIGNpcmN1bGFyIGJ1aWxkIGlzc3VlXHJcbiAgICAgICAgdmFyIHcgPSBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKFwiX2FwaS93ZWJcIiwgXCJjdXJyZW50dXNlclwiKTtcclxuICAgICAgICByZXR1cm4gdy5zZWxlY3QoXCJMb2dpbk5hbWVcIikuZ2V0KCkudGhlbihmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0VXNlckVmZmVjdGl2ZVBlcm1pc3Npb25zKHVzZXIuTG9naW5OYW1lKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEJyZWFrcyB0aGUgc2VjdXJpdHkgaW5oZXJpdGFuY2UgYXQgdGhpcyBsZXZlbCBvcHRpbmFsbHkgY29weWluZyBwZXJtaXNzaW9ucyBhbmQgY2xlYXJpbmcgc3Vic2NvcGVzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvcHlSb2xlQXNzaWdubWVudHMgSWYgdHJ1ZSB0aGUgcGVybWlzc2lvbnMgYXJlIGNvcGllZCBmcm9tIHRoZSBjdXJyZW50IHBhcmVudCBzY29wZVxyXG4gICAgICogQHBhcmFtIGNsZWFyU3Vic2NvcGVzIE9wdGlvbmFsLiB0cnVlIHRvIG1ha2UgYWxsIGNoaWxkIHNlY3VyYWJsZSBvYmplY3RzIGluaGVyaXQgcm9sZSBhc3NpZ25tZW50cyBmcm9tIHRoZSBjdXJyZW50IG9iamVjdFxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2VjdXJhYmxlLnByb3RvdHlwZS5icmVha1JvbGVJbmhlcml0YW5jZSA9IGZ1bmN0aW9uIChjb3B5Um9sZUFzc2lnbm1lbnRzLCBjbGVhclN1YnNjb3Blcykge1xyXG4gICAgICAgIGlmIChjb3B5Um9sZUFzc2lnbm1lbnRzID09PSB2b2lkIDApIHsgY29weVJvbGVBc3NpZ25tZW50cyA9IGZhbHNlOyB9XHJcbiAgICAgICAgaWYgKGNsZWFyU3Vic2NvcGVzID09PSB2b2lkIDApIHsgY2xlYXJTdWJzY29wZXMgPSBmYWxzZTsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTZWN1cmFibGUsIFwiYnJlYWtyb2xlaW5oZXJpdGFuY2UoY29weXJvbGVhc3NpZ25tZW50cz1cIiArIGNvcHlSb2xlQXNzaWdubWVudHMgKyBcIiwgY2xlYXJzdWJzY29wZXM9XCIgKyBjbGVhclN1YnNjb3BlcyArIFwiKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyB0aGUgbG9jYWwgcm9sZSBhc3NpZ25tZW50cyBzbyB0aGF0IGl0IHJlLWluaGVyaXQgcm9sZSBhc3NpZ25tZW50cyBmcm9tIHRoZSBwYXJlbnQgb2JqZWN0LlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZS5wcm90b3R5cGUucmVzZXRSb2xlSW5oZXJpdGFuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZSwgXCJyZXNldHJvbGVpbmhlcml0YW5jZVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRGV0ZXJtaW5lcyBpZiBhIGdpdmVuIHVzZXIgaGFzIHRoZSBhcHByb3ByaWF0ZSBwZXJtaXNzaW9uc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsb2dpbk5hbWUgVGhlIHVzZXIgdG8gY2hlY2tcclxuICAgICAqIEBwYXJhbSBwZXJtaXNzaW9uIFRoZSBwZXJtaXNzaW9uIGJlaW5nIGNoZWNrZWRcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZS5wcm90b3R5cGUudXNlckhhc1Blcm1pc3Npb25zID0gZnVuY3Rpb24gKGxvZ2luTmFtZSwgcGVybWlzc2lvbikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VXNlckVmZmVjdGl2ZVBlcm1pc3Npb25zKGxvZ2luTmFtZSkudGhlbihmdW5jdGlvbiAocGVybXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmhhc1Blcm1pc3Npb25zKHBlcm1zLCBwZXJtaXNzaW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERldGVybWluZXMgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgdGhlIHJlcXVlc3RlZCBwZXJtaXNzaW9uc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwZXJtaXNzaW9uIFRoZSBwZXJtaXNzaW9uIHdlIHdpc2ggdG8gY2hlY2tcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZS5wcm90b3R5cGUuY3VycmVudFVzZXJIYXNQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uIChwZXJtaXNzaW9uKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDdXJyZW50VXNlckVmZmVjdGl2ZVBlcm1pc3Npb25zKCkudGhlbihmdW5jdGlvbiAocGVybXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmhhc1Blcm1pc3Npb25zKHBlcm1zLCBwZXJtaXNzaW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFRha2VuIGZyb20gc3AuanMsIGNoZWNrcyB0aGUgc3VwcGxpZWQgcGVybWlzc2lvbnMgYWdhaW5zdCB0aGUgbWFza1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB2YWx1ZSBUaGUgc2VjdXJpdHkgcHJpbmNpcGFsJ3MgcGVybWlzc2lvbnMgb24gdGhlIGdpdmVuIG9iamVjdFxyXG4gICAgICogQHBhcmFtIHBlcm0gVGhlIHBlcm1pc3Npb24gY2hlY2tlZCBhZ2FpbnN0IHRoZSB2YWx1ZVxyXG4gICAgICovXHJcbiAgICAvKiB0c2xpbnQ6ZGlzYWJsZTpuby1iaXR3aXNlICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2VjdXJhYmxlLnByb3RvdHlwZS5oYXNQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uICh2YWx1ZSwgcGVybSkge1xyXG4gICAgICAgIGlmICghcGVybSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHBlcm0gPT09IFBlcm1pc3Npb25LaW5kLkZ1bGxNYXNrKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAodmFsdWUuSGlnaCAmIDMyNzY3KSA9PT0gMzI3NjcgJiYgdmFsdWUuTG93ID09PSA2NTUzNTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGVybSA9IHBlcm0gLSAxO1xyXG4gICAgICAgIHZhciBudW0gPSAxO1xyXG4gICAgICAgIGlmIChwZXJtID49IDAgJiYgcGVybSA8IDMyKSB7XHJcbiAgICAgICAgICAgIG51bSA9IG51bSA8PCBwZXJtO1xyXG4gICAgICAgICAgICByZXR1cm4gMCAhPT0gKHZhbHVlLkxvdyAmIG51bSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBlcm0gPj0gMzIgJiYgcGVybSA8IDY0KSB7XHJcbiAgICAgICAgICAgIG51bSA9IG51bSA8PCBwZXJtIC0gMzI7XHJcbiAgICAgICAgICAgIHJldHVybiAwICE9PSAodmFsdWUuSGlnaCAmIG51bSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZTtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcblxuLyoqXHJcbiAqIEludGVybmFsIGhlbHBlciBjbGFzcyB1c2VkIHRvIGF1Z21lbnQgY2xhc3NlcyB0byBpbmNsdWRlIHNoYXJpbmcgZnVuY3Rpb25hbGl0eVxyXG4gKi9cclxudmFyIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgc2hhcmluZyBsaW5rIGZvciB0aGUgc3VwcGxpZWRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2luZCBUaGUga2luZCBvZiBsaW5rIHRvIHNoYXJlXHJcbiAgICAgKiBAcGFyYW0gZXhwaXJhdGlvbiBUaGUgb3B0aW9uYWwgZXhwaXJhdGlvbiBmb3IgdGhpcyBsaW5rXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUucHJvdG90eXBlLmdldFNoYXJlTGluayA9IGZ1bmN0aW9uIChraW5kLCBleHBpcmF0aW9uKSB7XHJcbiAgICAgICAgaWYgKGV4cGlyYXRpb24gPT09IHZvaWQgMCkgeyBleHBpcmF0aW9uID0gbnVsbDsgfVxyXG4gICAgICAgIC8vIGRhdGUgbmVlZHMgdG8gYmUgYW4gSVNPIHN0cmluZyBvciBudWxsXHJcbiAgICAgICAgdmFyIGV4cFN0cmluZyA9IGV4cGlyYXRpb24gIT09IG51bGwgPyBleHBpcmF0aW9uLnRvSVNPU3RyaW5nKCkgOiBudWxsO1xyXG4gICAgICAgIC8vIGNsb25lIHVzaW5nIHRoZSBmYWN0b3J5IGFuZCBzZW5kIHRoZSByZXF1ZXN0XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgXCJzaGFyZUxpbmtcIikucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgcmVxdWVzdDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZUxpbms6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWxEYXRhOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb246IGV4cFN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0tpbmQ6IGtpbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2hhcmVzIHRoaXMgaW5zdGFuY2Ugd2l0aCB0aGUgc3VwcGxpZWQgdXNlcnNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbG9naW5OYW1lcyBSZXNvbHZlZCBsb2dpbiBuYW1lcyB0byBzaGFyZVxyXG4gICAgICogQHBhcmFtIHJvbGUgVGhlIHJvbGVcclxuICAgICAqIEBwYXJhbSByZXF1aXJlU2lnbmluIFRydWUgdG8gcmVxdWlyZSB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkLCBvdGhlcndpc2UgZmFsc2VcclxuICAgICAqIEBwYXJhbSBwcm9wYWdhdGVBY2wgVHJ1ZSB0byBhcHBseSB0aGlzIHNoYXJlIHRvIGFsbCBjaGlsZHJlblxyXG4gICAgICogQHBhcmFtIGVtYWlsRGF0YSBJZiBzdXBwbGllZCBhbiBlbWFpbCB3aWxsIGJlIHNlbnQgd2l0aCB0aGUgaW5kaWNhdGVkIHByb3BlcnRpZXNcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZS5wcm90b3R5cGUuc2hhcmVXaXRoID0gZnVuY3Rpb24gKGxvZ2luTmFtZXMsIHJvbGUsIHJlcXVpcmVTaWduaW4sIHByb3BhZ2F0ZUFjbCwgZW1haWxEYXRhKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAocmVxdWlyZVNpZ25pbiA9PT0gdm9pZCAwKSB7IHJlcXVpcmVTaWduaW4gPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmIChwcm9wYWdhdGVBY2wgPT09IHZvaWQgMCkgeyBwcm9wYWdhdGVBY2wgPSBmYWxzZTsgfVxyXG4gICAgICAgIC8vIGhhbmRsZSB0aGUgbXVsdGlwbGUgaW5wdXQgdHlwZXNcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobG9naW5OYW1lcykpIHtcclxuICAgICAgICAgICAgbG9naW5OYW1lcyA9IFtsb2dpbk5hbWVzXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHVzZXJTdHIgPSBqc1MobG9naW5OYW1lcy5tYXAoZnVuY3Rpb24gKGxvZ2luKSB7IHJldHVybiB7IEtleTogbG9naW4gfTsgfSkpO1xyXG4gICAgICAgIHZhciByb2xlRmlsdGVyID0gcm9sZSA9PT0gU2hhcmluZ1JvbGUuRWRpdCA/IFJvbGVUeXBlLkNvbnRyaWJ1dG9yIDogUm9sZVR5cGUuUmVhZGVyO1xyXG4gICAgICAgIC8vIHN0YXJ0IGJ5IGxvb2tpbmcgdXAgdGhlIHJvbGUgZGVmaW5pdGlvbiBpZCB3ZSBuZWVkIHRvIHNldCB0aGUgcm9sZVZhbHVlXHJcbiAgICAgICAgLy8gcmVtb3ZlIG5lZWQgdG8gcmVmZXJlbmNlIFdlYiBoZXJlLCB3aGljaCBjcmVhdGVkIGEgY2lyY3VsYXIgYnVpbGQgaXNzdWVcclxuICAgICAgICB2YXIgdyA9IG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbihcIl9hcGkvd2ViXCIsIFwicm9sZWRlZmluaXRpb25zXCIpO1xyXG4gICAgICAgIHJldHVybiB3LnNlbGVjdChcIklkXCIpLmZpbHRlcihcIlJvbGVUeXBlS2luZCBlcSBcIiArIHJvbGVGaWx0ZXIpLmdldCgpLnRoZW4oZnVuY3Rpb24gKGRlZikge1xyXG4gICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGVmKSB8fCBkZWYubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGxvY2F0ZSBhIHJvbGUgZGVmaW50aW9uIHdpdGggUm9sZVR5cGVLaW5kIFwiICsgcm9sZUZpbHRlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHBvc3RCb2R5ID0ge1xyXG4gICAgICAgICAgICAgICAgaW5jbHVkZUFub255bW91c0xpbmtJbkVtYWlsOiByZXF1aXJlU2lnbmluLFxyXG4gICAgICAgICAgICAgICAgcGVvcGxlUGlja2VySW5wdXQ6IHVzZXJTdHIsXHJcbiAgICAgICAgICAgICAgICBwcm9wYWdhdGVBY2w6IHByb3BhZ2F0ZUFjbCxcclxuICAgICAgICAgICAgICAgIHJvbGVWYWx1ZTogXCJyb2xlOlwiICsgZGVmWzBdLklkLFxyXG4gICAgICAgICAgICAgICAgdXNlU2ltcGxpZmllZFJvbGVzOiB0cnVlLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoZW1haWxEYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHBvc3RCb2R5ID0gZXh0ZW5kKHBvc3RCb2R5LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWxCb2R5OiBlbWFpbERhdGEuYm9keSxcclxuICAgICAgICAgICAgICAgICAgICBlbWFpbFN1YmplY3Q6IGVtYWlsRGF0YS5zdWJqZWN0ICE9PSB1bmRlZmluZWQgPyBlbWFpbERhdGEuc3ViamVjdCA6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VuZEVtYWlsOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUsIFwic2hhcmVPYmplY3RcIikucG9zdENvcmUoe1xyXG4gICAgICAgICAgICAgICAgYm9keToganNTKHBvc3RCb2R5KSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTaGFyZXMgYW4gb2JqZWN0IGJhc2VkIG9uIHRoZSBzdXBwbGllZCBvcHRpb25zXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgVGhlIHNldCBvZiBvcHRpb25zIHRvIHNlbmQgdG8gdGhlIFNoYXJlT2JqZWN0IG1ldGhvZFxyXG4gICAgICogQHBhcmFtIGJ5cGFzcyBJZiB0cnVlIGFueSBwcm9jZXNzaW5nIGlzIHNraXBwZWQgYW5kIHRoZSBvcHRpb25zIGFyZSBzZW50IGRpcmVjdGx5IHRvIHRoZSBTaGFyZU9iamVjdCBtZXRob2RcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZS5wcm90b3R5cGUuc2hhcmVPYmplY3QgPSBmdW5jdGlvbiAob3B0aW9ucywgYnlwYXNzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoYnlwYXNzID09PSB2b2lkIDApIHsgYnlwYXNzID0gZmFsc2U7IH1cclxuICAgICAgICBpZiAoYnlwYXNzKSB7XHJcbiAgICAgICAgICAgIC8vIGlmIHRoZSBieXBhc3MgZmxhZyBpcyBzZXQgc2VuZCB0aGUgc3VwcGxpZWQgcGFyYW1ldGVycyBkaXJlY3RseSB0byB0aGUgc2VydmljZVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZW5kU2hhcmVPYmplY3RSZXF1ZXN0KG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBleHRlbmQgb3VyIG9wdGlvbnMgd2l0aCBzb21lIGRlZmF1bHRzXHJcbiAgICAgICAgb3B0aW9ucyA9IGV4dGVuZChvcHRpb25zLCB7XHJcbiAgICAgICAgICAgIGdyb3VwOiBudWxsLFxyXG4gICAgICAgICAgICBpbmNsdWRlQW5vbnltb3VzTGlua0luRW1haWw6IGZhbHNlLFxyXG4gICAgICAgICAgICBwcm9wYWdhdGVBY2w6IGZhbHNlLFxyXG4gICAgICAgICAgICB1c2VTaW1wbGlmaWVkUm9sZXM6IHRydWUsXHJcbiAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Um9sZVZhbHVlKG9wdGlvbnMucm9sZSwgb3B0aW9ucy5ncm91cCkudGhlbihmdW5jdGlvbiAocm9sZVZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgbXVsdGlwbGUgaW5wdXQgdHlwZXNcclxuICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG9wdGlvbnMubG9naW5OYW1lcykpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMubG9naW5OYW1lcyA9IFtvcHRpb25zLmxvZ2luTmFtZXNdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB1c2VyU3RyID0ganNTKG9wdGlvbnMubG9naW5OYW1lcy5tYXAoZnVuY3Rpb24gKGxvZ2luKSB7IHJldHVybiB7IEtleTogbG9naW4gfTsgfSkpO1xyXG4gICAgICAgICAgICB2YXIgcG9zdEJvZHkgPSB7XHJcbiAgICAgICAgICAgICAgICBwZW9wbGVQaWNrZXJJbnB1dDogdXNlclN0cixcclxuICAgICAgICAgICAgICAgIHJvbGVWYWx1ZTogcm9sZVZhbHVlLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBvcHRpb25zLnVybCxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZW1haWxEYXRhICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5lbWFpbERhdGEgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHBvc3RCb2R5ID0gZXh0ZW5kKHBvc3RCb2R5LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWxCb2R5OiBvcHRpb25zLmVtYWlsRGF0YS5ib2R5LFxyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsU3ViamVjdDogb3B0aW9ucy5lbWFpbERhdGEuc3ViamVjdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5lbWFpbERhdGEuc3ViamVjdCA6IFwiU2hhcmVkIHdpdGggeW91LlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbmRFbWFpbDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZW5kU2hhcmVPYmplY3RSZXF1ZXN0KHBvc3RCb2R5KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENhbGxzIHRoZSB3ZWIncyBVbnNoYXJlT2JqZWN0IG1ldGhvZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cmwgVGhlIHVybCBvZiB0aGUgb2JqZWN0IHRvIHVuc2hhcmVcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZS5wcm90b3R5cGUudW5zaGFyZU9iamVjdFdlYiA9IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBcInVuc2hhcmVPYmplY3RcIikucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2tzIFBlcm1pc3Npb25zIG9uIHRoZSBsaXN0IG9mIFVzZXJzIGFuZCByZXR1cm5zIGJhY2sgcm9sZSB0aGUgdXNlcnMgaGF2ZSBvbiB0aGUgSXRlbS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcmVjaXBpZW50cyBUaGUgYXJyYXkgb2YgRW50aXRpZXMgZm9yIHdoaWNoIFBlcm1pc3Npb25zIG5lZWQgdG8gYmUgY2hlY2tlZC5cclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZS5wcm90b3R5cGUuY2hlY2tQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uIChyZWNpcGllbnRzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgXCJjaGVja1Blcm1pc3Npb25zXCIpLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHtcclxuICAgICAgICAgICAgICAgIHJlY2lwaWVudHM6IHJlY2lwaWVudHMsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0IFNoYXJpbmcgSW5mb3JtYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHJlcXVlc3QgVGhlIFNoYXJpbmdJbmZvcm1hdGlvblJlcXVlc3QgT2JqZWN0LlxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLnByb3RvdHlwZS5nZXRTaGFyaW5nSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIGlmIChyZXF1ZXN0ID09PSB2b2lkIDApIHsgcmVxdWVzdCA9IG51bGw7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBcImdldFNoYXJpbmdJbmZvcm1hdGlvblwiKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0OiByZXF1ZXN0LFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIHNoYXJpbmcgc2V0dGluZ3Mgb2YgYW4gaXRlbS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXNlU2ltcGxpZmllZFJvbGVzIERldGVybWluZXMgd2hldGhlciB0byB1c2Ugc2ltcGxpZmllZCByb2xlcy5cclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZS5wcm90b3R5cGUuZ2V0T2JqZWN0U2hhcmluZ1NldHRpbmdzID0gZnVuY3Rpb24gKHVzZVNpbXBsaWZpZWRSb2xlcykge1xyXG4gICAgICAgIGlmICh1c2VTaW1wbGlmaWVkUm9sZXMgPT09IHZvaWQgMCkgeyB1c2VTaW1wbGlmaWVkUm9sZXMgPSB0cnVlOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgXCJnZXRPYmplY3RTaGFyaW5nU2V0dGluZ3NcIikucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgdXNlU2ltcGxpZmllZFJvbGVzOiB1c2VTaW1wbGlmaWVkUm9sZXMsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVW5zaGFyZXMgdGhpcyBvYmplY3RcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZS5wcm90b3R5cGUudW5zaGFyZU9iamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBcInVuc2hhcmVPYmplY3RcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZXMgYSBsaW5rIGJ5IHR5cGVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2luZCBEZWxldGVzIGEgc2hhcmluZyBsaW5rIGJ5IHRoZSBraW5kIG9mIGxpbmtcclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZS5wcm90b3R5cGUuZGVsZXRlTGlua0J5S2luZCA9IGZ1bmN0aW9uIChraW5kKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgXCJkZWxldGVMaW5rQnlLaW5kXCIpLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHsgbGlua0tpbmQ6IGtpbmQgfSksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgbGluayB0byB0aGUgaXRlbS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2luZCBUaGUga2luZCBvZiBsaW5rIHRvIGJlIGRlbGV0ZWQuXHJcbiAgICAgKiBAcGFyYW0gc2hhcmVJZFxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLnByb3RvdHlwZS51bnNoYXJlTGluayA9IGZ1bmN0aW9uIChraW5kLCBzaGFyZUlkKSB7XHJcbiAgICAgICAgaWYgKHNoYXJlSWQgPT09IHZvaWQgMCkgeyBzaGFyZUlkID0gXCIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDBcIjsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUsIFwidW5zaGFyZUxpbmtcIikucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1MoeyBsaW5rS2luZDoga2luZCwgc2hhcmVJZDogc2hhcmVJZCB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENhbGN1bGF0ZXMgdGhlIHJvbGVWYWx1ZSBzdHJpbmcgdXNlZCBpbiB0aGUgc2hhcmluZyBxdWVyeVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb2xlIFRoZSBTaGFyaW5nIFJvbGVcclxuICAgICAqIEBwYXJhbSBncm91cCBUaGUgR3JvdXAgdHlwZVxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLnByb3RvdHlwZS5nZXRSb2xlVmFsdWUgPSBmdW5jdGlvbiAocm9sZSwgZ3JvdXApIHtcclxuICAgICAgICAvLyB3ZSB3aWxsIGdpdmUgZ3JvdXAgcHJlY2VkZW5jZSwgYmVjYXVzZSB3ZSBoYWQgdG8gbWFrZSBhIGNob2ljZVxyXG4gICAgICAgIGlmIChncm91cCAhPT0gdW5kZWZpbmVkICYmIGdyb3VwICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZ3JvdXApIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgUm9sZVR5cGUuQ29udHJpYnV0b3I6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIG5lZWQgdG8gcmVmZXJlbmNlIFdlYiBoZXJlLCB3aGljaCBjcmVhdGVkIGEgY2lyY3VsYXIgYnVpbGQgaXNzdWVcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVtYmVyR3JvdXAgPSBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKFwiX2FwaS93ZWJcIiwgXCJhc3NvY2lhdGVkbWVtYmVyZ3JvdXBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lbWJlckdyb3VwLnNlbGVjdChcIklkXCIpLmdldCgpLnRoZW4oZnVuY3Rpb24gKGcpIHsgcmV0dXJuIFwiZ3JvdXA6IFwiICsgZy5JZDsgfSk7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFJvbGVUeXBlLlJlYWRlcjpcclxuICAgICAgICAgICAgICAgIGNhc2UgUm9sZVR5cGUuR3Vlc3Q6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIG5lZWQgdG8gcmVmZXJlbmNlIFdlYiBoZXJlLCB3aGljaCBjcmVhdGVkIGEgY2lyY3VsYXIgYnVpbGQgaXNzdWVcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmlzaXRvckdyb3VwID0gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZShcIl9hcGkvd2ViXCIsIFwiYXNzb2NpYXRlZHZpc2l0b3Jncm91cFwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlzaXRvckdyb3VwLnNlbGVjdChcIklkXCIpLmdldCgpLnRoZW4oZnVuY3Rpb24gKGcpIHsgcmV0dXJuIFwiZ3JvdXA6IFwiICsgZy5JZDsgfSk7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBkZXRlcm1pbmUgcm9sZSB2YWx1ZSBmb3Igc3VwcGxpZWQgdmFsdWUuIENvbnRyaWJ1dG9yLCBSZWFkZXIsIGFuZCBHdWVzdCBhcmUgc3VwcG9ydGVkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgcm9sZUZpbHRlciA9IHJvbGUgPT09IFNoYXJpbmdSb2xlLkVkaXQgPyBSb2xlVHlwZS5Db250cmlidXRvciA6IFJvbGVUeXBlLlJlYWRlcjtcclxuICAgICAgICAgICAgLy8gcmVtb3ZlIG5lZWQgdG8gcmVmZXJlbmNlIFdlYiBoZXJlLCB3aGljaCBjcmVhdGVkIGEgY2lyY3VsYXIgYnVpbGQgaXNzdWVcclxuICAgICAgICAgICAgdmFyIHJvbGVEZWZzID0gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKFwiX2FwaS93ZWJcIiwgXCJyb2xlZGVmaW5pdGlvbnNcIik7XHJcbiAgICAgICAgICAgIHJldHVybiByb2xlRGVmcy5zZWxlY3QoXCJJZFwiKS50b3AoMSkuZmlsdGVyKFwiUm9sZVR5cGVLaW5kIGVxIFwiICsgcm9sZUZpbHRlcikuZ2V0KCkudGhlbihmdW5jdGlvbiAoZGVmKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGVmLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgbG9jYXRlIGFzc29jaWF0ZWQgcm9sZSBkZWZpbml0aW9uIGZvciBzdXBwbGllZCByb2xlLiBFZGl0IGFuZCBWaWV3IGFyZSBzdXBwb3J0ZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJyb2xlOiBcIiArIGRlZlswXS5JZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUucHJvdG90eXBlLmdldFNoYXJlT2JqZWN0V2ViID0gZnVuY3Rpb24gKGNhbmRpZGF0ZSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZShleHRyYWN0V2ViVXJsKGNhbmRpZGF0ZSksIFwiL19hcGkvU1AuV2ViLlNoYXJlT2JqZWN0XCIpKTtcclxuICAgIH07XHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLnByb3RvdHlwZS5zZW5kU2hhcmVPYmplY3RSZXF1ZXN0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRTaGFyZU9iamVjdFdlYih0aGlzLnRvVXJsKCkpLnRoZW4oZnVuY3Rpb24gKHdlYikge1xyXG4gICAgICAgICAgICByZXR1cm4gd2ViLmV4cGFuZChcIlVzZXJzV2l0aEFjY2Vzc1JlcXVlc3RzXCIsIFwiR3JvdXBzU2hhcmVkV2l0aFwiKS5hcyhTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgICAgICBib2R5OiBqc1Mob3B0aW9ucyksXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGUpKTtcclxudmFyIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVXZWIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZVdlYiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVXZWIoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTaGFyZXMgdGhpcyB3ZWIgd2l0aCB0aGUgc3VwcGxpZWQgdXNlcnNcclxuICAgICAqIEBwYXJhbSBsb2dpbk5hbWVzIFRoZSByZXNvbHZlZCBsb2dpbiBuYW1lcyB0byBzaGFyZVxyXG4gICAgICogQHBhcmFtIHJvbGUgVGhlIHJvbGUgdG8gc2hhcmUgdGhpcyB3ZWJcclxuICAgICAqIEBwYXJhbSBlbWFpbERhdGEgT3B0aW9uYWwgZW1haWwgZGF0YVxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlV2ViLnByb3RvdHlwZS5zaGFyZVdpdGggPSBmdW5jdGlvbiAobG9naW5OYW1lcywgcm9sZSwgZW1haWxEYXRhKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAocm9sZSA9PT0gdm9pZCAwKSB7IHJvbGUgPSBTaGFyaW5nUm9sZS5WaWV3OyB9XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgIC8vIHJlbW92ZSBuZWVkIHRvIHJlZmVyZW5jZSBXZWIgaGVyZSwgd2hpY2ggY3JlYXRlZCBhIGNpcmN1bGFyIGJ1aWxkIGlzc3VlXHJcbiAgICAgICAgdmFyIHdlYiA9IG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UoZXh0cmFjdFdlYlVybCh0aGlzLnRvVXJsKCkpLCBcIi9fYXBpL3dlYi91cmxcIik7XHJcbiAgICAgICAgcmV0dXJuIHdlYi5nZXQoKS50aGVuKGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgICAgICAgZGVwZW5kZW5jeSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuc2hhcmVPYmplY3QoY29tYmluZSh1cmwsIFwiL19sYXlvdXRzLzE1L2FjbGludi5hc3B4P2ZvclNoYXJpbmc9MSZtYnlwYXNzPTFcIiksIGxvZ2luTmFtZXMsIHJvbGUsIGVtYWlsRGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBQcm92aWRlcyBkaXJlY3QgYWNjZXNzIHRvIHRoZSBzdGF0aWMgd2ViLlNoYXJlT2JqZWN0IG1ldGhvZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cmwgVGhlIHVybCB0byBzaGFyZVxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZXMgUmVzb2x2ZWQgbG9naW5uYW1lcyBzdHJpbmdbXSBvZiBhIHNpbmdsZSBsb2dpbiBuYW1lIHN0cmluZ1xyXG4gICAgICogQHBhcmFtIHJvbGVWYWx1ZSBSb2xlIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0gZW1haWxEYXRhIE9wdGlvbmFsIGVtYWlsIGRhdGFcclxuICAgICAqIEBwYXJhbSBncm91cElkIE9wdGlvbmFsIGdyb3VwIGlkXHJcbiAgICAgKiBAcGFyYW0gcHJvcGFnYXRlQWNsXHJcbiAgICAgKiBAcGFyYW0gaW5jbHVkZUFub255bW91c0xpbmtJbkVtYWlsXHJcbiAgICAgKiBAcGFyYW0gdXNlU2ltcGxpZmllZFJvbGVzXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVXZWIucHJvdG90eXBlLnNoYXJlT2JqZWN0ID0gZnVuY3Rpb24gKHVybCwgbG9naW5OYW1lcywgcm9sZSwgZW1haWxEYXRhLCBncm91cCwgcHJvcGFnYXRlQWNsLCBpbmNsdWRlQW5vbnltb3VzTGlua0luRW1haWwsIHVzZVNpbXBsaWZpZWRSb2xlcykge1xyXG4gICAgICAgIGlmIChwcm9wYWdhdGVBY2wgPT09IHZvaWQgMCkgeyBwcm9wYWdhdGVBY2wgPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmIChpbmNsdWRlQW5vbnltb3VzTGlua0luRW1haWwgPT09IHZvaWQgMCkgeyBpbmNsdWRlQW5vbnltb3VzTGlua0luRW1haWwgPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmICh1c2VTaW1wbGlmaWVkUm9sZXMgPT09IHZvaWQgMCkgeyB1c2VTaW1wbGlmaWVkUm9sZXMgPSB0cnVlOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgbnVsbCkuc2hhcmVPYmplY3Qoe1xyXG4gICAgICAgICAgICBlbWFpbERhdGE6IGVtYWlsRGF0YSxcclxuICAgICAgICAgICAgZ3JvdXA6IGdyb3VwLFxyXG4gICAgICAgICAgICBpbmNsdWRlQW5vbnltb3VzTGlua0luRW1haWw6IGluY2x1ZGVBbm9ueW1vdXNMaW5rSW5FbWFpbCxcclxuICAgICAgICAgICAgbG9naW5OYW1lczogbG9naW5OYW1lcyxcclxuICAgICAgICAgICAgcHJvcGFnYXRlQWNsOiBwcm9wYWdhdGVBY2wsXHJcbiAgICAgICAgICAgIHJvbGU6IHJvbGUsXHJcbiAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICB1c2VTaW1wbGlmaWVkUm9sZXM6IHVzZVNpbXBsaWZpZWRSb2xlcyxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFN1cHBsaWVzIGEgbWV0aG9kIHRvIHBhc3MgYW55IHNldCBvZiBhcmd1bWVudHMgdG8gU2hhcmVPYmplY3RcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgc2V0IG9mIG9wdGlvbnMgdG8gc2VuZCB0byBTaGFyZU9iamVjdFxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlV2ViLnByb3RvdHlwZS5zaGFyZU9iamVjdFJhdyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgbnVsbCkuc2hhcmVPYmplY3Qob3B0aW9ucywgdHJ1ZSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVbnNoYXJlcyB0aGUgb2JqZWN0XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVybCBUaGUgdXJsIG9mIHRoZSBvYmplY3QgdG8gc3RvcCBzaGFyaW5nXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVXZWIucHJvdG90eXBlLnVuc2hhcmVPYmplY3QgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZSwgbnVsbCkudW5zaGFyZU9iamVjdFdlYih1cmwpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlV2ViO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVTZWN1cmFibGUpKTtcclxudmFyIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVJdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVJdGVtLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUl0ZW0oKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgbGluayBzdWl0YWJsZSBmb3Igc2hhcmluZyBmb3IgdGhpcyBpdGVtXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGtpbmQgVGhlIHR5cGUgb2YgbGluayB0byBzaGFyZVxyXG4gICAgICogQHBhcmFtIGV4cGlyYXRpb24gVGhlIG9wdGlvbmFsIGV4cGlyYXRpb24gZGF0ZVxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlSXRlbS5wcm90b3R5cGUuZ2V0U2hhcmVMaW5rID0gZnVuY3Rpb24gKGtpbmQsIGV4cGlyYXRpb24pIHtcclxuICAgICAgICBpZiAoa2luZCA9PT0gdm9pZCAwKSB7IGtpbmQgPSBTaGFyaW5nTGlua0tpbmQuT3JnYW5pemF0aW9uVmlldzsgfVxyXG4gICAgICAgIGlmIChleHBpcmF0aW9uID09PSB2b2lkIDApIHsgZXhwaXJhdGlvbiA9IG51bGw7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBudWxsKS5nZXRTaGFyZUxpbmsoa2luZCwgZXhwaXJhdGlvbik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTaGFyZXMgdGhpcyBpdGVtIHdpdGggb25lIG9yIG1vcmUgdXNlcnNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbG9naW5OYW1lcyBzdHJpbmcgb3Igc3RyaW5nW10gb2YgcmVzb2x2ZWQgbG9naW4gbmFtZXMgdG8gd2hpY2ggdGhpcyBpdGVtIHdpbGwgYmUgc2hhcmVkXHJcbiAgICAgKiBAcGFyYW0gcm9sZSBUaGUgcm9sZSAoVmlldyB8IEVkaXQpIGFwcGxpZWQgdG8gdGhlIHNoYXJlXHJcbiAgICAgKiBAcGFyYW0gZW1haWxEYXRhIE9wdGlvbmFsLCBpZiBpbmx1Y2RlZCBhbiBlbWFpbCB3aWxsIGJlIHNlbnQuIE5vdGUgc3ViamVjdCBjdXJyZW50bHkgaGFzIG5vIGVmZmVjdC5cclxuICAgICAqL1xyXG4gICAgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUl0ZW0ucHJvdG90eXBlLnNoYXJlV2l0aCA9IGZ1bmN0aW9uIChsb2dpbk5hbWVzLCByb2xlLCByZXF1aXJlU2lnbmluLCBlbWFpbERhdGEpIHtcclxuICAgICAgICBpZiAocm9sZSA9PT0gdm9pZCAwKSB7IHJvbGUgPSBTaGFyaW5nUm9sZS5WaWV3OyB9XHJcbiAgICAgICAgaWYgKHJlcXVpcmVTaWduaW4gPT09IHZvaWQgMCkgeyByZXF1aXJlU2lnbmluID0gZmFsc2U7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBudWxsKS5zaGFyZVdpdGgobG9naW5OYW1lcywgcm9sZSwgcmVxdWlyZVNpZ25pbiwgZmFsc2UsIGVtYWlsRGF0YSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVja3MgUGVybWlzc2lvbnMgb24gdGhlIGxpc3Qgb2YgVXNlcnMgYW5kIHJldHVybnMgYmFjayByb2xlIHRoZSB1c2VycyBoYXZlIG9uIHRoZSBJdGVtLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByZWNpcGllbnRzIFRoZSBhcnJheSBvZiBFbnRpdGllcyBmb3Igd2hpY2ggUGVybWlzc2lvbnMgbmVlZCB0byBiZSBjaGVja2VkLlxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlSXRlbS5wcm90b3R5cGUuY2hlY2tTaGFyaW5nUGVybWlzc2lvbnMgPSBmdW5jdGlvbiAocmVjaXBpZW50cykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUsIG51bGwpLmNoZWNrUGVybWlzc2lvbnMocmVjaXBpZW50cyk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgU2hhcmluZyBJbmZvcm1hdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcmVxdWVzdCBUaGUgU2hhcmluZ0luZm9ybWF0aW9uUmVxdWVzdCBPYmplY3QuXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVJdGVtLnByb3RvdHlwZS5nZXRTaGFyaW5nSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIGlmIChyZXF1ZXN0ID09PSB2b2lkIDApIHsgcmVxdWVzdCA9IG51bGw7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBudWxsKS5nZXRTaGFyaW5nSW5mb3JtYXRpb24ocmVxdWVzdCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBzaGFyaW5nIHNldHRpbmdzIG9mIGFuIGl0ZW0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZVNpbXBsaWZpZWRSb2xlcyBEZXRlcm1pbmVzIHdoZXRoZXIgdG8gdXNlIHNpbXBsaWZpZWQgcm9sZXMuXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVJdGVtLnByb3RvdHlwZS5nZXRPYmplY3RTaGFyaW5nU2V0dGluZ3MgPSBmdW5jdGlvbiAodXNlU2ltcGxpZmllZFJvbGVzKSB7XHJcbiAgICAgICAgaWYgKHVzZVNpbXBsaWZpZWRSb2xlcyA9PT0gdm9pZCAwKSB7IHVzZVNpbXBsaWZpZWRSb2xlcyA9IHRydWU7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBudWxsKS5nZXRPYmplY3RTaGFyaW5nU2V0dGluZ3ModXNlU2ltcGxpZmllZFJvbGVzKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFVuc2hhcmUgdGhpcyBpdGVtXHJcbiAgICAgKi9cclxuICAgIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVJdGVtLnByb3RvdHlwZS51bnNoYXJlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUsIG51bGwpLnVuc2hhcmVPYmplY3QoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZXMgYSBzaGFyaW5nIGxpbmsgYnkga2luZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBraW5kIERlbGV0ZXMgYSBzaGFyaW5nIGxpbmsgYnkgdGhlIGtpbmQgb2YgbGlua1xyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlSXRlbS5wcm90b3R5cGUuZGVsZXRlU2hhcmluZ0xpbmtCeUtpbmQgPSBmdW5jdGlvbiAoa2luZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUsIG51bGwpLmRlbGV0ZUxpbmtCeUtpbmQoa2luZCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgbGluayB0byB0aGUgaXRlbS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2luZCBUaGUga2luZCBvZiBsaW5rIHRvIGJlIGRlbGV0ZWQuXHJcbiAgICAgKiBAcGFyYW0gc2hhcmVJZFxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlSXRlbS5wcm90b3R5cGUudW5zaGFyZUxpbmsgPSBmdW5jdGlvbiAoa2luZCwgc2hhcmVJZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGUsIG51bGwpLnVuc2hhcmVMaW5rKGtpbmQsIHNoYXJlSWQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlSXRlbTtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlU2VjdXJhYmxlKSk7XHJcbnZhciBGaWxlRm9sZGVyU2hhcmVkID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZpbGVGb2xkZXJTaGFyZWQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBGaWxlRm9sZGVyU2hhcmVkKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGxpbmsgc3VpdGFibGUgZm9yIHNoYXJpbmdcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2luZCBUaGUga2luZCBvZiBsaW5rIHRvIGdldFxyXG4gICAgICogQHBhcmFtIGV4cGlyYXRpb24gT3B0aW9uYWwsIGFuIGV4cGlyYXRpb24gZm9yIHRoaXMgbGlua1xyXG4gICAgICovXHJcbiAgICBGaWxlRm9sZGVyU2hhcmVkLnByb3RvdHlwZS5nZXRTaGFyZUxpbmsgPSBmdW5jdGlvbiAoa2luZCwgZXhwaXJhdGlvbikge1xyXG4gICAgICAgIGlmIChraW5kID09PSB2b2lkIDApIHsga2luZCA9IFNoYXJpbmdMaW5rS2luZC5Pcmdhbml6YXRpb25WaWV3OyB9XHJcbiAgICAgICAgaWYgKGV4cGlyYXRpb24gPT09IHZvaWQgMCkgeyBleHBpcmF0aW9uID0gbnVsbDsgfVxyXG4gICAgICAgIHZhciBkZXBlbmRlbmN5ID0gdGhpcy5hZGRCYXRjaERlcGVuZGVuY3koKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRTaGFyZWFibGUoKS50aGVuKGZ1bmN0aW9uIChzaGFyZWFibGUpIHtcclxuICAgICAgICAgICAgZGVwZW5kZW5jeSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gc2hhcmVhYmxlLmdldFNoYXJlTGluayhraW5kLCBleHBpcmF0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAgICAgKiBDaGVja3MgUGVybWlzc2lvbnMgb24gdGhlIGxpc3Qgb2YgVXNlcnMgYW5kIHJldHVybnMgYmFjayByb2xlIHRoZSB1c2VycyBoYXZlIG9uIHRoZSBJdGVtLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHJlY2lwaWVudHMgVGhlIGFycmF5IG9mIEVudGl0aWVzIGZvciB3aGljaCBQZXJtaXNzaW9ucyBuZWVkIHRvIGJlIGNoZWNrZWQuXHJcbiAgICAgICAgICovXHJcbiAgICBGaWxlRm9sZGVyU2hhcmVkLnByb3RvdHlwZS5jaGVja1NoYXJpbmdQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uIChyZWNpcGllbnRzKSB7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNoYXJlYWJsZSgpLnRoZW4oZnVuY3Rpb24gKHNoYXJlYWJsZSkge1xyXG4gICAgICAgICAgICBkZXBlbmRlbmN5KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBzaGFyZWFibGUuY2hlY2tQZXJtaXNzaW9ucyhyZWNpcGllbnRzKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldCBTaGFyaW5nIEluZm9ybWF0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByZXF1ZXN0IFRoZSBTaGFyaW5nSW5mb3JtYXRpb25SZXF1ZXN0IE9iamVjdC5cclxuICAgICAqL1xyXG4gICAgRmlsZUZvbGRlclNoYXJlZC5wcm90b3R5cGUuZ2V0U2hhcmluZ0luZm9ybWF0aW9uID0gZnVuY3Rpb24gKHJlcXVlc3QpIHtcclxuICAgICAgICBpZiAocmVxdWVzdCA9PT0gdm9pZCAwKSB7IHJlcXVlc3QgPSBudWxsOyB9XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNoYXJlYWJsZSgpLnRoZW4oZnVuY3Rpb24gKHNoYXJlYWJsZSkge1xyXG4gICAgICAgICAgICBkZXBlbmRlbmN5KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBzaGFyZWFibGUuZ2V0U2hhcmluZ0luZm9ybWF0aW9uKHJlcXVlc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgc2hhcmluZyBzZXR0aW5ncyBvZiBhbiBpdGVtLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VTaW1wbGlmaWVkUm9sZXMgRGV0ZXJtaW5lcyB3aGV0aGVyIHRvIHVzZSBzaW1wbGlmaWVkIHJvbGVzLlxyXG4gICAgICovXHJcbiAgICBGaWxlRm9sZGVyU2hhcmVkLnByb3RvdHlwZS5nZXRPYmplY3RTaGFyaW5nU2V0dGluZ3MgPSBmdW5jdGlvbiAodXNlU2ltcGxpZmllZFJvbGVzKSB7XHJcbiAgICAgICAgaWYgKHVzZVNpbXBsaWZpZWRSb2xlcyA9PT0gdm9pZCAwKSB7IHVzZVNpbXBsaWZpZWRSb2xlcyA9IHRydWU7IH1cclxuICAgICAgICB2YXIgZGVwZW5kZW5jeSA9IHRoaXMuYWRkQmF0Y2hEZXBlbmRlbmN5KCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2hhcmVhYmxlKCkudGhlbihmdW5jdGlvbiAoc2hhcmVhYmxlKSB7XHJcbiAgICAgICAgICAgIGRlcGVuZGVuY3koKTtcclxuICAgICAgICAgICAgcmV0dXJuIHNoYXJlYWJsZS5nZXRPYmplY3RTaGFyaW5nU2V0dGluZ3ModXNlU2ltcGxpZmllZFJvbGVzKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFVuc2hhcmUgdGhpcyBpdGVtXHJcbiAgICAgKi9cclxuICAgIEZpbGVGb2xkZXJTaGFyZWQucHJvdG90eXBlLnVuc2hhcmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNoYXJlYWJsZSgpLnRoZW4oZnVuY3Rpb24gKHNoYXJlYWJsZSkge1xyXG4gICAgICAgICAgICBkZXBlbmRlbmN5KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBzaGFyZWFibGUudW5zaGFyZU9iamVjdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlcyBhIHNoYXJpbmcgbGluayBieSB0aGUga2luZCBvZiBsaW5rXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGtpbmQgVGhlIGtpbmQgb2YgbGluayB0byBiZSBkZWxldGVkLlxyXG4gICAgICovXHJcbiAgICBGaWxlRm9sZGVyU2hhcmVkLnByb3RvdHlwZS5kZWxldGVTaGFyaW5nTGlua0J5S2luZCA9IGZ1bmN0aW9uIChraW5kKSB7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNoYXJlYWJsZSgpLnRoZW4oZnVuY3Rpb24gKHNoYXJlYWJsZSkge1xyXG4gICAgICAgICAgICBkZXBlbmRlbmN5KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBzaGFyZWFibGUuZGVsZXRlTGlua0J5S2luZChraW5kKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBsaW5rIHRvIHRoZSBpdGVtLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBraW5kIFRoZSBraW5kIG9mIGxpbmsgdG8gYmUgZGVsZXRlZC5cclxuICAgICAqIEBwYXJhbSBzaGFyZUlkIFRoZSBzaGFyZSBpZCB0byBkZWxldGVcclxuICAgICAqL1xyXG4gICAgRmlsZUZvbGRlclNoYXJlZC5wcm90b3R5cGUudW5zaGFyZUxpbmsgPSBmdW5jdGlvbiAoa2luZCwgc2hhcmVJZCkge1xyXG4gICAgICAgIHZhciBkZXBlbmRlbmN5ID0gdGhpcy5hZGRCYXRjaERlcGVuZGVuY3koKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRTaGFyZWFibGUoKS50aGVuKGZ1bmN0aW9uIChzaGFyZWFibGUpIHtcclxuICAgICAgICAgICAgZGVwZW5kZW5jeSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gc2hhcmVhYmxlLnVuc2hhcmVMaW5rKGtpbmQsIHNoYXJlSWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRm9yIGZpbGVzIGFuZCBmb2xkZXJzIHdlIG5lZWQgdG8gdXNlIHRoZSBhc3NvY2lhdGVkIGl0ZW0gZW5kIHBvaW50XHJcbiAgICAgKi9cclxuICAgIEZpbGVGb2xkZXJTaGFyZWQucHJvdG90eXBlLmdldFNoYXJlYWJsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIC8vIHNoYXJpbmcgb25seSB3b3JrcyBvbiB0aGUgaXRlbSBlbmQgcG9pbnQsIG5vdCB0aGUgZmlsZSBvbmUgLSBzbyB3ZSBjcmVhdGUgYSBmb2xkZXIgaW5zdGFuY2Ugd2l0aCB0aGUgaXRlbSB1cmwgaW50ZXJuYWxseVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVGaWxlLCBcImxpc3RJdGVtQWxsRmllbGRzXCIsIGZhbHNlKS5zZWxlY3QoXCJvZGF0YS5pZFwiKS5nZXQoKS50aGVuKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgIHZhciBzaGFyZWFibGUgPSBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZShvZGF0YVVybEZyb20oZCkpO1xyXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGhhbmRsZSBiYXRjaGluZ1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFzQmF0Y2gpIHtcclxuICAgICAgICAgICAgICAgIHNoYXJlYWJsZSA9IHNoYXJlYWJsZS5pbkJhdGNoKF90aGlzLmJhdGNoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gc2hhcmVhYmxlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBGaWxlRm9sZGVyU2hhcmVkO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG52YXIgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUZpbGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUZpbGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlRmlsZSgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNoYXJlcyB0aGlzIGl0ZW0gd2l0aCBvbmUgb3IgbW9yZSB1c2Vyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsb2dpbk5hbWVzIHN0cmluZyBvciBzdHJpbmdbXSBvZiByZXNvbHZlZCBsb2dpbiBuYW1lcyB0byB3aGljaCB0aGlzIGl0ZW0gd2lsbCBiZSBzaGFyZWRcclxuICAgICAqIEBwYXJhbSByb2xlIFRoZSByb2xlIChWaWV3IHwgRWRpdCkgYXBwbGllZCB0byB0aGUgc2hhcmVcclxuICAgICAqIEBwYXJhbSBzaGFyZUV2ZXJ5dGhpbmcgU2hhcmUgZXZlcnl0aGluZyBpbiB0aGlzIGZvbGRlciwgZXZlbiBpdGVtcyB3aXRoIHVuaXF1ZSBwZXJtaXNzaW9ucy5cclxuICAgICAqIEBwYXJhbSByZXF1aXJlU2lnbmluIElmIHRydWUgdGhlIHVzZXIgbXVzdCBzaWduaW4gdG8gdmlldyBsaW5rLCBvdGhlcndpc2UgYW55b25lIHdpdGggdGhlIGxpbmsgY2FuIGFjY2VzcyB0aGUgcmVzb3VyY2VcclxuICAgICAqIEBwYXJhbSBlbWFpbERhdGEgT3B0aW9uYWwsIGlmIGlubHVjZGVkIGFuIGVtYWlsIHdpbGwgYmUgc2VudC4gTm90ZSBzdWJqZWN0IGN1cnJlbnRseSBoYXMgbm8gZWZmZWN0LlxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlRmlsZS5wcm90b3R5cGUuc2hhcmVXaXRoID0gZnVuY3Rpb24gKGxvZ2luTmFtZXMsIHJvbGUsIHJlcXVpcmVTaWduaW4sIGVtYWlsRGF0YSkge1xyXG4gICAgICAgIGlmIChyb2xlID09PSB2b2lkIDApIHsgcm9sZSA9IFNoYXJpbmdSb2xlLlZpZXc7IH1cclxuICAgICAgICBpZiAocmVxdWlyZVNpZ25pbiA9PT0gdm9pZCAwKSB7IHJlcXVpcmVTaWduaW4gPSBmYWxzZTsgfVxyXG4gICAgICAgIHZhciBkZXBlbmRlbmN5ID0gdGhpcy5hZGRCYXRjaERlcGVuZGVuY3koKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRTaGFyZWFibGUoKS50aGVuKGZ1bmN0aW9uIChzaGFyZWFibGUpIHtcclxuICAgICAgICAgICAgZGVwZW5kZW5jeSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gc2hhcmVhYmxlLnNoYXJlV2l0aChsb2dpbk5hbWVzLCByb2xlLCByZXF1aXJlU2lnbmluLCBmYWxzZSwgZW1haWxEYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUZpbGU7XHJcbn0oRmlsZUZvbGRlclNoYXJlZCkpO1xyXG52YXIgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUZvbGRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlRm9sZGVyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUZvbGRlcigpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNoYXJlcyB0aGlzIGl0ZW0gd2l0aCBvbmUgb3IgbW9yZSB1c2Vyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsb2dpbk5hbWVzIHN0cmluZyBvciBzdHJpbmdbXSBvZiByZXNvbHZlZCBsb2dpbiBuYW1lcyB0byB3aGljaCB0aGlzIGl0ZW0gd2lsbCBiZSBzaGFyZWRcclxuICAgICAqIEBwYXJhbSByb2xlIFRoZSByb2xlIChWaWV3IHwgRWRpdCkgYXBwbGllZCB0byB0aGUgc2hhcmVcclxuICAgICAqIEBwYXJhbSBzaGFyZUV2ZXJ5dGhpbmcgU2hhcmUgZXZlcnl0aGluZyBpbiB0aGlzIGZvbGRlciwgZXZlbiBpdGVtcyB3aXRoIHVuaXF1ZSBwZXJtaXNzaW9ucy5cclxuICAgICAqIEBwYXJhbSByZXF1aXJlU2lnbmluIElmIHRydWUgdGhlIHVzZXIgbXVzdCBzaWduaW4gdG8gdmlldyBsaW5rLCBvdGhlcndpc2UgYW55b25lIHdpdGggdGhlIGxpbmsgY2FuIGFjY2VzcyB0aGUgcmVzb3VyY2VcclxuICAgICAqIEBwYXJhbSBlbWFpbERhdGEgT3B0aW9uYWwsIGlmIGlubHVjZGVkIGFuIGVtYWlsIHdpbGwgYmUgc2VudC4gTm90ZSBzdWJqZWN0IGN1cnJlbnRseSBoYXMgbm8gZWZmZWN0LlxyXG4gICAgICovXHJcbiAgICBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlRm9sZGVyLnByb3RvdHlwZS5zaGFyZVdpdGggPSBmdW5jdGlvbiAobG9naW5OYW1lcywgcm9sZSwgcmVxdWlyZVNpZ25pbiwgc2hhcmVFdmVyeXRoaW5nLCBlbWFpbERhdGEpIHtcclxuICAgICAgICBpZiAocm9sZSA9PT0gdm9pZCAwKSB7IHJvbGUgPSBTaGFyaW5nUm9sZS5WaWV3OyB9XHJcbiAgICAgICAgaWYgKHJlcXVpcmVTaWduaW4gPT09IHZvaWQgMCkgeyByZXF1aXJlU2lnbmluID0gZmFsc2U7IH1cclxuICAgICAgICBpZiAoc2hhcmVFdmVyeXRoaW5nID09PSB2b2lkIDApIHsgc2hhcmVFdmVyeXRoaW5nID0gZmFsc2U7IH1cclxuICAgICAgICB2YXIgZGVwZW5kZW5jeSA9IHRoaXMuYWRkQmF0Y2hEZXBlbmRlbmN5KCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2hhcmVhYmxlKCkudGhlbihmdW5jdGlvbiAoc2hhcmVhYmxlKSB7XHJcbiAgICAgICAgICAgIGRlcGVuZGVuY3koKTtcclxuICAgICAgICAgICAgcmV0dXJuIHNoYXJlYWJsZS5zaGFyZVdpdGgobG9naW5OYW1lcywgcm9sZSwgcmVxdWlyZVNpZ25pbiwgc2hhcmVFdmVyeXRoaW5nLCBlbWFpbERhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlRm9sZGVyO1xyXG59KEZpbGVGb2xkZXJTaGFyZWQpKTtcblxudmFyIExpbWl0ZWRXZWJQYXJ0TWFuYWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhMaW1pdGVkV2ViUGFydE1hbmFnZXIsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBMaW1pdGVkV2ViUGFydE1hbmFnZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KExpbWl0ZWRXZWJQYXJ0TWFuYWdlci5wcm90b3R5cGUsIFwid2VicGFydHNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIHNldCBvZiB3ZWIgcGFydCBkZWZpbml0aW9ucyBjb250YWluZWQgYnkgdGhpcyB3ZWIgcGFydCBtYW5hZ2VyXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBXZWJQYXJ0RGVmaW5pdGlvbnModGhpcywgXCJ3ZWJwYXJ0c1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogRXhwb3J0cyBhIHdlYnBhcnQgZGVmaW5pdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCB0aGUgR1VJRCBpZCBvZiB0aGUgZGVmaW5pdGlvbiB0byBleHBvcnRcclxuICAgICAqL1xyXG4gICAgTGltaXRlZFdlYlBhcnRNYW5hZ2VyLnByb3RvdHlwZS5leHBvcnQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShMaW1pdGVkV2ViUGFydE1hbmFnZXIsIFwiRXhwb3J0V2ViUGFydFwiKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7IHdlYlBhcnRJZDogaWQgfSksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBJbXBvcnRzIGEgd2VicGFydFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB4bWwgd2VicGFydCBkZWZpbml0aW9uIHdoaWNoIG11c3QgYmUgdmFsaWQgWE1MIGluIHRoZSAuZHdwIG9yIC53ZWJwYXJ0IGZvcm1hdFxyXG4gICAgICovXHJcbiAgICBMaW1pdGVkV2ViUGFydE1hbmFnZXIucHJvdG90eXBlLmltcG9ydCA9IGZ1bmN0aW9uICh4bWwpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShMaW1pdGVkV2ViUGFydE1hbmFnZXIsIFwiSW1wb3J0V2ViUGFydFwiKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7IHdlYlBhcnRYbWw6IHhtbCB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTGltaXRlZFdlYlBhcnRNYW5hZ2VyO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGUpKTtcclxudmFyIFdlYlBhcnREZWZpbml0aW9ucyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhXZWJQYXJ0RGVmaW5pdGlvbnMsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBXZWJQYXJ0RGVmaW5pdGlvbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgd2ViIHBhcnQgZGVmaW5pdGlvbiBmcm9tIHRoZSBjb2xsZWN0aW9uIGJ5IGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBzdG9yYWdlIElEIG9mIHRoZSBTUFdlYlBhcnREZWZpbml0aW9uIHRvIHJldHJpZXZlXHJcbiAgICAgKi9cclxuICAgIFdlYlBhcnREZWZpbml0aW9ucy5wcm90b3R5cGUuZ2V0QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgV2ViUGFydERlZmluaXRpb24odGhpcywgXCJnZXRieWlkKCdcIiArIGlkICsgXCInKVwiKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSB3ZWIgcGFydCBkZWZpbml0aW9uIGZyb20gdGhlIGNvbGxlY3Rpb24gYnkgc3RvcmFnZSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgV2ViUGFydC5JRCBvZiB0aGUgU1BXZWJQYXJ0RGVmaW5pdGlvbiB0byByZXRyaWV2ZVxyXG4gICAgICovXHJcbiAgICBXZWJQYXJ0RGVmaW5pdGlvbnMucHJvdG90eXBlLmdldEJ5Q29udHJvbElkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBXZWJQYXJ0RGVmaW5pdGlvbih0aGlzLCBcImdldEJ5Q29udHJvbElkKCdcIiArIGlkICsgXCInKVwiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gV2ViUGFydERlZmluaXRpb25zO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbnZhciBXZWJQYXJ0RGVmaW5pdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhXZWJQYXJ0RGVmaW5pdGlvbiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFdlYlBhcnREZWZpbml0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWJQYXJ0RGVmaW5pdGlvbi5wcm90b3R5cGUsIFwid2VicGFydFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgd2VicGFydCBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhpcyBkZWZpbml0aW9uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgV2ViUGFydCh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogU2F2ZXMgY2hhbmdlcyB0byB0aGUgV2ViIFBhcnQgbWFkZSB1c2luZyBvdGhlciBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIG9uIHRoZSBTUFdlYlBhcnREZWZpbml0aW9uIG9iamVjdFxyXG4gICAgICovXHJcbiAgICBXZWJQYXJ0RGVmaW5pdGlvbi5wcm90b3R5cGUuc2F2ZUNoYW5nZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoV2ViUGFydERlZmluaXRpb24sIFwiU2F2ZVdlYlBhcnRDaGFuZ2VzXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBNb3ZlcyB0aGUgV2ViIFBhcnQgdG8gYSBkaWZmZXJlbnQgbG9jYXRpb24gb24gYSBXZWIgUGFydCBQYWdlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHpvbmVJZCBUaGUgSUQgb2YgdGhlIFdlYiBQYXJ0IFpvbmUgdG8gd2hpY2ggdG8gbW92ZSB0aGUgV2ViIFBhcnRcclxuICAgICAqIEBwYXJhbSB6b25lSW5kZXggQSBXZWIgUGFydCB6b25lIGluZGV4IHRoYXQgc3BlY2lmaWVzIHRoZSBwb3NpdGlvbiBhdCB3aGljaCB0aGUgV2ViIFBhcnQgaXMgdG8gYmUgbW92ZWQgd2l0aGluIHRoZSBkZXN0aW5hdGlvbiBXZWIgUGFydCB6b25lXHJcbiAgICAgKi9cclxuICAgIFdlYlBhcnREZWZpbml0aW9uLnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbiAoem9uZUlkLCB6b25lSW5kZXgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShXZWJQYXJ0RGVmaW5pdGlvbiwgXCJNb3ZlV2ViUGFydFRvKHpvbmVJRD0nXCIgKyB6b25lSWQgKyBcIicsIHpvbmVJbmRleD1cIiArIHpvbmVJbmRleCArIFwiKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ2xvc2VzIHRoZSBXZWIgUGFydC4gSWYgdGhlIFdlYiBQYXJ0IGlzIGFscmVhZHkgY2xvc2VkLCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmdcclxuICAgICAqL1xyXG4gICAgV2ViUGFydERlZmluaXRpb24ucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFdlYlBhcnREZWZpbml0aW9uLCBcIkNsb3NlV2ViUGFydFwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogT3BlbnMgdGhlIFdlYiBQYXJ0LiBJZiB0aGUgV2ViIFBhcnQgaXMgYWxyZWFkeSBjbG9zZWQsIHRoaXMgbWV0aG9kIGRvZXMgbm90aGluZ1xyXG4gICAgICovXHJcbiAgICBXZWJQYXJ0RGVmaW5pdGlvbi5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShXZWJQYXJ0RGVmaW5pdGlvbiwgXCJPcGVuV2ViUGFydFwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyBhIHdlYnBhcnQgZnJvbSBhIHBhZ2UsIGFsbCBzZXR0aW5ncyB3aWxsIGJlIGxvc3RcclxuICAgICAqL1xyXG4gICAgV2ViUGFydERlZmluaXRpb24ucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShXZWJQYXJ0RGVmaW5pdGlvbiwgXCJEZWxldGVXZWJQYXJ0XCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFdlYlBhcnREZWZpbml0aW9uO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG52YXIgV2ViUGFydCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhXZWJQYXJ0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gV2ViUGFydCgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBXZWJQYXJ0ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJ3ZWJwYXJ0XCIpXHJcbiAgICBdLCBXZWJQYXJ0KTtcclxuICAgIHJldHVybiBXZWJQYXJ0O1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xuXG4vKipcclxuICogRGVzY3JpYmVzIGEgY29sbGVjdGlvbiBvZiBGb2xkZXIgb2JqZWN0c1xyXG4gKlxyXG4gKi9cclxudmFyIEZvbGRlcnMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRm9sZGVycywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEZvbGRlcnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgRm9sZGVyc18xID0gRm9sZGVycztcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGZvbGRlciBieSBmb2xkZXIgbmFtZVxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgRm9sZGVycy5wcm90b3R5cGUuZ2V0QnlOYW1lID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICB2YXIgZiA9IG5ldyBGb2xkZXIodGhpcyk7XHJcbiAgICAgICAgZi5jb25jYXQoXCIoJ1wiICsgbmFtZSArIFwiJylcIik7XHJcbiAgICAgICAgcmV0dXJuIGY7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IGZvbGRlciB0byB0aGUgY3VycmVudCBmb2xkZXIgKHJlbGF0aXZlKSBvciBhbnkgZm9sZGVyIChhYnNvbHV0ZSlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXJsIFRoZSByZWxhdGl2ZSBvciBhYnNvbHV0ZSB1cmwgd2hlcmUgdGhlIG5ldyBmb2xkZXIgd2lsbCBiZSBjcmVhdGVkLiBVcmxzIHN0YXJ0aW5nIHdpdGggYSBmb3J3YXJkIHNsYXNoIGFyZSBhYnNvbHV0ZS5cclxuICAgICAqIEByZXR1cm5zIFRoZSBuZXcgRm9sZGVyIGFuZCB0aGUgcmF3IHJlc3BvbnNlLlxyXG4gICAgICovXHJcbiAgICBGb2xkZXJzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGb2xkZXJzXzEsIFwiYWRkKCdcIiArIHVybCArIFwiJylcIikucG9zdENvcmUoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogcmVzcG9uc2UsXHJcbiAgICAgICAgICAgICAgICBmb2xkZXI6IF90aGlzLmdldEJ5TmFtZSh1cmwpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHZhciBGb2xkZXJzXzE7XHJcbiAgICBGb2xkZXJzID0gRm9sZGVyc18xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJmb2xkZXJzXCIpXHJcbiAgICBdLCBGb2xkZXJzKTtcclxuICAgIHJldHVybiBGb2xkZXJzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBzaW5nbGUgRm9sZGVyIGluc3RhbmNlXHJcbiAqXHJcbiAqL1xyXG52YXIgRm9sZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZvbGRlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEZvbGRlcigpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy51cGRhdGUgPSBfdGhpcy5fdXBkYXRlKFwiU1AuRm9sZGVyXCIsIGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiAoeyBkYXRhOiBkYXRhLCBmb2xkZXI6IF90aGlzIH0pOyB9KTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9sZGVyLnByb3RvdHlwZSwgXCJjb250ZW50VHlwZU9yZGVyXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTcGVjaWZpZXMgdGhlIHNlcXVlbmNlIGluIHdoaWNoIGNvbnRlbnQgdHlwZXMgYXJlIGRpc3BsYXllZC5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKHRoaXMsIFwiY29udGVudFR5cGVPcmRlclwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb2xkZXIucHJvdG90eXBlLCBcImZpbGVzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoaXMgZm9sZGVyJ3MgZmlsZXNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpbGVzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEZvbGRlci5wcm90b3R5cGUsIFwiZm9sZGVyc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGlzIGZvbGRlcidzIHN1YiBmb2xkZXJzXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGb2xkZXJzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEZvbGRlci5wcm90b3R5cGUsIFwibGlzdEl0ZW1BbGxGaWVsZHNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhpcyBmb2xkZXIncyBsaXN0IGl0ZW0gZmllbGQgdmFsdWVzXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UodGhpcywgXCJsaXN0SXRlbUFsbEZpZWxkc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb2xkZXIucHJvdG90eXBlLCBcInBhcmVudEZvbGRlclwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgcGFyZW50IGZvbGRlciwgaWYgYXZhaWxhYmxlXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGb2xkZXIodGhpcywgXCJwYXJlbnRGb2xkZXJcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9sZGVyLnByb3RvdHlwZSwgXCJwcm9wZXJ0aWVzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoaXMgZm9sZGVyJ3MgcHJvcGVydGllc1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKHRoaXMsIFwicHJvcGVydGllc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb2xkZXIucHJvdG90eXBlLCBcInNlcnZlclJlbGF0aXZlVXJsXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoaXMgZm9sZGVyJ3Mgc2VydmVyIHJlbGF0aXZlIHVybFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZSh0aGlzLCBcInNlcnZlclJlbGF0aXZlVXJsXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEZvbGRlci5wcm90b3R5cGUsIFwidW5pcXVlQ29udGVudFR5cGVPcmRlclwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyBhIHZhbHVlIHRoYXQgc3BlY2lmaWVzIHRoZSBjb250ZW50IHR5cGUgb3JkZXIuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbih0aGlzLCBcInVuaXF1ZUNvbnRlbnRUeXBlT3JkZXJcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICogRGVsZXRlIHRoaXMgZm9sZGVyXHJcbiAgICAqXHJcbiAgICAqIEBwYXJhbSBlVGFnIFZhbHVlIHVzZWQgaW4gdGhlIElGLU1hdGNoIGhlYWRlciwgYnkgZGVmYXVsdCBcIipcIlxyXG4gICAgKi9cclxuICAgIEZvbGRlci5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKGVUYWcpIHtcclxuICAgICAgICBpZiAoZVRhZyA9PT0gdm9pZCAwKSB7IGVUYWcgPSBcIipcIjsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZvbGRlciwgbnVsbCkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBcIklGLU1hdGNoXCI6IGVUYWcsXHJcbiAgICAgICAgICAgICAgICBcIlgtSFRUUC1NZXRob2RcIjogXCJERUxFVEVcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIE1vdmVzIHRoZSBmb2xkZXIgdG8gdGhlIFJlY3ljbGUgQmluIGFuZCByZXR1cm5zIHRoZSBpZGVudGlmaWVyIG9mIHRoZSBuZXcgUmVjeWNsZSBCaW4gaXRlbS5cclxuICAgICAqL1xyXG4gICAgRm9sZGVyLnByb3RvdHlwZS5yZWN5Y2xlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZvbGRlciwgXCJyZWN5Y2xlXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBhc3NvY2lhdGVkIGxpc3QgaXRlbSBmb3IgdGhpcyBmb2xkZXIsIGxvYWRpbmcgdGhlIGRlZmF1bHQgcHJvcGVydGllc1xyXG4gICAgICovXHJcbiAgICBGb2xkZXIucHJvdG90eXBlLmdldEl0ZW0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlbGVjdHMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICBzZWxlY3RzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBxID0gdGhpcy5saXN0SXRlbUFsbEZpZWxkcztcclxuICAgICAgICByZXR1cm4gcS5zZWxlY3QuYXBwbHkocSwgc2VsZWN0cykuZ2V0KCkudGhlbihmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXh0ZW5kKG5ldyBJdGVtKG9kYXRhVXJsRnJvbShkKSksIGQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogTW92ZXMgYSBmb2xkZXIgdG8gZGVzdGluYXRpb24gcGF0aFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBkZXN0VXJsIEFic29sdXRlIG9yIHJlbGF0aXZlIFVSTCBvZiB0aGUgZGVzdGluYXRpb24gcGF0aFxyXG4gICAgICovXHJcbiAgICBGb2xkZXIucHJvdG90eXBlLm1vdmVUbyA9IGZ1bmN0aW9uIChkZXN0VXJsKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3QoXCJTZXJ2ZXJSZWxhdGl2ZVVybFwiKS5nZXQoKS50aGVuKGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICB2YXIgc3JjVXJsID0gX2EuU2VydmVyUmVsYXRpdmVVcmw7XHJcbiAgICAgICAgICAgIHZhciBjbGllbnQgPSBuZXcgU1BIdHRwQ2xpZW50KCk7XHJcbiAgICAgICAgICAgIHZhciB3ZWJCYXNlVXJsID0gX3RoaXMudG9VcmwoKS5zcGxpdChcIi9fYXBpXCIpWzBdO1xyXG4gICAgICAgICAgICB2YXIgaG9zdFVybCA9IHdlYkJhc2VVcmwucmVwbGFjZShcIjovL1wiLCBcIl9fX1wiKS5zcGxpdChcIi9cIilbMF0ucmVwbGFjZShcIl9fX1wiLCBcIjovL1wiKTtcclxuICAgICAgICAgICAgdmFyIG1ldGhvZFVybCA9IHdlYkJhc2VVcmwgKyBcIi9fYXBpL1NQLk1vdmVDb3B5VXRpbC5Nb3ZlRm9sZGVyKClcIjtcclxuICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5wb3N0KG1ldGhvZFVybCwge1xyXG4gICAgICAgICAgICAgICAgYm9keToganNTKHtcclxuICAgICAgICAgICAgICAgICAgICBkZXN0VXJsOiBkZXN0VXJsLmluZGV4T2YoXCJodHRwXCIpID09PSAwID8gZGVzdFVybCA6IFwiXCIgKyBob3N0VXJsICsgZGVzdFVybCxcclxuICAgICAgICAgICAgICAgICAgICBzcmNVcmw6IFwiXCIgKyBob3N0VXJsICsgc3JjVXJsLFxyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIuanNvbigpOyB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRm9sZGVyO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVGb2xkZXIpKTtcblxuLyoqXHJcbiAqIERlc2NyaWJlcyBhIGNvbGxlY3Rpb24gb2YgY29udGVudCB0eXBlc1xyXG4gKlxyXG4gKi9cclxudmFyIENvbnRlbnRUeXBlcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhDb250ZW50VHlwZXMsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBDb250ZW50VHlwZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgQ29udGVudFR5cGVzXzEgPSBDb250ZW50VHlwZXM7XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYW4gZXhpc3RpbmcgY29udGVudHR5cGUgdG8gYSBjb250ZW50IHR5cGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb250ZW50VHlwZUlkIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0LCBmb3IgZXhhbXBsZTogMHgwMTAxMDJcclxuICAgICAqL1xyXG4gICAgQ29udGVudFR5cGVzLnByb3RvdHlwZS5hZGRBdmFpbGFibGVDb250ZW50VHlwZSA9IGZ1bmN0aW9uIChjb250ZW50VHlwZUlkKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1Moe1xyXG4gICAgICAgICAgICBcImNvbnRlbnRUeXBlSWRcIjogY29udGVudFR5cGVJZCxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShDb250ZW50VHlwZXNfMSwgXCJhZGRBdmFpbGFibGVDb250ZW50VHlwZVwiKS5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBfdGhpcy5nZXRCeUlkKGRhdGEuaWQpLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSBDb250ZW50VHlwZSBieSBjb250ZW50IHR5cGUgaWRcclxuICAgICAqL1xyXG4gICAgQ29udGVudFR5cGVzLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgdmFyIGN0ID0gbmV3IENvbnRlbnRUeXBlKHRoaXMpO1xyXG4gICAgICAgIGN0LmNvbmNhdChcIignXCIgKyBpZCArIFwiJylcIik7XHJcbiAgICAgICAgcmV0dXJuIGN0O1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBjb250ZW50IHR5cGUgdG8gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaWQgVGhlIGRlc2lyZWQgY29udGVudCB0eXBlIGlkIGZvciB0aGUgbmV3IGNvbnRlbnQgdHlwZSAoYWxzbyBkZXRlcm1pbmVzIHRoZSBwYXJlbnQgY29udGVudCB0eXBlKVxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGNvbnRlbnQgdHlwZVxyXG4gICAgICogQHBhcmFtIGRlc2NyaXB0aW9uIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgY29udGVudCB0eXBlXHJcbiAgICAgKiBAcGFyYW0gZ3JvdXAgVGhlIGdyb3VwIGluIHdoaWNoIHRvIGFkZCB0aGUgY29udGVudCB0eXBlXHJcbiAgICAgKiBAcGFyYW0gYWRkaXRpb25hbFNldHRpbmdzIEFueSBhZGRpdGlvbmFsIHNldHRpbmdzIHRvIHByb3ZpZGUgd2hlbiBjcmVhdGluZyB0aGUgY29udGVudCB0eXBlXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBDb250ZW50VHlwZXMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgZGVzY3JpcHRpb24sIGdyb3VwLCBhZGRpdGlvbmFsU2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChkZXNjcmlwdGlvbiA9PT0gdm9pZCAwKSB7IGRlc2NyaXB0aW9uID0gXCJcIjsgfVxyXG4gICAgICAgIGlmIChncm91cCA9PT0gdm9pZCAwKSB7IGdyb3VwID0gXCJDdXN0b20gQ29udGVudCBUeXBlc1wiOyB9XHJcbiAgICAgICAgaWYgKGFkZGl0aW9uYWxTZXR0aW5ncyA9PT0gdm9pZCAwKSB7IGFkZGl0aW9uYWxTZXR0aW5ncyA9IHt9OyB9XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKE9iamVjdC5hc3NpZ24obWV0YWRhdGEoXCJTUC5Db250ZW50VHlwZVwiKSwge1xyXG4gICAgICAgICAgICBcIkRlc2NyaXB0aW9uXCI6IGRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBcIkdyb3VwXCI6IGdyb3VwLFxyXG4gICAgICAgICAgICBcIklkXCI6IHsgXCJTdHJpbmdWYWx1ZVwiOiBpZCB9LFxyXG4gICAgICAgICAgICBcIk5hbWVcIjogbmFtZSxcclxuICAgICAgICB9LCBhZGRpdGlvbmFsU2V0dGluZ3MpKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgY29udGVudFR5cGU6IF90aGlzLmdldEJ5SWQoZGF0YS5pZCksIGRhdGE6IGRhdGEgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgQ29udGVudFR5cGVzXzE7XHJcbiAgICBDb250ZW50VHlwZXMgPSBDb250ZW50VHlwZXNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwiY29udGVudHR5cGVzXCIpXHJcbiAgICBdLCBDb250ZW50VHlwZXMpO1xyXG4gICAgcmV0dXJuIENvbnRlbnRUeXBlcztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIENvbnRlbnRUeXBlIGluc3RhbmNlXHJcbiAqXHJcbiAqL1xyXG52YXIgQ29udGVudFR5cGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ29udGVudFR5cGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBDb250ZW50VHlwZSgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZWxldGUgdGhpcyBjb250ZW50IHR5cGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBfdGhpcy5kZWxldGUgPSBfdGhpcy5fZGVsZXRlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb250ZW50VHlwZS5wcm90b3R5cGUsIFwiZmllbGRMaW5rc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgY29sdW1uIChhbHNvIGtub3duIGFzIGZpZWxkKSByZWZlcmVuY2VzIGluIHRoZSBjb250ZW50IHR5cGUuXHJcbiAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZExpbmtzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnRlbnRUeXBlLnByb3RvdHlwZSwgXCJmaWVsZHNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgYSB2YWx1ZSB0aGF0IHNwZWNpZmllcyB0aGUgY29sbGVjdGlvbiBvZiBmaWVsZHMgZm9yIHRoZSBjb250ZW50IHR5cGUuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24odGhpcywgXCJmaWVsZHNcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29udGVudFR5cGUucHJvdG90eXBlLCBcInBhcmVudFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgcGFyZW50IGNvbnRlbnQgdHlwZSBvZiB0aGUgY29udGVudCB0eXBlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbnRlbnRUeXBlKHRoaXMsIFwicGFyZW50XCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnRlbnRUeXBlLnByb3RvdHlwZSwgXCJ3b3JrZmxvd0Fzc29jaWF0aW9uc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyBhIHZhbHVlIHRoYXQgc3BlY2lmaWVzIHRoZSBjb2xsZWN0aW9uIG9mIHdvcmtmbG93IGFzc29jaWF0aW9ucyBmb3IgdGhlIGNvbnRlbnQgdHlwZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbih0aGlzLCBcIndvcmtmbG93QXNzb2NpYXRpb25zXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIENvbnRlbnRUeXBlO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG4vKipcclxuICogUmVwcmVzZW50cyBhIGNvbGxlY3Rpb24gb2YgZmllbGQgbGluayBpbnN0YW5jZXNcclxuICovXHJcbnZhciBGaWVsZExpbmtzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZpZWxkTGlua3MsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBGaWVsZExpbmtzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIEZpZWxkTGluayBieSBHVUlEIGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBHVUlEIGlkIG9mIHRoZSBmaWVsZCBsaW5rXHJcbiAgICAgKi9cclxuICAgIEZpZWxkTGlua3MucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgZmwgPSBuZXcgRmllbGRMaW5rKHRoaXMpO1xyXG4gICAgICAgIGZsLmNvbmNhdChcIihndWlkJ1wiICsgaWQgKyBcIicpXCIpO1xyXG4gICAgICAgIHJldHVybiBmbDtcclxuICAgIH07XHJcbiAgICBGaWVsZExpbmtzID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJmaWVsZGxpbmtzXCIpXHJcbiAgICBdLCBGaWVsZExpbmtzKTtcclxuICAgIHJldHVybiBGaWVsZExpbmtzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBSZXByZXNlbnRzIGEgZmllbGQgbGluayBpbnN0YW5jZVxyXG4gKi9cclxudmFyIEZpZWxkTGluayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhGaWVsZExpbmssIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBGaWVsZExpbmsoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEZpZWxkTGluaztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcblxuLyoqXHJcbiAqIERlc2NyaWJlcyBhIGNvbGxlY3Rpb24gb2YgSXRlbSBvYmplY3RzXHJcbiAqXHJcbiAqL1xyXG52YXIgQXR0YWNobWVudEZpbGVzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEF0dGFjaG1lbnRGaWxlcywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEF0dGFjaG1lbnRGaWxlcygpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBBdHRhY2htZW50RmlsZXNfMSA9IEF0dGFjaG1lbnRGaWxlcztcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIEF0dGFjaG1lbnQgRmlsZSBieSBmaWxlbmFtZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBmaWxlLCBpbmNsdWRpbmcgZXh0ZW5zaW9uLlxyXG4gICAgICovXHJcbiAgICBBdHRhY2htZW50RmlsZXMucHJvdG90eXBlLmdldEJ5TmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgdmFyIGYgPSBuZXcgQXR0YWNobWVudEZpbGUodGhpcyk7XHJcbiAgICAgICAgZi5jb25jYXQoXCIoJ1wiICsgbmFtZSArIFwiJylcIik7XHJcbiAgICAgICAgcmV0dXJuIGY7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IGF0dGFjaG1lbnQgdG8gdGhlIGNvbGxlY3Rpb24uIE5vdCBzdXBwb3J0ZWQgZm9yIGJhdGNoaW5nLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBmaWxlLCBpbmNsdWRpbmcgZXh0ZW5zaW9uLlxyXG4gICAgICogQHBhcmFtIGNvbnRlbnQgVGhlIEJhc2U2NCBmaWxlIGNvbnRlbnQuXHJcbiAgICAgKi9cclxuICAgIEF0dGFjaG1lbnRGaWxlcy5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKG5hbWUsIGNvbnRlbnQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEF0dGFjaG1lbnRGaWxlc18xLCBcImFkZChGaWxlTmFtZT0nXCIgKyBuYW1lICsgXCInKVwiLCBmYWxzZSkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBjb250ZW50LFxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiByZXNwb25zZSxcclxuICAgICAgICAgICAgICAgIGZpbGU6IF90aGlzLmdldEJ5TmFtZShuYW1lKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgbXVsdGlwbGUgbmV3IGF0dGFjaG1lbnQgdG8gdGhlIGNvbGxlY3Rpb24uIE5vdCBzdXBwb3J0ZWQgZm9yIGJhdGNoaW5nLlxyXG4gICAgICpcclxuICAgICAqIEBmaWxlcyBuYW1lIFRoZSBjb2xsZWN0aW9uIG9mIGZpbGVzIHRvIGFkZFxyXG4gICAgICovXHJcbiAgICBBdHRhY2htZW50RmlsZXMucHJvdG90eXBlLmFkZE11bHRpcGxlID0gZnVuY3Rpb24gKGZpbGVzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAvLyBhZGQgdGhlIGZpbGVzIGluIHNlcmllcyBzbyB3ZSBkb24ndCBnZXQgdXBkYXRlIGNvbmZsaWN0c1xyXG4gICAgICAgIHJldHVybiBmaWxlcy5yZWR1Y2UoZnVuY3Rpb24gKGNoYWluLCBmaWxlKSB7IHJldHVybiBjaGFpbi50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmNsb25lKEF0dGFjaG1lbnRGaWxlc18xLCBcImFkZChGaWxlTmFtZT0nXCIgKyBmaWxlLm5hbWUgKyBcIicpXCIsIGZhbHNlKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGZpbGUuY29udGVudCxcclxuICAgICAgICB9KTsgfSk7IH0sIFByb21pc2UucmVzb2x2ZSgpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZSBtdWx0aXBsZSBhdHRhY2htZW50cyBmcm9tIHRoZSBjb2xsZWN0aW9uLiBOb3Qgc3VwcG9ydGVkIGZvciBiYXRjaGluZy5cclxuICAgICAqXHJcbiAgICAgKiBAZmlsZXMgbmFtZSBUaGUgY29sbGVjdGlvbiBvZiBmaWxlcyB0byBkZWxldGVcclxuICAgICAqL1xyXG4gICAgQXR0YWNobWVudEZpbGVzLnByb3RvdHlwZS5kZWxldGVNdWx0aXBsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBmaWxlcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIGZpbGVzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmaWxlcy5yZWR1Y2UoZnVuY3Rpb24gKGNoYWluLCBmaWxlKSB7IHJldHVybiBjaGFpbi50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmdldEJ5TmFtZShmaWxlKS5kZWxldGUoKTsgfSk7IH0sIFByb21pc2UucmVzb2x2ZSgpKTtcclxuICAgIH07XHJcbiAgICB2YXIgQXR0YWNobWVudEZpbGVzXzE7XHJcbiAgICBBdHRhY2htZW50RmlsZXMgPSBBdHRhY2htZW50RmlsZXNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwiQXR0YWNobWVudEZpbGVzXCIpXHJcbiAgICBdLCBBdHRhY2htZW50RmlsZXMpO1xyXG4gICAgcmV0dXJuIEF0dGFjaG1lbnRGaWxlcztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIGF0dGFjaG1lbnQgZmlsZSBpbnN0YW5jZVxyXG4gKlxyXG4gKi9cclxudmFyIEF0dGFjaG1lbnRGaWxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEF0dGFjaG1lbnRGaWxlLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQXR0YWNobWVudEZpbGUoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuZGVsZXRlID0gX3RoaXMuX2RlbGV0ZVdpdGhFVGFnO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUgYXMgdGV4dFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgQXR0YWNobWVudEZpbGUucHJvdG90eXBlLmdldFRleHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGFyc2VkKG5ldyBUZXh0UGFyc2VyKCkpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUgYXMgYSBibG9iLCBkb2VzIG5vdCB3b3JrIGluIE5vZGUuanNcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIEF0dGFjaG1lbnRGaWxlLnByb3RvdHlwZS5nZXRCbG9iID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFBhcnNlZChuZXcgQmxvYlBhcnNlcigpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIGNvbnRlbnRzIG9mIGEgZmlsZSBhcyBhbiBBcnJheUJ1ZmZlciwgd29ya3MgaW4gTm9kZS5qc1xyXG4gICAgICovXHJcbiAgICBBdHRhY2htZW50RmlsZS5wcm90b3R5cGUuZ2V0QnVmZmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFBhcnNlZChuZXcgQnVmZmVyUGFyc2VyKCkpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY29udGVudHMgb2YgYSBmaWxlIGFzIGFuIEFycmF5QnVmZmVyLCB3b3JrcyBpbiBOb2RlLmpzXHJcbiAgICAgKi9cclxuICAgIEF0dGFjaG1lbnRGaWxlLnByb3RvdHlwZS5nZXRKU09OID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFBhcnNlZChuZXcgSlNPTlBhcnNlcigpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdGhlIGNvbnRlbnQgb2YgYSBmaWxlLiBOb3Qgc3VwcG9ydGVkIGZvciBiYXRjaGluZ1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb250ZW50IFRoZSB2YWx1ZSB0byBzZXQgZm9yIHRoZSBmaWxlIGNvbnRlbnRzXHJcbiAgICAgKi9cclxuICAgIEF0dGFjaG1lbnRGaWxlLnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gKGNvbnRlbnQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEF0dGFjaG1lbnRGaWxlLCBcIiR2YWx1ZVwiLCBmYWxzZSkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBjb250ZW50LFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBcIlgtSFRUUC1NZXRob2RcIjogXCJQVVRcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChfKSB7IHJldHVybiBuZXcgQXR0YWNobWVudEZpbGUoX3RoaXMpOyB9KTtcclxuICAgIH07XHJcbiAgICAvLyAvKipcclxuICAgIC8vICAqIERlbGV0ZSB0aGlzIGF0dGFjaG1lbnQgZmlsZVxyXG4gICAgLy8gICpcclxuICAgIC8vICAqIEBwYXJhbSBlVGFnIFZhbHVlIHVzZWQgaW4gdGhlIElGLU1hdGNoIGhlYWRlciwgYnkgZGVmYXVsdCBcIipcIlxyXG4gICAgLy8gICovXHJcbiAgICAvLyBwdWJsaWMgZGVsZXRlKGVUYWcgPSBcIipcIik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgLy8gICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHtcclxuICAgIC8vICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgLy8gICAgICAgICAgICAgXCJJRi1NYXRjaFwiOiBlVGFnLFxyXG4gICAgLy8gICAgICAgICAgICAgXCJYLUhUVFAtTWV0aG9kXCI6IFwiREVMRVRFXCIsXHJcbiAgICAvLyAgICAgICAgIH0sXHJcbiAgICAvLyAgICAgfSk7XHJcbiAgICAvLyB9XHJcbiAgICBBdHRhY2htZW50RmlsZS5wcm90b3R5cGUuZ2V0UGFyc2VkID0gZnVuY3Rpb24gKHBhcnNlcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEF0dGFjaG1lbnRGaWxlLCBcIiR2YWx1ZVwiLCBmYWxzZSkuZ2V0KHBhcnNlcik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEF0dGFjaG1lbnRGaWxlO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xuXG4vKipcclxuICogRGVzY3JpYmVzIHRoZSB2aWV3cyBhdmFpbGFibGUgaW4gdGhlIGN1cnJlbnQgY29udGV4dFxyXG4gKlxyXG4gKi9cclxudmFyIFZpZXdzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFZpZXdzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVmlld3MoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgVmlld3NfMSA9IFZpZXdzO1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgdmlldyBieSBndWlkIGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBHVUlEIGlkIG9mIHRoZSB2aWV3XHJcbiAgICAgKi9cclxuICAgIFZpZXdzLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgdmFyIHYgPSBuZXcgVmlldyh0aGlzKTtcclxuICAgICAgICB2LmNvbmNhdChcIignXCIgKyBpZCArIFwiJylcIik7XHJcbiAgICAgICAgcmV0dXJuIHY7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgdmlldyBieSB0aXRsZSAoY2FzZS1zZW5zaXRpdmUpXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRpdGxlIFRoZSBjYXNlLXNlbnNpdGl2ZSB0aXRsZSBvZiB0aGUgdmlld1xyXG4gICAgICovXHJcbiAgICBWaWV3cy5wcm90b3R5cGUuZ2V0QnlUaXRsZSA9IGZ1bmN0aW9uICh0aXRsZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgVmlldyh0aGlzLCBcImdldEJ5VGl0bGUoJ1wiICsgdGl0bGUgKyBcIicpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyB2aWV3IHRvIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRpdGxlIFRoZSBuZXcgdmlld3MncyB0aXRsZVxyXG4gICAgICogQHBhcmFtIHBlcnNvbmFsVmlldyBUcnVlIGlmIHRoaXMgaXMgYSBwZXJzb25hbCB2aWV3LCBvdGhlcndpc2UgZmFsc2UsIGRlZmF1bHQgPSBmYWxzZVxyXG4gICAgICogQHBhcmFtIGFkZGl0aW9uYWxTZXR0aW5ncyBXaWxsIGJlIHBhc3NlZCBhcyBwYXJ0IG9mIHRoZSB2aWV3IGNyZWF0aW9uIGJvZHlcclxuICAgICAqL1xyXG4gICAgVmlld3MucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh0aXRsZSwgcGVyc29uYWxWaWV3LCBhZGRpdGlvbmFsU2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChwZXJzb25hbFZpZXcgPT09IHZvaWQgMCkgeyBwZXJzb25hbFZpZXcgPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmIChhZGRpdGlvbmFsU2V0dGluZ3MgPT09IHZvaWQgMCkgeyBhZGRpdGlvbmFsU2V0dGluZ3MgPSB7fTsgfVxyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyhPYmplY3QuYXNzaWduKG1ldGFkYXRhKFwiU1AuVmlld1wiKSwge1xyXG4gICAgICAgICAgICBcIlBlcnNvbmFsVmlld1wiOiBwZXJzb25hbFZpZXcsXHJcbiAgICAgICAgICAgIFwiVGl0bGVcIjogdGl0bGUsXHJcbiAgICAgICAgfSwgYWRkaXRpb25hbFNldHRpbmdzKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoVmlld3NfMSwgbnVsbCkucG9zdENvcmUoeyBib2R5OiBwb3N0Qm9keSB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICAgICAgdmlldzogX3RoaXMuZ2V0QnlJZChkYXRhLklkKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgVmlld3NfMTtcclxuICAgIFZpZXdzID0gVmlld3NfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwidmlld3NcIilcclxuICAgIF0sIFZpZXdzKTtcclxuICAgIHJldHVybiBWaWV3cztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIFZpZXcgaW5zdGFuY2VcclxuICpcclxuICovXHJcbnZhciBWaWV3ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFZpZXcsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBWaWV3KCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVwZGF0ZXMgdGhpcyB2aWV3IGludGFuY2Ugd2l0aCB0aGUgc3VwcGxpZWQgcHJvcGVydGllc1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHByb3BlcnRpZXMgQSBwbGFpbiBvYmplY3QgaGFzaCBvZiB2YWx1ZXMgdG8gdXBkYXRlIGZvciB0aGUgdmlld1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIF90aGlzLnVwZGF0ZSA9IF90aGlzLl91cGRhdGUoXCJTUC5WaWV3XCIsIGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiAoeyBkYXRhOiBkYXRhLCB2aWV3OiBfdGhpcyB9KTsgfSk7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRGVsZXRlIHRoaXMgdmlld1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgX3RoaXMuZGVsZXRlID0gX3RoaXMuX2RlbGV0ZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVmlldy5wcm90b3R5cGUsIFwiZmllbGRzXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWaWV3RmllbGRzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBsaXN0IHZpZXcgYXMgSFRNTC5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIFZpZXcucHJvdG90eXBlLnJlbmRlckFzSHRtbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlLCBcInJlbmRlcmFzaHRtbFwiKS5nZXQoKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVmlldztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcclxudmFyIFZpZXdGaWVsZHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVmlld0ZpZWxkcywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFZpZXdGaWVsZHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgVmlld0ZpZWxkc18xID0gVmlld0ZpZWxkcztcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIHZhbHVlIHRoYXQgc3BlY2lmaWVzIHRoZSBYTUwgc2NoZW1hIHRoYXQgcmVwcmVzZW50cyB0aGUgY29sbGVjdGlvbi5cclxuICAgICAqL1xyXG4gICAgVmlld0ZpZWxkcy5wcm90b3R5cGUuZ2V0U2NoZW1hWG1sID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNoYXJlUG9pbnRRdWVyeWFibGUsIFwic2NoZW1heG1sXCIpLmdldCgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyB0aGUgZmllbGQgd2l0aCB0aGUgc3BlY2lmaWVkIGZpZWxkIGludGVybmFsIG5hbWUgb3IgZGlzcGxheSBuYW1lIHRvIHRoZSBjb2xsZWN0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmaWVsZFRpdGxlT3JJbnRlcm5hbE5hbWUgVGhlIGNhc2Utc2Vuc2l0aXZlIGludGVybmFsIG5hbWUgb3IgZGlzcGxheSBuYW1lIG9mIHRoZSBmaWVsZCB0byBhZGQuXHJcbiAgICAgKi9cclxuICAgIFZpZXdGaWVsZHMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChmaWVsZFRpdGxlT3JJbnRlcm5hbE5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShWaWV3RmllbGRzXzEsIFwiYWRkdmlld2ZpZWxkKCdcIiArIGZpZWxkVGl0bGVPckludGVybmFsTmFtZSArIFwiJylcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIE1vdmVzIHRoZSBmaWVsZCB3aXRoIHRoZSBzcGVjaWZpZWQgZmllbGQgaW50ZXJuYWwgbmFtZSB0byB0aGUgc3BlY2lmaWVkIHBvc2l0aW9uIGluIHRoZSBjb2xsZWN0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmaWVsZEludGVybmFsTmFtZSBUaGUgY2FzZS1zZW5zaXRpdmUgaW50ZXJuYWwgbmFtZSBvZiB0aGUgZmllbGQgdG8gbW92ZS5cclxuICAgICAqIEBwYXJhbSBpbmRleCBUaGUgemVyby1iYXNlZCBpbmRleCBvZiB0aGUgbmV3IHBvc2l0aW9uIGZvciB0aGUgZmllbGQuXHJcbiAgICAgKi9cclxuICAgIFZpZXdGaWVsZHMucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAoZmllbGRJbnRlcm5hbE5hbWUsIGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoVmlld0ZpZWxkc18xLCBcIm1vdmV2aWV3ZmllbGR0b1wiKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7IFwiZmllbGRcIjogZmllbGRJbnRlcm5hbE5hbWUsIFwiaW5kZXhcIjogaW5kZXggfSksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmVzIGFsbCB0aGUgZmllbGRzIGZyb20gdGhlIGNvbGxlY3Rpb24uXHJcbiAgICAgKi9cclxuICAgIFZpZXdGaWVsZHMucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShWaWV3RmllbGRzXzEsIFwicmVtb3ZlYWxsdmlld2ZpZWxkc1wiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyB0aGUgZmllbGQgd2l0aCB0aGUgc3BlY2lmaWVkIGZpZWxkIGludGVybmFsIG5hbWUgZnJvbSB0aGUgY29sbGVjdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZmllbGRJbnRlcm5hbE5hbWUgVGhlIGNhc2Utc2Vuc2l0aXZlIGludGVybmFsIG5hbWUgb2YgdGhlIGZpZWxkIHRvIHJlbW92ZSBmcm9tIHRoZSB2aWV3LlxyXG4gICAgICovXHJcbiAgICBWaWV3RmllbGRzLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoZmllbGRJbnRlcm5hbE5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShWaWV3RmllbGRzXzEsIFwicmVtb3Zldmlld2ZpZWxkKCdcIiArIGZpZWxkSW50ZXJuYWxOYW1lICsgXCInKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIHZhciBWaWV3RmllbGRzXzE7XHJcbiAgICBWaWV3RmllbGRzID0gVmlld0ZpZWxkc18xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJ2aWV3ZmllbGRzXCIpXHJcbiAgICBdLCBWaWV3RmllbGRzKTtcclxuICAgIHJldHVybiBWaWV3RmllbGRzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XG5cbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIEZpZWxkIG9iamVjdHNcclxuICpcclxuICovXHJcbnZhciBGaWVsZHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRmllbGRzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRmllbGRzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIEZpZWxkc18xID0gRmllbGRzO1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgZmllbGQgZnJvbSB0aGUgY29sbGVjdGlvbiBieSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgSWQgb2YgdGhlIGxpc3RcclxuICAgICAqL1xyXG4gICAgRmllbGRzLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgdmFyIGYgPSBuZXcgRmllbGQodGhpcyk7XHJcbiAgICAgICAgZi5jb25jYXQoXCIoJ1wiICsgaWQgKyBcIicpXCIpO1xyXG4gICAgICAgIHJldHVybiBmO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGZpZWxkIGZyb20gdGhlIGNvbGxlY3Rpb24gYnkgdGl0bGVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIGNhc2Utc2Vuc2l0aXZlIHRpdGxlIG9mIHRoZSBmaWVsZFxyXG4gICAgICovXHJcbiAgICBGaWVsZHMucHJvdG90eXBlLmdldEJ5VGl0bGUgPSBmdW5jdGlvbiAodGl0bGUpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMsIFwiZ2V0QnlUaXRsZSgnXCIgKyB0aXRsZSArIFwiJylcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgZmllbGQgZnJvbSB0aGUgY29sbGVjdGlvbiBieSB1c2luZyBpbnRlcm5hbCBuYW1lIG9yIHRpdGxlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIGNhc2Utc2Vuc2l0aXZlIGludGVybmFsIG5hbWUgb3IgdGl0bGUgb2YgdGhlIGZpZWxkXHJcbiAgICAgKi9cclxuICAgIEZpZWxkcy5wcm90b3R5cGUuZ2V0QnlJbnRlcm5hbE5hbWVPclRpdGxlID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMsIFwiZ2V0QnlJbnRlcm5hbE5hbWVPclRpdGxlKCdcIiArIG5hbWUgKyBcIicpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIGZpZWxkIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgc2NoZW1hXHJcbiAgICAgKi9cclxuICAgIEZpZWxkcy5wcm90b3R5cGUuY3JlYXRlRmllbGRBc1htbCA9IGZ1bmN0aW9uICh4bWwpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBpbmZvO1xyXG4gICAgICAgIGlmICh0eXBlb2YgeG1sID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGluZm8gPSB7IFNjaGVtYVhtbDogeG1sIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpbmZvID0geG1sO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1Moe1xyXG4gICAgICAgICAgICBcInBhcmFtZXRlcnNcIjogZXh0ZW5kKG1ldGFkYXRhKFwiU1AuWG1sU2NoZW1hRmllbGRDcmVhdGlvbkluZm9ybWF0aW9uXCIpLCBpbmZvKSxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWVsZHNfMSwgXCJjcmVhdGVmaWVsZGFzeG1sXCIpLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHkgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBfdGhpcy5nZXRCeUlkKGRhdGEuSWQpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBmaWVsZCB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0aXRsZSBUaGUgbmV3IGZpZWxkJ3MgdGl0bGVcclxuICAgICAqIEBwYXJhbSBmaWVsZFR5cGUgVGhlIG5ldyBmaWVsZCdzIHR5cGUgKGV4OiBTUC5GaWVsZFRleHQpXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBEaWZmZXIgYnkgdHlwZSBvZiBmaWVsZCBiZWluZyBjcmVhdGVkIChzZWU6IGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvb2ZmaWNlL2RuNjAwMTgyLmFzcHgpXHJcbiAgICAgKi9cclxuICAgIEZpZWxkcy5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHRpdGxlLCBmaWVsZFR5cGUsIHByb3BlcnRpZXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyhPYmplY3QuYXNzaWduKG1ldGFkYXRhKGZpZWxkVHlwZSksIHtcclxuICAgICAgICAgICAgXCJUaXRsZVwiOiB0aXRsZSxcclxuICAgICAgICB9LCBwcm9wZXJ0aWVzKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmllbGRzXzEsIG51bGwpLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHkgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBfdGhpcy5nZXRCeUlkKGRhdGEuSWQpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBTUC5GaWVsZFRleHQgdG8gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIGZpZWxkIHRpdGxlXHJcbiAgICAgKiBAcGFyYW0gbWF4TGVuZ3RoIFRoZSBtYXhpbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIGFsbG93ZWQgaW4gdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC5cclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzIERpZmZlciBieSB0eXBlIG9mIGZpZWxkIGJlaW5nIGNyZWF0ZWQgKHNlZTogaHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9vZmZpY2UvZG42MDAxODIuYXNweClcclxuICAgICAqL1xyXG4gICAgRmllbGRzLnByb3RvdHlwZS5hZGRUZXh0ID0gZnVuY3Rpb24gKHRpdGxlLCBtYXhMZW5ndGgsIHByb3BlcnRpZXMpIHtcclxuICAgICAgICBpZiAobWF4TGVuZ3RoID09PSB2b2lkIDApIHsgbWF4TGVuZ3RoID0gMjU1OyB9XHJcbiAgICAgICAgdmFyIHByb3BzID0ge1xyXG4gICAgICAgICAgICBGaWVsZFR5cGVLaW5kOiAyLFxyXG4gICAgICAgICAgICBNYXhMZW5ndGg6IG1heExlbmd0aCxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFkZCh0aXRsZSwgXCJTUC5GaWVsZFRleHRcIiwgZXh0ZW5kKHByb3BzLCBwcm9wZXJ0aWVzKSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IFNQLkZpZWxkQ2FsY3VsYXRlZCB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0aXRsZSBUaGUgZmllbGQgdGl0bGUuXHJcbiAgICAgKiBAcGFyYW0gZm9ybXVsYSBUaGUgZm9ybXVsYSBmb3IgdGhlIGZpZWxkLlxyXG4gICAgICogQHBhcmFtIGRhdGVGb3JtYXQgVGhlIGRhdGUgYW5kIHRpbWUgZm9ybWF0IHRoYXQgaXMgZGlzcGxheWVkIGluIHRoZSBmaWVsZC5cclxuICAgICAqIEBwYXJhbSBvdXRwdXRUeXBlIFNwZWNpZmllcyB0aGUgb3V0cHV0IGZvcm1hdCBmb3IgdGhlIGZpZWxkLiBSZXByZXNlbnRzIGEgRmllbGRUeXBlIHZhbHVlLlxyXG4gICAgICogQHBhcmFtIHByb3BlcnRpZXMgRGlmZmVyIGJ5IHR5cGUgb2YgZmllbGQgYmVpbmcgY3JlYXRlZCAoc2VlOiBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L29mZmljZS9kbjYwMDE4Mi5hc3B4KVxyXG4gICAgICovXHJcbiAgICBGaWVsZHMucHJvdG90eXBlLmFkZENhbGN1bGF0ZWQgPSBmdW5jdGlvbiAodGl0bGUsIGZvcm11bGEsIGRhdGVGb3JtYXQsIG91dHB1dFR5cGUsIHByb3BlcnRpZXMpIHtcclxuICAgICAgICBpZiAob3V0cHV0VHlwZSA9PT0gdm9pZCAwKSB7IG91dHB1dFR5cGUgPSBGaWVsZFR5cGVzLlRleHQ7IH1cclxuICAgICAgICB2YXIgcHJvcHMgPSB7XHJcbiAgICAgICAgICAgIERhdGVGb3JtYXQ6IGRhdGVGb3JtYXQsXHJcbiAgICAgICAgICAgIEZpZWxkVHlwZUtpbmQ6IDE3LFxyXG4gICAgICAgICAgICBGb3JtdWxhOiBmb3JtdWxhLFxyXG4gICAgICAgICAgICBPdXRwdXRUeXBlOiBvdXRwdXRUeXBlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHRpdGxlLCBcIlNQLkZpZWxkQ2FsY3VsYXRlZFwiLCBleHRlbmQocHJvcHMsIHByb3BlcnRpZXMpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgU1AuRmllbGREYXRlVGltZSB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0aXRsZSBUaGUgZmllbGQgdGl0bGVcclxuICAgICAqIEBwYXJhbSBkaXNwbGF5Rm9ybWF0IFRoZSBmb3JtYXQgb2YgdGhlIGRhdGUgYW5kIHRpbWUgdGhhdCBpcyBkaXNwbGF5ZWQgaW4gdGhlIGZpZWxkLlxyXG4gICAgICogQHBhcmFtIGNhbGVuZGFyVHlwZSBTcGVjaWZpZXMgdGhlIGNhbGVuZGFyIHR5cGUgb2YgdGhlIGZpZWxkLlxyXG4gICAgICogQHBhcmFtIHByb3BlcnRpZXMgRGlmZmVyIGJ5IHR5cGUgb2YgZmllbGQgYmVpbmcgY3JlYXRlZCAoc2VlOiBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L29mZmljZS9kbjYwMDE4Mi5hc3B4KVxyXG4gICAgICovXHJcbiAgICBGaWVsZHMucHJvdG90eXBlLmFkZERhdGVUaW1lID0gZnVuY3Rpb24gKHRpdGxlLCBkaXNwbGF5Rm9ybWF0LCBjYWxlbmRhclR5cGUsIGZyaWVuZGx5RGlzcGxheUZvcm1hdCwgcHJvcGVydGllcykge1xyXG4gICAgICAgIGlmIChkaXNwbGF5Rm9ybWF0ID09PSB2b2lkIDApIHsgZGlzcGxheUZvcm1hdCA9IERhdGVUaW1lRmllbGRGb3JtYXRUeXBlLkRhdGVPbmx5OyB9XHJcbiAgICAgICAgaWYgKGNhbGVuZGFyVHlwZSA9PT0gdm9pZCAwKSB7IGNhbGVuZGFyVHlwZSA9IENhbGVuZGFyVHlwZS5HcmVnb3JpYW47IH1cclxuICAgICAgICBpZiAoZnJpZW5kbHlEaXNwbGF5Rm9ybWF0ID09PSB2b2lkIDApIHsgZnJpZW5kbHlEaXNwbGF5Rm9ybWF0ID0gMDsgfVxyXG4gICAgICAgIHZhciBwcm9wcyA9IHtcclxuICAgICAgICAgICAgRGF0ZVRpbWVDYWxlbmRhclR5cGU6IGNhbGVuZGFyVHlwZSxcclxuICAgICAgICAgICAgRGlzcGxheUZvcm1hdDogZGlzcGxheUZvcm1hdCxcclxuICAgICAgICAgICAgRmllbGRUeXBlS2luZDogNCxcclxuICAgICAgICAgICAgRnJpZW5kbHlEaXNwbGF5Rm9ybWF0OiBmcmllbmRseURpc3BsYXlGb3JtYXQsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGQodGl0bGUsIFwiU1AuRmllbGREYXRlVGltZVwiLCBleHRlbmQocHJvcHMsIHByb3BlcnRpZXMpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgU1AuRmllbGROdW1iZXIgdG8gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIGZpZWxkIHRpdGxlXHJcbiAgICAgKiBAcGFyYW0gbWluVmFsdWUgVGhlIGZpZWxkJ3MgbWluaW11bSB2YWx1ZVxyXG4gICAgICogQHBhcmFtIG1heFZhbHVlIFRoZSBmaWVsZCdzIG1heGltdW0gdmFsdWVcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzIERpZmZlciBieSB0eXBlIG9mIGZpZWxkIGJlaW5nIGNyZWF0ZWQgKHNlZTogaHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9vZmZpY2UvZG42MDAxODIuYXNweClcclxuICAgICAqL1xyXG4gICAgRmllbGRzLnByb3RvdHlwZS5hZGROdW1iZXIgPSBmdW5jdGlvbiAodGl0bGUsIG1pblZhbHVlLCBtYXhWYWx1ZSwgcHJvcGVydGllcykge1xyXG4gICAgICAgIHZhciBwcm9wcyA9IHsgRmllbGRUeXBlS2luZDogOSB9O1xyXG4gICAgICAgIGlmIChtaW5WYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHByb3BzID0gZXh0ZW5kKHsgTWluaW11bVZhbHVlOiBtaW5WYWx1ZSB9LCBwcm9wcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtYXhWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHByb3BzID0gZXh0ZW5kKHsgTWF4aW11bVZhbHVlOiBtYXhWYWx1ZSB9LCBwcm9wcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmFkZCh0aXRsZSwgXCJTUC5GaWVsZE51bWJlclwiLCBleHRlbmQocHJvcHMsIHByb3BlcnRpZXMpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgU1AuRmllbGRDdXJyZW5jeSB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0aXRsZSBUaGUgZmllbGQgdGl0bGVcclxuICAgICAqIEBwYXJhbSBtaW5WYWx1ZSBUaGUgZmllbGQncyBtaW5pbXVtIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0gbWF4VmFsdWUgVGhlIGZpZWxkJ3MgbWF4aW11bSB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGN1cnJlbmN5TG9jYWxJZCBTcGVjaWZpZXMgdGhlIGxhbmd1YWdlIGNvZGUgaWRlbnRpZmllciAoTENJRCkgdXNlZCB0byBmb3JtYXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZFxyXG4gICAgICogQHBhcmFtIHByb3BlcnRpZXMgRGlmZmVyIGJ5IHR5cGUgb2YgZmllbGQgYmVpbmcgY3JlYXRlZCAoc2VlOiBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L29mZmljZS9kbjYwMDE4Mi5hc3B4KVxyXG4gICAgICovXHJcbiAgICBGaWVsZHMucHJvdG90eXBlLmFkZEN1cnJlbmN5ID0gZnVuY3Rpb24gKHRpdGxlLCBtaW5WYWx1ZSwgbWF4VmFsdWUsIGN1cnJlbmN5TG9jYWxJZCwgcHJvcGVydGllcykge1xyXG4gICAgICAgIGlmIChjdXJyZW5jeUxvY2FsSWQgPT09IHZvaWQgMCkgeyBjdXJyZW5jeUxvY2FsSWQgPSAxMDMzOyB9XHJcbiAgICAgICAgdmFyIHByb3BzID0ge1xyXG4gICAgICAgICAgICBDdXJyZW5jeUxvY2FsZUlkOiBjdXJyZW5jeUxvY2FsSWQsXHJcbiAgICAgICAgICAgIEZpZWxkVHlwZUtpbmQ6IDEwLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKG1pblZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcHJvcHMgPSBleHRlbmQoeyBNaW5pbXVtVmFsdWU6IG1pblZhbHVlIH0sIHByb3BzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1heFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcHJvcHMgPSBleHRlbmQoeyBNYXhpbXVtVmFsdWU6IG1heFZhbHVlIH0sIHByb3BzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHRpdGxlLCBcIlNQLkZpZWxkQ3VycmVuY3lcIiwgZXh0ZW5kKHByb3BzLCBwcm9wZXJ0aWVzKSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IFNQLkZpZWxkTXVsdGlMaW5lVGV4dCB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0aXRsZSBUaGUgZmllbGQgdGl0bGVcclxuICAgICAqIEBwYXJhbSBudW1iZXJPZkxpbmVzIFNwZWNpZmllcyB0aGUgbnVtYmVyIG9mIGxpbmVzIG9mIHRleHQgdG8gZGlzcGxheSBmb3IgdGhlIGZpZWxkLlxyXG4gICAgICogQHBhcmFtIHJpY2hUZXh0IFNwZWNpZmllcyB3aGV0aGVyIHRoZSBmaWVsZCBzdXBwb3J0cyByaWNoIGZvcm1hdHRpbmcuXHJcbiAgICAgKiBAcGFyYW0gcmVzdHJpY3RlZE1vZGUgU3BlY2lmaWVzIHdoZXRoZXIgdGhlIGZpZWxkIHN1cHBvcnRzIGEgc3Vic2V0IG9mIHJpY2ggZm9ybWF0dGluZy5cclxuICAgICAqIEBwYXJhbSBhcHBlbmRPbmx5IFNwZWNpZmllcyB3aGV0aGVyIGFsbCBjaGFuZ2VzIHRvIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQgYXJlIGRpc3BsYXllZCBpbiBsaXN0IGZvcm1zLlxyXG4gICAgICogQHBhcmFtIGFsbG93SHlwZXJsaW5rIFNwZWNpZmllcyB3aGV0aGVyIGEgaHlwZXJsaW5rIGlzIGFsbG93ZWQgYXMgYSB2YWx1ZSBvZiB0aGUgZmllbGQuXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBEaWZmZXIgYnkgdHlwZSBvZiBmaWVsZCBiZWluZyBjcmVhdGVkIChzZWU6IGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvb2ZmaWNlL2RuNjAwMTgyLmFzcHgpXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBGaWVsZHMucHJvdG90eXBlLmFkZE11bHRpbGluZVRleHQgPSBmdW5jdGlvbiAodGl0bGUsIG51bWJlck9mTGluZXMsIHJpY2hUZXh0LCByZXN0cmljdGVkTW9kZSwgYXBwZW5kT25seSwgYWxsb3dIeXBlcmxpbmssIHByb3BlcnRpZXMpIHtcclxuICAgICAgICBpZiAobnVtYmVyT2ZMaW5lcyA9PT0gdm9pZCAwKSB7IG51bWJlck9mTGluZXMgPSA2OyB9XHJcbiAgICAgICAgaWYgKHJpY2hUZXh0ID09PSB2b2lkIDApIHsgcmljaFRleHQgPSB0cnVlOyB9XHJcbiAgICAgICAgaWYgKHJlc3RyaWN0ZWRNb2RlID09PSB2b2lkIDApIHsgcmVzdHJpY3RlZE1vZGUgPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmIChhcHBlbmRPbmx5ID09PSB2b2lkIDApIHsgYXBwZW5kT25seSA9IGZhbHNlOyB9XHJcbiAgICAgICAgaWYgKGFsbG93SHlwZXJsaW5rID09PSB2b2lkIDApIHsgYWxsb3dIeXBlcmxpbmsgPSB0cnVlOyB9XHJcbiAgICAgICAgdmFyIHByb3BzID0ge1xyXG4gICAgICAgICAgICBBbGxvd0h5cGVybGluazogYWxsb3dIeXBlcmxpbmssXHJcbiAgICAgICAgICAgIEFwcGVuZE9ubHk6IGFwcGVuZE9ubHksXHJcbiAgICAgICAgICAgIEZpZWxkVHlwZUtpbmQ6IDMsXHJcbiAgICAgICAgICAgIE51bWJlck9mTGluZXM6IG51bWJlck9mTGluZXMsXHJcbiAgICAgICAgICAgIFJlc3RyaWN0ZWRNb2RlOiByZXN0cmljdGVkTW9kZSxcclxuICAgICAgICAgICAgUmljaFRleHQ6IHJpY2hUZXh0LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHRpdGxlLCBcIlNQLkZpZWxkTXVsdGlMaW5lVGV4dFwiLCBleHRlbmQocHJvcHMsIHByb3BlcnRpZXMpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgU1AuRmllbGRVcmwgdG8gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIGZpZWxkIHRpdGxlXHJcbiAgICAgKi9cclxuICAgIEZpZWxkcy5wcm90b3R5cGUuYWRkVXJsID0gZnVuY3Rpb24gKHRpdGxlLCBkaXNwbGF5Rm9ybWF0LCBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgaWYgKGRpc3BsYXlGb3JtYXQgPT09IHZvaWQgMCkgeyBkaXNwbGF5Rm9ybWF0ID0gVXJsRmllbGRGb3JtYXRUeXBlLkh5cGVybGluazsgfVxyXG4gICAgICAgIHZhciBwcm9wcyA9IHtcclxuICAgICAgICAgICAgRGlzcGxheUZvcm1hdDogZGlzcGxheUZvcm1hdCxcclxuICAgICAgICAgICAgRmllbGRUeXBlS2luZDogMTEsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGQodGl0bGUsIFwiU1AuRmllbGRVcmxcIiwgZXh0ZW5kKHByb3BzLCBwcm9wZXJ0aWVzKSk7XHJcbiAgICB9O1xyXG4gICAgLyoqIEFkZHMgYSB1c2VyIGZpZWxkIHRvIHRoZSBjb2xsZWNpdG9uXHJcbiAgICAqXHJcbiAgICAqIEBwYXJhbSB0aXRsZSBUaGUgbmV3IGZpZWxkJ3MgdGl0bGVcclxuICAgICogQHBhcmFtIHNlbGVjdGlvbk1vZGUgVGhlIHNlbGVjdGlvbiBtb2RlIG9mIHRoZSBmaWVsZFxyXG4gICAgKiBAcGFyYW0gc2VsZWN0aW9uR3JvdXAgVmFsdWUgdGhhdCBzcGVjaWZpZXMgdGhlIGlkZW50aWZpZXIgb2YgdGhlIFNoYXJlUG9pbnQgZ3JvdXAgd2hvc2UgbWVtYmVycyBjYW4gYmUgc2VsZWN0ZWQgYXMgdmFsdWVzIG9mIHRoZSBmaWVsZFxyXG4gICAgKiBAcGFyYW0gcHJvcGVydGllc1xyXG4gICAgKi9cclxuICAgIEZpZWxkcy5wcm90b3R5cGUuYWRkVXNlciA9IGZ1bmN0aW9uICh0aXRsZSwgc2VsZWN0aW9uTW9kZSwgcHJvcGVydGllcykge1xyXG4gICAgICAgIHZhciBwcm9wcyA9IHtcclxuICAgICAgICAgICAgRmllbGRUeXBlS2luZDogMjAsXHJcbiAgICAgICAgICAgIFNlbGVjdGlvbk1vZGU6IHNlbGVjdGlvbk1vZGUsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGQodGl0bGUsIFwiU1AuRmllbGRVc2VyXCIsIGV4dGVuZChwcm9wcywgcHJvcGVydGllcykpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIFNQLkZpZWxkTG9va3VwIHRvIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRpdGxlIFRoZSBuZXcgZmllbGQncyB0aXRsZVxyXG4gICAgICogQHBhcmFtIGxvb2t1cExpc3RJZCBUaGUgZ3VpZCBpZCBvZiB0aGUgbGlzdCB3aGVyZSB0aGUgc291cmNlIG9mIHRoZSBsb29rdXAgaXMgZm91bmRcclxuICAgICAqIEBwYXJhbSBsb29rdXBGaWVsZE5hbWUgVGhlIGludGVybmFsIG5hbWUgb2YgdGhlIGZpZWxkIGluIHRoZSBzb3VyY2UgbGlzdFxyXG4gICAgICogQHBhcmFtIHByb3BlcnRpZXMgU2V0IG9mIGFkZGl0aW9uYWwgcHJvcGVydGllcyB0byBzZXQgb24gdGhlIG5ldyBmaWVsZFxyXG4gICAgICovXHJcbiAgICBGaWVsZHMucHJvdG90eXBlLmFkZExvb2t1cCA9IGZ1bmN0aW9uICh0aXRsZSwgbG9va3VwTGlzdElkLCBsb29rdXBGaWVsZE5hbWUsIHByb3BlcnRpZXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyhPYmplY3QuYXNzaWduKG1ldGFkYXRhKFwiU1AuRmllbGRDcmVhdGlvbkluZm9ybWF0aW9uXCIpLCB7XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IGV4dGVuZCh7XHJcbiAgICAgICAgICAgICAgICBGaWVsZFR5cGVLaW5kOiA3LFxyXG4gICAgICAgICAgICAgICAgTG9va3VwRmllbGROYW1lOiBsb29rdXBGaWVsZE5hbWUsXHJcbiAgICAgICAgICAgICAgICBMb29rdXBMaXN0SWQ6IGxvb2t1cExpc3RJZCxcclxuICAgICAgICAgICAgICAgIFRpdGxlOiB0aXRsZSxcclxuICAgICAgICAgICAgfSwgcHJvcGVydGllcyksXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpZWxkc18xLCBcImFkZGZpZWxkXCIpLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHkgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGZpZWxkOiBfdGhpcy5nZXRCeUlkKGRhdGEuSWQpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBTUC5GaWVsZENob2ljZSB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0aXRsZSBUaGUgZmllbGQgdGl0bGUuXHJcbiAgICAgKiBAcGFyYW0gY2hvaWNlcyBUaGUgY2hvaWNlcyBmb3IgdGhlIGZpZWxkLlxyXG4gICAgICogQHBhcmFtIGZvcm1hdCBUaGUgZGlzcGxheSBmb3JtYXQgb2YgdGhlIGF2YWlsYWJsZSBvcHRpb25zIGZvciB0aGUgZmllbGQuXHJcbiAgICAgKiBAcGFyYW0gZmlsbEluIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBmaWVsZCBhbGxvd3MgZmlsbC1pbiB2YWx1ZXMuXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBEaWZmZXIgYnkgdHlwZSBvZiBmaWVsZCBiZWluZyBjcmVhdGVkIChzZWU6IGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvb2ZmaWNlL2RuNjAwMTgyLmFzcHgpXHJcbiAgICAgKi9cclxuICAgIEZpZWxkcy5wcm90b3R5cGUuYWRkQ2hvaWNlID0gZnVuY3Rpb24gKHRpdGxlLCBjaG9pY2VzLCBmb3JtYXQsIGZpbGxJbiwgcHJvcGVydGllcykge1xyXG4gICAgICAgIGlmIChmb3JtYXQgPT09IHZvaWQgMCkgeyBmb3JtYXQgPSBDaG9pY2VGaWVsZEZvcm1hdFR5cGUuRHJvcGRvd247IH1cclxuICAgICAgICB2YXIgcHJvcHMgPSB7XHJcbiAgICAgICAgICAgIENob2ljZXM6IHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdHM6IGNob2ljZXMsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIEVkaXRGb3JtYXQ6IGZvcm1hdCxcclxuICAgICAgICAgICAgRmllbGRUeXBlS2luZDogNixcclxuICAgICAgICAgICAgRmlsbEluQ2hvaWNlOiBmaWxsSW4sXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGQodGl0bGUsIFwiU1AuRmllbGRDaG9pY2VcIiwgZXh0ZW5kKHByb3BzLCBwcm9wZXJ0aWVzKSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IFNQLkZpZWxkTXVsdGlDaG9pY2UgdG8gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIGZpZWxkIHRpdGxlLlxyXG4gICAgICogQHBhcmFtIGNob2ljZXMgVGhlIGNob2ljZXMgZm9yIHRoZSBmaWVsZC5cclxuICAgICAqIEBwYXJhbSBmaWxsSW4gU3BlY2lmaWVzIHdoZXRoZXIgdGhlIGZpZWxkIGFsbG93cyBmaWxsLWluIHZhbHVlcy5cclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzIERpZmZlciBieSB0eXBlIG9mIGZpZWxkIGJlaW5nIGNyZWF0ZWQgKHNlZTogaHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9vZmZpY2UvZG42MDAxODIuYXNweClcclxuICAgICAqL1xyXG4gICAgRmllbGRzLnByb3RvdHlwZS5hZGRNdWx0aUNob2ljZSA9IGZ1bmN0aW9uICh0aXRsZSwgY2hvaWNlcywgZmlsbEluLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgdmFyIHByb3BzID0ge1xyXG4gICAgICAgICAgICBDaG9pY2VzOiB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzOiBjaG9pY2VzLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBGaWVsZFR5cGVLaW5kOiAxNSxcclxuICAgICAgICAgICAgRmlsbEluQ2hvaWNlOiBmaWxsSW4sXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZGQodGl0bGUsIFwiU1AuRmllbGRNdWx0aUNob2ljZVwiLCBleHRlbmQocHJvcHMsIHByb3BlcnRpZXMpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgU1AuRmllbGRCb29sZWFuIHRvIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRpdGxlIFRoZSBmaWVsZCB0aXRsZS5cclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzIERpZmZlciBieSB0eXBlIG9mIGZpZWxkIGJlaW5nIGNyZWF0ZWQgKHNlZTogaHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9vZmZpY2UvZG42MDAxODIuYXNweClcclxuICAgICAqL1xyXG4gICAgRmllbGRzLnByb3RvdHlwZS5hZGRCb29sZWFuID0gZnVuY3Rpb24gKHRpdGxlLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgdmFyIHByb3BzID0ge1xyXG4gICAgICAgICAgICBGaWVsZFR5cGVLaW5kOiA4LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHRpdGxlLCBcIlNQLkZpZWxkXCIsIGV4dGVuZChwcm9wcywgcHJvcGVydGllcykpO1xyXG4gICAgfTtcclxuICAgIHZhciBGaWVsZHNfMTtcclxuICAgIEZpZWxkcyA9IEZpZWxkc18xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJmaWVsZHNcIilcclxuICAgIF0sIEZpZWxkcyk7XHJcbiAgICByZXR1cm4gRmllbGRzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBzaW5nbGUgb2YgRmllbGQgaW5zdGFuY2VcclxuICpcclxuICovXHJcbnZhciBGaWVsZCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhGaWVsZCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEZpZWxkKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERlbGV0ZSB0aGlzIGZpZWxkc1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgX3RoaXMuZGVsZXRlID0gX3RoaXMuX2RlbGV0ZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVwZGF0ZXMgdGhpcyBmaWVsZCBpbnRhbmNlIHdpdGggdGhlIHN1cHBsaWVkIHByb3BlcnRpZXNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBBIHBsYWluIG9iamVjdCBoYXNoIG9mIHZhbHVlcyB0byB1cGRhdGUgZm9yIHRoZSBsaXN0XHJcbiAgICAgKiBAcGFyYW0gZmllbGRUeXBlIFRoZSB0eXBlIHZhbHVlLCByZXF1aXJlZCB0byB1cGRhdGUgY2hpbGQgZmllbGQgdHlwZSBwcm9wZXJ0aWVzXHJcbiAgICAgKi9cclxuICAgIEZpZWxkLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAocHJvcGVydGllcywgZmllbGRUeXBlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoZmllbGRUeXBlID09PSB2b2lkIDApIHsgZmllbGRUeXBlID0gXCJTUC5GaWVsZFwiOyB9XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKGV4dGVuZChtZXRhZGF0YShmaWVsZFR5cGUpLCBwcm9wZXJ0aWVzKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBwb3N0Qm9keSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgXCJYLUhUVFAtTWV0aG9kXCI6IFwiTUVSR0VcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICAgICAgZmllbGQ6IF90aGlzLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhlIFNob3dJbkRpc3BsYXlGb3JtIHByb3BlcnR5IGZvciB0aGlzIGZpZWxkLlxyXG4gICAgICovXHJcbiAgICBGaWVsZC5wcm90b3R5cGUuc2V0U2hvd0luRGlzcGxheUZvcm0gPSBmdW5jdGlvbiAoc2hvdykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpZWxkLCBcInNldHNob3dpbmRpc3BsYXlmb3JtKFwiICsgc2hvdyArIFwiKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhlIFNob3dJbkVkaXRGb3JtIHByb3BlcnR5IGZvciB0aGlzIGZpZWxkLlxyXG4gICAgICovXHJcbiAgICBGaWVsZC5wcm90b3R5cGUuc2V0U2hvd0luRWRpdEZvcm0gPSBmdW5jdGlvbiAoc2hvdykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpZWxkLCBcInNldHNob3dpbmVkaXRmb3JtKFwiICsgc2hvdyArIFwiKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhlIFNob3dJbk5ld0Zvcm0gcHJvcGVydHkgZm9yIHRoaXMgZmllbGQuXHJcbiAgICAgKi9cclxuICAgIEZpZWxkLnByb3RvdHlwZS5zZXRTaG93SW5OZXdGb3JtID0gZnVuY3Rpb24gKHNob3cpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWVsZCwgXCJzZXRzaG93aW5uZXdmb3JtKFwiICsgc2hvdyArIFwiKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBGaWVsZDtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcblxuLyoqXHJcbiAqIERlc2NyaWJlcyBhIGNvbGxlY3Rpb24gb2YgRmllbGQgb2JqZWN0c1xyXG4gKlxyXG4gKi9cclxudmFyIEZvcm1zID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZvcm1zLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRm9ybXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgZm9ybSBieSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgZ3VpZCBpZCBvZiB0aGUgaXRlbSB0byByZXRyaWV2ZVxyXG4gICAgICovXHJcbiAgICBGb3Jtcy5wcm90b3R5cGUuZ2V0QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciBpID0gbmV3IEZvcm0odGhpcyk7XHJcbiAgICAgICAgaS5jb25jYXQoXCIoJ1wiICsgaWQgKyBcIicpXCIpO1xyXG4gICAgICAgIHJldHVybiBpO1xyXG4gICAgfTtcclxuICAgIEZvcm1zID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJmb3Jtc1wiKVxyXG4gICAgXSwgRm9ybXMpO1xyXG4gICAgcmV0dXJuIEZvcm1zO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBzaW5nbGUgb2YgRm9ybSBpbnN0YW5jZVxyXG4gKlxyXG4gKi9cclxudmFyIEZvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRm9ybSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEZvcm0oKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEZvcm07XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XG5cbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIHdlYmhvb2sgc3Vic2NyaXB0aW9uc1xyXG4gKlxyXG4gKi9cclxudmFyIFN1YnNjcmlwdGlvbnMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU3Vic2NyaXB0aW9ucywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFN1YnNjcmlwdGlvbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgd2ViaG9vayBzdWJzY3JpcHRpb25zIG9yIHRoZSBzcGVjaWZpZWQgd2ViaG9vayBzdWJzY3JpcHRpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc3Vic2NyaXB0aW9uSWQgVGhlIGlkIG9mIGEgc3BlY2lmaWMgd2ViaG9vayBzdWJzY3JpcHRpb24gdG8gcmV0cmlldmUsIG9taXQgdG8gcmV0cmlldmUgYWxsIHRoZSB3ZWJob29rIHN1YnNjcmlwdGlvbnNcclxuICAgICAqL1xyXG4gICAgU3Vic2NyaXB0aW9ucy5wcm90b3R5cGUuZ2V0QnlJZCA9IGZ1bmN0aW9uIChzdWJzY3JpcHRpb25JZCkge1xyXG4gICAgICAgIHZhciBzID0gbmV3IFN1YnNjcmlwdGlvbih0aGlzKTtcclxuICAgICAgICBzLmNvbmNhdChcIignXCIgKyBzdWJzY3JpcHRpb25JZCArIFwiJylcIik7XHJcbiAgICAgICAgcmV0dXJuIHM7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHdlYmhvb2sgc3Vic2NyaXB0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5vdGlmaWNhdGlvblVybCBUaGUgdXJsIHRvIHJlY2VpdmUgdGhlIG5vdGlmaWNhdGlvbnNcclxuICAgICAqIEBwYXJhbSBleHBpcmF0aW9uRGF0ZSBUaGUgZGF0ZSBhbmQgdGltZSB0byBleHBpcmUgdGhlIHN1YnNjcmlwdGlvbiBpbiB0aGUgZm9ybSBZWVlZLU1NLWRkVEhIOm1tOnNzKzAwOjAwIChtYXhpbXVtIG9mIDYgbW9udGhzKVxyXG4gICAgICogQHBhcmFtIGNsaWVudFN0YXRlIEEgY2xpZW50IHNwZWNpZmljIHN0cmluZyAoZGVmYXVsdHMgdG8gcG5wLWpzLWNvcmUtc3Vic2NyaXB0aW9uIHdoZW4gb21pdHRlZClcclxuICAgICAqL1xyXG4gICAgU3Vic2NyaXB0aW9ucy5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKG5vdGlmaWNhdGlvblVybCwgZXhwaXJhdGlvbkRhdGUsIGNsaWVudFN0YXRlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1Moe1xyXG4gICAgICAgICAgICBcImNsaWVudFN0YXRlXCI6IGNsaWVudFN0YXRlIHx8IFwicG5wLWpzLWNvcmUtc3Vic2NyaXB0aW9uXCIsXHJcbiAgICAgICAgICAgIFwiZXhwaXJhdGlvbkRhdGVUaW1lXCI6IGV4cGlyYXRpb25EYXRlLFxyXG4gICAgICAgICAgICBcIm5vdGlmaWNhdGlvblVybFwiOiBub3RpZmljYXRpb25VcmwsXHJcbiAgICAgICAgICAgIFwicmVzb3VyY2VcIjogdGhpcy50b1VybCgpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHksIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgZGF0YTogcmVzdWx0LCBzdWJzY3JpcHRpb246IF90aGlzLmdldEJ5SWQocmVzdWx0LmlkKSB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFN1YnNjcmlwdGlvbnMgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcInN1YnNjcmlwdGlvbnNcIilcclxuICAgIF0sIFN1YnNjcmlwdGlvbnMpO1xyXG4gICAgcmV0dXJuIFN1YnNjcmlwdGlvbnM7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24pKTtcclxuLyoqXHJcbiAqIERlc2NyaWJlcyBhIHNpbmdsZSB3ZWJob29rIHN1YnNjcmlwdGlvbiBpbnN0YW5jZVxyXG4gKlxyXG4gKi9cclxudmFyIFN1YnNjcmlwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhTdWJzY3JpcHRpb24sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTdWJzY3JpcHRpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW5ld3MgdGhpcyB3ZWJob29rIHN1YnNjcmlwdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBleHBpcmF0aW9uRGF0ZSBUaGUgZGF0ZSBhbmQgdGltZSB0byBleHBpcmUgdGhlIHN1YnNjcmlwdGlvbiBpbiB0aGUgZm9ybSBZWVlZLU1NLWRkVEhIOm1tOnNzKzAwOjAwIChtYXhpbXVtIG9mIDYgbW9udGhzKVxyXG4gICAgICovXHJcbiAgICBTdWJzY3JpcHRpb24ucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChleHBpcmF0aW9uRGF0ZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKHtcclxuICAgICAgICAgICAgXCJleHBpcmF0aW9uRGF0ZVRpbWVcIjogZXhwaXJhdGlvbkRhdGUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0Y2hDb3JlKHsgYm9keTogcG9zdEJvZHksIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IGRhdGEsIHN1YnNjcmlwdGlvbjogX3RoaXMgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhpcyB3ZWJob29rIHN1YnNjcmlwdGlvblxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgU3Vic2NyaXB0aW9uLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuZGVsZXRlQ29yZS5jYWxsKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTdWJzY3JpcHRpb247XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XG5cbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIHVzZXIgY3VzdG9tIGFjdGlvbnNcclxuICpcclxuICovXHJcbnZhciBVc2VyQ3VzdG9tQWN0aW9ucyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhVc2VyQ3VzdG9tQWN0aW9ucywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFVzZXJDdXN0b21BY3Rpb25zKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFVzZXJDdXN0b21BY3Rpb25zXzEgPSBVc2VyQ3VzdG9tQWN0aW9ucztcclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgdXNlciBjdXN0b20gYWN0aW9uIHdpdGggdGhlIHNwZWNpZmllZCBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgR1VJRCBpZCBvZiB0aGUgdXNlciBjdXN0b20gYWN0aW9uIHRvIHJldHJpZXZlXHJcbiAgICAgKi9cclxuICAgIFVzZXJDdXN0b21BY3Rpb25zLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgdmFyIHVjYSA9IG5ldyBVc2VyQ3VzdG9tQWN0aW9uKHRoaXMpO1xyXG4gICAgICAgIHVjYS5jb25jYXQoXCIoJ1wiICsgaWQgKyBcIicpXCIpO1xyXG4gICAgICAgIHJldHVybiB1Y2E7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgdXNlciBjdXN0b20gYWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHByb3BlcnRpZXMgVGhlIGluZm9ybWF0aW9uIG9iamVjdCBvZiBwcm9wZXJ0eSBuYW1lcyBhbmQgdmFsdWVzIHdoaWNoIGRlZmluZSB0aGUgbmV3IHVzZXIgY3VzdG9tIGFjdGlvblxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgVXNlckN1c3RvbUFjdGlvbnMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1MoZXh0ZW5kKHsgX19tZXRhZGF0YTogeyBcInR5cGVcIjogXCJTUC5Vc2VyQ3VzdG9tQWN0aW9uXCIgfSB9LCBwcm9wZXJ0aWVzKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdENvcmUoeyBib2R5OiBwb3N0Qm9keSB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246IF90aGlzLmdldEJ5SWQoZGF0YS5JZCksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlcyBhbGwgdXNlciBjdXN0b20gYWN0aW9ucyBpbiB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgVXNlckN1c3RvbUFjdGlvbnMucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFVzZXJDdXN0b21BY3Rpb25zXzEsIFwiY2xlYXJcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICB2YXIgVXNlckN1c3RvbUFjdGlvbnNfMTtcclxuICAgIFVzZXJDdXN0b21BY3Rpb25zID0gVXNlckN1c3RvbUFjdGlvbnNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwidXNlcmN1c3RvbWFjdGlvbnNcIilcclxuICAgIF0sIFVzZXJDdXN0b21BY3Rpb25zKTtcclxuICAgIHJldHVybiBVc2VyQ3VzdG9tQWN0aW9ucztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIHVzZXIgY3VzdG9tIGFjdGlvblxyXG4gKlxyXG4gKi9cclxudmFyIFVzZXJDdXN0b21BY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVXNlckN1c3RvbUFjdGlvbiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFVzZXJDdXN0b21BY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBVcGRhdGVzIHRoaXMgdXNlciBjdXN0b20gYWN0aW9uIHdpdGggdGhlIHN1cHBsaWVkIHByb3BlcnRpZXNcclxuICAgICAgICAqXHJcbiAgICAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBBbiBpbmZvcm1hdGlvbiBvYmplY3Qgb2YgcHJvcGVydHkgbmFtZXMgYW5kIHZhbHVlcyB0byB1cGRhdGUgZm9yIHRoaXMgdXNlciBjdXN0b20gYWN0aW9uXHJcbiAgICAgICAgKi9cclxuICAgICAgICBfdGhpcy51cGRhdGUgPSBfdGhpcy5fdXBkYXRlKFwiU1AuVXNlckN1c3RvbUFjdGlvblwiLCBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gKHsgZGF0YTogZGF0YSwgYWN0aW9uOiBfdGhpcyB9KTsgfSk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAqIFJlbW92ZXMgdGhpcyB1c2VyIGN1c3RvbSBhY3Rpb25cclxuICAgICpcclxuICAgICovXHJcbiAgICBVc2VyQ3VzdG9tQWN0aW9uLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuZGVsZXRlQ29yZS5jYWxsKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBVc2VyQ3VzdG9tQWN0aW9uO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xuXG4vKipcclxuICogRGVzY3JpYmVzIGEgY29sbGVjdGlvbiBvZiBMaXN0IG9iamVjdHNcclxuICpcclxuICovXHJcbnZhciBMaXN0cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhMaXN0cywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIExpc3RzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIExpc3RzXzEgPSBMaXN0cztcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGxpc3QgZnJvbSB0aGUgY29sbGVjdGlvbiBieSBndWlkIGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBJZCBvZiB0aGUgbGlzdCAoR1VJRClcclxuICAgICAqL1xyXG4gICAgTGlzdHMucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgbGlzdCA9IG5ldyBMaXN0KHRoaXMpO1xyXG4gICAgICAgIGxpc3QuY29uY2F0KFwiKCdcIiArIGlkICsgXCInKVwiKTtcclxuICAgICAgICByZXR1cm4gbGlzdDtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSBsaXN0IGZyb20gdGhlIGNvbGxlY3Rpb24gYnkgdGl0bGVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIHRpdGxlIG9mIHRoZSBsaXN0XHJcbiAgICAgKi9cclxuICAgIExpc3RzLnByb3RvdHlwZS5nZXRCeVRpdGxlID0gZnVuY3Rpb24gKHRpdGxlKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBMaXN0KHRoaXMsIFwiZ2V0QnlUaXRsZSgnXCIgKyB0aXRsZSArIFwiJylcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IGxpc3QgdG8gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIG5ldyBsaXN0J3MgdGl0bGVcclxuICAgICAqIEBwYXJhbSBkZXNjcmlwdGlvbiBUaGUgbmV3IGxpc3QncyBkZXNjcmlwdGlvblxyXG4gICAgICogQHBhcmFtIHRlbXBsYXRlIFRoZSBsaXN0IHRlbXBsYXRlIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0gZW5hYmxlQ29udGVudFR5cGVzIElmIHRydWUgY29udGVudCB0eXBlcyB3aWxsIGJlIGFsbG93ZWQgYW5kIGVuYWJsZWQsIG90aGVyd2lzZSB0aGV5IHdpbGwgYmUgZGlzYWxsb3dlZCBhbmQgbm90IGVuYWJsZWRcclxuICAgICAqIEBwYXJhbSBhZGRpdGlvbmFsU2V0dGluZ3MgV2lsbCBiZSBwYXNzZWQgYXMgcGFydCBvZiB0aGUgbGlzdCBjcmVhdGlvbiBib2R5XHJcbiAgICAgKi9cclxuICAgIExpc3RzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAodGl0bGUsIGRlc2NyaXB0aW9uLCB0ZW1wbGF0ZSwgZW5hYmxlQ29udGVudFR5cGVzLCBhZGRpdGlvbmFsU2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChkZXNjcmlwdGlvbiA9PT0gdm9pZCAwKSB7IGRlc2NyaXB0aW9uID0gXCJcIjsgfVxyXG4gICAgICAgIGlmICh0ZW1wbGF0ZSA9PT0gdm9pZCAwKSB7IHRlbXBsYXRlID0gMTAwOyB9XHJcbiAgICAgICAgaWYgKGVuYWJsZUNvbnRlbnRUeXBlcyA9PT0gdm9pZCAwKSB7IGVuYWJsZUNvbnRlbnRUeXBlcyA9IGZhbHNlOyB9XHJcbiAgICAgICAgaWYgKGFkZGl0aW9uYWxTZXR0aW5ncyA9PT0gdm9pZCAwKSB7IGFkZGl0aW9uYWxTZXR0aW5ncyA9IHt9OyB9XHJcbiAgICAgICAgdmFyIGFkZFNldHRpbmdzID0gZXh0ZW5kKHtcclxuICAgICAgICAgICAgXCJBbGxvd0NvbnRlbnRUeXBlc1wiOiBlbmFibGVDb250ZW50VHlwZXMsXHJcbiAgICAgICAgICAgIFwiQmFzZVRlbXBsYXRlXCI6IHRlbXBsYXRlLFxyXG4gICAgICAgICAgICBcIkNvbnRlbnRUeXBlc0VuYWJsZWRcIjogZW5hYmxlQ29udGVudFR5cGVzLFxyXG4gICAgICAgICAgICBcIkRlc2NyaXB0aW9uXCI6IGRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBcIlRpdGxlXCI6IHRpdGxlLFxyXG4gICAgICAgICAgICBcIl9fbWV0YWRhdGFcIjogeyBcInR5cGVcIjogXCJTUC5MaXN0XCIgfSxcclxuICAgICAgICB9LCBhZGRpdGlvbmFsU2V0dGluZ3MpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHsgYm9keToganNTKGFkZFNldHRpbmdzKSB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IGRhdGEsIGxpc3Q6IF90aGlzLmdldEJ5VGl0bGUoYWRkU2V0dGluZ3MuVGl0bGUpIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBFbnN1cmVzIHRoYXQgdGhlIHNwZWNpZmllZCBsaXN0IGV4aXN0cyBpbiB0aGUgY29sbGVjdGlvbiAobm90ZTogdGhpcyBtZXRob2Qgbm90IHN1cHBvcnRlZCBmb3IgYmF0Y2hpbmcpXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRpdGxlIFRoZSBuZXcgbGlzdCdzIHRpdGxlXHJcbiAgICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gVGhlIG5ldyBsaXN0J3MgZGVzY3JpcHRpb25cclxuICAgICAqIEBwYXJhbSB0ZW1wbGF0ZSBUaGUgbGlzdCB0ZW1wbGF0ZSB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGVuYWJsZUNvbnRlbnRUeXBlcyBJZiB0cnVlIGNvbnRlbnQgdHlwZXMgd2lsbCBiZSBhbGxvd2VkIGFuZCBlbmFibGVkLCBvdGhlcndpc2UgdGhleSB3aWxsIGJlIGRpc2FsbG93ZWQgYW5kIG5vdCBlbmFibGVkXHJcbiAgICAgKiBAcGFyYW0gYWRkaXRpb25hbFNldHRpbmdzIFdpbGwgYmUgcGFzc2VkIGFzIHBhcnQgb2YgdGhlIGxpc3QgY3JlYXRpb24gYm9keSBvciB1c2VkIHRvIHVwZGF0ZSBhbiBleGlzdGluZyBsaXN0XHJcbiAgICAgKi9cclxuICAgIExpc3RzLnByb3RvdHlwZS5lbnN1cmUgPSBmdW5jdGlvbiAodGl0bGUsIGRlc2NyaXB0aW9uLCB0ZW1wbGF0ZSwgZW5hYmxlQ29udGVudFR5cGVzLCBhZGRpdGlvbmFsU2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChkZXNjcmlwdGlvbiA9PT0gdm9pZCAwKSB7IGRlc2NyaXB0aW9uID0gXCJcIjsgfVxyXG4gICAgICAgIGlmICh0ZW1wbGF0ZSA9PT0gdm9pZCAwKSB7IHRlbXBsYXRlID0gMTAwOyB9XHJcbiAgICAgICAgaWYgKGVuYWJsZUNvbnRlbnRUeXBlcyA9PT0gdm9pZCAwKSB7IGVuYWJsZUNvbnRlbnRUeXBlcyA9IGZhbHNlOyB9XHJcbiAgICAgICAgaWYgKGFkZGl0aW9uYWxTZXR0aW5ncyA9PT0gdm9pZCAwKSB7IGFkZGl0aW9uYWxTZXR0aW5ncyA9IHt9OyB9XHJcbiAgICAgICAgaWYgKHRoaXMuaGFzQmF0Y2gpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGVuc3VyZSBsaXN0IG1ldGhvZCBpcyBub3Qgc3VwcG9ydGVkIGZvciB1c2UgaW4gYSBiYXRjaC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIHZhciBhZGRPclVwZGF0ZVNldHRpbmdzID0gZXh0ZW5kKGFkZGl0aW9uYWxTZXR0aW5ncywgeyBUaXRsZTogdGl0bGUsIERlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwgQ29udGVudFR5cGVzRW5hYmxlZDogZW5hYmxlQ29udGVudFR5cGVzIH0sIHRydWUpO1xyXG4gICAgICAgICAgICB2YXIgbGlzdCA9IF90aGlzLmdldEJ5VGl0bGUoYWRkT3JVcGRhdGVTZXR0aW5ncy5UaXRsZSk7XHJcbiAgICAgICAgICAgIGxpc3QuZ2V0KCkudGhlbihmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICAgICAgbGlzdC51cGRhdGUoYWRkT3JVcGRhdGVTZXR0aW5ncykudGhlbihmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBjcmVhdGVkOiBmYWxzZSwgZGF0YTogZCwgbGlzdDogX3RoaXMuZ2V0QnlUaXRsZShhZGRPclVwZGF0ZVNldHRpbmdzLlRpdGxlKSB9KTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiByZWplY3QoZSk7IH0pO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuYWRkKHRpdGxlLCBkZXNjcmlwdGlvbiwgdGVtcGxhdGUsIGVuYWJsZUNvbnRlbnRUeXBlcywgYWRkT3JVcGRhdGVTZXR0aW5ncykudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBjcmVhdGVkOiB0cnVlLCBkYXRhOiByLmRhdGEsIGxpc3Q6IF90aGlzLmdldEJ5VGl0bGUoYWRkT3JVcGRhdGVTZXR0aW5ncy5UaXRsZSkgfSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gcmVqZWN0KGUpOyB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgbGlzdCB0aGF0IGlzIHRoZSBkZWZhdWx0IGFzc2V0IGxvY2F0aW9uIGZvciBpbWFnZXMgb3Igb3RoZXIgZmlsZXMsIHdoaWNoIHRoZSB1c2VycyB1cGxvYWQgdG8gdGhlaXIgd2lraSBwYWdlcy5cclxuICAgICAqL1xyXG4gICAgTGlzdHMucHJvdG90eXBlLmVuc3VyZVNpdGVBc3NldHNMaWJyYXJ5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKExpc3RzXzEsIFwiZW5zdXJlc2l0ZWFzc2V0c2xpYnJhcnlcIikucG9zdENvcmUoKS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdChvZGF0YVVybEZyb20oanNvbikpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGxpc3QgdGhhdCBpcyB0aGUgZGVmYXVsdCBsb2NhdGlvbiBmb3Igd2lraSBwYWdlcy5cclxuICAgICAqL1xyXG4gICAgTGlzdHMucHJvdG90eXBlLmVuc3VyZVNpdGVQYWdlc0xpYnJhcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoTGlzdHNfMSwgXCJlbnN1cmVzaXRlcGFnZXNsaWJyYXJ5XCIpLnBvc3RDb3JlKCkudGhlbihmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IExpc3Qob2RhdGFVcmxGcm9tKGpzb24pKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgTGlzdHNfMTtcclxuICAgIExpc3RzID0gTGlzdHNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwibGlzdHNcIilcclxuICAgIF0sIExpc3RzKTtcclxuICAgIHJldHVybiBMaXN0cztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIExpc3QgaW5zdGFuY2VcclxuICpcclxuICovXHJcbnZhciBMaXN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKExpc3QsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBMaXN0KCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMaXN0LnByb3RvdHlwZSwgXCJjb250ZW50VHlwZXNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGNvbnRlbnQgdHlwZXMgaW4gdGhpcyBsaXN0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb250ZW50VHlwZXModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwiaXRlbXNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGl0ZW1zIGluIHRoaXMgbGlzdFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgSXRlbXModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwidmlld3NcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIHZpZXdzIGluIHRoaXMgbGlzdFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmlld3ModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwiZmllbGRzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBmaWVsZHMgaW4gdGhpcyBsaXN0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZHModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwiZm9ybXNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGZvcm1zIGluIHRoaXMgbGlzdFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybXModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwiZGVmYXVsdFZpZXdcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGRlZmF1bHQgdmlldyBvZiB0aGlzIGxpc3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZpZXcodGhpcywgXCJEZWZhdWx0Vmlld1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMaXN0LnByb3RvdHlwZSwgXCJ1c2VyQ3VzdG9tQWN0aW9uc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IGFsbCBjdXN0b20gYWN0aW9ucyBvbiBhIHNpdGUgY29sbGVjdGlvblxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVXNlckN1c3RvbUFjdGlvbnModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwiZWZmZWN0aXZlQmFzZVBlcm1pc3Npb25zXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBlZmZlY3RpdmUgYmFzZSBwZXJtaXNzaW9ucyBvZiB0aGlzIGxpc3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGUodGhpcywgXCJFZmZlY3RpdmVCYXNlUGVybWlzc2lvbnNcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwiZXZlbnRSZWNlaXZlcnNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGV2ZW50IHJlY2VpdmVycyBhdHRhY2hlZCB0byB0aGlzIGxpc3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKHRoaXMsIFwiRXZlbnRSZWNlaXZlcnNcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdC5wcm90b3R5cGUsIFwicmVsYXRlZEZpZWxkc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgcmVsYXRlZCBmaWVsZHMgb2YgdGhpcyBsaXN0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlKHRoaXMsIFwiZ2V0UmVsYXRlZEZpZWxkc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMaXN0LnByb3RvdHlwZSwgXCJpbmZvcm1hdGlvblJpZ2h0c01hbmFnZW1lbnRTZXR0aW5nc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgSVJNIHNldHRpbmdzIGZvciB0aGlzIGxpc3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGUodGhpcywgXCJJbmZvcm1hdGlvblJpZ2h0c01hbmFnZW1lbnRTZXR0aW5nc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMaXN0LnByb3RvdHlwZSwgXCJzdWJzY3JpcHRpb25zXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSB3ZWJob29rIHN1YnNjcmlwdGlvbnMgb2YgdGhpcyBsaXN0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdWJzY3JpcHRpb25zKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KExpc3QucHJvdG90eXBlLCBcInJvb3RGb2xkZXJcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSByb290IGZvbGRlciBvZiB0aGUgbGlzdFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEZvbGRlcih0aGlzLCBcInJvb3RGb2xkZXJcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSB2aWV3IGJ5IHZpZXcgZ3VpZCBpZFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgTGlzdC5wcm90b3R5cGUuZ2V0VmlldyA9IGZ1bmN0aW9uICh2aWV3SWQpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFZpZXcodGhpcywgXCJnZXRWaWV3KCdcIiArIHZpZXdJZCArIFwiJylcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVcGRhdGVzIHRoaXMgbGlzdCBpbnRhbmNlIHdpdGggdGhlIHN1cHBsaWVkIHByb3BlcnRpZXNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBBIHBsYWluIG9iamVjdCBoYXNoIG9mIHZhbHVlcyB0byB1cGRhdGUgZm9yIHRoZSBsaXN0XHJcbiAgICAgKiBAcGFyYW0gZVRhZyBWYWx1ZSB1c2VkIGluIHRoZSBJRi1NYXRjaCBoZWFkZXIsIGJ5IGRlZmF1bHQgXCIqXCJcclxuICAgICAqL1xyXG4gICAgLyogdHNsaW50OmRpc2FibGUgbm8tc3RyaW5nLWxpdGVyYWwgKi9cclxuICAgIExpc3QucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChwcm9wZXJ0aWVzLCBlVGFnKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoZVRhZyA9PT0gdm9pZCAwKSB7IGVUYWcgPSBcIipcIjsgfVxyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyhleHRlbmQoe1xyXG4gICAgICAgICAgICBcIl9fbWV0YWRhdGFcIjogeyBcInR5cGVcIjogXCJTUC5MaXN0XCIgfSxcclxuICAgICAgICB9LCBwcm9wZXJ0aWVzKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBwb3N0Qm9keSxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgXCJJRi1NYXRjaFwiOiBlVGFnLFxyXG4gICAgICAgICAgICAgICAgXCJYLUhUVFAtTWV0aG9kXCI6IFwiTUVSR0VcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciByZXRMaXN0ID0gX3RoaXM7XHJcbiAgICAgICAgICAgIGlmIChoT1AocHJvcGVydGllcywgXCJUaXRsZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0TGlzdCA9IF90aGlzLmdldFBhcmVudChMaXN0LCBfdGhpcy5wYXJlbnRVcmwsIFwiZ2V0QnlUaXRsZSgnXCIgKyBwcm9wZXJ0aWVzW1wiVGl0bGVcIl0gKyBcIicpXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICAgICAgbGlzdDogcmV0TGlzdCxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKiB0c2xpbnQ6ZW5hYmxlICovXHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZSB0aGlzIGxpc3RcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZVRhZyBWYWx1ZSB1c2VkIGluIHRoZSBJRi1NYXRjaCBoZWFkZXIsIGJ5IGRlZmF1bHQgXCIqXCJcclxuICAgICAqL1xyXG4gICAgTGlzdC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKGVUYWcpIHtcclxuICAgICAgICBpZiAoZVRhZyA9PT0gdm9pZCAwKSB7IGVUYWcgPSBcIipcIjsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgXCJJRi1NYXRjaFwiOiBlVGFnLFxyXG4gICAgICAgICAgICAgICAgXCJYLUhUVFAtTWV0aG9kXCI6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBjb2xsZWN0aW9uIG9mIGNoYW5nZXMgZnJvbSB0aGUgY2hhbmdlIGxvZyB0aGF0IGhhdmUgb2NjdXJyZWQgd2l0aGluIHRoZSBsaXN0LCBiYXNlZCBvbiB0aGUgc3BlY2lmaWVkIHF1ZXJ5LlxyXG4gICAgICovXHJcbiAgICBMaXN0LnByb3RvdHlwZS5nZXRDaGFuZ2VzID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoTGlzdCwgXCJnZXRjaGFuZ2VzXCIpLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHsgXCJxdWVyeVwiOiBleHRlbmQoeyBcIl9fbWV0YWRhdGFcIjogeyBcInR5cGVcIjogXCJTUC5DaGFuZ2VRdWVyeVwiIH0gfSwgcXVlcnkpIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIGNvbGxlY3Rpb24gb2YgaXRlbXMgZnJvbSB0aGUgbGlzdCBiYXNlZCBvbiB0aGUgc3BlY2lmaWVkIHF1ZXJ5LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBDYW1sUXVlcnkgVGhlIFF1ZXJ5IHNjaGVtYSBvZiBDb2xsYWJvcmF0aXZlIEFwcGxpY2F0aW9uIE1hcmt1cFxyXG4gICAgICogTGFuZ3VhZ2UgKENBTUwpIGlzIHVzZWQgaW4gdmFyaW91cyB3YXlzIHdpdGhpbiB0aGUgY29udGV4dCBvZiBNaWNyb3NvZnQgU2hhcmVQb2ludCBGb3VuZGF0aW9uXHJcbiAgICAgKiB0byBkZWZpbmUgcXVlcmllcyBhZ2FpbnN0IGxpc3QgZGF0YS5cclxuICAgICAqIHNlZTpcclxuICAgICAqXHJcbiAgICAgKiBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L29mZmljZS9tczQ2NzUyMS5hc3B4XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGV4cGFuZHMgQSBVUkkgd2l0aCBhICRleHBhbmQgU3lzdGVtIFF1ZXJ5IE9wdGlvbiBpbmRpY2F0ZXMgdGhhdCBFbnRyaWVzIGFzc29jaWF0ZWQgd2l0aFxyXG4gICAgICogdGhlIEVudHJ5IG9yIENvbGxlY3Rpb24gb2YgRW50cmllcyBpZGVudGlmaWVkIGJ5IHRoZSBSZXNvdXJjZSBQYXRoXHJcbiAgICAgKiBzZWN0aW9uIG9mIHRoZSBVUkkgbXVzdCBiZSByZXByZXNlbnRlZCBpbmxpbmUgKGkuZS4gZWFnZXJseSBsb2FkZWQpLlxyXG4gICAgICogc2VlOlxyXG4gICAgICpcclxuICAgICAqIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvb2ZmaWNlL2ZwMTQyMzg1LmFzcHhcclxuICAgICAqXHJcbiAgICAgKiBodHRwOi8vd3d3Lm9kYXRhLm9yZy9kb2N1bWVudGF0aW9uL29kYXRhLXZlcnNpb24tMi0wL3VyaS1jb252ZW50aW9ucy8jRXhwYW5kU3lzdGVtUXVlcnlPcHRpb25cclxuICAgICAqL1xyXG4gICAgTGlzdC5wcm90b3R5cGUuZ2V0SXRlbXNCeUNBTUxRdWVyeSA9IGZ1bmN0aW9uIChxdWVyeSkge1xyXG4gICAgICAgIHZhciBleHBhbmRzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgZXhwYW5kc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHEgPSB0aGlzLmNsb25lKExpc3QsIFwiZ2V0aXRlbXNcIik7XHJcbiAgICAgICAgcmV0dXJuIHEuZXhwYW5kLmFwcGx5KHEsIGV4cGFuZHMpLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHsgXCJxdWVyeVwiOiBleHRlbmQoeyBcIl9fbWV0YWRhdGFcIjogeyBcInR5cGVcIjogXCJTUC5DYW1sUXVlcnlcIiB9IH0sIHF1ZXJ5KSB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNlZTogaHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9vZmZpY2UvZG4yOTI1NTQuYXNweFxyXG4gICAgICovXHJcbiAgICBMaXN0LnByb3RvdHlwZS5nZXRMaXN0SXRlbUNoYW5nZXNTaW5jZVRva2VuID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoTGlzdCwgXCJnZXRsaXN0aXRlbWNoYW5nZXNzaW5jZXRva2VuXCIpLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHsgXCJxdWVyeVwiOiBleHRlbmQoeyBcIl9fbWV0YWRhdGFcIjogeyBcInR5cGVcIjogXCJTUC5DaGFuZ2VMb2dJdGVtUXVlcnlcIiB9IH0sIHF1ZXJ5KSB9KSxcclxuICAgICAgICB9LCB7IHBhcnNlOiBmdW5jdGlvbiAocikgeyByZXR1cm4gci50ZXh0KCk7IH0gfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBNb3ZlcyB0aGUgbGlzdCB0byB0aGUgUmVjeWNsZSBCaW4gYW5kIHJldHVybnMgdGhlIGlkZW50aWZpZXIgb2YgdGhlIG5ldyBSZWN5Y2xlIEJpbiBpdGVtLlxyXG4gICAgICovXHJcbiAgICBMaXN0LnByb3RvdHlwZS5yZWN5Y2xlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKExpc3QsIFwicmVjeWNsZVwiKS5wb3N0Q29yZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGhPUChkYXRhLCBcIlJlY3ljbGVcIikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLlJlY3ljbGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVuZGVycyBsaXN0IGRhdGEgYmFzZWQgb24gdGhlIHZpZXcgeG1sIHByb3ZpZGVkXHJcbiAgICAgKi9cclxuICAgIExpc3QucHJvdG90eXBlLnJlbmRlckxpc3REYXRhID0gZnVuY3Rpb24gKHZpZXdYbWwpIHtcclxuICAgICAgICB2YXIgcSA9IHRoaXMuY2xvbmUoTGlzdCwgXCJyZW5kZXJsaXN0ZGF0YShAdmlld1htbClcIik7XHJcbiAgICAgICAgcS5xdWVyeS5zZXQoXCJAdmlld1htbFwiLCBcIidcIiArIHZpZXdYbWwgKyBcIidcIik7XHJcbiAgICAgICAgcmV0dXJuIHEucG9zdENvcmUoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIC8vIGRhdGEgd2lsbCBiZSBhIHN0cmluZywgc28gd2UgcGFyc2UgaXQgYWdhaW5cclxuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChoT1AoZGF0YSwgXCJSZW5kZXJMaXN0RGF0YVwiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuUmVuZGVyTGlzdERhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgZGF0YSBmb3IgdGhlIHNwZWNpZmllZCBxdWVyeSB2aWV3XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBhcmFtZXRlcnMgVGhlIHBhcmFtZXRlcnMgdG8gYmUgdXNlZCB0byByZW5kZXIgbGlzdCBkYXRhIGFzIEpTT04gc3RyaW5nLlxyXG4gICAgICogQHBhcmFtIG92ZXJyaWRlUGFyYW1ldGVycyBUaGUgcGFyYW1ldGVycyB0aGF0IGFyZSB1c2VkIHRvIG92ZXJyaWRlIGFuZCBleHRlbmQgdGhlIHJlZ3VsYXIgU1BSZW5kZXJMaXN0RGF0YVBhcmFtZXRlcnMuXHJcbiAgICAgKi9cclxuICAgIExpc3QucHJvdG90eXBlLnJlbmRlckxpc3REYXRhQXNTdHJlYW0gPSBmdW5jdGlvbiAocGFyYW1ldGVycywgb3ZlcnJpZGVQYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgaWYgKG92ZXJyaWRlUGFyYW1ldGVycyA9PT0gdm9pZCAwKSB7IG92ZXJyaWRlUGFyYW1ldGVycyA9IG51bGw7IH1cclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlUGFyYW1ldGVyczogZXh0ZW5kKG1ldGFkYXRhKFwiU1AuUmVuZGVyTGlzdERhdGFPdmVycmlkZVBhcmFtZXRlcnNcIiksIG92ZXJyaWRlUGFyYW1ldGVycyksXHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IGV4dGVuZChtZXRhZGF0YShcIlNQLlJlbmRlckxpc3REYXRhUGFyYW1ldGVyc1wiKSwgcGFyYW1ldGVycyksXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShMaXN0LCBcIlJlbmRlckxpc3REYXRhQXNTdHJlYW1cIiwgdHJ1ZSkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1MocG9zdEJvZHkpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgZmllbGQgdmFsdWVzIGFuZCBmaWVsZCBzY2hlbWEgYXR0cmlidXRlcyBmb3IgYSBsaXN0IGl0ZW0uXHJcbiAgICAgKi9cclxuICAgIExpc3QucHJvdG90eXBlLnJlbmRlckxpc3RGb3JtRGF0YSA9IGZ1bmN0aW9uIChpdGVtSWQsIGZvcm1JZCwgbW9kZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKExpc3QsIFwicmVuZGVybGlzdGZvcm1kYXRhKGl0ZW1pZD1cIiArIGl0ZW1JZCArIFwiLCBmb3JtaWQ9J1wiICsgZm9ybUlkICsgXCInLCBtb2RlPSdcIiArIG1vZGUgKyBcIicpXCIpLnBvc3RDb3JlKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAvLyBkYXRhIHdpbGwgYmUgYSBzdHJpbmcsIHNvIHdlIHBhcnNlIGl0IGFnYWluXHJcbiAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoaE9QKGRhdGEsIFwiTGlzdERhdGFcIikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLkxpc3REYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlc2VydmVzIGEgbGlzdCBpdGVtIElEIGZvciBpZGVtcG90ZW50IGxpc3QgaXRlbSBjcmVhdGlvbi5cclxuICAgICAqL1xyXG4gICAgTGlzdC5wcm90b3R5cGUucmVzZXJ2ZUxpc3RJdGVtSWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoTGlzdCwgXCJyZXNlcnZlbGlzdGl0ZW1pZFwiKS5wb3N0Q29yZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGhPUChkYXRhLCBcIlJlc2VydmVMaXN0SXRlbUlkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5SZXNlcnZlTGlzdEl0ZW1JZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBMaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZSBmb3IgdGhpcyBsaXN0LCB1c2VkIHdoZW4gYWRkaW5nL3VwZGF0aW5nIGxpc3QgaXRlbXMuIERvZXMgbm90IHN1cHBvcnQgYmF0Y2hpbmcuXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBMaXN0LnByb3RvdHlwZS5nZXRMaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShMaXN0LCBudWxsLCBmYWxzZSkuc2VsZWN0KFwiTGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWVcIikuZ2V0KCkudGhlbihmdW5jdGlvbiAobykgeyByZXR1cm4gby5MaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZTsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGFuIGl0ZW0gdXNpbmcgcGF0aCAoaW4gYSBmb2xkZXIpLCB2YWxpZGF0ZXMgYW5kIHNldHMgaXRzIGZpZWxkIHZhbHVlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZm9ybVZhbHVlcyBUaGUgZmllbGRzIHRvIGNoYW5nZSBhbmQgdGhlaXIgbmV3IHZhbHVlcy5cclxuICAgICAqIEBwYXJhbSBkZWNvZGVkVXJsIFBhdGggZGVjb2RlZCB1cmw7IGZvbGRlcidzIHNlcnZlciByZWxhdGl2ZSBwYXRoLlxyXG4gICAgICogQHBhcmFtIGJOZXdEb2N1bWVudFVwZGF0ZSB0cnVlIGlmIHRoZSBsaXN0IGl0ZW0gaXMgYSBkb2N1bWVudCBiZWluZyB1cGRhdGVkIGFmdGVyIHVwbG9hZDsgb3RoZXJ3aXNlIGZhbHNlLlxyXG4gICAgICogQHBhcmFtIGNoZWNrSW5Db21tZW50IE9wdGlvbmFsIGNoZWNrIGluIGNvbW1lbnQuXHJcbiAgICAgKi9cclxuICAgIExpc3QucHJvdG90eXBlLmFkZFZhbGlkYXRlVXBkYXRlSXRlbVVzaW5nUGF0aCA9IGZ1bmN0aW9uIChmb3JtVmFsdWVzLCBkZWNvZGVkVXJsLCBiTmV3RG9jdW1lbnRVcGRhdGUsIGNoZWNrSW5Db21tZW50KSB7XHJcbiAgICAgICAgaWYgKGJOZXdEb2N1bWVudFVwZGF0ZSA9PT0gdm9pZCAwKSB7IGJOZXdEb2N1bWVudFVwZGF0ZSA9IGZhbHNlOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoTGlzdCwgXCJBZGRWYWxpZGF0ZVVwZGF0ZUl0ZW1Vc2luZ1BhdGgoKVwiKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7XHJcbiAgICAgICAgICAgICAgICBiTmV3RG9jdW1lbnRVcGRhdGU6IGJOZXdEb2N1bWVudFVwZGF0ZSxcclxuICAgICAgICAgICAgICAgIGNoZWNrSW5Db21tZW50OiBjaGVja0luQ29tbWVudCxcclxuICAgICAgICAgICAgICAgIGZvcm1WYWx1ZXM6IGZvcm1WYWx1ZXMsXHJcbiAgICAgICAgICAgICAgICBsaXN0SXRlbUNyZWF0ZUluZm86IHtcclxuICAgICAgICAgICAgICAgICAgICBGb2xkZXJQYXRoOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRVcmw6IGRlY29kZWRVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fbWV0YWRhdGE6IHsgdHlwZTogXCJTUC5SZXNvdXJjZVBhdGhcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgX19tZXRhZGF0YTogeyB0eXBlOiBcIlNQLkxpc3RJdGVtQ3JlYXRpb25JbmZvcm1hdGlvblVzaW5nUGF0aFwiIH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiByZXMuQWRkVmFsaWRhdGVVcGRhdGVJdGVtVXNpbmdQYXRoICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLkFkZFZhbGlkYXRlVXBkYXRlSXRlbVVzaW5nUGF0aC5yZXN1bHRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIExpc3Q7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZVNlY3VyYWJsZSkpO1xuXG4vKipcclxuICogUmVwcmVzZW50cyBhIENvbGxlY3Rpb24gb2YgY29tbWVudHNcclxuICovXHJcbnZhciBDb21tZW50cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhDb21tZW50cywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENvbW1lbnRzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIENvbW1lbnRzXzEgPSBDb21tZW50cztcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBjb21tZW50IHRvIHRoaXMgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbmZvIENvbW1lbnQgaW5mb3JtYXRpb24gdG8gYWRkXHJcbiAgICAgKi9cclxuICAgIENvbW1lbnRzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoaW5mbykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBpbmZvID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGluZm8gPSB7IHRleHQ6IGluZm8gfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKGV4dGVuZChtZXRhZGF0YShcIk1pY3Jvc29mdC5TaGFyZVBvaW50LkNvbW1lbnRzLmNvbW1lbnRcIiksIGluZm8pKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShDb21tZW50c18xLCBudWxsKS5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pLnRoZW4oZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGV4dGVuZChfdGhpcy5nZXRCeUlkKGQuaWQpLCBkKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSBjb21tZW50IGJ5IGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIElkIG9mIHRoZSBjb21tZW50IHRvIGxvYWRcclxuICAgICAqL1xyXG4gICAgQ29tbWVudHMucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgYyA9IG5ldyBDb21tZW50KHRoaXMpO1xyXG4gICAgICAgIGMuY29uY2F0KFwiKFwiICsgaWQgKyBcIilcIik7XHJcbiAgICAgICAgcmV0dXJuIGM7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWxldGVzIGFsbCB0aGUgY29tbWVudHMgaW4gdGhpcyBjb2xsZWN0aW9uXHJcbiAgICAgKi9cclxuICAgIENvbW1lbnRzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShDb21tZW50c18xLCBcIkRlbGV0ZUFsbFwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIHZhciBDb21tZW50c18xO1xyXG4gICAgQ29tbWVudHMgPSBDb21tZW50c18xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJjb21tZW50c1wiKVxyXG4gICAgXSwgQ29tbWVudHMpO1xyXG4gICAgcmV0dXJuIENvbW1lbnRzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBSZXByZXNlbnRzIGEgY29tbWVudFxyXG4gKi9cclxudmFyIENvbW1lbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ29tbWVudCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENvbW1lbnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbW1lbnQucHJvdG90eXBlLCBcInJlcGxpZXNcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlcGxpZXModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIExpa2VzIHRoZSBjb21tZW50IGFzIHRoZSBjdXJyZW50IHVzZXJcclxuICAgICAqL1xyXG4gICAgQ29tbWVudC5wcm90b3R5cGUubGlrZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShDb21tZW50LCBcIkxpa2VcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFVubGlrZXMgdGhlIGNvbW1lbnQgYXMgdGhlIGN1cnJlbnQgdXNlclxyXG4gICAgICovXHJcbiAgICBDb21tZW50LnByb3RvdHlwZS51bmxpa2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoQ29tbWVudCwgXCJVbmxpa2VcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZXMgdGhpcyBjb21tZW50XHJcbiAgICAgKi9cclxuICAgIENvbW1lbnQucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShDb21tZW50LCBcIkRlbGV0ZUNvbW1lbnRcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ29tbWVudDtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcclxuLyoqXHJcbiAqIFJlcHJlc2VudHMgYSBDb2xsZWN0aW9uIG9mIGNvbW1lbnRzXHJcbiAqL1xyXG52YXIgUmVwbGllcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhSZXBsaWVzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gUmVwbGllcygpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBSZXBsaWVzXzEgPSBSZXBsaWVzO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHJlcGx5IHRvIHRoaXMgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbmZvIENvbW1lbnQgaW5mb3JtYXRpb24gdG8gYWRkXHJcbiAgICAgKi9cclxuICAgIFJlcGxpZXMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChpbmZvKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBpbmZvID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGluZm8gPSB7IHRleHQ6IGluZm8gfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKGV4dGVuZChtZXRhZGF0YShcIk1pY3Jvc29mdC5TaGFyZVBvaW50LkNvbW1lbnRzLmNvbW1lbnRcIiksIGluZm8pKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShSZXBsaWVzXzEsIG51bGwpLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHkgfSkudGhlbihmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXh0ZW5kKG5ldyBDb21tZW50KG9kYXRhVXJsRnJvbShkKSksIGQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHZhciBSZXBsaWVzXzE7XHJcbiAgICBSZXBsaWVzID0gUmVwbGllc18xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJyZXBsaWVzXCIpXHJcbiAgICBdLCBSZXBsaWVzKTtcclxuICAgIHJldHVybiBSZXBsaWVzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XG5cbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIEl0ZW0gb2JqZWN0c1xyXG4gKlxyXG4gKi9cclxudmFyIEl0ZW1zID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEl0ZW1zLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gSXRlbXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgSXRlbXNfMSA9IEl0ZW1zO1xyXG4gICAgLyoqXHJcbiAgICAqIEdldHMgYW4gSXRlbSBieSBpZFxyXG4gICAgKlxyXG4gICAgKiBAcGFyYW0gaWQgVGhlIGludGVnZXIgaWQgb2YgdGhlIGl0ZW0gdG8gcmV0cmlldmVcclxuICAgICovXHJcbiAgICBJdGVtcy5wcm90b3R5cGUuZ2V0QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciBpID0gbmV3IEl0ZW0odGhpcyk7XHJcbiAgICAgICAgaS5jb25jYXQoXCIoXCIgKyBpZCArIFwiKVwiKTtcclxuICAgICAgICByZXR1cm4gaTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgQkNTIEl0ZW0gYnkgc3RyaW5nIGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHN0cmluZ0lkIFRoZSBzdHJpbmcgaWQgb2YgdGhlIEJDUyBpdGVtIHRvIHJldHJpZXZlXHJcbiAgICAgKi9cclxuICAgIEl0ZW1zLnByb3RvdHlwZS5nZXRJdGVtQnlTdHJpbmdJZCA9IGZ1bmN0aW9uIChzdHJpbmdJZCkge1xyXG4gICAgICAgIC8vIGNyZWF0ZXMgYW4gaXRlbSB3aXRoIHRoZSBwYXJlbnQgbGlzdCBwYXRoIGFuZCBhcHBlbmQgb3V0IG1ldGhvZCBjYWxsXHJcbiAgICAgICAgcmV0dXJuIG5ldyBJdGVtKHRoaXMucGFyZW50VXJsLCBcImdldEl0ZW1CeVN0cmluZ0lkKCdcIiArIHN0cmluZ0lkICsgXCInKVwiKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNraXBzIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIGl0ZW1zIChodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L29mZmljZS9mcDE0MjM4NS5hc3B4I3NlY3Rpb25TZWN0aW9uNilcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc2tpcCBUaGUgc3RhcnRpbmcgaWQgd2hlcmUgdGhlIHBhZ2Ugc2hvdWxkIHN0YXJ0LCB1c2Ugd2l0aCB0b3AgdG8gc3BlY2lmeSBwYWdlc1xyXG4gICAgICogQHBhcmFtIHJldmVyc2UgSXQgdHJ1ZSB0aGUgUGFnZWRQcmV2PXRydWUgcGFyYW1ldGVyIGlzIGFkZGVkIGFsbG93aW5nIGJhY2t3YXJkcyBuYXZpZ2F0aW9uIGluIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKi9cclxuICAgIEl0ZW1zLnByb3RvdHlwZS5za2lwID0gZnVuY3Rpb24gKHNraXAsIHJldmVyc2UpIHtcclxuICAgICAgICBpZiAocmV2ZXJzZSA9PT0gdm9pZCAwKSB7IHJldmVyc2UgPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmIChyZXZlcnNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucXVlcnkuc2V0KFwiJHNraXB0b2tlblwiLCBlbmNvZGVVUklDb21wb25lbnQoXCJQYWdlZD1UUlVFJlBhZ2VkUHJldj1UUlVFJnBfSUQ9XCIgKyBza2lwKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXJ5LnNldChcIiRza2lwdG9rZW5cIiwgZW5jb2RlVVJJQ29tcG9uZW50KFwiUGFnZWQ9VFJVRSZwX0lEPVwiICsgc2tpcCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSBjb2xsZWN0aW9uIGRlc2lnbmVkIHRvIGFpZCBpbiBwYWdpbmcgdGhyb3VnaCBkYXRhXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBJdGVtcy5wcm90b3R5cGUuZ2V0UGFnZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KG5ldyBQYWdlZEl0ZW1Db2xsZWN0aW9uUGFyc2VyKHRoaXMpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYWxsIHRoZSBpdGVtcyBpbiBhIGxpc3QsIHJlZ2FyZGxlc3Mgb2YgY291bnQuIERvZXMgbm90IHN1cHBvcnQgYmF0Y2hpbmcgb3IgY2FjaGluZ1xyXG4gICAgICpcclxuICAgICAqICBAcGFyYW0gcmVxdWVzdFNpemUgTnVtYmVyIG9mIGl0ZW1zIHRvIHJldHVybiBpbiBlYWNoIHJlcXVlc3QgKERlZmF1bHQ6IDIwMDApXHJcbiAgICAgKiAgQHBhcmFtIGFjY2VwdEhlYWRlciBBbGxvd3MgZm9yIHNldHRpbmcgdGhlIHZhbHVlIG9mIHRoZSBBY2NlcHQgaGVhZGVyIGZvciBTUCAyMDEzIHN1cHBvcnRcclxuICAgICAqL1xyXG4gICAgSXRlbXMucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uIChyZXF1ZXN0U2l6ZSwgYWNjZXB0SGVhZGVyKSB7XHJcbiAgICAgICAgaWYgKHJlcXVlc3RTaXplID09PSB2b2lkIDApIHsgcmVxdWVzdFNpemUgPSAyMDAwOyB9XHJcbiAgICAgICAgaWYgKGFjY2VwdEhlYWRlciA9PT0gdm9pZCAwKSB7IGFjY2VwdEhlYWRlciA9IFwiYXBwbGljYXRpb24vanNvbjtvZGF0YT1ub21ldGFkYXRhXCI7IH1cclxuICAgICAgICBMb2dnZXIud3JpdGUoXCJDYWxsaW5nIGl0ZW1zLmdldEFsbCBzaG91bGQgYmUgZG9uZSBzcGFyaW5nbHkuIEVuc3VyZSB0aGlzIGlzIHRoZSBjb3JyZWN0IGNob2ljZS4gSWYgeW91IGFyZSB1bnN1cmUsIGl0IGlzIG5vdC5cIiwgMiAvKiBXYXJuaW5nICovKTtcclxuICAgICAgICAvLyB0aGlzIHdpbGwgYmUgdXNlZCBmb3IgdGhlIGFjdHVhbCBxdWVyeVxyXG4gICAgICAgIC8vIGFuZCB3ZSBzZXQgbm8gbWV0YWRhdGEgaGVyZSB0byB0cnkgYW5kIHJlZHVjZSB0cmFmZmljXHJcbiAgICAgICAgdmFyIGl0ZW1zID0gbmV3IEl0ZW1zXzEodGhpcywgXCJcIikudG9wKHJlcXVlc3RTaXplKS5jb25maWd1cmUoe1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBcIkFjY2VwdFwiOiBhY2NlcHRIZWFkZXIsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gbGV0J3MgY29weSBvdmVyIHRoZSBvZGF0YSBxdWVyeSBwYXJhbXMgdGhhdCBjYW4gYmUgYXBwbGllZFxyXG4gICAgICAgIC8vICR0b3AgLSBhbGxvdyBzZXR0aW5nIHRoZSBwYWdlIHNpemUgdGhpcyB3YXkgKG92ZXJyaWRlIHdoYXQgd2UgZGlkIGFib3ZlKVxyXG4gICAgICAgIC8vICRzZWxlY3QgLSBhbGxvdyBwaWNraW5nIHRoZSByZXR1cm4gZmllbGRzIChnb29kIGJlaGF2aW9yKVxyXG4gICAgICAgIC8vICRmaWx0ZXIgLSBhbGxvdyBzZXR0aW5nIGEgZmlsdGVyLCB0aG91Z2ggdGhpcyBtYXkgZmFpbCBkdWUgZm9yIGxhcmdlIGxpc3RzXHJcbiAgICAgICAgdGhpcy5xdWVyeS5mb3JFYWNoKGZ1bmN0aW9uICh2LCBrKSB7XHJcbiAgICAgICAgICAgIGlmICgvXlxcJHNlbGVjdHxmaWx0ZXJ8dG9wfGV4cGFuZCQvaS50ZXN0KGspKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5xdWVyeS5zZXQoaywgdik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBnaXZlIGJhY2sgdGhlIHByb21pc2VcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAvLyB0aGlzIHdpbGwgZXZlbnR1YWxseSBob2xkIHRoZSBpdGVtcyB3ZSByZXR1cm5cclxuICAgICAgICAgICAgdmFyIGl0ZW1zQ29sbGVjdG9yID0gW107XHJcbiAgICAgICAgICAgIC8vIGFjdGlvbiB0aGF0IHdpbGwgZ2F0aGVyIHVwIG91ciByZXN1bHRzIHJlY3Vyc2l2ZWx5XHJcbiAgICAgICAgICAgIHZhciBnYXRoZXJlciA9IGZ1bmN0aW9uIChsYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb2xsZWN0IHRoYXQgc2V0IG9mIHJlc3VsdHNcclxuICAgICAgICAgICAgICAgIFtdLnB1c2guYXBwbHkoaXRlbXNDb2xsZWN0b3IsIGxhc3QucmVzdWx0cyk7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIG1vcmUsIHJlcGVhdCAtIG90aGVyd2lzZSByZXNvbHZlIHdpdGggdGhlIGNvbGxlY3RlZCBpdGVtc1xyXG4gICAgICAgICAgICAgICAgaWYgKGxhc3QuaGFzTmV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhc3QuZ2V0TmV4dCgpLnRoZW4oZ2F0aGVyZXIpLmNhdGNoKHJlamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW1zQ29sbGVjdG9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy8gc3RhcnQgdGhlIGN5Y2xlXHJcbiAgICAgICAgICAgIGl0ZW1zLmdldFBhZ2VkKCkudGhlbihnYXRoZXJlcikuY2F0Y2gocmVqZWN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgaXRlbSB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzIFRoZSBuZXcgaXRlbXMncyBwcm9wZXJ0aWVzXHJcbiAgICAgKiBAcGFyYW0gbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUgVGhlIHR5cGUgbmFtZSBvZiB0aGUgbGlzdCdzIGVudGl0aWVzXHJcbiAgICAgKi9cclxuICAgIEl0ZW1zLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAocHJvcGVydGllcywgbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChwcm9wZXJ0aWVzID09PSB2b2lkIDApIHsgcHJvcGVydGllcyA9IHt9OyB9XHJcbiAgICAgICAgaWYgKGxpc3RJdGVtRW50aXR5VHlwZUZ1bGxOYW1lID09PSB2b2lkIDApIHsgbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUgPSBudWxsOyB9XHJcbiAgICAgICAgdmFyIHJlbW92ZURlcGVuZGVuY3kgPSB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVuc3VyZUxpc3RJdGVtRW50aXR5VHlwZU5hbWUobGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUpLnRoZW4oZnVuY3Rpb24gKGxpc3RJdGVtRW50aXR5VHlwZSkge1xyXG4gICAgICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1MoZXh0ZW5kKG1ldGFkYXRhKGxpc3RJdGVtRW50aXR5VHlwZSksIHByb3BlcnRpZXMpKTtcclxuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBfdGhpcy5jbG9uZShJdGVtc18xLCBcIlwiKS5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICBpdGVtOiBfdGhpcy5nZXRCeUlkKGRhdGEuSWQpLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJlbW92ZURlcGVuZGVuY3koKTtcclxuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBFbnN1cmVzIHdlIGhhdmUgdGhlIHByb3BlciBsaXN0IGl0ZW0gZW50aXR5IHR5cGUgbmFtZSwgZWl0aGVyIGZyb20gdGhlIHZhbHVlIHByb3ZpZGVkIG9yIGZyb20gdGhlIGxpc3RcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY2FuZGlkYXRlbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUgVGhlIHBvdGVudGlhbCB0eXBlIG5hbWVcclxuICAgICAqL1xyXG4gICAgSXRlbXMucHJvdG90eXBlLmVuc3VyZUxpc3RJdGVtRW50aXR5VHlwZU5hbWUgPSBmdW5jdGlvbiAoY2FuZGlkYXRlbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUpIHtcclxuICAgICAgICByZXR1cm4gY2FuZGlkYXRlbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUgP1xyXG4gICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoY2FuZGlkYXRlbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUpIDpcclxuICAgICAgICAgICAgdGhpcy5nZXRQYXJlbnQoTGlzdCkuZ2V0TGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUoKTtcclxuICAgIH07XHJcbiAgICB2YXIgSXRlbXNfMTtcclxuICAgIEl0ZW1zID0gSXRlbXNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwiaXRlbXNcIilcclxuICAgIF0sIEl0ZW1zKTtcclxuICAgIHJldHVybiBJdGVtcztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpbmVzIGEgc2luZ2xlIEl0ZW0gaW5zdGFuY2VcclxuICpcclxuICovXHJcbnZhciBJdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEl0ZW0sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJdGVtKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERlbGV0ZSB0aGlzIGl0ZW1cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBlVGFnIFZhbHVlIHVzZWQgaW4gdGhlIElGLU1hdGNoIGhlYWRlciwgYnkgZGVmYXVsdCBcIipcIlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIF90aGlzLmRlbGV0ZSA9IF90aGlzLl9kZWxldGVXaXRoRVRhZztcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSXRlbS5wcm90b3R5cGUsIFwiYXR0YWNobWVudEZpbGVzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBzZXQgb2YgYXR0YWNobWVudHMgZm9yIHRoaXMgaXRlbVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXR0YWNobWVudEZpbGVzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEl0ZW0ucHJvdG90eXBlLCBcImNvbnRlbnRUeXBlXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBjb250ZW50IHR5cGUgZm9yIHRoaXMgaXRlbVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29udGVudFR5cGUodGhpcywgXCJDb250ZW50VHlwZVwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShJdGVtLnByb3RvdHlwZSwgXCJjb21tZW50c1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgY29sbGVjdGlvbiBvZiBjb21tZW50cyBhc3NvY2lhdGVkIHdpdGggdGhpcyBsaXN0IGl0ZW1cclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb21tZW50cyh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShJdGVtLnByb3RvdHlwZSwgXCJlZmZlY3RpdmVCYXNlUGVybWlzc2lvbnNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGVmZmVjdGl2ZSBiYXNlIHBlcm1pc3Npb25zIGZvciB0aGUgaXRlbVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZSh0aGlzLCBcIkVmZmVjdGl2ZUJhc2VQZXJtaXNzaW9uc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShJdGVtLnByb3RvdHlwZSwgXCJlZmZlY3RpdmVCYXNlUGVybWlzc2lvbnNGb3JVSVwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgZWZmZWN0aXZlIGJhc2UgcGVybWlzc2lvbnMgZm9yIHRoZSBpdGVtIGluIGEgVUkgY29udGV4dFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZSh0aGlzLCBcIkVmZmVjdGl2ZUJhc2VQZXJtaXNzaW9uc0ZvclVJXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEl0ZW0ucHJvdG90eXBlLCBcImZpZWxkVmFsdWVzQXNIVE1MXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBmaWVsZCB2YWx1ZXMgZm9yIHRoaXMgbGlzdCBpdGVtIGluIHRoZWlyIEhUTUwgcmVwcmVzZW50YXRpb25cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSh0aGlzLCBcIkZpZWxkVmFsdWVzQXNIVE1MXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEl0ZW0ucHJvdG90eXBlLCBcImZpZWxkVmFsdWVzQXNUZXh0XCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBmaWVsZCB2YWx1ZXMgZm9yIHRoaXMgbGlzdCBpdGVtIGluIHRoZWlyIHRleHQgcmVwcmVzZW50YXRpb25cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSh0aGlzLCBcIkZpZWxkVmFsdWVzQXNUZXh0XCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEl0ZW0ucHJvdG90eXBlLCBcImZpZWxkVmFsdWVzRm9yRWRpdFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgZmllbGQgdmFsdWVzIGZvciB0aGlzIGxpc3QgaXRlbSBmb3IgdXNlIGluIGVkaXRpbmcgY29udHJvbHNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSh0aGlzLCBcIkZpZWxkVmFsdWVzRm9yRWRpdFwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShJdGVtLnByb3RvdHlwZSwgXCJmb2xkZXJcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGZvbGRlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBsaXN0IGl0ZW0gKGlmIHRoaXMgaXRlbSByZXByZXNlbnRzIGEgZm9sZGVyKVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRm9sZGVyKHRoaXMsIFwiZm9sZGVyXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEl0ZW0ucHJvdG90eXBlLCBcImZpbGVcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGZvbGRlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBsaXN0IGl0ZW0gKGlmIHRoaXMgaXRlbSByZXByZXNlbnRzIGEgZm9sZGVyKVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmlsZSh0aGlzLCBcImZpbGVcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSXRlbS5wcm90b3R5cGUsIFwidmVyc2lvbnNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGNvbGxlY3Rpb24gb2YgdmVyc2lvbnMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgaXRlbVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEl0ZW1WZXJzaW9ucyh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogVXBkYXRlcyB0aGlzIGxpc3QgaW50YW5jZSB3aXRoIHRoZSBzdXBwbGllZCBwcm9wZXJ0aWVzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHByb3BlcnRpZXMgQSBwbGFpbiBvYmplY3QgaGFzaCBvZiB2YWx1ZXMgdG8gdXBkYXRlIGZvciB0aGUgbGlzdFxyXG4gICAgICogQHBhcmFtIGVUYWcgVmFsdWUgdXNlZCBpbiB0aGUgSUYtTWF0Y2ggaGVhZGVyLCBieSBkZWZhdWx0IFwiKlwiXHJcbiAgICAgKiBAcGFyYW0gbGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUgVGhlIHR5cGUgbmFtZSBvZiB0aGUgbGlzdCdzIGVudGl0aWVzXHJcbiAgICAgKi9cclxuICAgIEl0ZW0ucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChwcm9wZXJ0aWVzLCBlVGFnLCBsaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKGVUYWcgPT09IHZvaWQgMCkgeyBlVGFnID0gXCIqXCI7IH1cclxuICAgICAgICBpZiAobGlzdEl0ZW1FbnRpdHlUeXBlRnVsbE5hbWUgPT09IHZvaWQgMCkgeyBsaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZSA9IG51bGw7IH1cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICB2YXIgcmVtb3ZlRGVwZW5kZW5jeSA9IF90aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuZW5zdXJlTGlzdEl0ZW1FbnRpdHlUeXBlTmFtZShsaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZSkudGhlbihmdW5jdGlvbiAobGlzdEl0ZW1FbnRpdHlUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1MoZXh0ZW5kKG1ldGFkYXRhKGxpc3RJdGVtRW50aXR5VHlwZSksIHByb3BlcnRpZXMpKTtcclxuICAgICAgICAgICAgICAgIHJlbW92ZURlcGVuZGVuY3koKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9keTogcG9zdEJvZHksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIklGLU1hdGNoXCI6IGVUYWcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiWC1IVFRQLU1ldGhvZFwiOiBcIk1FUkdFXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0sIG5ldyBJdGVtVXBkYXRlZFBhcnNlcigpKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IF90aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiByZWplY3QoZSk7IH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY29sbGVjdGlvbiBvZiBwZW9wbGUgd2hvIGhhdmUgbGlrZWQgdGhpcyBpdGVtXHJcbiAgICAgKi9cclxuICAgIEl0ZW0ucHJvdG90eXBlLmdldExpa2VkQnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoSXRlbSwgXCJsaWtlZEJ5XCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBMaWtlcyB0aGlzIGl0ZW0gYXMgdGhlIGN1cnJlbnQgdXNlclxyXG4gICAgICovXHJcbiAgICBJdGVtLnByb3RvdHlwZS5saWtlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEl0ZW0sIFwibGlrZVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVW5saWtlcyB0aGlzIGl0ZW0gYXMgdGhlIGN1cnJlbnQgdXNlclxyXG4gICAgICovXHJcbiAgICBJdGVtLnByb3RvdHlwZS51bmxpa2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoSXRlbSwgXCJ1bmxpa2VcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIE1vdmVzIHRoZSBsaXN0IGl0ZW0gdG8gdGhlIFJlY3ljbGUgQmluIGFuZCByZXR1cm5zIHRoZSBpZGVudGlmaWVyIG9mIHRoZSBuZXcgUmVjeWNsZSBCaW4gaXRlbS5cclxuICAgICAqL1xyXG4gICAgSXRlbS5wcm90b3R5cGUucmVjeWNsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShJdGVtLCBcInJlY3ljbGVcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZ1bGwgVVJMIHRvIHRoZSBXT1BJIGZyYW1lLlxyXG4gICAgICogSWYgdGhlcmUgaXMgbm8gYXNzb2NpYXRlZCBXT1BJIGFwcGxpY2F0aW9uLCBvciBubyBhc3NvY2lhdGVkIGFjdGlvbiwgYW4gZW1wdHkgc3RyaW5nIGlzIHJldHVybmVkLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBhY3Rpb24gRGlzcGxheSBtb2RlOiAwOiB2aWV3LCAxOiBlZGl0LCAyOiBtb2JpbGVWaWV3LCAzOiBpbnRlcmFjdGl2ZVByZXZpZXdcclxuICAgICAqL1xyXG4gICAgSXRlbS5wcm90b3R5cGUuZ2V0V29waUZyYW1lVXJsID0gZnVuY3Rpb24gKGFjdGlvbikge1xyXG4gICAgICAgIGlmIChhY3Rpb24gPT09IHZvaWQgMCkgeyBhY3Rpb24gPSAwOyB9XHJcbiAgICAgICAgdmFyIGkgPSB0aGlzLmNsb25lKEl0ZW0sIFwiZ2V0V09QSUZyYW1lVXJsKEBhY3Rpb24pXCIpO1xyXG4gICAgICAgIGkucXVlcnkuc2V0KFwiQGFjdGlvblwiLCBhY3Rpb24pO1xyXG4gICAgICAgIHJldHVybiBpLnBvc3RDb3JlKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAvLyBoYW5kbGUgdmVyYm9zZSBtb2RlXHJcbiAgICAgICAgICAgIGlmIChoT1AoZGF0YSwgXCJHZXRXT1BJRnJhbWVVcmxcIikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLkdldFdPUElGcmFtZVVybDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFZhbGlkYXRlcyBhbmQgc2V0cyB0aGUgdmFsdWVzIG9mIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbiBvZiBmaWVsZHMgZm9yIHRoZSBsaXN0IGl0ZW0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGZvcm1WYWx1ZXMgVGhlIGZpZWxkcyB0byBjaGFuZ2UgYW5kIHRoZWlyIG5ldyB2YWx1ZXMuXHJcbiAgICAgKiBAcGFyYW0gbmV3RG9jdW1lbnRVcGRhdGUgdHJ1ZSBpZiB0aGUgbGlzdCBpdGVtIGlzIGEgZG9jdW1lbnQgYmVpbmcgdXBkYXRlZCBhZnRlciB1cGxvYWQ7IG90aGVyd2lzZSBmYWxzZS5cclxuICAgICAqL1xyXG4gICAgSXRlbS5wcm90b3R5cGUudmFsaWRhdGVVcGRhdGVMaXN0SXRlbSA9IGZ1bmN0aW9uIChmb3JtVmFsdWVzLCBuZXdEb2N1bWVudFVwZGF0ZSkge1xyXG4gICAgICAgIGlmIChuZXdEb2N1bWVudFVwZGF0ZSA9PT0gdm9pZCAwKSB7IG5ld0RvY3VtZW50VXBkYXRlID0gZmFsc2U7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShJdGVtLCBcInZhbGlkYXRldXBkYXRlbGlzdGl0ZW1cIikucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1MoeyBcImZvcm1WYWx1ZXNcIjogZm9ybVZhbHVlcywgYk5ld0RvY3VtZW50VXBkYXRlOiBuZXdEb2N1bWVudFVwZGF0ZSB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEVuc3VyZXMgd2UgaGF2ZSB0aGUgcHJvcGVyIGxpc3QgaXRlbSBlbnRpdHkgdHlwZSBuYW1lLCBlaXRoZXIgZnJvbSB0aGUgdmFsdWUgcHJvdmlkZWQgb3IgZnJvbSB0aGUgbGlzdFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYW5kaWRhdGVsaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZSBUaGUgcG90ZW50aWFsIHR5cGUgbmFtZVxyXG4gICAgICovXHJcbiAgICBJdGVtLnByb3RvdHlwZS5lbnN1cmVMaXN0SXRlbUVudGl0eVR5cGVOYW1lID0gZnVuY3Rpb24gKGNhbmRpZGF0ZWxpc3RJdGVtRW50aXR5VHlwZUZ1bGxOYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIGNhbmRpZGF0ZWxpc3RJdGVtRW50aXR5VHlwZUZ1bGxOYW1lID9cclxuICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKGNhbmRpZGF0ZWxpc3RJdGVtRW50aXR5VHlwZUZ1bGxOYW1lKSA6XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0UGFyZW50KExpc3QsIHRoaXMucGFyZW50VXJsLnN1YnN0cigwLCB0aGlzLnBhcmVudFVybC5sYXN0SW5kZXhPZihcIi9cIikpKS5nZXRMaXN0SXRlbUVudGl0eVR5cGVGdWxsTmFtZSgpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBJdGVtO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVJdGVtKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIFZlcnNpb24gb2JqZWN0c1xyXG4gKlxyXG4gKi9cclxudmFyIEl0ZW1WZXJzaW9ucyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJdGVtVmVyc2lvbnMsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJdGVtVmVyc2lvbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgdmVyc2lvbiBieSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB2ZXJzaW9uSWQgVGhlIGlkIG9mIHRoZSB2ZXJzaW9uIHRvIHJldHJpZXZlXHJcbiAgICAgKi9cclxuICAgIEl0ZW1WZXJzaW9ucy5wcm90b3R5cGUuZ2V0QnlJZCA9IGZ1bmN0aW9uICh2ZXJzaW9uSWQpIHtcclxuICAgICAgICB2YXIgdiA9IG5ldyBJdGVtVmVyc2lvbih0aGlzKTtcclxuICAgICAgICB2LmNvbmNhdChcIihcIiArIHZlcnNpb25JZCArIFwiKVwiKTtcclxuICAgICAgICByZXR1cm4gdjtcclxuICAgIH07XHJcbiAgICBJdGVtVmVyc2lvbnMgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcInZlcnNpb25zXCIpXHJcbiAgICBdLCBJdGVtVmVyc2lvbnMpO1xyXG4gICAgcmV0dXJuIEl0ZW1WZXJzaW9ucztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIFZlcnNpb24gaW5zdGFuY2VcclxuICpcclxuICovXHJcbnZhciBJdGVtVmVyc2lvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJdGVtVmVyc2lvbiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEl0ZW1WZXJzaW9uKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogRGVsZXRlIGEgc3BlY2lmaWMgdmVyc2lvbiBvZiBhIGZpbGUuXHJcbiAgICAgICAgKlxyXG4gICAgICAgICogQHBhcmFtIGVUYWcgVmFsdWUgdXNlZCBpbiB0aGUgSUYtTWF0Y2ggaGVhZGVyLCBieSBkZWZhdWx0IFwiKlwiXHJcbiAgICAgICAgKi9cclxuICAgICAgICBfdGhpcy5kZWxldGUgPSBfdGhpcy5fZGVsZXRlV2l0aEVUYWc7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEl0ZW1WZXJzaW9uO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG4vKipcclxuICogUHJvdmlkZXMgcGFnaW5nIGZ1bmN0aW9uYWxpdHkgZm9yIGxpc3QgaXRlbXNcclxuICovXHJcbnZhciBQYWdlZEl0ZW1Db2xsZWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUGFnZWRJdGVtQ29sbGVjdGlvbihwYXJlbnQsIG5leHRVcmwsIHJlc3VsdHMpIHtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICAgICAgICB0aGlzLm5leHRVcmwgPSBuZXh0VXJsO1xyXG4gICAgICAgIHRoaXMucmVzdWx0cyA9IHJlc3VsdHM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUGFnZWRJdGVtQ29sbGVjdGlvbi5wcm90b3R5cGUsIFwiaGFzTmV4dFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSWYgdHJ1ZSB0aGVyZSBhcmUgbW9yZSByZXN1bHRzIGF2YWlsYWJsZSBpbiB0aGUgc2V0LCBvdGhlcndpc2UgdGhlcmUgYXJlIG5vdFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRoaXMubmV4dFVybCA9PT0gXCJzdHJpbmdcIiAmJiB0aGlzLm5leHRVcmwubGVuZ3RoID4gMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgbmV4dCBzZXQgb2YgcmVzdWx0cywgb3IgcmVzb2x2ZXMgdG8gbnVsbCBpZiBubyByZXN1bHRzIGFyZSBhdmFpbGFibGVcclxuICAgICAqL1xyXG4gICAgUGFnZWRJdGVtQ29sbGVjdGlvbi5wcm90b3R5cGUuZ2V0TmV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5oYXNOZXh0KSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IG5ldyBJdGVtcyh0aGlzLm5leHRVcmwsIG51bGwpLmNvbmZpZ3VyZUZyb20odGhpcy5wYXJlbnQpO1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbXMuZ2V0UGFnZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyKSB7IHJldHVybiByKG51bGwpOyB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUGFnZWRJdGVtQ29sbGVjdGlvbjtcclxufSgpKTtcclxudmFyIFBhZ2VkSXRlbUNvbGxlY3Rpb25QYXJzZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoUGFnZWRJdGVtQ29sbGVjdGlvblBhcnNlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFBhZ2VkSXRlbUNvbGxlY3Rpb25QYXJzZXIoX3BhcmVudCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX3BhcmVudCA9IF9wYXJlbnQ7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgUGFnZWRJdGVtQ29sbGVjdGlvblBhcnNlci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAocikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgaWYgKF90aGlzLmhhbmRsZUVycm9yKHIsIHJlamVjdCkpIHtcclxuICAgICAgICAgICAgICAgIHIuanNvbigpLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dFVybCA9IGhPUChqc29uLCBcImRcIikgJiYgaE9QKGpzb24uZCwgXCJfX25leHRcIikgPyBqc29uLmQuX19uZXh0IDoganNvbltcIm9kYXRhLm5leHRMaW5rXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobmV3IFBhZ2VkSXRlbUNvbGxlY3Rpb24oX3RoaXMuX3BhcmVudCwgbmV4dFVybCwgX3RoaXMucGFyc2VPRGF0YUpTT04oanNvbikpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFBhZ2VkSXRlbUNvbGxlY3Rpb25QYXJzZXI7XHJcbn0oT0RhdGFQYXJzZXJCYXNlKSk7XHJcbnZhciBJdGVtVXBkYXRlZFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJdGVtVXBkYXRlZFBhcnNlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEl0ZW1VcGRhdGVkUGFyc2VyKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIEl0ZW1VcGRhdGVkUGFyc2VyLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaGFuZGxlRXJyb3IociwgcmVqZWN0KSkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJvZGF0YS5ldGFnXCI6IHIuaGVhZGVycy5nZXQoXCJldGFnXCIpLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSXRlbVVwZGF0ZWRQYXJzZXI7XHJcbn0oT0RhdGFQYXJzZXJCYXNlKSk7XG5cbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIEZpbGUgb2JqZWN0c1xyXG4gKlxyXG4gKi9cclxudmFyIEZpbGVzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZpbGVzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRmlsZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgRmlsZXNfMSA9IEZpbGVzO1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgRmlsZSBieSBmaWxlbmFtZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBmaWxlLCBpbmNsdWRpbmcgZXh0ZW5zaW9uLlxyXG4gICAgICovXHJcbiAgICBGaWxlcy5wcm90b3R5cGUuZ2V0QnlOYW1lID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICB2YXIgZiA9IG5ldyBGaWxlKHRoaXMpO1xyXG4gICAgICAgIGYuY29uY2F0KFwiKCdcIiArIG5hbWUgKyBcIicpXCIpO1xyXG4gICAgICAgIHJldHVybiBmO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXBsb2FkcyBhIGZpbGUuIE5vdCBzdXBwb3J0ZWQgZm9yIGJhdGNoaW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVybCBUaGUgZm9sZGVyLXJlbGF0aXZlIHVybCBvZiB0aGUgZmlsZS5cclxuICAgICAqIEBwYXJhbSBjb250ZW50IFRoZSBmaWxlIGNvbnRlbnRzIGJsb2IuXHJcbiAgICAgKiBAcGFyYW0gc2hvdWxkT3ZlcldyaXRlIFNob3VsZCBhIGZpbGUgd2l0aCB0aGUgc2FtZSBuYW1lIGluIHRoZSBzYW1lIGxvY2F0aW9uIGJlIG92ZXJ3cml0dGVuPyAoZGVmYXVsdDogdHJ1ZSlcclxuICAgICAqIEByZXR1cm5zIFRoZSBuZXcgRmlsZSBhbmQgdGhlIHJhdyByZXNwb25zZS5cclxuICAgICAqL1xyXG4gICAgRmlsZXMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh1cmwsIGNvbnRlbnQsIHNob3VsZE92ZXJXcml0ZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHNob3VsZE92ZXJXcml0ZSA9PT0gdm9pZCAwKSB7IHNob3VsZE92ZXJXcml0ZSA9IHRydWU7IH1cclxuICAgICAgICByZXR1cm4gbmV3IEZpbGVzXzEodGhpcywgXCJhZGQob3ZlcndyaXRlPVwiICsgc2hvdWxkT3ZlcldyaXRlICsgXCIsdXJsPSdcIiArIHVybCArIFwiJylcIilcclxuICAgICAgICAgICAgLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keTogY29udGVudCxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogcmVzcG9uc2UsXHJcbiAgICAgICAgICAgICAgICBmaWxlOiBfdGhpcy5nZXRCeU5hbWUodXJsKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFVwbG9hZHMgYSBmaWxlLiBOb3Qgc3VwcG9ydGVkIGZvciBiYXRjaGluZ1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cmwgVGhlIGZvbGRlci1yZWxhdGl2ZSB1cmwgb2YgdGhlIGZpbGUuXHJcbiAgICAgKiBAcGFyYW0gY29udGVudCBUaGUgQmxvYiBmaWxlIGNvbnRlbnQgdG8gYWRkXHJcbiAgICAgKiBAcGFyYW0gcHJvZ3Jlc3MgQSBjYWxsYmFjayBmdW5jdGlvbiB3aGljaCBjYW4gYmUgdXNlZCB0byB0cmFjayB0aGUgcHJvZ3Jlc3Mgb2YgdGhlIHVwbG9hZFxyXG4gICAgICogQHBhcmFtIHNob3VsZE92ZXJXcml0ZSBTaG91bGQgYSBmaWxlIHdpdGggdGhlIHNhbWUgbmFtZSBpbiB0aGUgc2FtZSBsb2NhdGlvbiBiZSBvdmVyd3JpdHRlbj8gKGRlZmF1bHQ6IHRydWUpXHJcbiAgICAgKiBAcGFyYW0gY2h1bmtTaXplIFRoZSBzaXplIG9mIGVhY2ggZmlsZSBzbGljZSwgaW4gYnl0ZXMgKGRlZmF1bHQ6IDEwNDg1NzYwKVxyXG4gICAgICogQHJldHVybnMgVGhlIG5ldyBGaWxlIGFuZCB0aGUgcmF3IHJlc3BvbnNlLlxyXG4gICAgICovXHJcbiAgICBGaWxlcy5wcm90b3R5cGUuYWRkQ2h1bmtlZCA9IGZ1bmN0aW9uICh1cmwsIGNvbnRlbnQsIHByb2dyZXNzLCBzaG91bGRPdmVyV3JpdGUsIGNodW5rU2l6ZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHNob3VsZE92ZXJXcml0ZSA9PT0gdm9pZCAwKSB7IHNob3VsZE92ZXJXcml0ZSA9IHRydWU7IH1cclxuICAgICAgICBpZiAoY2h1bmtTaXplID09PSB2b2lkIDApIHsgY2h1bmtTaXplID0gMTA0ODU3NjA7IH1cclxuICAgICAgICB2YXIgYWRkZXIgPSB0aGlzLmNsb25lKEZpbGVzXzEsIFwiYWRkKG92ZXJ3cml0ZT1cIiArIHNob3VsZE92ZXJXcml0ZSArIFwiLHVybD0nXCIgKyB1cmwgKyBcIicpXCIsIGZhbHNlKTtcclxuICAgICAgICByZXR1cm4gYWRkZXIucG9zdENvcmUoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5nZXRCeU5hbWUodXJsKTsgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGZpbGUpIHsgcmV0dXJuIGZpbGUuc2V0Q29udGVudENodW5rZWQoY29udGVudCwgcHJvZ3Jlc3MsIGNodW5rU2l6ZSk7IH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIGdob3N0ZWQgZmlsZSB0byBhbiBleGlzdGluZyBsaXN0IG9yIGRvY3VtZW50IGxpYnJhcnkuIE5vdCBzdXBwb3J0ZWQgZm9yIGJhdGNoaW5nLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmaWxlVXJsIFRoZSBzZXJ2ZXItcmVsYXRpdmUgdXJsIHdoZXJlIHlvdSB3YW50IHRvIHNhdmUgdGhlIGZpbGUuXHJcbiAgICAgKiBAcGFyYW0gdGVtcGxhdGVGaWxlVHlwZSBUaGUgdHlwZSBvZiB1c2UgdG8gY3JlYXRlIHRoZSBmaWxlLlxyXG4gICAgICogQHJldHVybnMgVGhlIHRlbXBsYXRlIGZpbGUgdGhhdCB3YXMgYWRkZWQgYW5kIHRoZSByYXcgcmVzcG9uc2UuXHJcbiAgICAgKi9cclxuICAgIEZpbGVzLnByb3RvdHlwZS5hZGRUZW1wbGF0ZUZpbGUgPSBmdW5jdGlvbiAoZmlsZVVybCwgdGVtcGxhdGVGaWxlVHlwZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZXNfMSwgXCJhZGRUZW1wbGF0ZUZpbGUodXJsb2ZmaWxlPSdcIiArIGZpbGVVcmwgKyBcIicsdGVtcGxhdGVmaWxldHlwZT1cIiArIHRlbXBsYXRlRmlsZVR5cGUgKyBcIilcIiwgZmFsc2UpXHJcbiAgICAgICAgICAgIC5wb3N0Q29yZSgpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiByZXNwb25zZSxcclxuICAgICAgICAgICAgICAgIGZpbGU6IF90aGlzLmdldEJ5TmFtZShmaWxlVXJsKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgRmlsZXNfMTtcclxuICAgIEZpbGVzID0gRmlsZXNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwiZmlsZXNcIilcclxuICAgIF0sIEZpbGVzKTtcclxuICAgIHJldHVybiBGaWxlcztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgc2luZ2xlIEZpbGUgaW5zdGFuY2VcclxuICpcclxuICovXHJcbnZhciBGaWxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZpbGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBGaWxlKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGaWxlLnByb3RvdHlwZSwgXCJsaXN0SXRlbUFsbEZpZWxkc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyBhIHZhbHVlIHRoYXQgc3BlY2lmaWVzIHRoZSBsaXN0IGl0ZW0gZmllbGQgdmFsdWVzIGZvciB0aGUgbGlzdCBpdGVtIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGZpbGUuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UodGhpcywgXCJsaXN0SXRlbUFsbEZpZWxkc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGaWxlLnByb3RvdHlwZSwgXCJ2ZXJzaW9uc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyBhIGNvbGxlY3Rpb24gb2YgdmVyc2lvbnNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlcnNpb25zKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBcHByb3ZlcyB0aGUgZmlsZSBzdWJtaXR0ZWQgZm9yIGNvbnRlbnQgYXBwcm92YWwgd2l0aCB0aGUgc3BlY2lmaWVkIGNvbW1lbnQuXHJcbiAgICAgKiBPbmx5IGRvY3VtZW50cyBpbiBsaXN0cyB0aGF0IGFyZSBlbmFibGVkIGZvciBjb250ZW50IGFwcHJvdmFsIGNhbiBiZSBhcHByb3ZlZC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29tbWVudCBUaGUgY29tbWVudCBmb3IgdGhlIGFwcHJvdmFsLlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5hcHByb3ZlID0gZnVuY3Rpb24gKGNvbW1lbnQpIHtcclxuICAgICAgICBpZiAoY29tbWVudCA9PT0gdm9pZCAwKSB7IGNvbW1lbnQgPSBcIlwiOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCJhcHByb3ZlKGNvbW1lbnQ9J1wiICsgY29tbWVudCArIFwiJylcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFN0b3BzIHRoZSBjaHVuayB1cGxvYWQgc2Vzc2lvbiB3aXRob3V0IHNhdmluZyB0aGUgdXBsb2FkZWQgZGF0YS4gRG9lcyBub3Qgc3VwcG9ydCBiYXRjaGluZy5cclxuICAgICAqIElmIHRoZSBmaWxlIGRvZXNu4oCZdCBhbHJlYWR5IGV4aXN0IGluIHRoZSBsaWJyYXJ5LCB0aGUgcGFydGlhbGx5IHVwbG9hZGVkIGZpbGUgd2lsbCBiZSBkZWxldGVkLlxyXG4gICAgICogVXNlIHRoaXMgaW4gcmVzcG9uc2UgdG8gdXNlciBhY3Rpb24gKGFzIGluIGEgcmVxdWVzdCB0byBjYW5jZWwgYW4gdXBsb2FkKSBvciBhbiBlcnJvciBvciBleGNlcHRpb24uXHJcbiAgICAgKiBVc2UgdGhlIHVwbG9hZElkIHZhbHVlIHRoYXQgd2FzIHBhc3NlZCB0byB0aGUgU3RhcnRVcGxvYWQgbWV0aG9kIHRoYXQgc3RhcnRlZCB0aGUgdXBsb2FkIHNlc3Npb24uXHJcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjdXJyZW50bHkgYXZhaWxhYmxlIG9ubHkgb24gT2ZmaWNlIDM2NS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXBsb2FkSWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSB1cGxvYWQgc2Vzc2lvbi5cclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUuY2FuY2VsVXBsb2FkID0gZnVuY3Rpb24gKHVwbG9hZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCJjYW5jZWxVcGxvYWQodXBsb2FkSWQ9Z3VpZCdcIiArIHVwbG9hZElkICsgXCInKVwiLCBmYWxzZSkucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENoZWNrcyB0aGUgZmlsZSBpbiB0byBhIGRvY3VtZW50IGxpYnJhcnkgYmFzZWQgb24gdGhlIGNoZWNrLWluIHR5cGUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbW1lbnQgQSBjb21tZW50IGZvciB0aGUgY2hlY2staW4uIEl0cyBsZW5ndGggbXVzdCBiZSA8PSAxMDIzLlxyXG4gICAgICogQHBhcmFtIGNoZWNraW5UeXBlIFRoZSBjaGVjay1pbiB0eXBlIGZvciB0aGUgZmlsZS5cclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUuY2hlY2tpbiA9IGZ1bmN0aW9uIChjb21tZW50LCBjaGVja2luVHlwZSkge1xyXG4gICAgICAgIGlmIChjb21tZW50ID09PSB2b2lkIDApIHsgY29tbWVudCA9IFwiXCI7IH1cclxuICAgICAgICBpZiAoY2hlY2tpblR5cGUgPT09IHZvaWQgMCkgeyBjaGVja2luVHlwZSA9IENoZWNraW5UeXBlLk1ham9yOyB9XHJcbiAgICAgICAgaWYgKGNvbW1lbnQubGVuZ3RoID4gMTAyMykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbWF4aW11bSBjb21tZW50IGxlbmd0aCBpcyAxMDIzIGNoYXJhY3RlcnMuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWxlLCBcImNoZWNraW4oY29tbWVudD0nXCIgKyBjb21tZW50ICsgXCInLGNoZWNraW50eXBlPVwiICsgY2hlY2tpblR5cGUgKyBcIilcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENoZWNrcyBvdXQgdGhlIGZpbGUgZnJvbSBhIGRvY3VtZW50IGxpYnJhcnkuXHJcbiAgICAgKi9cclxuICAgIEZpbGUucHJvdG90eXBlLmNoZWNrb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpbGUsIFwiY2hlY2tvdXRcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENvcGllcyB0aGUgZmlsZSB0byB0aGUgZGVzdGluYXRpb24gdXJsLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cmwgVGhlIGFic29sdXRlIHVybCBvciBzZXJ2ZXIgcmVsYXRpdmUgdXJsIG9mIHRoZSBkZXN0aW5hdGlvbiBmaWxlIHBhdGggdG8gY29weSB0by5cclxuICAgICAqIEBwYXJhbSBzaG91bGRPdmVyV3JpdGUgU2hvdWxkIGEgZmlsZSB3aXRoIHRoZSBzYW1lIG5hbWUgaW4gdGhlIHNhbWUgbG9jYXRpb24gYmUgb3ZlcndyaXR0ZW4/XHJcbiAgICAgKi9cclxuICAgIEZpbGUucHJvdG90eXBlLmNvcHlUbyA9IGZ1bmN0aW9uICh1cmwsIHNob3VsZE92ZXJXcml0ZSkge1xyXG4gICAgICAgIGlmIChzaG91bGRPdmVyV3JpdGUgPT09IHZvaWQgMCkgeyBzaG91bGRPdmVyV3JpdGUgPSB0cnVlOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCJjb3B5VG8oc3RybmV3dXJsPSdcIiArIHVybCArIFwiJyxib3ZlcndyaXRlPVwiICsgc2hvdWxkT3ZlcldyaXRlICsgXCIpXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWxldGUgdGhpcyBmaWxlLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBlVGFnIFZhbHVlIHVzZWQgaW4gdGhlIElGLU1hdGNoIGhlYWRlciwgYnkgZGVmYXVsdCBcIipcIlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoZVRhZykge1xyXG4gICAgICAgIGlmIChlVGFnID09PSB2b2lkIDApIHsgZVRhZyA9IFwiKlwiOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgbnVsbCkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICBcIklGLU1hdGNoXCI6IGVUYWcsXHJcbiAgICAgICAgICAgICAgICBcIlgtSFRUUC1NZXRob2RcIjogXCJERUxFVEVcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERlbmllcyBhcHByb3ZhbCBmb3IgYSBmaWxlIHRoYXQgd2FzIHN1Ym1pdHRlZCBmb3IgY29udGVudCBhcHByb3ZhbC5cclxuICAgICAqIE9ubHkgZG9jdW1lbnRzIGluIGxpc3RzIHRoYXQgYXJlIGVuYWJsZWQgZm9yIGNvbnRlbnQgYXBwcm92YWwgY2FuIGJlIGRlbmllZC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29tbWVudCBUaGUgY29tbWVudCBmb3IgdGhlIGRlbmlhbC5cclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUuZGVueSA9IGZ1bmN0aW9uIChjb21tZW50KSB7XHJcbiAgICAgICAgaWYgKGNvbW1lbnQgPT09IHZvaWQgMCkgeyBjb21tZW50ID0gXCJcIjsgfVxyXG4gICAgICAgIGlmIChjb21tZW50Lmxlbmd0aCA+IDEwMjMpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIG1heGltdW0gY29tbWVudCBsZW5ndGggaXMgMTAyMyBjaGFyYWN0ZXJzLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCJkZW55KGNvbW1lbnQ9J1wiICsgY29tbWVudCArIFwiJylcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNwZWNpZmllcyB0aGUgY29udHJvbCBzZXQgdXNlZCB0byBhY2Nlc3MsIG1vZGlmeSwgb3IgYWRkIFdlYiBQYXJ0cyBhc3NvY2lhdGVkIHdpdGggdGhpcyBXZWIgUGFydCBQYWdlIGFuZCB2aWV3LlxyXG4gICAgICogQW4gZXhjZXB0aW9uIGlzIHRocm93biBpZiB0aGUgZmlsZSBpcyBub3QgYW4gQVNQWCBwYWdlLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzY29wZSBUaGUgV2ViUGFydHNQZXJzb25hbGl6YXRpb25TY29wZSB2aWV3IG9uIHRoZSBXZWIgUGFydHMgcGFnZS5cclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUuZ2V0TGltaXRlZFdlYlBhcnRNYW5hZ2VyID0gZnVuY3Rpb24gKHNjb3BlKSB7XHJcbiAgICAgICAgaWYgKHNjb3BlID09PSB2b2lkIDApIHsgc2NvcGUgPSBXZWJQYXJ0c1BlcnNvbmFsaXphdGlvblNjb3BlLlNoYXJlZDsgfVxyXG4gICAgICAgIHJldHVybiBuZXcgTGltaXRlZFdlYlBhcnRNYW5hZ2VyKHRoaXMsIFwiZ2V0TGltaXRlZFdlYlBhcnRNYW5hZ2VyKHNjb3BlPVwiICsgc2NvcGUgKyBcIilcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBNb3ZlcyB0aGUgZmlsZSB0byB0aGUgc3BlY2lmaWVkIGRlc3RpbmF0aW9uIHVybC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXJsIFRoZSBhYnNvbHV0ZSB1cmwgb3Igc2VydmVyIHJlbGF0aXZlIHVybCBvZiB0aGUgZGVzdGluYXRpb24gZmlsZSBwYXRoIHRvIG1vdmUgdG8uXHJcbiAgICAgKiBAcGFyYW0gbW92ZU9wZXJhdGlvbnMgVGhlIGJpdHdpc2UgTW92ZU9wZXJhdGlvbnMgdmFsdWUgZm9yIGhvdyB0byBtb3ZlIHRoZSBmaWxlLlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbiAodXJsLCBtb3ZlT3BlcmF0aW9ucykge1xyXG4gICAgICAgIGlmIChtb3ZlT3BlcmF0aW9ucyA9PT0gdm9pZCAwKSB7IG1vdmVPcGVyYXRpb25zID0gTW92ZU9wZXJhdGlvbnMuT3ZlcndyaXRlOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCJtb3ZlVG8obmV3dXJsPSdcIiArIHVybCArIFwiJyxmbGFncz1cIiArIG1vdmVPcGVyYXRpb25zICsgXCIpXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJtaXRzIHRoZSBmaWxlIGZvciBjb250ZW50IGFwcHJvdmFsIHdpdGggdGhlIHNwZWNpZmllZCBjb21tZW50LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb21tZW50IFRoZSBjb21tZW50IGZvciB0aGUgcHVibGlzaGVkIGZpbGUuIEl0cyBsZW5ndGggbXVzdCBiZSA8PSAxMDIzLlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5wdWJsaXNoID0gZnVuY3Rpb24gKGNvbW1lbnQpIHtcclxuICAgICAgICBpZiAoY29tbWVudCA9PT0gdm9pZCAwKSB7IGNvbW1lbnQgPSBcIlwiOyB9XHJcbiAgICAgICAgaWYgKGNvbW1lbnQubGVuZ3RoID4gMTAyMykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbWF4aW11bSBjb21tZW50IGxlbmd0aCBpcyAxMDIzIGNoYXJhY3RlcnMuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWxlLCBcInB1Ymxpc2goY29tbWVudD0nXCIgKyBjb21tZW50ICsgXCInKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogTW92ZXMgdGhlIGZpbGUgdG8gdGhlIFJlY3ljbGUgQmluIGFuZCByZXR1cm5zIHRoZSBpZGVudGlmaWVyIG9mIHRoZSBuZXcgUmVjeWNsZSBCaW4gaXRlbS5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBUaGUgR1VJRCBvZiB0aGUgcmVjeWNsZWQgZmlsZS5cclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUucmVjeWNsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWxlLCBcInJlY3ljbGVcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJldmVydHMgYW4gZXhpc3RpbmcgY2hlY2tvdXQgZm9yIHRoZSBmaWxlLlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUudW5kb0NoZWNrb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpbGUsIFwidW5kb0NoZWNrb3V0XCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmVzIHRoZSBmaWxlIGZyb20gY29udGVudCBhcHByb3ZhbCBvciB1bnB1Ymxpc2ggYSBtYWpvciB2ZXJzaW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb21tZW50IFRoZSBjb21tZW50IGZvciB0aGUgdW5wdWJsaXNoIG9wZXJhdGlvbi4gSXRzIGxlbmd0aCBtdXN0IGJlIDw9IDEwMjMuXHJcbiAgICAgKi9cclxuICAgIEZpbGUucHJvdG90eXBlLnVucHVibGlzaCA9IGZ1bmN0aW9uIChjb21tZW50KSB7XHJcbiAgICAgICAgaWYgKGNvbW1lbnQgPT09IHZvaWQgMCkgeyBjb21tZW50ID0gXCJcIjsgfVxyXG4gICAgICAgIGlmIChjb21tZW50Lmxlbmd0aCA+IDEwMjMpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIG1heGltdW0gY29tbWVudCBsZW5ndGggaXMgMTAyMyBjaGFyYWN0ZXJzLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCJ1bnB1Ymxpc2goY29tbWVudD0nXCIgKyBjb21tZW50ICsgXCInKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUgYXMgdGV4dC4gTm90IHN1cHBvcnRlZCBpbiBiYXRjaGluZy5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIEZpbGUucHJvdG90eXBlLmdldFRleHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCIkdmFsdWVcIiwgZmFsc2UpLmdldChuZXcgVGV4dFBhcnNlcigpLCB7IGhlYWRlcnM6IHsgXCJiaW5hcnlTdHJpbmdSZXNwb25zZUJvZHlcIjogXCJ0cnVlXCIgfSB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIGNvbnRlbnRzIG9mIHRoZSBmaWxlIGFzIGEgYmxvYiwgZG9lcyBub3Qgd29yayBpbiBOb2RlLmpzLiBOb3Qgc3VwcG9ydGVkIGluIGJhdGNoaW5nLlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUuZ2V0QmxvYiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWxlLCBcIiR2YWx1ZVwiLCBmYWxzZSkuZ2V0KG5ldyBCbG9iUGFyc2VyKCksIHsgaGVhZGVyczogeyBcImJpbmFyeVN0cmluZ1Jlc3BvbnNlQm9keVwiOiBcInRydWVcIiB9IH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY29udGVudHMgb2YgYSBmaWxlIGFzIGFuIEFycmF5QnVmZmVyLCB3b3JrcyBpbiBOb2RlLmpzLiBOb3Qgc3VwcG9ydGVkIGluIGJhdGNoaW5nLlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5nZXRCdWZmZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoRmlsZSwgXCIkdmFsdWVcIiwgZmFsc2UpLmdldChuZXcgQnVmZmVyUGFyc2VyKCksIHsgaGVhZGVyczogeyBcImJpbmFyeVN0cmluZ1Jlc3BvbnNlQm9keVwiOiBcInRydWVcIiB9IH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY29udGVudHMgb2YgYSBmaWxlIGFzIGFuIEFycmF5QnVmZmVyLCB3b3JrcyBpbiBOb2RlLmpzLiBOb3Qgc3VwcG9ydGVkIGluIGJhdGNoaW5nLlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5nZXRKU09OID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpbGUsIFwiJHZhbHVlXCIsIGZhbHNlKS5nZXQobmV3IEpTT05QYXJzZXIoKSwgeyBoZWFkZXJzOiB7IFwiYmluYXJ5U3RyaW5nUmVzcG9uc2VCb2R5XCI6IFwidHJ1ZVwiIH0gfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIHRoZSBjb250ZW50IG9mIGEgZmlsZSwgZm9yIGxhcmdlIGZpbGVzIHVzZSBzZXRDb250ZW50Q2h1bmtlZC4gTm90IHN1cHBvcnRlZCBpbiBiYXRjaGluZy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29udGVudCBUaGUgZmlsZSBjb250ZW50XHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gKGNvbnRlbnQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpbGUsIFwiJHZhbHVlXCIsIGZhbHNlKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGNvbnRlbnQsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgIFwiWC1IVFRQLU1ldGhvZFwiOiBcIlBVVFwiLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKF8pIHsgcmV0dXJuIG5ldyBGaWxlKF90aGlzKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBhc3NvY2lhdGVkIGxpc3QgaXRlbSBmb3IgdGhpcyBmb2xkZXIsIGxvYWRpbmcgdGhlIGRlZmF1bHQgcHJvcGVydGllc1xyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5nZXRJdGVtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzZWxlY3RzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgc2VsZWN0c1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcSA9IHRoaXMubGlzdEl0ZW1BbGxGaWVsZHM7XHJcbiAgICAgICAgcmV0dXJuIHEuc2VsZWN0LmFwcGx5KHEsIHNlbGVjdHMpLmdldCgpLnRoZW4oZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGV4dGVuZChuZXcgSXRlbShvZGF0YVVybEZyb20oZCkpLCBkKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdGhlIGNvbnRlbnRzIG9mIGEgZmlsZSB1c2luZyBhIGNodW5rZWQgdXBsb2FkIGFwcHJvYWNoLiBOb3Qgc3VwcG9ydGVkIGluIGJhdGNoaW5nLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmaWxlIFRoZSBmaWxlIHRvIHVwbG9hZFxyXG4gICAgICogQHBhcmFtIHByb2dyZXNzIEEgY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggY2FuIGJlIHVzZWQgdG8gdHJhY2sgdGhlIHByb2dyZXNzIG9mIHRoZSB1cGxvYWRcclxuICAgICAqIEBwYXJhbSBjaHVua1NpemUgVGhlIHNpemUgb2YgZWFjaCBmaWxlIHNsaWNlLCBpbiBieXRlcyAoZGVmYXVsdDogMTA0ODU3NjApXHJcbiAgICAgKi9cclxuICAgIEZpbGUucHJvdG90eXBlLnNldENvbnRlbnRDaHVua2VkID0gZnVuY3Rpb24gKGZpbGUsIHByb2dyZXNzLCBjaHVua1NpemUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChjaHVua1NpemUgPT09IHZvaWQgMCkgeyBjaHVua1NpemUgPSAxMDQ4NTc2MDsgfVxyXG4gICAgICAgIGlmIChwcm9ncmVzcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHByb2dyZXNzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbnVsbDsgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGZpbGVTaXplID0gZmlsZS5zaXplO1xyXG4gICAgICAgIHZhciBibG9ja0NvdW50ID0gcGFyc2VJbnQoKGZpbGUuc2l6ZSAvIGNodW5rU2l6ZSkudG9TdHJpbmcoKSwgMTApICsgKChmaWxlLnNpemUgJSBjaHVua1NpemUgPT09IDApID8gMSA6IDApO1xyXG4gICAgICAgIHZhciB1cGxvYWRJZCA9IGdldEdVSUQoKTtcclxuICAgICAgICAvLyBzdGFydCB0aGUgY2hhaW4gd2l0aCB0aGUgZmlyc3QgZnJhZ21lbnRcclxuICAgICAgICBwcm9ncmVzcyh7IHVwbG9hZElkOiB1cGxvYWRJZCwgYmxvY2tOdW1iZXI6IDEsIGNodW5rU2l6ZTogY2h1bmtTaXplLCBjdXJyZW50UG9pbnRlcjogMCwgZmlsZVNpemU6IGZpbGVTaXplLCBzdGFnZTogXCJzdGFydGluZ1wiLCB0b3RhbEJsb2NrczogYmxvY2tDb3VudCB9KTtcclxuICAgICAgICB2YXIgY2hhaW4gPSB0aGlzLnN0YXJ0VXBsb2FkKHVwbG9hZElkLCBmaWxlLnNsaWNlKDAsIGNodW5rU2l6ZSkpO1xyXG4gICAgICAgIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gKGkpIHtcclxuICAgICAgICAgICAgY2hhaW4gPSBjaGFpbi50aGVuKGZ1bmN0aW9uIChwb2ludGVyKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzcyh7IHVwbG9hZElkOiB1cGxvYWRJZCwgYmxvY2tOdW1iZXI6IGksIGNodW5rU2l6ZTogY2h1bmtTaXplLCBjdXJyZW50UG9pbnRlcjogcG9pbnRlciwgZmlsZVNpemU6IGZpbGVTaXplLCBzdGFnZTogXCJjb250aW51ZVwiLCB0b3RhbEJsb2NrczogYmxvY2tDb3VudCB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jb250aW51ZVVwbG9hZCh1cGxvYWRJZCwgcG9pbnRlciwgZmlsZS5zbGljZShwb2ludGVyLCBwb2ludGVyICsgY2h1bmtTaXplKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gc2tpcCB0aGUgZmlyc3QgYW5kIGxhc3QgYmxvY2tzXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDI7IGkgPCBibG9ja0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgX2xvb3BfMShpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNoYWluLnRoZW4oZnVuY3Rpb24gKHBvaW50ZXIpIHtcclxuICAgICAgICAgICAgcHJvZ3Jlc3MoeyB1cGxvYWRJZDogdXBsb2FkSWQsIGJsb2NrTnVtYmVyOiBibG9ja0NvdW50LCBjaHVua1NpemU6IGNodW5rU2l6ZSwgY3VycmVudFBvaW50ZXI6IHBvaW50ZXIsIGZpbGVTaXplOiBmaWxlU2l6ZSwgc3RhZ2U6IFwiZmluaXNoaW5nXCIsIHRvdGFsQmxvY2tzOiBibG9ja0NvdW50IH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuZmluaXNoVXBsb2FkKHVwbG9hZElkLCBwb2ludGVyLCBmaWxlLnNsaWNlKHBvaW50ZXIpKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyBhIG5ldyBjaHVuayB1cGxvYWQgc2Vzc2lvbiBhbmQgdXBsb2FkcyB0aGUgZmlyc3QgZnJhZ21lbnQuXHJcbiAgICAgKiBUaGUgY3VycmVudCBmaWxlIGNvbnRlbnQgaXMgbm90IGNoYW5nZWQgd2hlbiB0aGlzIG1ldGhvZCBjb21wbGV0ZXMuXHJcbiAgICAgKiBUaGUgbWV0aG9kIGlzIGlkZW1wb3RlbnQgKGFuZCB0aGVyZWZvcmUgZG9lcyBub3QgY2hhbmdlIHRoZSByZXN1bHQpIGFzIGxvbmcgYXMgeW91IHVzZSB0aGUgc2FtZSB2YWx1ZXMgZm9yIHVwbG9hZElkIGFuZCBzdHJlYW0uXHJcbiAgICAgKiBUaGUgdXBsb2FkIHNlc3Npb24gZW5kcyBlaXRoZXIgd2hlbiB5b3UgdXNlIHRoZSBDYW5jZWxVcGxvYWQgbWV0aG9kIG9yIHdoZW4geW91IHN1Y2Nlc3NmdWxseVxyXG4gICAgICogY29tcGxldGUgdGhlIHVwbG9hZCBzZXNzaW9uIGJ5IHBhc3NpbmcgdGhlIHJlc3Qgb2YgdGhlIGZpbGUgY29udGVudHMgdGhyb3VnaCB0aGUgQ29udGludWVVcGxvYWQgYW5kIEZpbmlzaFVwbG9hZCBtZXRob2RzLlxyXG4gICAgICogVGhlIFN0YXJ0VXBsb2FkIGFuZCBDb250aW51ZVVwbG9hZCBtZXRob2RzIHJldHVybiB0aGUgc2l6ZSBvZiB0aGUgcnVubmluZyB0b3RhbCBvZiB1cGxvYWRlZCBkYXRhIGluIGJ5dGVzLFxyXG4gICAgICogc28geW91IGNhbiBwYXNzIHRob3NlIHJldHVybiB2YWx1ZXMgdG8gc3Vic2VxdWVudCB1c2VzIG9mIENvbnRpbnVlVXBsb2FkIGFuZCBGaW5pc2hVcGxvYWQuXHJcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjdXJyZW50bHkgYXZhaWxhYmxlIG9ubHkgb24gT2ZmaWNlIDM2NS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXBsb2FkSWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSB1cGxvYWQgc2Vzc2lvbi5cclxuICAgICAqIEBwYXJhbSBmcmFnbWVudCBUaGUgZmlsZSBjb250ZW50cy5cclxuICAgICAqIEByZXR1cm5zIFRoZSBzaXplIG9mIHRoZSB0b3RhbCB1cGxvYWRlZCBkYXRhIGluIGJ5dGVzLlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5zdGFydFVwbG9hZCA9IGZ1bmN0aW9uICh1cGxvYWRJZCwgZnJhZ21lbnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWxlLCBcInN0YXJ0VXBsb2FkKHVwbG9hZElkPWd1aWQnXCIgKyB1cGxvYWRJZCArIFwiJylcIiwgZmFsc2UpXHJcbiAgICAgICAgICAgIC5wb3N0Q29yZSh7IGJvZHk6IGZyYWdtZW50IH0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChuKSB7XHJcbiAgICAgICAgICAgIC8vIFdoZW4gT0RhdGE9dmVyYm9zZSB0aGUgcGF5bG9hZCBoYXMgdGhlIGZvbGxvd2luZyBzaGFwZTpcclxuICAgICAgICAgICAgLy8geyBTdGFydFVwbG9hZDogXCIxMDQ4NTc2MFwiIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBuID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICBuID0gbi5TdGFydFVwbG9hZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChuKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENvbnRpbnVlcyB0aGUgY2h1bmsgdXBsb2FkIHNlc3Npb24gd2l0aCBhbiBhZGRpdGlvbmFsIGZyYWdtZW50LlxyXG4gICAgICogVGhlIGN1cnJlbnQgZmlsZSBjb250ZW50IGlzIG5vdCBjaGFuZ2VkLlxyXG4gICAgICogVXNlIHRoZSB1cGxvYWRJZCB2YWx1ZSB0aGF0IHdhcyBwYXNzZWQgdG8gdGhlIFN0YXJ0VXBsb2FkIG1ldGhvZCB0aGF0IHN0YXJ0ZWQgdGhlIHVwbG9hZCBzZXNzaW9uLlxyXG4gICAgICogVGhpcyBtZXRob2QgaXMgY3VycmVudGx5IGF2YWlsYWJsZSBvbmx5IG9uIE9mZmljZSAzNjUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVwbG9hZElkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgdXBsb2FkIHNlc3Npb24uXHJcbiAgICAgKiBAcGFyYW0gZmlsZU9mZnNldCBUaGUgc2l6ZSBvZiB0aGUgb2Zmc2V0IGludG8gdGhlIGZpbGUgd2hlcmUgdGhlIGZyYWdtZW50IHN0YXJ0cy5cclxuICAgICAqIEBwYXJhbSBmcmFnbWVudCBUaGUgZmlsZSBjb250ZW50cy5cclxuICAgICAqIEByZXR1cm5zIFRoZSBzaXplIG9mIHRoZSB0b3RhbCB1cGxvYWRlZCBkYXRhIGluIGJ5dGVzLlxyXG4gICAgICovXHJcbiAgICBGaWxlLnByb3RvdHlwZS5jb250aW51ZVVwbG9hZCA9IGZ1bmN0aW9uICh1cGxvYWRJZCwgZmlsZU9mZnNldCwgZnJhZ21lbnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGaWxlLCBcImNvbnRpbnVlVXBsb2FkKHVwbG9hZElkPWd1aWQnXCIgKyB1cGxvYWRJZCArIFwiJyxmaWxlT2Zmc2V0PVwiICsgZmlsZU9mZnNldCArIFwiKVwiLCBmYWxzZSlcclxuICAgICAgICAgICAgLnBvc3RDb3JlKHsgYm9keTogZnJhZ21lbnQgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG4pIHtcclxuICAgICAgICAgICAgLy8gV2hlbiBPRGF0YT12ZXJib3NlIHRoZSBwYXlsb2FkIGhhcyB0aGUgZm9sbG93aW5nIHNoYXBlOlxyXG4gICAgICAgICAgICAvLyB7IENvbnRpbnVlVXBsb2FkOiBcIjIwOTcxNTIwXCIgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG4gPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgIG4gPSBuLkNvbnRpbnVlVXBsb2FkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KG4pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXBsb2FkcyB0aGUgbGFzdCBmaWxlIGZyYWdtZW50IGFuZCBjb21taXRzIHRoZSBmaWxlLiBUaGUgY3VycmVudCBmaWxlIGNvbnRlbnQgaXMgY2hhbmdlZCB3aGVuIHRoaXMgbWV0aG9kIGNvbXBsZXRlcy5cclxuICAgICAqIFVzZSB0aGUgdXBsb2FkSWQgdmFsdWUgdGhhdCB3YXMgcGFzc2VkIHRvIHRoZSBTdGFydFVwbG9hZCBtZXRob2QgdGhhdCBzdGFydGVkIHRoZSB1cGxvYWQgc2Vzc2lvbi5cclxuICAgICAqIFRoaXMgbWV0aG9kIGlzIGN1cnJlbnRseSBhdmFpbGFibGUgb25seSBvbiBPZmZpY2UgMzY1LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cGxvYWRJZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIHVwbG9hZCBzZXNzaW9uLlxyXG4gICAgICogQHBhcmFtIGZpbGVPZmZzZXQgVGhlIHNpemUgb2YgdGhlIG9mZnNldCBpbnRvIHRoZSBmaWxlIHdoZXJlIHRoZSBmcmFnbWVudCBzdGFydHMuXHJcbiAgICAgKiBAcGFyYW0gZnJhZ21lbnQgVGhlIGZpbGUgY29udGVudHMuXHJcbiAgICAgKiBAcmV0dXJucyBUaGUgbmV3bHkgdXBsb2FkZWQgZmlsZS5cclxuICAgICAqL1xyXG4gICAgRmlsZS5wcm90b3R5cGUuZmluaXNoVXBsb2FkID0gZnVuY3Rpb24gKHVwbG9hZElkLCBmaWxlT2Zmc2V0LCBmcmFnbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEZpbGUsIFwiZmluaXNoVXBsb2FkKHVwbG9hZElkPWd1aWQnXCIgKyB1cGxvYWRJZCArIFwiJyxmaWxlT2Zmc2V0PVwiICsgZmlsZU9mZnNldCArIFwiKVwiLCBmYWxzZSlcclxuICAgICAgICAgICAgLnBvc3RDb3JlKHsgYm9keTogZnJhZ21lbnQgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiByZXNwb25zZSxcclxuICAgICAgICAgICAgICAgIGZpbGU6IG5ldyBGaWxlKG9kYXRhVXJsRnJvbShyZXNwb25zZSkpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBGaWxlO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVGaWxlKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBjb2xsZWN0aW9uIG9mIFZlcnNpb24gb2JqZWN0c1xyXG4gKlxyXG4gKi9cclxudmFyIFZlcnNpb25zID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFZlcnNpb25zLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVmVyc2lvbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgVmVyc2lvbnNfMSA9IFZlcnNpb25zO1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgdmVyc2lvbiBieSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB2ZXJzaW9uSWQgVGhlIGlkIG9mIHRoZSB2ZXJzaW9uIHRvIHJldHJpZXZlXHJcbiAgICAgKi9cclxuICAgIFZlcnNpb25zLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKHZlcnNpb25JZCkge1xyXG4gICAgICAgIHZhciB2ID0gbmV3IFZlcnNpb24odGhpcyk7XHJcbiAgICAgICAgdi5jb25jYXQoXCIoXCIgKyB2ZXJzaW9uSWQgKyBcIilcIik7XHJcbiAgICAgICAgcmV0dXJuIHY7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWxldGVzIGFsbCB0aGUgZmlsZSB2ZXJzaW9uIG9iamVjdHMgaW4gdGhlIGNvbGxlY3Rpb24uXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBWZXJzaW9ucy5wcm90b3R5cGUuZGVsZXRlQWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgVmVyc2lvbnNfMSh0aGlzLCBcImRlbGV0ZUFsbFwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlcyB0aGUgc3BlY2lmaWVkIHZlcnNpb24gb2YgdGhlIGZpbGUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHZlcnNpb25JZCBUaGUgSUQgb2YgdGhlIGZpbGUgdmVyc2lvbiB0byBkZWxldGUuXHJcbiAgICAgKi9cclxuICAgIFZlcnNpb25zLnByb3RvdHlwZS5kZWxldGVCeUlkID0gZnVuY3Rpb24gKHZlcnNpb25JZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFZlcnNpb25zXzEsIFwiZGVsZXRlQnlJZCh2aWQ9XCIgKyB2ZXJzaW9uSWQgKyBcIilcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlY3ljbGVzIHRoZSBzcGVjaWZpZWQgdmVyc2lvbiBvZiB0aGUgZmlsZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdmVyc2lvbklkIFRoZSBJRCBvZiB0aGUgZmlsZSB2ZXJzaW9uIHRvIGRlbGV0ZS5cclxuICAgICAqL1xyXG4gICAgVmVyc2lvbnMucHJvdG90eXBlLnJlY3ljbGVCeUlEID0gZnVuY3Rpb24gKHZlcnNpb25JZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFZlcnNpb25zXzEsIFwicmVjeWNsZUJ5SUQodmlkPVwiICsgdmVyc2lvbklkICsgXCIpXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWxldGVzIHRoZSBmaWxlIHZlcnNpb24gb2JqZWN0IHdpdGggdGhlIHNwZWNpZmllZCB2ZXJzaW9uIGxhYmVsLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsYWJlbCBUaGUgdmVyc2lvbiBsYWJlbCBvZiB0aGUgZmlsZSB2ZXJzaW9uIHRvIGRlbGV0ZSwgZm9yIGV4YW1wbGU6IDEuMlxyXG4gICAgICovXHJcbiAgICBWZXJzaW9ucy5wcm90b3R5cGUuZGVsZXRlQnlMYWJlbCA9IGZ1bmN0aW9uIChsYWJlbCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFZlcnNpb25zXzEsIFwiZGVsZXRlQnlMYWJlbCh2ZXJzaW9ubGFiZWw9J1wiICsgbGFiZWwgKyBcIicpXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZWN5Y2xlcyB0aGUgZmlsZSB2ZXJzaW9uIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQgdmVyc2lvbiBsYWJlbC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbGFiZWwgVGhlIHZlcnNpb24gbGFiZWwgb2YgdGhlIGZpbGUgdmVyc2lvbiB0byBkZWxldGUsIGZvciBleGFtcGxlOiAxLjJcclxuICAgICAqL1xyXG4gICAgVmVyc2lvbnMucHJvdG90eXBlLnJlY3ljbGVCeUxhYmVsID0gZnVuY3Rpb24gKGxhYmVsKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoVmVyc2lvbnNfMSwgXCJyZWN5Y2xlQnlMYWJlbCh2ZXJzaW9ubGFiZWw9J1wiICsgbGFiZWwgKyBcIicpXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGZpbGUgdmVyc2lvbiBmcm9tIHRoZSBmaWxlIHNwZWNpZmllZCBieSB0aGUgdmVyc2lvbiBsYWJlbC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbGFiZWwgVGhlIHZlcnNpb24gbGFiZWwgb2YgdGhlIGZpbGUgdmVyc2lvbiB0byByZXN0b3JlLCBmb3IgZXhhbXBsZTogMS4yXHJcbiAgICAgKi9cclxuICAgIFZlcnNpb25zLnByb3RvdHlwZS5yZXN0b3JlQnlMYWJlbCA9IGZ1bmN0aW9uIChsYWJlbCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFZlcnNpb25zXzEsIFwicmVzdG9yZUJ5TGFiZWwodmVyc2lvbmxhYmVsPSdcIiArIGxhYmVsICsgXCInKVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgfTtcclxuICAgIHZhciBWZXJzaW9uc18xO1xyXG4gICAgVmVyc2lvbnMgPSBWZXJzaW9uc18xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJ2ZXJzaW9uc1wiKVxyXG4gICAgXSwgVmVyc2lvbnMpO1xyXG4gICAgcmV0dXJuIFZlcnNpb25zO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBzaW5nbGUgVmVyc2lvbiBpbnN0YW5jZVxyXG4gKlxyXG4gKi9cclxudmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVmVyc2lvbiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFZlcnNpb24oKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBEZWxldGUgYSBzcGVjaWZpYyB2ZXJzaW9uIG9mIGEgZmlsZS5cclxuICAgICAgICAqXHJcbiAgICAgICAgKiBAcGFyYW0gZVRhZyBWYWx1ZSB1c2VkIGluIHRoZSBJRi1NYXRjaCBoZWFkZXIsIGJ5IGRlZmF1bHQgXCIqXCJcclxuICAgICAgICAqL1xyXG4gICAgICAgIF90aGlzLmRlbGV0ZSA9IF90aGlzLl9kZWxldGVXaXRoRVRhZztcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICAgICAgLy8gLyoqXHJcbiAgICAgICAgLy8gKiBEZWxldGUgYSBzcGVjaWZpYyB2ZXJzaW9uIG9mIGEgZmlsZS5cclxuICAgICAgICAvLyAqXHJcbiAgICAgICAgLy8gKiBAcGFyYW0gZVRhZyBWYWx1ZSB1c2VkIGluIHRoZSBJRi1NYXRjaCBoZWFkZXIsIGJ5IGRlZmF1bHQgXCIqXCJcclxuICAgICAgICAvLyAqL1xyXG4gICAgICAgIC8vIHB1YmxpYyBkZWxldGUoZVRhZyA9IFwiKlwiKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHtcclxuICAgICAgICAvLyAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAvLyAgICAgICAgICAgICBcIklGLU1hdGNoXCI6IGVUYWcsXHJcbiAgICAgICAgLy8gICAgICAgICAgICAgXCJYLUhUVFAtTWV0aG9kXCI6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgLy8gICAgICAgICB9LFxyXG4gICAgICAgIC8vICAgICB9KTtcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gVmVyc2lvbjtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcclxudmFyIENoZWNraW5UeXBlO1xyXG4oZnVuY3Rpb24gKENoZWNraW5UeXBlKSB7XHJcbiAgICBDaGVja2luVHlwZVtDaGVja2luVHlwZVtcIk1pbm9yXCJdID0gMF0gPSBcIk1pbm9yXCI7XHJcbiAgICBDaGVja2luVHlwZVtDaGVja2luVHlwZVtcIk1ham9yXCJdID0gMV0gPSBcIk1ham9yXCI7XHJcbiAgICBDaGVja2luVHlwZVtDaGVja2luVHlwZVtcIk92ZXJ3cml0ZVwiXSA9IDJdID0gXCJPdmVyd3JpdGVcIjtcclxufSkoQ2hlY2tpblR5cGUgfHwgKENoZWNraW5UeXBlID0ge30pKTtcclxudmFyIFdlYlBhcnRzUGVyc29uYWxpemF0aW9uU2NvcGU7XHJcbihmdW5jdGlvbiAoV2ViUGFydHNQZXJzb25hbGl6YXRpb25TY29wZSkge1xyXG4gICAgV2ViUGFydHNQZXJzb25hbGl6YXRpb25TY29wZVtXZWJQYXJ0c1BlcnNvbmFsaXphdGlvblNjb3BlW1wiVXNlclwiXSA9IDBdID0gXCJVc2VyXCI7XHJcbiAgICBXZWJQYXJ0c1BlcnNvbmFsaXphdGlvblNjb3BlW1dlYlBhcnRzUGVyc29uYWxpemF0aW9uU2NvcGVbXCJTaGFyZWRcIl0gPSAxXSA9IFwiU2hhcmVkXCI7XHJcbn0pKFdlYlBhcnRzUGVyc29uYWxpemF0aW9uU2NvcGUgfHwgKFdlYlBhcnRzUGVyc29uYWxpemF0aW9uU2NvcGUgPSB7fSkpO1xyXG52YXIgTW92ZU9wZXJhdGlvbnM7XHJcbihmdW5jdGlvbiAoTW92ZU9wZXJhdGlvbnMpIHtcclxuICAgIE1vdmVPcGVyYXRpb25zW01vdmVPcGVyYXRpb25zW1wiT3ZlcndyaXRlXCJdID0gMV0gPSBcIk92ZXJ3cml0ZVwiO1xyXG4gICAgTW92ZU9wZXJhdGlvbnNbTW92ZU9wZXJhdGlvbnNbXCJBbGxvd0Jyb2tlblRoaWNrZXRzXCJdID0gOF0gPSBcIkFsbG93QnJva2VuVGhpY2tldHNcIjtcclxufSkoTW92ZU9wZXJhdGlvbnMgfHwgKE1vdmVPcGVyYXRpb25zID0ge30pKTtcclxudmFyIFRlbXBsYXRlRmlsZVR5cGU7XHJcbihmdW5jdGlvbiAoVGVtcGxhdGVGaWxlVHlwZSkge1xyXG4gICAgVGVtcGxhdGVGaWxlVHlwZVtUZW1wbGF0ZUZpbGVUeXBlW1wiU3RhbmRhcmRQYWdlXCJdID0gMF0gPSBcIlN0YW5kYXJkUGFnZVwiO1xyXG4gICAgVGVtcGxhdGVGaWxlVHlwZVtUZW1wbGF0ZUZpbGVUeXBlW1wiV2lraVBhZ2VcIl0gPSAxXSA9IFwiV2lraVBhZ2VcIjtcclxuICAgIFRlbXBsYXRlRmlsZVR5cGVbVGVtcGxhdGVGaWxlVHlwZVtcIkZvcm1QYWdlXCJdID0gMl0gPSBcIkZvcm1QYWdlXCI7XHJcbiAgICBUZW1wbGF0ZUZpbGVUeXBlW1RlbXBsYXRlRmlsZVR5cGVbXCJDbGllbnRTaWRlUGFnZVwiXSA9IDNdID0gXCJDbGllbnRTaWRlUGFnZVwiO1xyXG59KShUZW1wbGF0ZUZpbGVUeXBlIHx8IChUZW1wbGF0ZUZpbGVUeXBlID0ge30pKTtcblxuLyoqXHJcbiAqIFJlcHJlc2VudHMgYW4gYXBwIGNhdGFsb2dcclxuICovXHJcbnZhciBBcHBDYXRhbG9nID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEFwcENhdGFsb2csIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBBcHBDYXRhbG9nKGJhc2VVcmwsIHBhdGgpIHtcclxuICAgICAgICBpZiAocGF0aCA9PT0gdm9pZCAwKSB7IHBhdGggPSBcIl9hcGkvd2ViL3RlbmFudGFwcGNhdGFsb2cvQXZhaWxhYmxlQXBwc1wiOyB9XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIGV4dHJhY3RXZWJVcmwodHlwZW9mIGJhc2VVcmwgPT09IFwic3RyaW5nXCIgPyBiYXNlVXJsIDogYmFzZVVybC50b1VybCgpKSwgcGF0aCkgfHwgdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGRldGFpbHMgb2Ygc3BlY2lmaWMgYXBwIGZyb20gdGhlIGFwcCBjYXRhbG9nXHJcbiAgICAgKiBAcGFyYW0gaWQgLSBTcGVjaWZ5IHRoZSBndWlkIG9mIHRoZSBhcHBcclxuICAgICAqL1xyXG4gICAgQXBwQ2F0YWxvZy5wcm90b3R5cGUuZ2V0QXBwQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQXBwKHRoaXMsIFwiZ2V0QnlJZCgnXCIgKyBpZCArIFwiJylcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVcGxvYWRzIGFuIGFwcCBwYWNrYWdlLiBOb3Qgc3VwcG9ydGVkIGZvciBiYXRjaGluZ1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmaWxlbmFtZSBGaWxlbmFtZSB0byBjcmVhdGUuXHJcbiAgICAgKiBAcGFyYW0gY29udGVudCBhcHAgcGFja2FnZSBkYXRhIChlZzogdGhlIC5hcHAgb3IgLnNwcGtnIGZpbGUpLlxyXG4gICAgICogQHBhcmFtIHNob3VsZE92ZXJXcml0ZSBTaG91bGQgYW4gYXBwIHdpdGggdGhlIHNhbWUgbmFtZSBpbiB0aGUgc2FtZSBsb2NhdGlvbiBiZSBvdmVyd3JpdHRlbj8gKGRlZmF1bHQ6IHRydWUpXHJcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlPEFwcEFkZFJlc3VsdD5cclxuICAgICAqL1xyXG4gICAgQXBwQ2F0YWxvZy5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGZpbGVuYW1lLCBjb250ZW50LCBzaG91bGRPdmVyV3JpdGUpIHtcclxuICAgICAgICBpZiAoc2hvdWxkT3ZlcldyaXRlID09PSB2b2lkIDApIHsgc2hvdWxkT3ZlcldyaXRlID0gdHJ1ZTsgfVxyXG4gICAgICAgIC8vIHlvdSBkb24ndCBhZGQgdG8gdGhlIGF2YWlsYWJsZWFwcHMgY29sbGVjdGlvblxyXG4gICAgICAgIHZhciBhZGRlciA9IG5ldyBBcHBDYXRhbG9nKGV4dHJhY3RXZWJVcmwodGhpcy50b1VybCgpKSwgXCJfYXBpL3dlYi90ZW5hbnRhcHBjYXRhbG9nL2FkZChvdmVyd3JpdGU9XCIgKyBzaG91bGRPdmVyV3JpdGUgKyBcIix1cmw9J1wiICsgZmlsZW5hbWUgKyBcIicpXCIpO1xyXG4gICAgICAgIHJldHVybiBhZGRlci5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGNvbnRlbnQsXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogcixcclxuICAgICAgICAgICAgICAgIGZpbGU6IG5ldyBGaWxlKG9kYXRhVXJsRnJvbShyKSksXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEFwcENhdGFsb2c7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24pKTtcclxuLyoqXHJcbiAqIFJlcHJlc2VudHMgdGhlIGFjdGlvbnMgeW91IGNhbiBwcmVmb3JtIG9uIGEgZ2l2ZW4gYXBwIHdpdGhpbiB0aGUgY2F0YWxvZ1xyXG4gKi9cclxudmFyIEFwcCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhBcHAsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBBcHAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIG1ldGhvZCBkZXBsb3lzIGFuIGFwcCBvbiB0aGUgYXBwIGNhdGFsb2cuICBJdCBtdXN0IGJlIGNhbGxlZCBpbiB0aGUgY29udGV4dFxyXG4gICAgICogb2YgdGhlIHRlbmFudCBhcHAgY2F0YWxvZyB3ZWIgb3IgaXQgd2lsbCBmYWlsLlxyXG4gICAgICovXHJcbiAgICBBcHAucHJvdG90eXBlLmRlcGxveSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShBcHAsIFwiRGVwbG95XCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIG1ldGhvZCByZXRyYWN0cyBhIGRlcGxveWVkIGFwcCBvbiB0aGUgYXBwIGNhdGFsb2cuICBJdCBtdXN0IGJlIGNhbGxlZCBpbiB0aGUgY29udGV4dFxyXG4gICAgICogb2YgdGhlIHRlbmFudCBhcHAgY2F0YWxvZyB3ZWIgb3IgaXQgd2lsbCBmYWlsLlxyXG4gICAgICovXHJcbiAgICBBcHAucHJvdG90eXBlLnJldHJhY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoQXBwLCBcIlJldHJhY3RcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgbWV0aG9kIGFsbG93cyBhbiBhcHAgd2hpY2ggaXMgYWxyZWFkeSBkZXBsb3llZCB0byBiZSBpbnN0YWxsZWQgb24gYSB3ZWJcclxuICAgICAqL1xyXG4gICAgQXBwLnByb3RvdHlwZS5pbnN0YWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEFwcCwgXCJJbnN0YWxsXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIG1ldGhvZCBhbGxvd3MgYW4gYXBwIHdoaWNoIGlzIGFscmVhZHkgaW5zYXRsbGVkIHRvIGJlIHVuaW5zdGFsbGVkIG9uIGEgd2ViXHJcbiAgICAgKi9cclxuICAgIEFwcC5wcm90b3R5cGUudW5pbnN0YWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEFwcCwgXCJVbmluc3RhbGxcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgbWV0aG9kIGFsbG93cyBhbiBhcHAgd2hpY2ggaXMgYWxyZWFkeSBpbnNhdGxsZWQgdG8gYmUgdXBncmFkZWQgb24gYSB3ZWJcclxuICAgICAqL1xyXG4gICAgQXBwLnByb3RvdHlwZS51cGdyYWRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEFwcCwgXCJVcGdyYWRlXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIG1ldGhvZCByZW1vdmVzIGFuIGFwcCBmcm9tIHRoZSBhcHAgY2F0YWxvZy4gIEl0IG11c3QgYmUgY2FsbGVkIGluIHRoZSBjb250ZXh0XHJcbiAgICAgKiBvZiB0aGUgdGVuYW50IGFwcCBjYXRhbG9nIHdlYiBvciBpdCB3aWxsIGZhaWwuXHJcbiAgICAgKi9cclxuICAgIEFwcC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKEFwcCwgXCJSZW1vdmVcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQXBwO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xuXG4vKipcclxuICogTWFuYWdlcyBhIGJhdGNoIG9mIE9EYXRhIG9wZXJhdGlvbnNcclxuICovXHJcbnZhciBTUEJhdGNoID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNQQmF0Y2gsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTUEJhdGNoKGJhc2VVcmwpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmJhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUGFyc2VzIHRoZSByZXNwb25zZSBmcm9tIGEgYmF0Y2ggcmVxdWVzdCBpbnRvIGFuIGFycmF5IG9mIFJlc3BvbnNlIGluc3RhbmNlc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBib2R5IFRleHQgYm9keSBvZiB0aGUgcmVzcG9uc2UgZnJvbSB0aGUgYmF0Y2ggcmVxdWVzdFxyXG4gICAgICovXHJcbiAgICBTUEJhdGNoLlBhcnNlUmVzcG9uc2UgPSBmdW5jdGlvbiAoYm9keSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIHZhciByZXNwb25zZXMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGhlYWRlciA9IFwiLS1iYXRjaHJlc3BvbnNlX1wiO1xyXG4gICAgICAgICAgICAvLyBFeC4gXCJIVFRQLzEuMSA1MDAgSW50ZXJuYWwgU2VydmVyIEVycm9yXCJcclxuICAgICAgICAgICAgdmFyIHN0YXR1c1JlZ0V4cCA9IG5ldyBSZWdFeHAoXCJeSFRUUC9bMC05Ll0rICsoWzAtOV0rKSArKC4qKVwiLCBcImlcIik7XHJcbiAgICAgICAgICAgIHZhciBsaW5lcyA9IGJvZHkuc3BsaXQoXCJcXG5cIik7XHJcbiAgICAgICAgICAgIHZhciBzdGF0ZSA9IFwiYmF0Y2hcIjtcclxuICAgICAgICAgICAgdmFyIHN0YXR1cztcclxuICAgICAgICAgICAgdmFyIHN0YXR1c1RleHQ7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBsaW5lID0gbGluZXNbaV07XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJhdGNoXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsaW5lLnN1YnN0cigwLCBoZWFkZXIubGVuZ3RoKSA9PT0gaGVhZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFwiYmF0Y2hIZWFkZXJzXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZS50cmltKCkgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJlc3BvbnNlLCBsaW5lIFwiICsgaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJhdGNoSGVhZGVyc1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZS50cmltKCkgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gXCJzdGF0dXNcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwic3RhdHVzXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0cyA9IHN0YXR1c1JlZ0V4cC5leGVjKGxpbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoICE9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0YXR1cywgbGluZSBcIiArIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHBhcnNlSW50KHBhcnRzWzFdLCAxMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQgPSBwYXJ0c1syXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBcInN0YXR1c0hlYWRlcnNcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInN0YXR1c0hlYWRlcnNcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmUudHJpbSgpID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFwiYm9keVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJib2R5XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlcy5wdXNoKChzdGF0dXMgPT09IDIwNCkgPyBuZXcgUmVzcG9uc2UoKSA6IG5ldyBSZXNwb25zZShsaW5lLCB7IHN0YXR1czogc3RhdHVzLCBzdGF0dXNUZXh0OiBzdGF0dXNUZXh0IH0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBcImJhdGNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZSAhPT0gXCJzdGF0dXNcIikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgZW5kIG9mIGlucHV0XCIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgU1BCYXRjaC5wcm90b3R5cGUuZXhlY3V0ZUltcGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBMb2dnZXIud3JpdGUoXCJbXCIgKyB0aGlzLmJhdGNoSWQgKyBcIl0gKFwiICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIFwiKSBFeGVjdXRpbmcgYmF0Y2ggd2l0aCBcIiArIHRoaXMucmVxdWVzdHMubGVuZ3RoICsgXCIgcmVxdWVzdHMuXCIsIDEgLyogSW5mbyAqLyk7XHJcbiAgICAgICAgLy8gaWYgd2UgZG9uJ3QgaGF2ZSBhbnkgcmVxdWVzdHMsIGRvbid0IGJvdGhlciBzZW5kaW5nIGFueXRoaW5nXHJcbiAgICAgICAgLy8gdGhpcyBjb3VsZCBiZSBkdWUgdG8gY2FjaGluZyBmdXJ0aGVyIHVwc3RyZWFtLCBvciBqdXN0IGFuIGVtcHR5IGJhdGNoXHJcbiAgICAgICAgaWYgKHRoaXMucmVxdWVzdHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICBMb2dnZXIud3JpdGUoXCJSZXNvbHZpbmcgZW1wdHkgYmF0Y2guXCIsIDEgLyogSW5mbyAqLyk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gY3JlYXRpbmcgdGhlIGNsaWVudCBoZXJlIGFsbG93cyB0aGUgdXJsIHRvIGJlIHBvcHVsYXRlZCBmb3Igbm9kZWpzIGNsaWVudCBhcyB3ZWxsIGFzIHBvdGVudGlhbGx5XHJcbiAgICAgICAgLy8gYW55IG90aGVyIGhhY2tzIG5lZWRlZCBmb3Igb3RoZXIgdHlwZXMgb2YgY2xpZW50cy4gRXNzZW50aWFsbHkgYWxsb3dzIHRoZSBhYnNvbHV0ZVJlcXVlc3RVcmxcclxuICAgICAgICAvLyBiZWxvdyB0byBiZSBjb3JyZWN0XHJcbiAgICAgICAgdmFyIGNsaWVudCA9IG5ldyBTUEh0dHBDbGllbnQoKTtcclxuICAgICAgICAvLyBkdWUgdG8gdGltaW5nIHdlIG5lZWQgdG8gZ2V0IHRoZSBhYnNvbHV0ZSB1cmwgaGVyZSBzbyB3ZSBjYW4gdXNlIGl0IGZvciBhbGwgdGhlIGluZGl2aWR1YWwgcmVxdWVzdHNcclxuICAgICAgICAvLyBhbmQgZm9yIHNlbmRpbmcgdGhlIGVudGlyZSBiYXRjaFxyXG4gICAgICAgIHJldHVybiB0b0Fic29sdXRlVXJsKHRoaXMuYmFzZVVybCkudGhlbihmdW5jdGlvbiAoYWJzb2x1dGVSZXF1ZXN0VXJsKSB7XHJcbiAgICAgICAgICAgIC8vIGJ1aWxkIGFsbCB0aGUgcmVxdWVzdHMsIHNlbmQgdGhlbSwgcGlwZSByZXN1bHRzIGluIG9yZGVyIHRvIHBhcnNlcnNcclxuICAgICAgICAgICAgdmFyIGJhdGNoQm9keSA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudENoYW5nZVNldElkID0gXCJcIjtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpcy5yZXF1ZXN0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcUluZm8gPSBfdGhpcy5yZXF1ZXN0c1tpXTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXFJbmZvLm1ldGhvZCA9PT0gXCJHRVRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2hhbmdlU2V0SWQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlbmQgYW4gZXhpc3RpbmcgY2hhbmdlIHNldFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXRjaEJvZHkucHVzaChcIi0tY2hhbmdlc2V0X1wiICsgY3VycmVudENoYW5nZVNldElkICsgXCItLVxcblxcblwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYW5nZVNldElkID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hCb2R5LnB1c2goXCItLWJhdGNoX1wiICsgX3RoaXMuYmF0Y2hJZCArIFwiXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDaGFuZ2VTZXRJZC5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0IG5ldyBjaGFuZ2Ugc2V0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDaGFuZ2VTZXRJZCA9IGdldEdVSUQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmF0Y2hCb2R5LnB1c2goXCItLWJhdGNoX1wiICsgX3RoaXMuYmF0Y2hJZCArIFwiXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXRjaEJvZHkucHVzaChcIkNvbnRlbnQtVHlwZTogbXVsdGlwYXJ0L21peGVkOyBib3VuZGFyeT1cXFwiY2hhbmdlc2V0X1wiICsgY3VycmVudENoYW5nZVNldElkICsgXCJcXFwiXFxuXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBiYXRjaEJvZHkucHVzaChcIi0tY2hhbmdlc2V0X1wiICsgY3VycmVudENoYW5nZVNldElkICsgXCJcXG5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjb21tb24gYmF0Y2ggcGFydCBwcmVmaXhcclxuICAgICAgICAgICAgICAgIGJhdGNoQm9keS5wdXNoKFwiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9odHRwXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgYmF0Y2hCb2R5LnB1c2goXCJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiaW5hcnlcXG5cXG5cIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSB1cmwgb2YgdGhlIGluZGl2aWR1YWwgcmVxdWVzdCB3aXRoaW4gdGhlIGJhdGNoXHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gaXNVcmxBYnNvbHV0ZShyZXFJbmZvLnVybCkgPyByZXFJbmZvLnVybCA6IGNvbWJpbmUoYWJzb2x1dGVSZXF1ZXN0VXJsLCByZXFJbmZvLnVybCk7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIud3JpdGUoXCJbXCIgKyBfdGhpcy5iYXRjaElkICsgXCJdIChcIiArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyBcIikgQWRkaW5nIHJlcXVlc3QgXCIgKyByZXFJbmZvLm1ldGhvZCArIFwiIFwiICsgdXJsICsgXCIgdG8gYmF0Y2guXCIsIDAgLyogVmVyYm9zZSAqLyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVxSW5mby5tZXRob2QgIT09IFwiR0VUXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gcmVxSW5mby5tZXRob2Q7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhc3RIZWFkZXJzID0gcmVxSW5mby5vcHRpb25zLmhlYWRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhPUChyZXFJbmZvLCBcIm9wdGlvbnNcIikgJiYgaE9QKHJlcUluZm8ub3B0aW9ucywgXCJoZWFkZXJzXCIpICYmIGNhc3RIZWFkZXJzW1wiWC1IVFRQLU1ldGhvZFwiXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGNhc3RIZWFkZXJzW1wiWC1IVFRQLU1ldGhvZFwiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNhc3RIZWFkZXJzW1wiWC1IVFRQLU1ldGhvZFwiXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hCb2R5LnB1c2gobWV0aG9kICsgXCIgXCIgKyB1cmwgKyBcIiBIVFRQLzEuMVxcblwiKTtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLnNldChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb247b2RhdGE9dmVyYm9zZTtjaGFyc2V0PXV0Zi04XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hCb2R5LnB1c2gocmVxSW5mby5tZXRob2QgKyBcIiBcIiArIHVybCArIFwiIEhUVFAvMS4xXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gbWVyZ2UgZ2xvYmFsIGNvbmZpZyBoZWFkZXJzXHJcbiAgICAgICAgICAgICAgICBtZXJnZUhlYWRlcnMoaGVhZGVycywgU1BSdW50aW1lQ29uZmlnLmhlYWRlcnMpO1xyXG4gICAgICAgICAgICAgICAgLy8gbWVyZ2UgcGVyLXJlcXVlc3QgaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcUluZm8ub3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lcmdlSGVhZGVycyhoZWFkZXJzLCByZXFJbmZvLm9wdGlvbnMuaGVhZGVycyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBsYXN0bHkgd2UgYXBwbHkgYW55IGRlZmF1bHQgaGVhZGVycyB3ZSBuZWVkIHRoYXQgbWF5IG5vdCBleGlzdFxyXG4gICAgICAgICAgICAgICAgaWYgKCFoZWFkZXJzLmhhcyhcIkFjY2VwdFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQWNjZXB0XCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghaGVhZGVycy5oYXMoXCJDb250ZW50LVR5cGVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb247b2RhdGE9dmVyYm9zZTtjaGFyc2V0PXV0Zi04XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFoZWFkZXJzLmhhcyhcIlgtQ2xpZW50U2VydmljZS1DbGllbnRUYWdcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChcIlgtQ2xpZW50U2VydmljZS1DbGllbnRUYWdcIiwgXCJQblBDb3JlSlM6QHBucC0xLjIuMVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHdyaXRlIGhlYWRlcnMgaW50byBiYXRjaCBib2R5XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hCb2R5LnB1c2gobmFtZSArIFwiOiBcIiArIHZhbHVlICsgXCJcXG5cIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJhdGNoQm9keS5wdXNoKFwiXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcUluZm8ub3B0aW9ucy5ib2R5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hCb2R5LnB1c2gocmVxSW5mby5vcHRpb25zLmJvZHkgKyBcIlxcblxcblwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY3VycmVudENoYW5nZVNldElkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIENsb3NlIHRoZSBjaGFuZ2VzZXRcclxuICAgICAgICAgICAgICAgIGJhdGNoQm9keS5wdXNoKFwiLS1jaGFuZ2VzZXRfXCIgKyBjdXJyZW50Q2hhbmdlU2V0SWQgKyBcIi0tXFxuXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENoYW5nZVNldElkID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXRjaEJvZHkucHVzaChcIi0tYmF0Y2hfXCIgKyBfdGhpcy5iYXRjaElkICsgXCItLVxcblwiKTtcclxuICAgICAgICAgICAgdmFyIGJhdGNoT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIFwiYm9keVwiOiBiYXRjaEJvZHkuam9pbihcIlwiKSxcclxuICAgICAgICAgICAgICAgIFwiaGVhZGVyc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PWJhdGNoX1wiICsgX3RoaXMuYmF0Y2hJZCxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcIm1ldGhvZFwiOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgTG9nZ2VyLndyaXRlKFwiW1wiICsgX3RoaXMuYmF0Y2hJZCArIFwiXSAoXCIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgXCIpIFNlbmRpbmcgYmF0Y2ggcmVxdWVzdC5cIiwgMSAvKiBJbmZvICovKTtcclxuICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5mZXRjaChjb21iaW5lKGFic29sdXRlUmVxdWVzdFVybCwgXCIvX2FwaS8kYmF0Y2hcIiksIGJhdGNoT3B0aW9ucylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyKSB7IHJldHVybiByLnRleHQoKTsgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKFNQQmF0Y2guUGFyc2VSZXNwb25zZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZXMubGVuZ3RoICE9PSBfdGhpcy5yZXF1ZXN0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgcHJvcGVybHkgcGFyc2UgcmVzcG9uc2VzIHRvIG1hdGNoIHJlcXVlc3RzIGluIGJhdGNoLlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIExvZ2dlci53cml0ZShcIltcIiArIF90aGlzLmJhdGNoSWQgKyBcIl0gKFwiICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIFwiKSBSZXNvbHZpbmcgYmF0Y2hlZCByZXF1ZXN0cy5cIiwgMSAvKiBJbmZvICovKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZXMucmVkdWNlKGZ1bmN0aW9uIChjaGFpbiwgcmVzcG9uc2UsIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBfdGhpcy5yZXF1ZXN0c1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nZ2VyLndyaXRlKFwiW1wiICsgcmVxdWVzdC5pZCArIFwiXSAoXCIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgXCIpIFJlc29sdmluZyByZXF1ZXN0IGluIGJhdGNoIFwiICsgX3RoaXMuYmF0Y2hJZCArIFwiLlwiLCAxIC8qIEluZm8gKi8pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGFpbi50aGVuKGZ1bmN0aW9uIChfKSB7IHJldHVybiByZXF1ZXN0LnBhcnNlci5wYXJzZShyZXNwb25zZSkudGhlbihyZXF1ZXN0LnJlc29sdmUpLmNhdGNoKHJlcXVlc3QucmVqZWN0KTsgfSk7XHJcbiAgICAgICAgICAgICAgICB9LCBQcm9taXNlLnJlc29sdmUoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTUEJhdGNoO1xyXG59KE9EYXRhQmF0Y2gpKTtcblxuLyoqXHJcbiAqIFBhZ2UgcHJvbW90aW9uIHN0YXRlXHJcbiAqL1xyXG52YXIgUHJvbW90ZWRTdGF0ZTtcclxuKGZ1bmN0aW9uIChQcm9tb3RlZFN0YXRlKSB7XHJcbiAgICAvKipcclxuICAgICAqIFJlZ3VsYXIgY2xpZW50IHNpZGUgcGFnZVxyXG4gICAgICovXHJcbiAgICBQcm9tb3RlZFN0YXRlW1Byb21vdGVkU3RhdGVbXCJOb3RQcm9tb3RlZFwiXSA9IDBdID0gXCJOb3RQcm9tb3RlZFwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBQYWdlIHRoYXQgd2lsbCBiZSBwcm9tb3RlZCBhcyBuZXdzIGFydGljbGUgYWZ0ZXIgcHVibGlzaGluZ1xyXG4gICAgICovXHJcbiAgICBQcm9tb3RlZFN0YXRlW1Byb21vdGVkU3RhdGVbXCJQcm9tb3RlT25QdWJsaXNoXCJdID0gMV0gPSBcIlByb21vdGVPblB1Ymxpc2hcIjtcclxuICAgIC8qKlxyXG4gICAgICogUGFnZSB0aGF0IGlzIHByb21vdGVkIGFzIG5ld3MgYXJ0aWNsZVxyXG4gICAgICovXHJcbiAgICBQcm9tb3RlZFN0YXRlW1Byb21vdGVkU3RhdGVbXCJQcm9tb3RlZFwiXSA9IDJdID0gXCJQcm9tb3RlZFwiO1xyXG59KShQcm9tb3RlZFN0YXRlIHx8IChQcm9tb3RlZFN0YXRlID0ge30pKTtcclxuLyoqXHJcbiAqIEdldHMgdGhlIG5leHQgb3JkZXIgdmFsdWUgMSBiYXNlZCBmb3IgdGhlIHByb3ZpZGVkIGNvbGxlY3Rpb25cclxuICpcclxuICogQHBhcmFtIGNvbGxlY3Rpb24gQ29sbGVjdGlvbiBvZiBvcmRlcmFibGUgdGhpbmdzXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXROZXh0T3JkZXIoY29sbGVjdGlvbikge1xyXG4gICAgaWYgKGNvbGxlY3Rpb24ubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KG51bGwsIGNvbGxlY3Rpb24ubWFwKGZ1bmN0aW9uIChpKSB7IHJldHVybiBpLm9yZGVyOyB9KSkgKyAxO1xyXG59XHJcbi8qKlxyXG4gKiBBZnRlciBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yNzM3ODkvaXMtdGhlcmUtYS12ZXJzaW9uLW9mLWphdmFzY3JpcHRzLXN0cmluZy1pbmRleG9mLXRoYXQtYWxsb3dzLWZvci1yZWd1bGFyLWV4cHIvMjc0MDk0IzI3NDA5NFxyXG4gKlxyXG4gKiBAcGFyYW0gdGhpcyBUeXBlcyB0aGUgY2FsbGVkIGNvbnRleHQgdGhpcyB0byBhIHN0cmluZyBpbiB3aGljaCB0aGUgc2VhcmNoIHdpbGwgYmUgY29uZHVjdGVkXHJcbiAqIEBwYXJhbSByZWdleCBBIHJlZ2V4IG9yIHN0cmluZyB0byBtYXRjaFxyXG4gKiBAcGFyYW0gc3RhcnRwb3MgQSBzdGFydGluZyBwb3NpdGlvbiBmcm9tIHdoaWNoIHRoZSBzZWFyY2ggd2lsbCBiZWdpblxyXG4gKi9cclxuZnVuY3Rpb24gcmVnZXhJbmRleE9mKHJlZ2V4LCBzdGFydHBvcykge1xyXG4gICAgaWYgKHN0YXJ0cG9zID09PSB2b2lkIDApIHsgc3RhcnRwb3MgPSAwOyB9XHJcbiAgICB2YXIgaW5kZXhPZiA9IHRoaXMuc3Vic3RyaW5nKHN0YXJ0cG9zKS5zZWFyY2gocmVnZXgpO1xyXG4gICAgcmV0dXJuIChpbmRleE9mID49IDApID8gKGluZGV4T2YgKyAoc3RhcnRwb3MpKSA6IGluZGV4T2Y7XHJcbn1cclxuLyoqXHJcbiAqIEZpbmRzIGJvdW5kZWQgYmxvY2tzIG9mIG1hcmt1cCBib3VuZGVkIGJ5IGRpdnMsIGVuc3VyaW5nIHRvIG1hdGNoIHRoZSBlbmRpbmcgZGl2IGV2ZW4gd2l0aCBuZXN0ZWQgZGl2cyBpbiB0aGUgaW50ZXJzdGl0aWFsIG1hcmt1cFxyXG4gKlxyXG4gKiBAcGFyYW0gaHRtbCBIVE1MIHRvIHNlYXJjaFxyXG4gKiBAcGFyYW0gYm91bmRhcnlTdGFydFBhdHRlcm4gVGhlIHN0YXJ0aW5nIHBhdHRlcm4gdG8gZmluZCwgdHlwaWNhbGx5IGEgZGl2IHdpdGggYXR0cmlidXRlXHJcbiAqIEBwYXJhbSBjb2xsZWN0b3IgQSBmdW5jIHRvIHRha2UgdGhlIGZvdW5kIGJsb2NrIGFuZCBwcm92aWRlIGEgd2F5IHRvIGZvcm0gaXQgaW50byBhIHVzZWZ1bCByZXR1cm4gdGhhdCBpcyBhZGRlZCBpbnRvIHRoZSByZXR1cm4gYXJyYXlcclxuICovXHJcbmZ1bmN0aW9uIGdldEJvdW5kZWREaXZNYXJrdXAoaHRtbCwgYm91bmRhcnlTdGFydFBhdHRlcm4sIGNvbGxlY3Rvcikge1xyXG4gICAgdmFyIGJsb2NrcyA9IFtdO1xyXG4gICAgaWYgKGh0bWwgPT09IHVuZGVmaW5lZCB8fCBodG1sID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIGJsb2NrcztcclxuICAgIH1cclxuICAgIC8vIHJlbW92ZSBzb21lIGV4dHJhIHdoaXRlc3BhY2UgaWYgcHJlc2VudFxyXG4gICAgdmFyIGNsZWFuZWRIdG1sID0gaHRtbC5yZXBsYWNlKC9bXFx0XFxyXFxuXS9nLCBcIlwiKTtcclxuICAgIC8vIGZpbmQgdGhlIGZpcnN0IGRpdlxyXG4gICAgdmFyIHN0YXJ0SW5kZXggPSByZWdleEluZGV4T2YuY2FsbChjbGVhbmVkSHRtbCwgYm91bmRhcnlTdGFydFBhdHRlcm4pO1xyXG4gICAgaWYgKHN0YXJ0SW5kZXggPCAwKSB7XHJcbiAgICAgICAgLy8gd2UgZm91bmQgbm8gYmxvY2tzIGluIHRoZSBzdXBwbGllZCBodG1sXHJcbiAgICAgICAgcmV0dXJuIGJsb2NrcztcclxuICAgIH1cclxuICAgIC8vIHRoaXMgbG9vcCBmaW5kcyBlYWNoIG9mIHRoZSBibG9ja3NcclxuICAgIHdoaWxlIChzdGFydEluZGV4ID4gLTEpIHtcclxuICAgICAgICAvLyB3ZSBoYXZlIG9uZSBvcGVuIGRpdiBjb3VudGluZyBmcm9tIHRoZSBvbmUgZm91bmQgYWJvdmUgdXNpbmcgYm91bmRhcnlTdGFydFBhdHRlcm4gc28gd2UgbmVlZCB0byBlbnN1cmUgd2UgZmluZCBpdCdzIGNsb3NlXHJcbiAgICAgICAgdmFyIG9wZW5Db3VudGVyID0gMTtcclxuICAgICAgICB2YXIgc2VhcmNoSW5kZXggPSBzdGFydEluZGV4ICsgMTtcclxuICAgICAgICB2YXIgbmV4dERpdk9wZW4gPSAtMTtcclxuICAgICAgICB2YXIgbmV4dENsb3NlRGl2ID0gLTE7XHJcbiAgICAgICAgLy8gdGhpcyBsb29wIGZpbmRzIHRoZSA8L2Rpdj4gdGFnIHRoYXQgbWF0Y2hlcyB0aGUgb3BlbmluZyBvZiB0aGUgY29udHJvbFxyXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgICAgIC8vIGZpbmQgYm90aCB0aGUgbmV4dCBvcGVuaW5nIGFuZCBjbG9zaW5nIGRpdiB0YWdzIGZyb20gb3VyIGN1cnJlbnQgc2VhcmNoaW5nIGluZGV4XHJcbiAgICAgICAgICAgIG5leHREaXZPcGVuID0gcmVnZXhJbmRleE9mLmNhbGwoY2xlYW5lZEh0bWwsIC88ZGl2W14+XSo+L2ksIHNlYXJjaEluZGV4KTtcclxuICAgICAgICAgICAgbmV4dENsb3NlRGl2ID0gcmVnZXhJbmRleE9mLmNhbGwoY2xlYW5lZEh0bWwsIC88XFwvZGl2Pi9pLCBzZWFyY2hJbmRleCk7XHJcbiAgICAgICAgICAgIGlmIChuZXh0RGl2T3BlbiA8IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgbm8gbW9yZSBvcGVuaW5nIGRpdnMsIGp1c3Qgc2V0IHRoaXMgdG8gc2ltcGxpZnkgY2hlY2tzIGJlbG93XHJcbiAgICAgICAgICAgICAgICBuZXh0RGl2T3BlbiA9IGNsZWFuZWRIdG1sLmxlbmd0aCArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHdoaWNoIHdlIGZvdW5kIGZpcnN0LCB0aGVuIGluY3JlbWVudCBvciBkZWNyZW1lbnQgb3VyIGNvdW50ZXJcclxuICAgICAgICAgICAgLy8gYW5kIHNldCB0aGUgbG9jYXRpb24gdG8gYmVnaW4gc2VhcmNoaW5nIGFnYWluXHJcbiAgICAgICAgICAgIGlmIChuZXh0RGl2T3BlbiA8IG5leHRDbG9zZURpdikge1xyXG4gICAgICAgICAgICAgICAgb3BlbkNvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgIHNlYXJjaEluZGV4ID0gbmV4dERpdk9wZW4gKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG5leHRDbG9zZURpdiA8IG5leHREaXZPcGVuKSB7XHJcbiAgICAgICAgICAgICAgICBvcGVuQ291bnRlci0tO1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoSW5kZXggPSBuZXh0Q2xvc2VEaXYgKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIG9uY2Ugd2UgaGF2ZSBubyBvcGVuIGRpdnMgYmFjayB0byB0aGUgbGV2ZWwgb2YgdGhlIG9wZW5pbmcgY29udHJvbCBkaXZcclxuICAgICAgICAgICAgLy8gbWVhbmluZyB3ZSBoYXZlIGFsbCBvZiB0aGUgbWFya3VwIHdlIGludGVuZGVkIHRvIGZpbmRcclxuICAgICAgICAgICAgaWYgKG9wZW5Db3VudGVyID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIGJvdW5kZWQgbWFya3VwLCArNiBpcyB0aGUgc2l6ZSBvZiB0aGUgZW5kaW5nIDwvZGl2PiB0YWdcclxuICAgICAgICAgICAgICAgIHZhciBtYXJrdXAgPSBjbGVhbmVkSHRtbC5zdWJzdHJpbmcoc3RhcnRJbmRleCwgbmV4dENsb3NlRGl2ICsgNikudHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0aGUgY29udHJvbCBkYXRhIHdlIGZvdW5kIHRvIHRoZSBhcnJheVxyXG4gICAgICAgICAgICAgICAgYmxvY2tzLnB1c2goY29sbGVjdG9yKG1hcmt1cCkpO1xyXG4gICAgICAgICAgICAgICAgLy8gZ2V0IG91dCBvZiBvdXIgd2hpbGUgbG9vcFxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG9wZW5Db3VudGVyID4gMTAwMCB8fCBvcGVuQ291bnRlciA8IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYW4gYXJiaXRyYXJ5IGN1dC1vZmYgYnV0IGxpa2VseSB3ZSB3aWxsIG5vdCBoYXZlIDEwMDAgbmVzdGVkIGRpdnNcclxuICAgICAgICAgICAgICAgIC8vIHNvbWV0aGluZyBoYXMgZ29uZSB3cm9uZyBhYm92ZSBhbmQgd2UgYXJlIHByb2JhYmx5IHN0dWNrIGluIG91ciB3aGlsZSBsb29wXHJcbiAgICAgICAgICAgICAgICAvLyBsZXQncyBnZXQgb3V0IG9mIG91ciB3aGlsZSBsb29wIGFuZCBub3QgaGFuZyBldmVyeXRoaW5nXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJnZXRCb3VuZGVkRGl2TWFya3VwIGV4Y2VlZGVkIGRlcHRoIHBhcmFtZXRlcnMuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGdldCB0aGUgc3RhcnQgb2YgdGhlIG5leHQgY29udHJvbFxyXG4gICAgICAgIHN0YXJ0SW5kZXggPSByZWdleEluZGV4T2YuY2FsbChjbGVhbmVkSHRtbCwgYm91bmRhcnlTdGFydFBhdHRlcm4sIG5leHRDbG9zZURpdik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYmxvY2tzO1xyXG59XHJcbi8qKlxyXG4gKiBOb3JtYWxpemVzIHRoZSBvcmRlciB2YWx1ZSBmb3IgYWxsIHRoZSBzZWN0aW9ucywgY29sdW1ucywgYW5kIGNvbnRyb2xzIHRvIGJlIDEgYmFzZWQgYW5kIHN0ZXBwZWQgKDEsIDIsIDMuLi4pXHJcbiAqXHJcbiAqIEBwYXJhbSBjb2xsZWN0aW9uIFRoZSBjb2xsZWN0aW9uIHRvIG5vcm1hbGl6ZVxyXG4gKi9cclxuZnVuY3Rpb24gcmVpbmRleChjb2xsZWN0aW9uKSB7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbGxlY3Rpb24ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb2xsZWN0aW9uW2ldLm9yZGVyID0gaSArIDE7XHJcbiAgICAgICAgaWYgKGhPUChjb2xsZWN0aW9uW2ldLCBcImNvbHVtbnNcIikpIHtcclxuICAgICAgICAgICAgcmVpbmRleChjb2xsZWN0aW9uW2ldLmNvbHVtbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChoT1AoY29sbGVjdGlvbltpXSwgXCJjb250cm9sc1wiKSkge1xyXG4gICAgICAgICAgICByZWluZGV4KGNvbGxlY3Rpb25baV0uY29udHJvbHMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vKipcclxuICogUmVwcmVzZW50cyB0aGUgZGF0YSBhbmQgbWV0aG9kcyBhc3NvY2lhdGVkIHdpdGggY2xpZW50IHNpZGUgXCJtb2Rlcm5cIiBwYWdlc1xyXG4gKi9cclxudmFyIENsaWVudFNpZGVQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENsaWVudFNpZGVQYWdlLCBfc3VwZXIpO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBDbGllbnRTaWRlUGFnZSBjbGFzc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBiYXNlVXJsIFRoZSB1cmwgb3IgU2hhcmVQb2ludFF1ZXJ5YWJsZSB3aGljaCBmb3JtcyB0aGUgcGFyZW50IG9mIHRoaXMgd2ViIGNvbGxlY3Rpb25cclxuICAgICAqIEBwYXJhbSBjb21tZW50c0Rpc2FibGVkIEluZGljYXRlcyBpZiBjb21tZW50cyBhcmUgZGlzYWJsZWQsIG5vdCB2YWxpZCB1bnRpbCBsb2FkIGlzIGNhbGxlZFxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBDbGllbnRTaWRlUGFnZShmaWxlLCBzZWN0aW9ucywgY29tbWVudHNEaXNhYmxlZCkge1xyXG4gICAgICAgIGlmIChzZWN0aW9ucyA9PT0gdm9pZCAwKSB7IHNlY3Rpb25zID0gW107IH1cclxuICAgICAgICBpZiAoY29tbWVudHNEaXNhYmxlZCA9PT0gdm9pZCAwKSB7IGNvbW1lbnRzRGlzYWJsZWQgPSBmYWxzZTsgfVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGZpbGUpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuc2VjdGlvbnMgPSBzZWN0aW9ucztcclxuICAgICAgICBfdGhpcy5jb21tZW50c0Rpc2FibGVkID0gY29tbWVudHNEaXNhYmxlZDtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgYmxhbmsgcGFnZSB3aXRoaW4gdGhlIHN1cHBsaWVkIGxpYnJhcnlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbGlicmFyeSBUaGUgbGlicmFyeSBpbiB3aGljaCB0byBjcmVhdGUgdGhlIHBhZ2VcclxuICAgICAqIEBwYXJhbSBwYWdlTmFtZSBGaWxlbmFtZSBvZiB0aGUgcGFnZSwgc3VjaCBhcyBcInBhZ2UuYXNweFwiXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgVGhlIGRpc3BsYXkgdGl0bGUgb2YgdGhlIHBhZ2VcclxuICAgICAqIEBwYXJhbSBwYWdlTGF5b3V0VHlwZSBMYXlvdXQgdHlwZSBvZiB0aGUgcGFnZSB0byB1c2VcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UuY3JlYXRlID0gZnVuY3Rpb24gKGxpYnJhcnksIHBhZ2VOYW1lLCB0aXRsZSwgcGFnZUxheW91dFR5cGUpIHtcclxuICAgICAgICBpZiAocGFnZUxheW91dFR5cGUgPT09IHZvaWQgMCkgeyBwYWdlTGF5b3V0VHlwZSA9IFwiQXJ0aWNsZVwiOyB9XHJcbiAgICAgICAgLy8gc2VlIGlmIGZpbGUgZXhpc3RzLCBpZiBub3QgY3JlYXRlIGl0XHJcbiAgICAgICAgcmV0dXJuIGxpYnJhcnkucm9vdEZvbGRlci5maWxlcy5zZWxlY3QoXCJOYW1lXCIpLmZpbHRlcihcIk5hbWUgZXEgJ1wiICsgcGFnZU5hbWUgKyBcIidcIikuZ2V0KCkudGhlbihmdW5jdGlvbiAoZnMpIHtcclxuICAgICAgICAgICAgaWYgKGZzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkEgZmlsZSB3aXRoIHRoZSBuYW1lICdcIiArIHBhZ2VOYW1lICsgXCInIGFscmVhZHkgZXhpc3RzIGluIHRoZSBsaWJyYXJ5ICdcIiArIGxpYnJhcnkudG9VcmwoKSArIFwiJy5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gZ2V0IG91ciBzZXJ2ZXIgcmVsYXRpdmUgcGF0aFxyXG4gICAgICAgICAgICByZXR1cm4gbGlicmFyeS5yb290Rm9sZGVyLnNlbGVjdChcIlNlcnZlclJlbGF0aXZlUGF0aFwiKS5nZXQoKS50aGVuKGZ1bmN0aW9uIChwYXRoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFnZVNlcnZlclJlbFBhdGggPSBjb21iaW5lKFwiL1wiLCBwYXRoLlNlcnZlclJlbGF0aXZlUGF0aC5EZWNvZGVkVXJsLCBwYWdlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBhZGQgdGhlIHRlbXBsYXRlIGZpbGVcclxuICAgICAgICAgICAgICAgIHJldHVybiBsaWJyYXJ5LnJvb3RGb2xkZXIuZmlsZXMuYWRkVGVtcGxhdGVGaWxlKHBhZ2VTZXJ2ZXJSZWxQYXRoLCBUZW1wbGF0ZUZpbGVUeXBlLkNsaWVudFNpZGVQYWdlKS50aGVuKGZ1bmN0aW9uIChmYXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIGl0ZW0gYXNzb2NpYXRlZCB3aXRoIHRoZSBmaWxlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhci5maWxlLmdldEl0ZW0oKS50aGVuKGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgaXRlbSB0byBoYXZlIHRoZSBjb3JyZWN0IHZhbHVlcyB0byBjcmVhdGUgdGhlIGNsaWVudCBzaWRlIHBhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkudXBkYXRlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhbm5lckltYWdlVXJsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXJsOiBcIi9fbGF5b3V0cy8xNS9pbWFnZXMvc2l0ZXBhZ2V0aHVtYm5haWwucG5nXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FudmFzQ29udGVudDE6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDbGllbnRTaWRlQXBwbGljYXRpb25JZDogXCJiNjkxN2NiMS05M2EwLTRiOTctYTg0ZC03Y2Y0OTk3NWQ0ZWNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlSWQ6IFwiMHgwMTAxMDA5RDFDQjI1NURBNzY0MjRGODYwRDkxRjIwRTZDNDExOFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFnZUxheW91dFR5cGU6IHBhZ2VMYXlvdXRUeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbW90ZWRTdGF0ZTogMCAvKiBOb3RQcm9tb3RlZCAqLyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpdGxlOiB0aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoaWFyKSB7IHJldHVybiBuZXcgQ2xpZW50U2lkZVBhZ2UoaWFyLml0ZW0uZmlsZSwgaWFyLml0ZW0uQ29tbWVudHNEaXNhYmxlZCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBDbGllbnRTaWRlUGFnZSBpbnN0YW5jZSBmcm9tIHRoZSBwcm92aWRlZCBodG1sIGNvbnRlbnQgc3RyaW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGh0bWwgSFRNTCBtYXJrdXAgcmVwcmVzZW50aW5nIHRoZSBwYWdlXHJcbiAgICAgKi9cclxuICAgIENsaWVudFNpZGVQYWdlLmZyb21GaWxlID0gZnVuY3Rpb24gKGZpbGUpIHtcclxuICAgICAgICB2YXIgcGFnZSA9IG5ldyBDbGllbnRTaWRlUGFnZShmaWxlKTtcclxuICAgICAgICByZXR1cm4gcGFnZS5sb2FkKCkudGhlbihmdW5jdGlvbiAoXykgeyByZXR1cm4gcGFnZTsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDb252ZXJ0cyBhIGpzb24gb2JqZWN0IHRvIGFuIGVzY2FwZWQgc3RyaW5nIGFwcHJvcHJpYXRlIGZvciB1c2UgaW4gYXR0cmlidXRlcyB3aGVuIHN0b3JpbmcgY2xpZW50LXNpZGUgY29udHJvbHNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ganNvbiBUaGUganNvbiBvYmplY3QgdG8gZW5jb2RlIGludG8gYSBzdHJpbmdcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UuanNvblRvRXNjYXBlZFN0cmluZyA9IGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgcmV0dXJuIGpzUyhqc29uKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXCIvZywgXCImcXVvdDtcIilcclxuICAgICAgICAgICAgLnJlcGxhY2UoLzovZywgXCImIzU4O1wiKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvey9nLCBcIiYjMTIzO1wiKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvfS9nLCBcIiYjMTI1O1wiKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvXFxbL2csIFwiXFxbXCIpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXF0vZywgXCJcXF1cIilcclxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcLi9nLCBcIlxcLlwiKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENvbnZlcnRzIGFuIGVzY2FwZWQgc3RyaW5nIGZyb20gYSBjbGllbnQtc2lkZSBjb250cm9sIGF0dHJpYnV0ZSB0byBhIGpzb24gb2JqZWN0XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGVzY2FwZWRTdHJpbmdcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UuZXNjYXBlZFN0cmluZ1RvSnNvbiA9IGZ1bmN0aW9uIChlc2NhcGVkU3RyaW5nKSB7XHJcbiAgICAgICAgdmFyIHVuZXNwYWNlID0gZnVuY3Rpb24gKGVzY2FwZWQpIHtcclxuICAgICAgICAgICAgdmFyIG1hcERpY3QgPSBbXHJcbiAgICAgICAgICAgICAgICBbLyZxdW90Oy9nLCBcIlxcXCJcIl0sIFsvJiM1ODsvZywgXCI6XCJdLCBbLyYjMTIzOy9nLCBcIntcIl0sIFsvJiMxMjU7L2csIFwifVwiXSxcclxuICAgICAgICAgICAgICAgIFsvXFxcXFxcXFwvZywgXCJcXFxcXCJdLCBbL1xcXFxcXD8vZywgXCI/XCJdLCBbL1xcXFxcXC4vZywgXCIuXCJdLCBbL1xcXFxcXFsvZywgXCJbXCJdLCBbL1xcXFxcXF0vZywgXCJdXCJdLFxyXG4gICAgICAgICAgICAgICAgWy9cXFxcXFwoL2csIFwiKFwiXSwgWy9cXFxcXFwpL2csIFwiKVwiXSwgWy9cXFxcXFx8L2csIFwifFwiXSwgWy9cXFxcXFwrL2csIFwiK1wiXSxcclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgcmV0dXJuIG1hcERpY3QucmVkdWNlKGZ1bmN0aW9uIChyLCBtKSB7IHJldHVybiByLnJlcGxhY2UobVswXSwgbVsxXSk7IH0sIGVzY2FwZWQpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodW5lc3BhY2UoZXNjYXBlZFN0cmluZykpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkIGEgc2VjdGlvbiB0byB0aGlzIHBhZ2VcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UucHJvdG90eXBlLmFkZFNlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlY3Rpb24gPSBuZXcgQ2FudmFzU2VjdGlvbih0aGlzLCBnZXROZXh0T3JkZXIodGhpcy5zZWN0aW9ucykpO1xyXG4gICAgICAgIHRoaXMuc2VjdGlvbnMucHVzaChzZWN0aW9uKTtcclxuICAgICAgICByZXR1cm4gc2VjdGlvbjtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENvbnZlcnRzIHRoaXMgcGFnZSdzIGNvbnRlbnQgdG8gaHRtbCBtYXJrdXBcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UucHJvdG90eXBlLnRvSHRtbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyB0cmlnZ2VyIHJlaW5kZXggb2YgdGhlIGVudGlyZSB0cmVlXHJcbiAgICAgICAgcmVpbmRleCh0aGlzLnNlY3Rpb25zKTtcclxuICAgICAgICB2YXIgaHRtbCA9IFtdO1xyXG4gICAgICAgIGh0bWwucHVzaChcIjxkaXY+XCIpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBodG1sLnB1c2godGhpcy5zZWN0aW9uc1tpXS50b0h0bWwoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGh0bWwucHVzaChcIjwvZGl2PlwiKTtcclxuICAgICAgICByZXR1cm4gaHRtbC5qb2luKFwiXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogTG9hZHMgdGhpcyBwYWdlIGluc3RhbmNlJ3MgY29udGVudCBmcm9tIHRoZSBzdXBwbGllZCBodG1sXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGh0bWwgaHRtbCBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBwYWdlJ3MgY29udGVudFxyXG4gICAgICovXHJcbiAgICBDbGllbnRTaWRlUGFnZS5wcm90b3R5cGUuZnJvbUh0bWwgPSBmdW5jdGlvbiAoaHRtbCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgLy8gcmVzZXQgc2VjdGlvbnNcclxuICAgICAgICB0aGlzLnNlY3Rpb25zID0gW107XHJcbiAgICAgICAgLy8gZ2F0aGVyIG91ciBjb250cm9scyBmcm9tIHRoZSBzdXBwbGllZCBodG1sXHJcbiAgICAgICAgZ2V0Qm91bmRlZERpdk1hcmt1cChodG1sLCAvPGRpdlxcYltePl0qZGF0YS1zcC1jYW52YXNjb250cm9sW14+XSo/Pi9pLCBmdW5jdGlvbiAobWFya3VwKSB7XHJcbiAgICAgICAgICAgIC8vIGdldCB0aGUgY29udHJvbCB0eXBlXHJcbiAgICAgICAgICAgIHZhciBjdCA9IC9jb250cm9sVHlwZSZxdW90OyYjNTg7KFxcZCo/KSwvaS5leGVjKG1hcmt1cCk7XHJcbiAgICAgICAgICAgIC8vIGlmIG5vIGNvbnRyb2wgdHlwZSBpcyBwcmVzZW50IHRoaXMgaXMgYSBjb2x1bW4gd2hpY2ggd2UgZ2l2ZSB0eXBlIDAgdG8gbGV0IHVzIHByb2Nlc3MgaXRcclxuICAgICAgICAgICAgdmFyIGNvbnRyb2xUeXBlID0gY3QgPT0gbnVsbCB8fCBjdC5sZW5ndGggPCAyID8gMCA6IHBhcnNlSW50KGN0WzFdLCAxMCk7XHJcbiAgICAgICAgICAgIHZhciBjb250cm9sID0gbnVsbDtcclxuICAgICAgICAgICAgc3dpdGNoIChjb250cm9sVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGVtcHR5IGNhbnZhcyBjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sID0gbmV3IENhbnZhc0NvbHVtbihudWxsLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sLmZyb21IdG1sKG1hcmt1cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubWVyZ2VDb2x1bW5Ub1RyZWUoY29udHJvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xpZW50IHNpZGUgd2VicGFydFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2wgPSBuZXcgQ2xpZW50U2lkZVdlYnBhcnQoXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbC5mcm9tSHRtbChtYXJrdXApO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLm1lcmdlUGFydFRvVHJlZShjb250cm9sKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICAvLyBjbGllbnQgc2lkZSB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbCA9IG5ldyBDbGllbnRTaWRlVGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2wuZnJvbUh0bWwobWFya3VwKTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tZXJnZVBhcnRUb1RyZWUoY29udHJvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyByZWZyZXNoIGFsbCB0aGUgb3JkZXJzIHdpdGhpbiB0aGUgdHJlZVxyXG4gICAgICAgIHJlaW5kZXgodGhpcy5zZWN0aW9ucyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBMb2FkcyB0aGlzIHBhZ2UncyBjb250ZW50IGZyb20gdGhlIHNlcnZlclxyXG4gICAgICovXHJcbiAgICBDbGllbnRTaWRlUGFnZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEl0ZW0oXCJDYW52YXNDb250ZW50MVwiLCBcIkNvbW1lbnRzRGlzYWJsZWRcIikudGhlbihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICBfdGhpcy5mcm9tSHRtbChpdGVtLkNhbnZhc0NvbnRlbnQxKTtcclxuICAgICAgICAgICAgX3RoaXMuY29tbWVudHNEaXNhYmxlZCA9IGl0ZW0uQ29tbWVudHNEaXNhYmxlZDtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFBlcnNpc3RzIHRoZSBjb250ZW50IGNoYW5nZXMgKHNlY3Rpb25zLCBjb2x1bW5zLCBhbmQgY29udHJvbHMpXHJcbiAgICAgKi9cclxuICAgIENsaWVudFNpZGVQYWdlLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZVByb3BlcnRpZXMoeyBDYW52YXNDb250ZW50MTogdGhpcy50b0h0bWwoKSB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEVuYWJsZXMgY29tbWVudHMgb24gdGhpcyBwYWdlXHJcbiAgICAgKi9cclxuICAgIENsaWVudFNpZGVQYWdlLnByb3RvdHlwZS5lbmFibGVDb21tZW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNldENvbW1lbnRzT24odHJ1ZSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICBfdGhpcy5jb21tZW50c0Rpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRGlzYWJsZXMgY29tbWVudHMgb24gdGhpcyBwYWdlXHJcbiAgICAgKi9cclxuICAgIENsaWVudFNpZGVQYWdlLnByb3RvdHlwZS5kaXNhYmxlQ29tbWVudHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5zZXRDb21tZW50c09uKGZhbHNlKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgIF90aGlzLmNvbW1lbnRzRGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEZpbmRzIGEgY29udHJvbCBieSB0aGUgc3BlY2lmaWVkIGluc3RhbmNlIGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIEluc3RhbmNlIGlkIG9mIHRoZSBjb250cm9sIHRvIGZpbmRcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UucHJvdG90eXBlLmZpbmRDb250cm9sQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZpbmRDb250cm9sKGZ1bmN0aW9uIChjKSB7IHJldHVybiBjLmlkID09PSBpZDsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBGaW5kcyBhIGNvbnRyb2wgd2l0aGluIHRoaXMgcGFnZSdzIGNvbnRyb2wgdHJlZSB1c2luZyB0aGUgc3VwcGxpZWQgcHJlZGljYXRlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHByZWRpY2F0ZSBUYWtlcyBhIGNvbnRyb2wgYW5kIHJldHVybnMgdHJ1ZSBvciBmYWxzZSwgaWYgdHJ1ZSB0aGF0IGNvbnRyb2wgaXMgcmV0dXJuZWQgYnkgZmluZENvbnRyb2xcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UucHJvdG90eXBlLmZpbmRDb250cm9sID0gZnVuY3Rpb24gKHByZWRpY2F0ZSkge1xyXG4gICAgICAgIC8vIGNoZWNrIGFsbCBzZWN0aW9uc1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBjaGVjayBhbGwgY29sdW1uc1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuc2VjdGlvbnNbaV0uY29sdW1ucy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgYWxsIGNvbnRyb2xzXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMuc2VjdGlvbnNbaV0uY29sdW1uc1tqXS5jb250cm9scy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgcHJlZGljYXRlIGxpa2VzIHRoaXMgY29udHJvbFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmVkaWNhdGUodGhpcy5zZWN0aW9uc1tpXS5jb2x1bW5zW2pdLmNvbnRyb2xzW2tdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZWN0aW9uc1tpXS5jb2x1bW5zW2pdLmNvbnRyb2xzW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB3ZSBmb3VuZCBub3RoaW5nIHNvIGdpdmUgbm90aGluZyBiYWNrXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIHRoZSBjb21tZW50cyBmbGFnIGZvciBhIHBhZ2VcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gb24gSWYgdHJ1ZSBjb21tZW50cyBhcmUgZW5hYmxlZCwgZmFsc2UgdGhleSBhcmUgZGlzYWJsZWRcclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UucHJvdG90eXBlLnNldENvbW1lbnRzT24gPSBmdW5jdGlvbiAob24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRJdGVtKCkudGhlbihmdW5jdGlvbiAoaSkge1xyXG4gICAgICAgICAgICB2YXIgdXBkYXRlciA9IG5ldyBJdGVtKGksIFwiU2V0Q29tbWVudHNEaXNhYmxlZChcIiArICFvbiArIFwiKVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZXIudXBkYXRlKHt9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIE1lcmdlcyB0aGUgY29udHJvbCBpbnRvIHRoZSB0cmVlIG9mIHNlY3Rpb25zIGFuZCBjb2x1bW5zIGZvciB0aGlzIHBhZ2VcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29udHJvbCBUaGUgY29udHJvbCB0byBtZXJnZVxyXG4gICAgICovXHJcbiAgICBDbGllbnRTaWRlUGFnZS5wcm90b3R5cGUubWVyZ2VQYXJ0VG9UcmVlID0gZnVuY3Rpb24gKGNvbnRyb2wpIHtcclxuICAgICAgICB2YXIgc2VjdGlvbiA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvbHVtbiA9IG51bGw7XHJcbiAgICAgICAgdmFyIHNlY3Rpb25zID0gdGhpcy5zZWN0aW9ucy5maWx0ZXIoZnVuY3Rpb24gKHMpIHsgcmV0dXJuIHMub3JkZXIgPT09IGNvbnRyb2wuY29udHJvbERhdGEucG9zaXRpb24uem9uZUluZGV4OyB9KTtcclxuICAgICAgICBpZiAoc2VjdGlvbnMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICBzZWN0aW9uID0gbmV3IENhbnZhc1NlY3Rpb24odGhpcywgY29udHJvbC5jb250cm9sRGF0YS5wb3NpdGlvbi56b25lSW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLnNlY3Rpb25zLnB1c2goc2VjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZWN0aW9uID0gc2VjdGlvbnNbMF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjb2x1bW5zID0gc2VjdGlvbi5jb2x1bW5zLmZpbHRlcihmdW5jdGlvbiAoYykgeyByZXR1cm4gYy5vcmRlciA9PT0gY29udHJvbC5jb250cm9sRGF0YS5wb3NpdGlvbi5zZWN0aW9uSW5kZXg7IH0pO1xyXG4gICAgICAgIGlmIChjb2x1bW5zLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgY29sdW1uID0gbmV3IENhbnZhc0NvbHVtbihzZWN0aW9uLCBjb250cm9sLmNvbnRyb2xEYXRhLnBvc2l0aW9uLnNlY3Rpb25JbmRleCwgY29udHJvbC5jb250cm9sRGF0YS5wb3NpdGlvbi5zZWN0aW9uRmFjdG9yKTtcclxuICAgICAgICAgICAgc2VjdGlvbi5jb2x1bW5zLnB1c2goY29sdW1uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbHVtbiA9IGNvbHVtbnNbMF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnRyb2wuY29sdW1uID0gY29sdW1uO1xyXG4gICAgICAgIGNvbHVtbi5hZGRDb250cm9sKGNvbnRyb2wpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogTWVyZ2VzIHRoZSBzdXBwbGllZCBjb2x1bW4gaW50byB0aGUgdHJlZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb2x1bW4gQ29sdW1uIHRvIG1lcmdlXHJcbiAgICAgKiBAcGFyYW0gcG9zaXRpb24gVGhlIHBvc2l0aW9uIGRhdGEgZm9yIHRoZSBjb2x1bW5cclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhZ2UucHJvdG90eXBlLm1lcmdlQ29sdW1uVG9UcmVlID0gZnVuY3Rpb24gKGNvbHVtbikge1xyXG4gICAgICAgIHZhciBzZWN0aW9uID0gbnVsbDtcclxuICAgICAgICB2YXIgc2VjdGlvbnMgPSB0aGlzLnNlY3Rpb25zLmZpbHRlcihmdW5jdGlvbiAocykgeyByZXR1cm4gcy5vcmRlciA9PT0gY29sdW1uLmNvbnRyb2xEYXRhLnBvc2l0aW9uLnpvbmVJbmRleDsgfSk7XHJcbiAgICAgICAgaWYgKHNlY3Rpb25zLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgc2VjdGlvbiA9IG5ldyBDYW52YXNTZWN0aW9uKHRoaXMsIGNvbHVtbi5jb250cm9sRGF0YS5wb3NpdGlvbi56b25lSW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLnNlY3Rpb25zLnB1c2goc2VjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZWN0aW9uID0gc2VjdGlvbnNbMF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbHVtbi5zZWN0aW9uID0gc2VjdGlvbjtcclxuICAgICAgICBzZWN0aW9uLmNvbHVtbnMucHVzaChjb2x1bW4pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXBkYXRlcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgdW5kZXJseWluZyBMaXN0SXRlbSBhc3NvY2lhdGVkIHdpdGggdGhpcyBDbGllbnRTaWRlUGFnZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzIFNldCBvZiBwcm9wZXJ0aWVzIHRvIHVwZGF0ZVxyXG4gICAgICogQHBhcmFtIGVUYWcgVmFsdWUgdXNlZCBpbiB0aGUgSUYtTWF0Y2ggaGVhZGVyLCBieSBkZWZhdWx0IFwiKlwiXHJcbiAgICAgKi9cclxuICAgIENsaWVudFNpZGVQYWdlLnByb3RvdHlwZS51cGRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKHByb3BlcnRpZXMsIGVUYWcpIHtcclxuICAgICAgICBpZiAoZVRhZyA9PT0gdm9pZCAwKSB7IGVUYWcgPSBcIipcIjsgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEl0ZW0oKS50aGVuKGZ1bmN0aW9uIChpKSB7IHJldHVybiBpLnVwZGF0ZShwcm9wZXJ0aWVzLCBlVGFnKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENsaWVudFNpZGVQYWdlO1xyXG59KEZpbGUpKTtcclxudmFyIENhbnZhc1NlY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDYW52YXNTZWN0aW9uKHBhZ2UsIG9yZGVyLCBjb2x1bW5zKSB7XHJcbiAgICAgICAgaWYgKGNvbHVtbnMgPT09IHZvaWQgMCkgeyBjb2x1bW5zID0gW107IH1cclxuICAgICAgICB0aGlzLnBhZ2UgPSBwYWdlO1xyXG4gICAgICAgIHRoaXMub3JkZXIgPSBvcmRlcjtcclxuICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xyXG4gICAgICAgIHRoaXMuX21lbUlkID0gZ2V0R1VJRCgpO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENhbnZhc1NlY3Rpb24ucHJvdG90eXBlLCBcImRlZmF1bHRDb2x1bW5cIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERlZmF1bHQgY29sdW1uICh0aGlzLmNvbHVtbnNbMF0pIGZvciB0aGlzIHNlY3Rpb25cclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1ucy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZENvbHVtbigxMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1uc1swXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBjb2x1bW4gdG8gdGhpcyBzZWN0aW9uXHJcbiAgICAgKi9cclxuICAgIENhbnZhc1NlY3Rpb24ucHJvdG90eXBlLmFkZENvbHVtbiA9IGZ1bmN0aW9uIChmYWN0b3IpIHtcclxuICAgICAgICB2YXIgY29sdW1uID0gbmV3IENhbnZhc0NvbHVtbih0aGlzLCBnZXROZXh0T3JkZXIodGhpcy5jb2x1bW5zKSwgZmFjdG9yKTtcclxuICAgICAgICB0aGlzLmNvbHVtbnMucHVzaChjb2x1bW4pO1xyXG4gICAgICAgIHJldHVybiBjb2x1bW47XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgY29udHJvbCB0byB0aGUgZGVmYXVsdCBjb2x1bW4gZm9yIHRoaXMgc2VjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb250cm9sIENvbnRyb2wgdG8gYWRkIHRvIHRoZSBkZWZhdWx0IGNvbHVtblxyXG4gICAgICovXHJcbiAgICBDYW52YXNTZWN0aW9uLnByb3RvdHlwZS5hZGRDb250cm9sID0gZnVuY3Rpb24gKGNvbnRyb2wpIHtcclxuICAgICAgICB0aGlzLmRlZmF1bHRDb2x1bW4uYWRkQ29udHJvbChjb250cm9sKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICBDYW52YXNTZWN0aW9uLnByb3RvdHlwZS50b0h0bWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGh0bWwgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBodG1sLnB1c2godGhpcy5jb2x1bW5zW2ldLnRvSHRtbCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGh0bWwuam9pbihcIlwiKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhpcyBzZWN0aW9uIGFuZCBhbGwgY29udGFpbmVkIGNvbHVtbnMgYW5kIGNvbnRyb2xzIGZyb20gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqL1xyXG4gICAgQ2FudmFzU2VjdGlvbi5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wYWdlLnNlY3Rpb25zID0gdGhpcy5wYWdlLnNlY3Rpb25zLmZpbHRlcihmdW5jdGlvbiAoc2VjdGlvbikgeyByZXR1cm4gc2VjdGlvbi5fbWVtSWQgIT09IF90aGlzLl9tZW1JZDsgfSk7XHJcbiAgICAgICAgcmVpbmRleCh0aGlzLnBhZ2Uuc2VjdGlvbnMpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDYW52YXNTZWN0aW9uO1xyXG59KCkpO1xyXG52YXIgQ2FudmFzQ29udHJvbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENhbnZhc0NvbnRyb2woY29udHJvbFR5cGUsIGRhdGFWZXJzaW9uLCBjb2x1bW4sIG9yZGVyLCBpZCwgY29udHJvbERhdGEpIHtcclxuICAgICAgICBpZiAoY29sdW1uID09PSB2b2lkIDApIHsgY29sdW1uID0gbnVsbDsgfVxyXG4gICAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7IG9yZGVyID0gMTsgfVxyXG4gICAgICAgIGlmIChpZCA9PT0gdm9pZCAwKSB7IGlkID0gZ2V0R1VJRCgpOyB9XHJcbiAgICAgICAgaWYgKGNvbnRyb2xEYXRhID09PSB2b2lkIDApIHsgY29udHJvbERhdGEgPSBudWxsOyB9XHJcbiAgICAgICAgdGhpcy5jb250cm9sVHlwZSA9IGNvbnRyb2xUeXBlO1xyXG4gICAgICAgIHRoaXMuZGF0YVZlcnNpb24gPSBkYXRhVmVyc2lvbjtcclxuICAgICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjtcclxuICAgICAgICB0aGlzLm9yZGVyID0gb3JkZXI7XHJcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xyXG4gICAgICAgIHRoaXMuY29udHJvbERhdGEgPSBjb250cm9sRGF0YTtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYW52YXNDb250cm9sLnByb3RvdHlwZSwgXCJqc29uRGF0YVwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVmFsdWUgb2YgdGhlIGNvbnRyb2wncyBcImRhdGEtc3AtY29udHJvbGRhdGFcIiBhdHRyaWJ1dGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIENsaWVudFNpZGVQYWdlLmpzb25Ub0VzY2FwZWRTdHJpbmcodGhpcy5nZXRDb250cm9sRGF0YSgpKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIENhbnZhc0NvbnRyb2wucHJvdG90eXBlLmZyb21IdG1sID0gZnVuY3Rpb24gKGh0bWwpIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xEYXRhID0gQ2xpZW50U2lkZVBhZ2UuZXNjYXBlZFN0cmluZ1RvSnNvbihnZXRBdHRyVmFsdWVGcm9tU3RyaW5nKGh0bWwsIFwiZGF0YS1zcC1jb250cm9sZGF0YVwiKSk7XHJcbiAgICAgICAgdGhpcy5kYXRhVmVyc2lvbiA9IGdldEF0dHJWYWx1ZUZyb21TdHJpbmcoaHRtbCwgXCJkYXRhLXNwLWNhbnZhc2RhdGF2ZXJzaW9uXCIpO1xyXG4gICAgICAgIHRoaXMuY29udHJvbFR5cGUgPSB0aGlzLmNvbnRyb2xEYXRhLmNvbnRyb2xUeXBlO1xyXG4gICAgICAgIHRoaXMuaWQgPSB0aGlzLmNvbnRyb2xEYXRhLmlkO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDYW52YXNDb250cm9sO1xyXG59KCkpO1xyXG52YXIgQ2FudmFzQ29sdW1uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENhbnZhc0NvbHVtbiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENhbnZhc0NvbHVtbihzZWN0aW9uLCBvcmRlciwgZmFjdG9yLCBjb250cm9scywgZGF0YVZlcnNpb24pIHtcclxuICAgICAgICBpZiAoZmFjdG9yID09PSB2b2lkIDApIHsgZmFjdG9yID0gMTI7IH1cclxuICAgICAgICBpZiAoY29udHJvbHMgPT09IHZvaWQgMCkgeyBjb250cm9scyA9IFtdOyB9XHJcbiAgICAgICAgaWYgKGRhdGFWZXJzaW9uID09PSB2b2lkIDApIHsgZGF0YVZlcnNpb24gPSBcIjEuMFwiOyB9XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgMCwgZGF0YVZlcnNpb24pIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuc2VjdGlvbiA9IHNlY3Rpb247XHJcbiAgICAgICAgX3RoaXMub3JkZXIgPSBvcmRlcjtcclxuICAgICAgICBfdGhpcy5mYWN0b3IgPSBmYWN0b3I7XHJcbiAgICAgICAgX3RoaXMuY29udHJvbHMgPSBjb250cm9scztcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBDYW52YXNDb2x1bW4ucHJvdG90eXBlLmFkZENvbnRyb2wgPSBmdW5jdGlvbiAoY29udHJvbCkge1xyXG4gICAgICAgIGNvbnRyb2wuY29sdW1uID0gdGhpcztcclxuICAgICAgICB0aGlzLmNvbnRyb2xzLnB1c2goY29udHJvbCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgQ2FudmFzQ29sdW1uLnByb3RvdHlwZS5nZXRDb250cm9sID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udHJvbHNbaW5kZXhdO1xyXG4gICAgfTtcclxuICAgIENhbnZhc0NvbHVtbi5wcm90b3R5cGUudG9IdG1sID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBodG1sID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuY29udHJvbHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICBodG1sLnB1c2goXCI8ZGl2IGRhdGEtc3AtY2FudmFzY29udHJvbD1cXFwiXFxcIiBkYXRhLXNwLWNhbnZhc2RhdGF2ZXJzaW9uPVxcXCJcIiArIHRoaXMuZGF0YVZlcnNpb24gKyBcIlxcXCIgZGF0YS1zcC1jb250cm9sZGF0YT1cXFwiXCIgKyB0aGlzLmpzb25EYXRhICsgXCJcXFwiPjwvZGl2PlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jb250cm9scy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaHRtbC5wdXNoKHRoaXMuY29udHJvbHNbaV0udG9IdG1sKGkgKyAxKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGh0bWwuam9pbihcIlwiKTtcclxuICAgIH07XHJcbiAgICBDYW52YXNDb2x1bW4ucHJvdG90eXBlLmZyb21IdG1sID0gZnVuY3Rpb24gKGh0bWwpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmZyb21IdG1sLmNhbGwodGhpcywgaHRtbCk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sRGF0YSA9IENsaWVudFNpZGVQYWdlLmVzY2FwZWRTdHJpbmdUb0pzb24oZ2V0QXR0clZhbHVlRnJvbVN0cmluZyhodG1sLCBcImRhdGEtc3AtY29udHJvbGRhdGFcIikpO1xyXG4gICAgICAgIHRoaXMuZmFjdG9yID0gdGhpcy5jb250cm9sRGF0YS5wb3NpdGlvbi5zZWN0aW9uRmFjdG9yO1xyXG4gICAgICAgIHRoaXMub3JkZXIgPSB0aGlzLmNvbnRyb2xEYXRhLnBvc2l0aW9uLnNlY3Rpb25JbmRleDtcclxuICAgIH07XHJcbiAgICBDYW52YXNDb2x1bW4ucHJvdG90eXBlLmdldENvbnRyb2xEYXRhID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRpc3BsYXlNb2RlOiAyLFxyXG4gICAgICAgICAgICBwb3NpdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgc2VjdGlvbkZhY3RvcjogdGhpcy5mYWN0b3IsXHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uSW5kZXg6IHRoaXMub3JkZXIsXHJcbiAgICAgICAgICAgICAgICB6b25lSW5kZXg6IHRoaXMuc2VjdGlvbi5vcmRlcixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyB0aGlzIGNvbHVtbiBhbmQgYWxsIGNvbnRhaW5lZCBjb250cm9scyBmcm9tIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKi9cclxuICAgIENhbnZhc0NvbHVtbi5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zZWN0aW9uLmNvbHVtbnMgPSB0aGlzLnNlY3Rpb24uY29sdW1ucy5maWx0ZXIoZnVuY3Rpb24gKGNvbHVtbikgeyByZXR1cm4gY29sdW1uLmlkICE9PSBfdGhpcy5pZDsgfSk7XHJcbiAgICAgICAgcmVpbmRleCh0aGlzLmNvbHVtbi5jb250cm9scyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENhbnZhc0NvbHVtbjtcclxufShDYW52YXNDb250cm9sKSk7XHJcbi8qKlxyXG4gKiBBYnN0cmFjdCBjbGFzcyB3aXRoIHNoYXJlZCBmdW5jdGlvbmFsaXR5IGZvciBwYXJ0c1xyXG4gKi9cclxudmFyIENsaWVudFNpZGVQYXJ0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENsaWVudFNpZGVQYXJ0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2xpZW50U2lkZVBhcnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmVzIHRoaXMgY29sdW1uIGFuZCBhbGwgY29udGFpbmVkIGNvbnRyb2xzIGZyb20gdGhlIGNvbGxlY3Rpb25cclxuICAgICAqL1xyXG4gICAgQ2xpZW50U2lkZVBhcnQucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuY29sdW1uLmNvbnRyb2xzID0gdGhpcy5jb2x1bW4uY29udHJvbHMuZmlsdGVyKGZ1bmN0aW9uIChjb250cm9sKSB7IHJldHVybiBjb250cm9sLmlkICE9PSBfdGhpcy5pZDsgfSk7XHJcbiAgICAgICAgcmVpbmRleCh0aGlzLmNvbHVtbi5jb250cm9scyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENsaWVudFNpZGVQYXJ0O1xyXG59KENhbnZhc0NvbnRyb2wpKTtcclxudmFyIENsaWVudFNpZGVUZXh0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENsaWVudFNpZGVUZXh0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2xpZW50U2lkZVRleHQodGV4dCkge1xyXG4gICAgICAgIGlmICh0ZXh0ID09PSB2b2lkIDApIHsgdGV4dCA9IFwiXCI7IH1cclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCA0LCBcIjEuMFwiKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnRleHQgPSB0ZXh0O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDbGllbnRTaWRlVGV4dC5wcm90b3R5cGUsIFwidGV4dFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIHRleHQgbWFya3VwIG9mIHRoaXMgY29udHJvbFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGV4dDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKCF0ZXh0LnN0YXJ0c1dpdGgoXCI8cD5cIikpIHtcclxuICAgICAgICAgICAgICAgIHRleHQgPSBcIjxwPlwiICsgdGV4dCArIFwiPC9wPlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX3RleHQgPSB0ZXh0O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgQ2xpZW50U2lkZVRleHQucHJvdG90eXBlLmdldENvbnRyb2xEYXRhID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xUeXBlOiB0aGlzLmNvbnRyb2xUeXBlLFxyXG4gICAgICAgICAgICBlZGl0b3JUeXBlOiBcIkNLRWRpdG9yXCIsXHJcbiAgICAgICAgICAgIGlkOiB0aGlzLmlkLFxyXG4gICAgICAgICAgICBwb3NpdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbEluZGV4OiB0aGlzLm9yZGVyLFxyXG4gICAgICAgICAgICAgICAgc2VjdGlvbkZhY3RvcjogdGhpcy5jb2x1bW4uZmFjdG9yLFxyXG4gICAgICAgICAgICAgICAgc2VjdGlvbkluZGV4OiB0aGlzLmNvbHVtbi5vcmRlcixcclxuICAgICAgICAgICAgICAgIHpvbmVJbmRleDogdGhpcy5jb2x1bW4uc2VjdGlvbi5vcmRlcixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIENsaWVudFNpZGVUZXh0LnByb3RvdHlwZS50b0h0bWwgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAvLyBzZXQgb3VyIG9yZGVyIHRvIHRoZSB2YWx1ZSBwYXNzZWQgaW5cclxuICAgICAgICB0aGlzLm9yZGVyID0gaW5kZXg7XHJcbiAgICAgICAgdmFyIGh0bWwgPSBbXTtcclxuICAgICAgICBodG1sLnB1c2goXCI8ZGl2IGRhdGEtc3AtY2FudmFzY29udHJvbD1cXFwiXFxcIiBkYXRhLXNwLWNhbnZhc2RhdGF2ZXJzaW9uPVxcXCJcIiArIHRoaXMuZGF0YVZlcnNpb24gKyBcIlxcXCIgZGF0YS1zcC1jb250cm9sZGF0YT1cXFwiXCIgKyB0aGlzLmpzb25EYXRhICsgXCJcXFwiPlwiKTtcclxuICAgICAgICBodG1sLnB1c2goXCI8ZGl2IGRhdGEtc3AtcnRlPVxcXCJcXFwiPlwiKTtcclxuICAgICAgICBodG1sLnB1c2goXCJcIiArIHRoaXMudGV4dCk7XHJcbiAgICAgICAgaHRtbC5wdXNoKFwiPC9kaXY+XCIpO1xyXG4gICAgICAgIGh0bWwucHVzaChcIjwvZGl2PlwiKTtcclxuICAgICAgICByZXR1cm4gaHRtbC5qb2luKFwiXCIpO1xyXG4gICAgfTtcclxuICAgIENsaWVudFNpZGVUZXh0LnByb3RvdHlwZS5mcm9tSHRtbCA9IGZ1bmN0aW9uIChodG1sKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmZyb21IdG1sLmNhbGwodGhpcywgaHRtbCk7XHJcbiAgICAgICAgdGhpcy50ZXh0ID0gXCJcIjtcclxuICAgICAgICBnZXRCb3VuZGVkRGl2TWFya3VwKGh0bWwsIC88ZGl2W14+XSpkYXRhLXNwLXJ0ZVtePl0qPi9pLCBmdW5jdGlvbiAocykge1xyXG4gICAgICAgICAgICAvLyBub3cgd2UgbmVlZCB0byBncmFiIHRoZSBpbm5lciB0ZXh0IGJldHdlZW4gdGhlIGRpdnNcclxuICAgICAgICAgICAgdmFyIG1hdGNoID0gLzxkaXZbXj5dKmRhdGEtc3AtcnRlW14+XSo+KC4qPyk8XFwvZGl2PiQvaS5leGVjKHMpO1xyXG4gICAgICAgICAgICBfdGhpcy50ZXh0ID0gbWF0Y2gubGVuZ3RoID4gMSA/IG1hdGNoWzFdIDogXCJcIjtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ2xpZW50U2lkZVRleHQ7XHJcbn0oQ2xpZW50U2lkZVBhcnQpKTtcclxudmFyIENsaWVudFNpZGVXZWJwYXJ0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENsaWVudFNpZGVXZWJwYXJ0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2xpZW50U2lkZVdlYnBhcnQodGl0bGUsIGRlc2NyaXB0aW9uLCBwcm9wZXJ0aWVKc29uLCB3ZWJQYXJ0SWQsIGh0bWxQcm9wZXJ0aWVzLCBzZXJ2ZXJQcm9jZXNzZWRDb250ZW50LCBjYW52YXNEYXRhVmVyc2lvbikge1xyXG4gICAgICAgIGlmIChkZXNjcmlwdGlvbiA9PT0gdm9pZCAwKSB7IGRlc2NyaXB0aW9uID0gXCJcIjsgfVxyXG4gICAgICAgIGlmIChwcm9wZXJ0aWVKc29uID09PSB2b2lkIDApIHsgcHJvcGVydGllSnNvbiA9IHt9OyB9XHJcbiAgICAgICAgaWYgKHdlYlBhcnRJZCA9PT0gdm9pZCAwKSB7IHdlYlBhcnRJZCA9IFwiXCI7IH1cclxuICAgICAgICBpZiAoaHRtbFByb3BlcnRpZXMgPT09IHZvaWQgMCkgeyBodG1sUHJvcGVydGllcyA9IFwiXCI7IH1cclxuICAgICAgICBpZiAoc2VydmVyUHJvY2Vzc2VkQ29udGVudCA9PT0gdm9pZCAwKSB7IHNlcnZlclByb2Nlc3NlZENvbnRlbnQgPSBudWxsOyB9XHJcbiAgICAgICAgaWYgKGNhbnZhc0RhdGFWZXJzaW9uID09PSB2b2lkIDApIHsgY2FudmFzRGF0YVZlcnNpb24gPSBcIjEuMFwiOyB9XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgMywgXCIxLjBcIikgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50aXRsZSA9IHRpdGxlO1xyXG4gICAgICAgIF90aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XHJcbiAgICAgICAgX3RoaXMucHJvcGVydGllSnNvbiA9IHByb3BlcnRpZUpzb247XHJcbiAgICAgICAgX3RoaXMud2ViUGFydElkID0gd2ViUGFydElkO1xyXG4gICAgICAgIF90aGlzLmh0bWxQcm9wZXJ0aWVzID0gaHRtbFByb3BlcnRpZXM7XHJcbiAgICAgICAgX3RoaXMuc2VydmVyUHJvY2Vzc2VkQ29udGVudCA9IHNlcnZlclByb2Nlc3NlZENvbnRlbnQ7XHJcbiAgICAgICAgX3RoaXMuY2FudmFzRGF0YVZlcnNpb24gPSBjYW52YXNEYXRhVmVyc2lvbjtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBDbGllbnRTaWRlV2VicGFydC5mcm9tQ29tcG9uZW50RGVmID0gZnVuY3Rpb24gKGRlZmluaXRpb24pIHtcclxuICAgICAgICB2YXIgcGFydCA9IG5ldyBDbGllbnRTaWRlV2VicGFydChcIlwiKTtcclxuICAgICAgICBwYXJ0LmltcG9ydChkZWZpbml0aW9uKTtcclxuICAgICAgICByZXR1cm4gcGFydDtcclxuICAgIH07XHJcbiAgICBDbGllbnRTaWRlV2VicGFydC5wcm90b3R5cGUuaW1wb3J0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xyXG4gICAgICAgIHRoaXMud2ViUGFydElkID0gY29tcG9uZW50LklkLnJlcGxhY2UoL15cXHt8XFx9JC9nLCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHZhciBtYW5pZmVzdCA9IEpTT04ucGFyc2UoY29tcG9uZW50Lk1hbmlmZXN0KTtcclxuICAgICAgICB0aGlzLnRpdGxlID0gbWFuaWZlc3QucHJlY29uZmlndXJlZEVudHJpZXNbMF0udGl0bGUuZGVmYXVsdDtcclxuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gbWFuaWZlc3QucHJlY29uZmlndXJlZEVudHJpZXNbMF0uZGVzY3JpcHRpb24uZGVmYXVsdDtcclxuICAgICAgICB0aGlzLmRhdGFWZXJzaW9uID0gXCJcIjtcclxuICAgICAgICB0aGlzLnByb3BlcnRpZUpzb24gPSB0aGlzLnBhcnNlSnNvblByb3BlcnRpZXMobWFuaWZlc3QucHJlY29uZmlndXJlZEVudHJpZXNbMF0ucHJvcGVydGllcyk7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50U2lkZVdlYnBhcnQucHJvdG90eXBlLnNldFByb3BlcnRpZXMgPSBmdW5jdGlvbiAocHJvcGVydGllcykge1xyXG4gICAgICAgIHRoaXMucHJvcGVydGllSnNvbiA9IGV4dGVuZCh0aGlzLnByb3BlcnRpZUpzb24sIHByb3BlcnRpZXMpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIENsaWVudFNpZGVXZWJwYXJ0LnByb3RvdHlwZS5nZXRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZUpzb247XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50U2lkZVdlYnBhcnQucHJvdG90eXBlLnRvSHRtbCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIC8vIHNldCBvdXIgb3JkZXIgdG8gdGhlIHZhbHVlIHBhc3NlZCBpblxyXG4gICAgICAgIHRoaXMub3JkZXIgPSBpbmRleDtcclxuICAgICAgICAvLyB3aWxsIGZvcm0gdGhlIHZhbHVlIG9mIHRoZSBkYXRhLXNwLXdlYnBhcnRkYXRhIGF0dHJpYnV0ZVxyXG4gICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICBkYXRhVmVyc2lvbjogdGhpcy5kYXRhVmVyc2lvbixcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIGlkOiB0aGlzLndlYlBhcnRJZCxcclxuICAgICAgICAgICAgaW5zdGFuY2VJZDogdGhpcy5pZCxcclxuICAgICAgICAgICAgcHJvcGVydGllczogdGhpcy5wcm9wZXJ0aWVKc29uLFxyXG4gICAgICAgICAgICBzZXJ2ZXJQcm9jZXNzZWRDb250ZW50OiB0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQsXHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIGh0bWwgPSBbXTtcclxuICAgICAgICBodG1sLnB1c2goXCI8ZGl2IGRhdGEtc3AtY2FudmFzY29udHJvbD1cXFwiXFxcIiBkYXRhLXNwLWNhbnZhc2RhdGF2ZXJzaW9uPVxcXCJcIiArIHRoaXMuY2FudmFzRGF0YVZlcnNpb24gKyBcIlxcXCIgZGF0YS1zcC1jb250cm9sZGF0YT1cXFwiXCIgKyB0aGlzLmpzb25EYXRhICsgXCJcXFwiPlwiKTtcclxuICAgICAgICBodG1sLnB1c2goXCI8ZGl2IGRhdGEtc3Atd2VicGFydD1cXFwiXFxcIiBkYXRhLXNwLXdlYnBhcnRkYXRhdmVyc2lvbj1cXFwiXCIgKyB0aGlzLmRhdGFWZXJzaW9uICsgXCJcXFwiIGRhdGEtc3Atd2VicGFydGRhdGE9XFxcIlwiICsgQ2xpZW50U2lkZVBhZ2UuanNvblRvRXNjYXBlZFN0cmluZyhkYXRhKSArIFwiXFxcIj5cIik7XHJcbiAgICAgICAgaHRtbC5wdXNoKFwiPGRpdiBkYXRhLXNwLWNvbXBvbmVudGlkPlwiKTtcclxuICAgICAgICBodG1sLnB1c2godGhpcy53ZWJQYXJ0SWQpO1xyXG4gICAgICAgIGh0bWwucHVzaChcIjwvZGl2PlwiKTtcclxuICAgICAgICBodG1sLnB1c2goXCI8ZGl2IGRhdGEtc3AtaHRtbHByb3BlcnRpZXM9XFxcIlxcXCI+XCIpO1xyXG4gICAgICAgIGh0bWwucHVzaCh0aGlzLnJlbmRlckh0bWxQcm9wZXJ0aWVzKCkpO1xyXG4gICAgICAgIGh0bWwucHVzaChcIjwvZGl2PlwiKTtcclxuICAgICAgICBodG1sLnB1c2goXCI8L2Rpdj5cIik7XHJcbiAgICAgICAgaHRtbC5wdXNoKFwiPC9kaXY+XCIpO1xyXG4gICAgICAgIHJldHVybiBodG1sLmpvaW4oXCJcIik7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50U2lkZVdlYnBhcnQucHJvdG90eXBlLmZyb21IdG1sID0gZnVuY3Rpb24gKGh0bWwpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmZyb21IdG1sLmNhbGwodGhpcywgaHRtbCk7XHJcbiAgICAgICAgdmFyIHdlYlBhcnREYXRhID0gQ2xpZW50U2lkZVBhZ2UuZXNjYXBlZFN0cmluZ1RvSnNvbihnZXRBdHRyVmFsdWVGcm9tU3RyaW5nKGh0bWwsIFwiZGF0YS1zcC13ZWJwYXJ0ZGF0YVwiKSk7XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IHdlYlBhcnREYXRhLnRpdGxlO1xyXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSB3ZWJQYXJ0RGF0YS5kZXNjcmlwdGlvbjtcclxuICAgICAgICB0aGlzLndlYlBhcnRJZCA9IHdlYlBhcnREYXRhLmlkO1xyXG4gICAgICAgIHRoaXMuY2FudmFzRGF0YVZlcnNpb24gPSBnZXRBdHRyVmFsdWVGcm9tU3RyaW5nKGh0bWwsIFwiZGF0YS1zcC1jYW52YXNkYXRhdmVyc2lvblwiKS5yZXBsYWNlKC9cXFxcXFwuLywgXCIuXCIpO1xyXG4gICAgICAgIHRoaXMuZGF0YVZlcnNpb24gPSBnZXRBdHRyVmFsdWVGcm9tU3RyaW5nKGh0bWwsIFwiZGF0YS1zcC13ZWJwYXJ0ZGF0YXZlcnNpb25cIikucmVwbGFjZSgvXFxcXFxcLi8sIFwiLlwiKTtcclxuICAgICAgICB0aGlzLnNldFByb3BlcnRpZXMod2ViUGFydERhdGEucHJvcGVydGllcyk7XHJcbiAgICAgICAgaWYgKHdlYlBhcnREYXRhLnNlcnZlclByb2Nlc3NlZENvbnRlbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQgPSB3ZWJQYXJ0RGF0YS5zZXJ2ZXJQcm9jZXNzZWRDb250ZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBnZXQgb3VyIGh0bWwgcHJvcGVydGllc1xyXG4gICAgICAgIHZhciBodG1sUHJvcHMgPSBnZXRCb3VuZGVkRGl2TWFya3VwKGh0bWwsIC88ZGl2XFxiW14+XSpkYXRhLXNwLWh0bWxwcm9wZXJ0aWVzW14+XSo/Pi9pLCBmdW5jdGlvbiAobWFya3VwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXJrdXAucmVwbGFjZSgvXjxkaXZcXGJbXj5dKmRhdGEtc3AtaHRtbHByb3BlcnRpZXNbXj5dKj8+L2ksIFwiXCIpLnJlcGxhY2UoLzxcXC9kaXY+JC9pLCBcIlwiKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmh0bWxQcm9wZXJ0aWVzID0gaHRtbFByb3BzLmxlbmd0aCA+IDAgPyBodG1sUHJvcHNbMF0gOiBcIlwiO1xyXG4gICAgfTtcclxuICAgIENsaWVudFNpZGVXZWJwYXJ0LnByb3RvdHlwZS5nZXRDb250cm9sRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjb250cm9sVHlwZTogdGhpcy5jb250cm9sVHlwZSxcclxuICAgICAgICAgICAgaWQ6IHRoaXMuaWQsXHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sSW5kZXg6IHRoaXMub3JkZXIsXHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uRmFjdG9yOiB0aGlzLmNvbHVtbi5mYWN0b3IsXHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uSW5kZXg6IHRoaXMuY29sdW1uLm9yZGVyLFxyXG4gICAgICAgICAgICAgICAgem9uZUluZGV4OiB0aGlzLmNvbHVtbi5zZWN0aW9uLm9yZGVyLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB3ZWJQYXJ0SWQ6IHRoaXMud2ViUGFydElkLFxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50U2lkZVdlYnBhcnQucHJvdG90eXBlLnJlbmRlckh0bWxQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBodG1sID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuc2VydmVyUHJvY2Vzc2VkQ29udGVudCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuc2VydmVyUHJvY2Vzc2VkQ29udGVudCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBodG1sLnB1c2godGhpcy5odG1sUHJvcGVydGllcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc2VydmVyUHJvY2Vzc2VkQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQuc2VhcmNoYWJsZVBsYWluVGV4dHMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQuc2VhcmNoYWJsZVBsYWluVGV4dHMpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbC5wdXNoKFwiPGRpdiBkYXRhLXNwLXByb3AtbmFtZT1cXFwiXCIgKyBrZXlzW2ldICsgXCJcXFwiIGRhdGEtc3Atc2VhcmNoYWJsZXBsYWludGV4dD1cXFwidHJ1ZVxcXCI+XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGh0bWwucHVzaCh0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQuc2VhcmNoYWJsZVBsYWluVGV4dHNba2V5c1tpXV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGh0bWwucHVzaChcIjwvZGl2PlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXJ2ZXJQcm9jZXNzZWRDb250ZW50LmltYWdlU291cmNlcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuc2VydmVyUHJvY2Vzc2VkQ29udGVudC5pbWFnZVNvdXJjZXMpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbC5wdXNoKFwiPGltZyBkYXRhLXNwLXByb3AtbmFtZT1cXFwiXCIgKyBrZXlzW2ldICsgXCJcXFwiIHNyYz1cXFwiXCIgKyB0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQuaW1hZ2VTb3VyY2VzW2tleXNbaV1dICsgXCJcXFwiIC8+XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQubGlua3MgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQubGlua3MpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbC5wdXNoKFwiPGEgZGF0YS1zcC1wcm9wLW5hbWU9XFxcIlwiICsga2V5c1tpXSArIFwiXFxcIiBocmVmPVxcXCJcIiArIHRoaXMuc2VydmVyUHJvY2Vzc2VkQ29udGVudC5saW5rc1trZXlzW2ldXSArIFwiXFxcIj48L2E+XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBodG1sLmpvaW4oXCJcIik7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50U2lkZVdlYnBhcnQucHJvdG90eXBlLnBhcnNlSnNvblByb3BlcnRpZXMgPSBmdW5jdGlvbiAocHJvcHMpIHtcclxuICAgICAgICAvLyBJZiB0aGUgd2ViIHBhcnQgaGFzIHRoZSBzZXJ2ZXJQcm9jZXNzZWRDb250ZW50IHByb3BlcnR5IHRoZW4ga2VlcCB0aGlzIG9uZSBhcyBpdCBtaWdodCBiZSBuZWVkZWQgYXMgaW5wdXQgdG8gcmVuZGVyIHRoZSB3ZWIgcGFydCBIVE1MIGxhdGVyIG9uXHJcbiAgICAgICAgaWYgKHByb3BzLndlYlBhcnREYXRhICE9PSB1bmRlZmluZWQgJiYgcHJvcHMud2ViUGFydERhdGEuc2VydmVyUHJvY2Vzc2VkQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmVyUHJvY2Vzc2VkQ29udGVudCA9IHByb3BzLndlYlBhcnREYXRhLnNlcnZlclByb2Nlc3NlZENvbnRlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHByb3BzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlcnZlclByb2Nlc3NlZENvbnRlbnQgPSBwcm9wcy5zZXJ2ZXJQcm9jZXNzZWRDb250ZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJQcm9jZXNzZWRDb250ZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHByb3BzLndlYlBhcnREYXRhICE9PSB1bmRlZmluZWQgJiYgcHJvcHMud2ViUGFydERhdGEucHJvcGVydGllcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwcm9wcy53ZWJQYXJ0RGF0YS5wcm9wZXJ0aWVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChwcm9wcy5wcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHByb3BzLnByb3BlcnRpZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJvcHM7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBDbGllbnRTaWRlV2VicGFydDtcclxufShDbGllbnRTaWRlUGFydCkpO1xuXG4vKipcclxuICogUmVwcmVzZW50cyBhIGNvbGxlY3Rpb24gb2YgbmF2aWdhdGlvbiBub2Rlc1xyXG4gKlxyXG4gKi9cclxudmFyIE5hdmlnYXRpb25Ob2RlcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhOYXZpZ2F0aW9uTm9kZXMsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uTm9kZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgbmF2aWdhdGlvbiBub2RlIGJ5IGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBpZCBvZiB0aGUgbm9kZVxyXG4gICAgICovXHJcbiAgICBOYXZpZ2F0aW9uTm9kZXMucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgbm9kZSA9IG5ldyBOYXZpZ2F0aW9uTm9kZSh0aGlzKTtcclxuICAgICAgICBub2RlLmNvbmNhdChcIihcIiArIGlkICsgXCIpXCIpO1xyXG4gICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBub2RlIHRvIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRpdGxlIERpc3BsYXkgbmFtZSBvZiB0aGUgbm9kZVxyXG4gICAgICogQHBhcmFtIHVybCBUaGUgdXJsIG9mIHRoZSBub2RlXHJcbiAgICAgKiBAcGFyYW0gdmlzaWJsZSBJZiB0cnVlIHRoZSBub2RlIGlzIHZpc2libGUsIG90aGVyd2lzZSBpdCBpcyBoaWRkZW4gKGRlZmF1bHQ6IHRydWUpXHJcbiAgICAgKi9cclxuICAgIE5hdmlnYXRpb25Ob2Rlcy5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHRpdGxlLCB1cmwsIHZpc2libGUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh2aXNpYmxlID09PSB2b2lkIDApIHsgdmlzaWJsZSA9IHRydWU7IH1cclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1MoZXh0ZW5kKG1ldGFkYXRhKFwiU1AuTmF2aWdhdGlvbk5vZGVcIiksIHtcclxuICAgICAgICAgICAgSXNWaXNpYmxlOiB2aXNpYmxlLFxyXG4gICAgICAgICAgICBUaXRsZTogdGl0bGUsXHJcbiAgICAgICAgICAgIFVybDogdXJsLFxyXG4gICAgICAgIH0pKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShOYXZpZ2F0aW9uTm9kZXMsIG51bGwpLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHkgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIG5vZGU6IF90aGlzLmdldEJ5SWQoZGF0YS5JZCksXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBNb3ZlcyBhIG5vZGUgdG8gYmUgYWZ0ZXIgYW5vdGhlciBub2RlIGluIHRoZSBuYXZpZ2F0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5vZGVJZCBJZCBvZiB0aGUgbm9kZSB0byBtb3ZlXHJcbiAgICAgKiBAcGFyYW0gcHJldmlvdXNOb2RlSWQgSWQgb2YgdGhlIG5vZGUgYWZ0ZXIgd2hpY2ggd2UgbW92ZSB0aGUgbm9kZSBzcGVjaWZpZWQgYnkgbm9kZUlkXHJcbiAgICAgKi9cclxuICAgIE5hdmlnYXRpb25Ob2Rlcy5wcm90b3R5cGUubW92ZUFmdGVyID0gZnVuY3Rpb24gKG5vZGVJZCwgcHJldmlvdXNOb2RlSWQpIHtcclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1Moe1xyXG4gICAgICAgICAgICBub2RlSWQ6IG5vZGVJZCxcclxuICAgICAgICAgICAgcHJldmlvdXNOb2RlSWQ6IHByZXZpb3VzTm9kZUlkLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKE5hdmlnYXRpb25Ob2RlcywgXCJNb3ZlQWZ0ZXJcIikucG9zdENvcmUoeyBib2R5OiBwb3N0Qm9keSB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTmF2aWdhdGlvbk5vZGVzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBSZXByZXNlbnRzIGFuIGluc3RhbmNlIG9mIGEgbmF2aWdhdGlvbiBub2RlXHJcbiAqXHJcbiAqL1xyXG52YXIgTmF2aWdhdGlvbk5vZGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoTmF2aWdhdGlvbk5vZGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uTm9kZSgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTmF2aWdhdGlvbk5vZGUucHJvdG90eXBlLCBcImNoaWxkcmVuXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBSZXByZXNlbnRzIHRoZSBjaGlsZCBub2RlcyBvZiB0aGlzIG5vZGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYXZpZ2F0aW9uTm9kZXModGhpcywgXCJDaGlsZHJlblwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlcyB0aGlzIG5vZGUgYW5kIGFueSBjaGlsZCBub2Rlc1xyXG4gICAgICovXHJcbiAgICBOYXZpZ2F0aW9uTm9kZS5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIucHJvdG90eXBlLmRlbGV0ZUNvcmUuY2FsbCh0aGlzKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTmF2aWdhdGlvbk5vZGU7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XHJcbi8qKlxyXG4gKiBFeHBvc2VzIHRoZSBuYXZpZ2F0aW9uIGNvbXBvbmVudHNcclxuICpcclxuICovXHJcbnZhciBOYXZpZ2F0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKE5hdmlnYXRpb24sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShOYXZpZ2F0aW9uLnByb3RvdHlwZSwgXCJxdWlja2xhdW5jaFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgcXVpY2tsYXVuY2ggbmF2aWdhdGlvbiBub2RlcyBmb3IgdGhlIGN1cnJlbnQgY29udGV4dFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgTmF2aWdhdGlvbk5vZGVzKHRoaXMsIFwicXVpY2tsYXVuY2hcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTmF2aWdhdGlvbi5wcm90b3R5cGUsIFwidG9wTmF2aWdhdGlvbkJhclwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgdG9wIGJhciBuYXZpZ2F0aW9uIG5vZGVzIGZvciB0aGUgY3VycmVudCBjb250ZXh0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYXZpZ2F0aW9uTm9kZXModGhpcywgXCJ0b3BuYXZpZ2F0aW9uYmFyXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgTmF2aWdhdGlvbiA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwibmF2aWdhdGlvblwiKVxyXG4gICAgXSwgTmF2aWdhdGlvbik7XHJcbiAgICByZXR1cm4gTmF2aWdhdGlvbjtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlKSk7XHJcbi8qKlxyXG4gKiBSZXByZXNlbnRzIHRoZSB0b3AgbGV2ZWwgbmF2aWdhdGlvbiBzZXJ2aWNlXHJcbiAqL1xyXG52YXIgTmF2aWdhdGlvblNlcnZpY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoTmF2aWdhdGlvblNlcnZpY2UsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uU2VydmljZShwYXRoKSB7XHJcbiAgICAgICAgaWYgKHBhdGggPT09IHZvaWQgMCkgeyBwYXRoID0gbnVsbDsgfVxyXG4gICAgICAgIHJldHVybiBfc3VwZXIuY2FsbCh0aGlzLCBcIl9hcGkvbmF2aWdhdGlvblwiLCBwYXRoKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgTWVudVN0YXRlIHNlcnZpY2Ugb3BlcmF0aW9uIHJldHVybnMgYSBNZW51LVN0YXRlIChkdW1wKSBvZiBhIFNpdGVNYXBQcm92aWRlciBvbiBhIHNpdGUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG1lbnVOb2RlS2V5IE1lbnVOb2RlLktleSBvZiB0aGUgc3RhcnQgbm9kZSB3aXRoaW4gdGhlIFNpdGVNYXBQcm92aWRlciBJZiBubyBrZXkgaXMgcHJvdmlkZWQgdGhlIFNpdGVNYXBQcm92aWRlci5Sb290Tm9kZSB3aWxsIGJlIHRoZSByb290IG9mIHRoZSBtZW51IHN0YXRlLlxyXG4gICAgICogQHBhcmFtIGRlcHRoIERlcHRoIG9mIHRoZSBkdW1wLiBJZiBubyB2YWx1ZSBpcyBwcm92aWRlZCBhIGR1bXAgd2l0aCB0aGUgZGVwdGggb2YgMTAgaXMgcmV0dXJuZWRcclxuICAgICAqIEBwYXJhbSBtYXBQcm92aWRlck5hbWUgVGhlIG5hbWUgaWRlbnRpZnlpbmcgdGhlIFNpdGVNYXBQcm92aWRlciB0byBiZSB1c2VkXHJcbiAgICAgKiBAcGFyYW0gY3VzdG9tUHJvcGVydGllcyBjb21tYSBzZXBlcmF0ZWQgbGlzdCBvZiBjdXN0b20gcHJvcGVydGllcyB0byBiZSByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgTmF2aWdhdGlvblNlcnZpY2UucHJvdG90eXBlLmdldE1lbnVTdGF0ZSA9IGZ1bmN0aW9uIChtZW51Tm9kZUtleSwgZGVwdGgsIG1hcFByb3ZpZGVyTmFtZSwgY3VzdG9tUHJvcGVydGllcykge1xyXG4gICAgICAgIGlmIChtZW51Tm9kZUtleSA9PT0gdm9pZCAwKSB7IG1lbnVOb2RlS2V5ID0gbnVsbDsgfVxyXG4gICAgICAgIGlmIChkZXB0aCA9PT0gdm9pZCAwKSB7IGRlcHRoID0gMTA7IH1cclxuICAgICAgICBpZiAobWFwUHJvdmlkZXJOYW1lID09PSB2b2lkIDApIHsgbWFwUHJvdmlkZXJOYW1lID0gbnVsbDsgfVxyXG4gICAgICAgIGlmIChjdXN0b21Qcm9wZXJ0aWVzID09PSB2b2lkIDApIHsgY3VzdG9tUHJvcGVydGllcyA9IG51bGw7IH1cclxuICAgICAgICByZXR1cm4gKG5ldyBOYXZpZ2F0aW9uU2VydmljZShcIk1lbnVTdGF0ZVwiKSkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcyxcclxuICAgICAgICAgICAgICAgIGRlcHRoOiBkZXB0aCxcclxuICAgICAgICAgICAgICAgIG1hcFByb3ZpZGVyTmFtZTogbWFwUHJvdmlkZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgbWVudU5vZGVLZXk6IG1lbnVOb2RlS2V5LFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFRyaWVzIHRvIGdldCBhIFNpdGVNYXBOb2RlLktleSBmb3IgYSBnaXZlbiBVUkwgd2l0aGluIGEgc2l0ZSBjb2xsZWN0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjdXJyZW50VXJsIEEgdXJsIHJlcHJlc2VudGluZyB0aGUgU2l0ZU1hcE5vZGVcclxuICAgICAqIEBwYXJhbSBtYXBQcm92aWRlck5hbWUgVGhlIG5hbWUgaWRlbnRpZnlpbmcgdGhlIFNpdGVNYXBQcm92aWRlciB0byBiZSB1c2VkXHJcbiAgICAgKi9cclxuICAgIE5hdmlnYXRpb25TZXJ2aWNlLnByb3RvdHlwZS5nZXRNZW51Tm9kZUtleSA9IGZ1bmN0aW9uIChjdXJyZW50VXJsLCBtYXBQcm92aWRlck5hbWUpIHtcclxuICAgICAgICBpZiAobWFwUHJvdmlkZXJOYW1lID09PSB2b2lkIDApIHsgbWFwUHJvdmlkZXJOYW1lID0gbnVsbDsgfVxyXG4gICAgICAgIHJldHVybiAobmV3IE5hdmlnYXRpb25TZXJ2aWNlKFwiTWVudU5vZGVLZXlcIikpLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRVcmw6IGN1cnJlbnRVcmwsXHJcbiAgICAgICAgICAgICAgICBtYXBQcm92aWRlck5hbWU6IG1hcFByb3ZpZGVyTmFtZSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE5hdmlnYXRpb25TZXJ2aWNlO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGUpKTtcblxuLyoqXHJcbiAqIERlc2NyaWJlcyByZWdpb25hbCBzZXR0aW5ncyBPRGFkYSBvYmplY3RcclxuICovXHJcbnZhciBSZWdpb25hbFNldHRpbmdzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFJlZ2lvbmFsU2V0dGluZ3MsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBSZWdpb25hbFNldHRpbmdzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWdpb25hbFNldHRpbmdzLnByb3RvdHlwZSwgXCJpbnN0YWxsZWRMYW5ndWFnZXNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGNvbGxlY3Rpb24gb2YgbGFuZ3VhZ2VzIHVzZWQgaW4gYSBzZXJ2ZXIgZmFybS5cclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbnN0YWxsZWRMYW5ndWFnZXModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVnaW9uYWxTZXR0aW5ncy5wcm90b3R5cGUsIFwiZ2xvYmFsSW5zdGFsbGVkTGFuZ3VhZ2VzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBjb2xsZWN0aW9uIG9mIGxhbmd1YWdlIHBhY2tzIHRoYXQgYXJlIGluc3RhbGxlZCBvbiB0aGUgc2VydmVyLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEluc3RhbGxlZExhbmd1YWdlcyh0aGlzLCBcImdsb2JhbGluc3RhbGxlZGxhbmd1YWdlc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWdpb25hbFNldHRpbmdzLnByb3RvdHlwZSwgXCJ0aW1lWm9uZVwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aW1lIHpvbmVcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lWm9uZSh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWdpb25hbFNldHRpbmdzLnByb3RvdHlwZSwgXCJ0aW1lWm9uZXNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGltZSB6b25lc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVab25lcyh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIFJlZ2lvbmFsU2V0dGluZ3MgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcInJlZ2lvbmFsc2V0dGluZ3NcIilcclxuICAgIF0sIFJlZ2lvbmFsU2V0dGluZ3MpO1xyXG4gICAgcmV0dXJuIFJlZ2lvbmFsU2V0dGluZ3M7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgaW5zdGFsbGVkIGxhbmd1YWdlcyBPRGFkYSBxdWVyaWFibGUgY29sbGVjdGlvblxyXG4gKi9cclxudmFyIEluc3RhbGxlZExhbmd1YWdlcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJbnN0YWxsZWRMYW5ndWFnZXMsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJbnN0YWxsZWRMYW5ndWFnZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgSW5zdGFsbGVkTGFuZ3VhZ2VzID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJpbnN0YWxsZWRsYW5ndWFnZXNcIilcclxuICAgIF0sIEluc3RhbGxlZExhbmd1YWdlcyk7XHJcbiAgICByZXR1cm4gSW5zdGFsbGVkTGFuZ3VhZ2VzO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgVGltZVpvbmUgT0RhZGEgb2JqZWN0XHJcbiAqL1xyXG52YXIgVGltZVpvbmUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVGltZVpvbmUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUaW1lWm9uZSgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBUaW1lWm9uZV8xID0gVGltZVpvbmU7XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYW4gTG9jYWwgVGltZSBieSBVVEMgVGltZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1dGNUaW1lIFVUQyBUaW1lIGFzIERhdGUgb3IgSVNPIFN0cmluZ1xyXG4gICAgICovXHJcbiAgICBUaW1lWm9uZS5wcm90b3R5cGUudXRjVG9Mb2NhbFRpbWUgPSBmdW5jdGlvbiAodXRjVGltZSkge1xyXG4gICAgICAgIHZhciBkYXRlSXNvU3RyaW5nO1xyXG4gICAgICAgIGlmICh0eXBlb2YgdXRjVGltZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBkYXRlSXNvU3RyaW5nID0gdXRjVGltZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGRhdGVJc29TdHJpbmcgPSB1dGNUaW1lLnRvSVNPU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFRpbWVab25lXzEsIFwidXRjdG9sb2NhbHRpbWUoJ1wiICsgZGF0ZUlzb1N0cmluZyArIFwiJylcIilcclxuICAgICAgICAgICAgLnBvc3RDb3JlKClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgeyByZXR1cm4gaE9QKHJlcywgXCJVVENUb0xvY2FsVGltZVwiKSA/IHJlcy5VVENUb0xvY2FsVGltZSA6IHJlczsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGFuIFVUQyBUaW1lIGJ5IExvY2FsIFRpbWVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbG9jYWxUaW1lIExvY2FsIFRpbWUgYXMgRGF0ZSBvciBJU08gU3RyaW5nXHJcbiAgICAgKi9cclxuICAgIFRpbWVab25lLnByb3RvdHlwZS5sb2NhbFRpbWVUb1VUQyA9IGZ1bmN0aW9uIChsb2NhbFRpbWUpIHtcclxuICAgICAgICB2YXIgZGF0ZUlzb1N0cmluZztcclxuICAgICAgICBpZiAodHlwZW9mIGxvY2FsVGltZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBkYXRlSXNvU3RyaW5nID0gbG9jYWxUaW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZGF0ZUlzb1N0cmluZyA9IGRhdGVBZGQobG9jYWxUaW1lLCBcIm1pbnV0ZVwiLCBsb2NhbFRpbWUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC0xKS50b0lTT1N0cmluZygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShUaW1lWm9uZV8xLCBcImxvY2FsdGltZXRvdXRjKCdcIiArIGRhdGVJc29TdHJpbmcgKyBcIicpXCIpXHJcbiAgICAgICAgICAgIC5wb3N0Q29yZSgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgcmV0dXJuIGhPUChyZXMsIFwiTG9jYWxUaW1lVG9VVENcIikgPyByZXMuTG9jYWxUaW1lVG9VVEMgOiByZXM7IH0pO1xyXG4gICAgfTtcclxuICAgIHZhciBUaW1lWm9uZV8xO1xyXG4gICAgVGltZVpvbmUgPSBUaW1lWm9uZV8xID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJ0aW1lem9uZVwiKVxyXG4gICAgXSwgVGltZVpvbmUpO1xyXG4gICAgcmV0dXJuIFRpbWVab25lO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIHRpbWUgem9uZXMgcXVlcmlhYmxlIGNvbGxlY3Rpb25cclxuICovXHJcbnZhciBUaW1lWm9uZXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVGltZVpvbmVzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVGltZVpvbmVzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFRpbWVab25lc18xID0gVGltZVpvbmVzO1xyXG4gICAgLy8gaHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9vZmZpY2UvamoyNDcwMDguYXNweCAtIHRpbWV6b25lcyBpZHNcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhbiBUaW1lWm9uZSBieSBpZFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgaW50ZWdlciBpZCBvZiB0aGUgdGltZXpvbmUgdG8gcmV0cmlldmVcclxuICAgICAqL1xyXG4gICAgVGltZVpvbmVzLnByb3RvdHlwZS5nZXRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgLy8gZG8gdGhlIHBvc3QgYW5kIG1lcmdlIHRoZSByZXN1bHQgaW50byBhIFRpbWVab25lIGluc3RhbmNlIHNvIHRoZSBkYXRhIGFuZCBtZXRob2RzIGFyZSBhdmFpbGFibGVcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShUaW1lWm9uZXNfMSwgXCJHZXRCeUlkKFwiICsgaWQgKyBcIilcIikucG9zdENvcmUoe30sIHNwT0RhdGFFbnRpdHkoVGltZVpvbmUpKTtcclxuICAgIH07XHJcbiAgICB2YXIgVGltZVpvbmVzXzE7XHJcbiAgICBUaW1lWm9uZXMgPSBUaW1lWm9uZXNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwidGltZXpvbmVzXCIpXHJcbiAgICBdLCBUaW1lWm9uZXMpO1xyXG4gICAgcmV0dXJuIFRpbWVab25lcztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xuXG52YXIgZnVuY3MgPSBuZXcgTWFwKFtcclxuICAgIFtcInRleHRcIiwgXCJRdWVyeXRleHRcIl0sXHJcbiAgICBbXCJ0ZW1wbGF0ZVwiLCBcIlF1ZXJ5VGVtcGxhdGVcIl0sXHJcbiAgICBbXCJzb3VyY2VJZFwiLCBcIlNvdXJjZUlkXCJdLFxyXG4gICAgW1widHJpbUR1cGxpY2F0ZXNJbmNsdWRlSWRcIiwgXCJcIl0sXHJcbiAgICBbXCJzdGFydFJvd1wiLCBcIlwiXSxcclxuICAgIFtcInJvd0xpbWl0XCIsIFwiXCJdLFxyXG4gICAgW1wicmFua2luZ01vZGVsSWRcIiwgXCJcIl0sXHJcbiAgICBbXCJyb3dzUGVyUGFnZVwiLCBcIlwiXSxcclxuICAgIFtcInNlbGVjdFByb3BlcnRpZXNcIiwgXCJcIl0sXHJcbiAgICBbXCJjdWx0dXJlXCIsIFwiXCJdLFxyXG4gICAgW1widGltZVpvbmVJZFwiLCBcIlwiXSxcclxuICAgIFtcInJlZmluZW1lbnRGaWx0ZXJzXCIsIFwiXCJdLFxyXG4gICAgW1wicmVmaW5lcnNcIiwgXCJcIl0sXHJcbiAgICBbXCJoaWRkZW5Db25zdHJhaW50c1wiLCBcIlwiXSxcclxuICAgIFtcInNvcnRMaXN0XCIsIFwiXCJdLFxyXG4gICAgW1widGltZW91dFwiLCBcIlwiXSxcclxuICAgIFtcImhpdGhpZ2hsaWdodGVkUHJvcGVydGllc1wiLCBcIlwiXSxcclxuICAgIFtcImNsaWVudFR5cGVcIiwgXCJcIl0sXHJcbiAgICBbXCJwZXJzb25hbGl6YXRpb25EYXRhXCIsIFwiXCJdLFxyXG4gICAgW1wicmVzdWx0c1VSTFwiLCBcIlwiXSxcclxuICAgIFtcInF1ZXJ5VGFnXCIsIFwiXCJdLFxyXG4gICAgW1wicHJvcGVydGllc1wiLCBcIlwiXSxcclxuICAgIFtcInF1ZXJ5VGVtcGxhdGVQcm9wZXJ0aWVzVXJsXCIsIFwiXCJdLFxyXG4gICAgW1wicmVvcmRlcmluZ1J1bGVzXCIsIFwiXCJdLFxyXG4gICAgW1wiaGl0SGlnaGxpZ2h0ZWRNdWx0aXZhbHVlUHJvcGVydHlMaW1pdFwiLCBcIlwiXSxcclxuICAgIFtcImNvbGxhcHNlU3BlY2lmaWNhdGlvblwiLCBcIlwiXSxcclxuICAgIFtcInVpTGFuZ3VhZ2VcIiwgXCJcIl0sXHJcbiAgICBbXCJkZXNpcmVkU25pcHBldExlbmd0aFwiLCBcIlwiXSxcclxuICAgIFtcIm1heFNuaXBwZXRMZW5ndGhcIiwgXCJcIl0sXHJcbiAgICBbXCJzdW1tYXJ5TGVuZ3RoXCIsIFwiXCJdLFxyXG5dKTtcclxudmFyIHByb3BzID0gbmV3IE1hcChbXSk7XHJcbmZ1bmN0aW9uIHRvUHJvcENhc2Uoc3RyKSB7XHJcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL14oLikvLCBmdW5jdGlvbiAoJDEpIHsgcmV0dXJuICQxLnRvVXBwZXJDYXNlKCk7IH0pO1xyXG59XHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBTZWFyY2hRdWVyeUJ1aWxkZXJcclxuICpcclxuICogQHBhcmFtIHF1ZXJ5VGV4dCBJbml0aWFsIHF1ZXJ5IHRleHRcclxuICogQHBhcmFtIF9xdWVyeSBBbnkgaW5pdGlhbCBxdWVyeSBjb25maWd1cmF0aW9uXHJcbiAqL1xyXG5mdW5jdGlvbiBTZWFyY2hRdWVyeUJ1aWxkZXIocXVlcnlUZXh0LCBfcXVlcnkpIHtcclxuICAgIGlmIChxdWVyeVRleHQgPT09IHZvaWQgMCkgeyBxdWVyeVRleHQgPSBcIlwiOyB9XHJcbiAgICBpZiAoX3F1ZXJ5ID09PSB2b2lkIDApIHsgX3F1ZXJ5ID0ge307IH1cclxuICAgIHJldHVybiBuZXcgUHJveHkoe1xyXG4gICAgICAgIHF1ZXJ5OiBPYmplY3QuYXNzaWduKHtcclxuICAgICAgICAgICAgUXVlcnl0ZXh0OiBxdWVyeVRleHQsXHJcbiAgICAgICAgfSwgX3F1ZXJ5KSxcclxuICAgIH0sIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uIChzZWxmLCBwcm9wZXJ0eUtleSwgcHJveHkpIHtcclxuICAgICAgICAgICAgdmFyIHBrID0gcHJvcGVydHlLZXkudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgaWYgKHBrID09PSBcInRvU2VhcmNoUXVlcnlcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlbGYucXVlcnk7IH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGZ1bmNzLmhhcyhwaykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVbX2ldID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcHBlZFBrID0gZnVuY3MuZ2V0KHBrKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnF1ZXJ5W21hcHBlZFBrLmxlbmd0aCA+IDAgPyBtYXBwZWRQayA6IHRvUHJvcENhc2UocGspXSA9IHZhbHVlLmxlbmd0aCA+IDEgPyB2YWx1ZSA6IHZhbHVlWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm94eTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHByb3BLZXkgPSBwcm9wcy5oYXMocGspID8gcHJvcHMuZ2V0KHBrKSA6IHRvUHJvcENhc2UocGspO1xyXG4gICAgICAgICAgICBzZWxmLnF1ZXJ5W3Byb3BLZXldID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHByb3h5O1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxufVxyXG4vKipcclxuICogRGVzY3JpYmVzIHRoZSBzZWFyY2ggQVBJXHJcbiAqXHJcbiAqL1xyXG52YXIgU2VhcmNoID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNlYXJjaCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNlYXJjaCgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEByZXR1cm5zIFByb21pc2VcclxuICAgICAqL1xyXG4gICAgU2VhcmNoLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24gKHF1ZXJ5SW5pdCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5wYXJzZVF1ZXJ5KHF1ZXJ5SW5pdCk7XHJcbiAgICAgICAgdmFyIGZvcm1hdHRlZEJvZHk7XHJcbiAgICAgICAgZm9ybWF0dGVkQm9keSA9IHF1ZXJ5O1xyXG4gICAgICAgIGlmIChmb3JtYXR0ZWRCb2R5LlNlbGVjdFByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgZm9ybWF0dGVkQm9keS5TZWxlY3RQcm9wZXJ0aWVzID0gdGhpcy5maXh1cFByb3AocXVlcnkuU2VsZWN0UHJvcGVydGllcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmb3JtYXR0ZWRCb2R5LlJlZmluZW1lbnRGaWx0ZXJzKSB7XHJcbiAgICAgICAgICAgIGZvcm1hdHRlZEJvZHkuUmVmaW5lbWVudEZpbHRlcnMgPSB0aGlzLmZpeHVwUHJvcChxdWVyeS5SZWZpbmVtZW50RmlsdGVycyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmb3JtYXR0ZWRCb2R5LlNvcnRMaXN0KSB7XHJcbiAgICAgICAgICAgIGZvcm1hdHRlZEJvZHkuU29ydExpc3QgPSB0aGlzLmZpeHVwUHJvcChxdWVyeS5Tb3J0TGlzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmb3JtYXR0ZWRCb2R5LkhpdGhpZ2hsaWdodGVkUHJvcGVydGllcykge1xyXG4gICAgICAgICAgICBmb3JtYXR0ZWRCb2R5LkhpdGhpZ2hsaWdodGVkUHJvcGVydGllcyA9IHRoaXMuZml4dXBQcm9wKHF1ZXJ5LkhpdEhpZ2hsaWdodGVkUHJvcGVydGllcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmb3JtYXR0ZWRCb2R5LlJlb3JkZXJpbmdSdWxlcykge1xyXG4gICAgICAgICAgICBmb3JtYXR0ZWRCb2R5LlJlb3JkZXJpbmdSdWxlcyA9IHRoaXMuZml4dXBQcm9wKHF1ZXJ5LlJlb3JkZXJpbmdSdWxlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmb3JtYXR0ZWRCb2R5LlByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgZm9ybWF0dGVkQm9keS5Qcm9wZXJ0aWVzID0gdGhpcy5maXh1cFByb3AocXVlcnkuUHJvcGVydGllcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyh7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGV4dGVuZChtZXRhZGF0YShcIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLlNlYXJjaC5SRVNULlNlYXJjaFJlcXVlc3RcIiksIGZvcm1hdHRlZEJvZHkpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIGlmIHdlIGFyZSB1c2luZyBjYWNoaW5nIHdpdGggdGhpcyBzZWFyY2ggcmVxdWVzdCwgdGhlbiB3ZSBuZWVkIHRvIGhhbmRsZSBzb21lIHdvcmsgdXBmcm9udCB0byBlbmFibGUgdGhhdFxyXG4gICAgICAgIGlmICh0aGlzLl91c2VDYWNoaW5nKSB7XHJcbiAgICAgICAgICAgIC8vIGZvcmNlIHVzZSBvZiB0aGUgY2FjaGUgZm9yIHRoaXMgcmVxdWVzdCBpZiAudXNpbmdDYWNoaW5nIHdhcyBjYWxsZWRcclxuICAgICAgICAgICAgdGhpcy5fZm9yY2VDYWNoaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gYmVjYXVzZSBhbGwgdGhlIHJlcXVlc3RzIHVzZSB0aGUgc2FtZSB1cmwgdGhleSB3b3VsZCBjb2xsaWRlIGluIHRoZSBjYWNoZSB3ZSB1c2UgYSBzcGVjaWFsIGtleVxyXG4gICAgICAgICAgICB2YXIgY2FjaGVLZXkgPSBcIlBuUGpzLlNlYXJjaFdpdGhDYWNoaW5nKFwiICsgZ2V0SGFzaENvZGUocG9zdEJvZHkpICsgXCIpXCI7XHJcbiAgICAgICAgICAgIGlmIChvYmplY3REZWZpbmVkTm90TnVsbCh0aGlzLl9jYWNoaW5nT3B0aW9ucykpIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIG91ciBrZXkgZW5kcyBpbiB0aGUgcG9zdHF1ZXJ5IHVybCB3ZSBvdmVyd3JpdGUgaXRcclxuICAgICAgICAgICAgICAgIGlmICgvXFwvX2FwaVxcL3NlYXJjaFxcL3Bvc3RxdWVyeSQvaS50ZXN0KHRoaXMuX2NhY2hpbmdPcHRpb25zLmtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYWNoaW5nT3B0aW9ucy5rZXkgPSBjYWNoZUtleTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NhY2hpbmdPcHRpb25zID0gbmV3IENhY2hpbmdPcHRpb25zKGNhY2hlS2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIG5ldyBTZWFyY2hSZXN1bHRzKGRhdGEsIF90aGlzLnRvVXJsKCksIHF1ZXJ5KTsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBGaXhlcyB1cCBwcm9wZXJ0aWVzIHRoYXQgZXhwZWN0IHRvIGNvbnNpc3Qgb2YgYSBcInJlc3VsdHNcIiBjb2xsZWN0aW9uIHdoZW4gbmVlZGVkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHByb3AgcHJvcGVydHkgdG8gZml4dXAgZm9yIGNvbnRhaW5lciBzdHJ1Y3RcclxuICAgICAqL1xyXG4gICAgU2VhcmNoLnByb3RvdHlwZS5maXh1cFByb3AgPSBmdW5jdGlvbiAocHJvcCkge1xyXG4gICAgICAgIHJldHVybiBoT1AocHJvcCwgXCJyZXN1bHRzXCIpID8gcHJvcCA6IHsgcmVzdWx0czogcHJvcCB9O1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVHJhbnNsYXRlcyBvbmUgb2YgdGhlIHF1ZXJ5IGluaXRpYWxpemVycyBpbnRvIGEgU2VhcmNoUXVlcnkgaW5zdGFuY2VcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcXVlcnlcclxuICAgICAqL1xyXG4gICAgU2VhcmNoLnByb3RvdHlwZS5wYXJzZVF1ZXJ5ID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcbiAgICAgICAgdmFyIGZpbmFsUXVlcnk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBxdWVyeSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBmaW5hbFF1ZXJ5ID0geyBRdWVyeXRleHQ6IHF1ZXJ5IH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHF1ZXJ5LnRvU2VhcmNoUXVlcnkpIHtcclxuICAgICAgICAgICAgZmluYWxRdWVyeSA9IHF1ZXJ5LnRvU2VhcmNoUXVlcnkoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGZpbmFsUXVlcnkgPSBxdWVyeTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZpbmFsUXVlcnk7XHJcbiAgICB9O1xyXG4gICAgU2VhcmNoID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJfYXBpL3NlYXJjaC9wb3N0cXVlcnlcIilcclxuICAgIF0sIFNlYXJjaCk7XHJcbiAgICByZXR1cm4gU2VhcmNoO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIHRoZSBTZWFyY2hSZXN1bHRzIGNsYXNzLCB3aGljaCByZXR1cm5zIHRoZSBmb3JtYXR0ZWQgYW5kIHJhdyB2ZXJzaW9uIG9mIHRoZSBxdWVyeSByZXNwb25zZVxyXG4gKi9cclxudmFyIFNlYXJjaFJlc3VsdHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFNlYXJjaFJlc3VsdCBjbGFzc1xyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gU2VhcmNoUmVzdWx0cyhyYXdSZXNwb25zZSwgX3VybCwgX3F1ZXJ5LCBfcmF3LCBfcHJpbWFyeSkge1xyXG4gICAgICAgIGlmIChfcmF3ID09PSB2b2lkIDApIHsgX3JhdyA9IG51bGw7IH1cclxuICAgICAgICBpZiAoX3ByaW1hcnkgPT09IHZvaWQgMCkgeyBfcHJpbWFyeSA9IG51bGw7IH1cclxuICAgICAgICB0aGlzLl91cmwgPSBfdXJsO1xyXG4gICAgICAgIHRoaXMuX3F1ZXJ5ID0gX3F1ZXJ5O1xyXG4gICAgICAgIHRoaXMuX3JhdyA9IF9yYXc7XHJcbiAgICAgICAgdGhpcy5fcHJpbWFyeSA9IF9wcmltYXJ5O1xyXG4gICAgICAgIHRoaXMuX3JhdyA9IHJhd1Jlc3BvbnNlLnBvc3RxdWVyeSA/IHJhd1Jlc3BvbnNlLnBvc3RxdWVyeSA6IHJhd1Jlc3BvbnNlO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlYXJjaFJlc3VsdHMucHJvdG90eXBlLCBcIkVsYXBzZWRUaW1lXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuUmF3U2VhcmNoUmVzdWx0cy5FbGFwc2VkVGltZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWFyY2hSZXN1bHRzLnByb3RvdHlwZSwgXCJSb3dDb3VudFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLlJhd1NlYXJjaFJlc3VsdHMuUHJpbWFyeVF1ZXJ5UmVzdWx0LlJlbGV2YW50UmVzdWx0cy5Sb3dDb3VudDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWFyY2hSZXN1bHRzLnByb3RvdHlwZSwgXCJUb3RhbFJvd3NcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5SYXdTZWFyY2hSZXN1bHRzLlByaW1hcnlRdWVyeVJlc3VsdC5SZWxldmFudFJlc3VsdHMuVG90YWxSb3dzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlYXJjaFJlc3VsdHMucHJvdG90eXBlLCBcIlRvdGFsUm93c0luY2x1ZGluZ0R1cGxpY2F0ZXNcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5SYXdTZWFyY2hSZXN1bHRzLlByaW1hcnlRdWVyeVJlc3VsdC5SZWxldmFudFJlc3VsdHMuVG90YWxSb3dzSW5jbHVkaW5nRHVwbGljYXRlcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWFyY2hSZXN1bHRzLnByb3RvdHlwZSwgXCJSYXdTZWFyY2hSZXN1bHRzXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JhdztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWFyY2hSZXN1bHRzLnByb3RvdHlwZSwgXCJQcmltYXJ5U2VhcmNoUmVzdWx0c1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wcmltYXJ5ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmltYXJ5ID0gdGhpcy5mb3JtYXRTZWFyY2hSZXN1bHRzKHRoaXMuX3Jhdy5QcmltYXJ5UXVlcnlSZXN1bHQuUmVsZXZhbnRSZXN1bHRzLlRhYmxlLlJvd3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcmltYXJ5O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgcGFnZSBvZiByZXN1bHRzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBhZ2VOdW1iZXIgSW5kZXggb2YgdGhlIHBhZ2UgdG8gcmV0dXJuLiBVc2VkIHRvIGRldGVybWluZSBTdGFydFJvd1xyXG4gICAgICogQHBhcmFtIHBhZ2VTaXplIE9wdGlvbmFsLCBpdGVtcyBwZXIgcGFnZSAoZGVmYXVsdCA9IDEwKVxyXG4gICAgICovXHJcbiAgICBTZWFyY2hSZXN1bHRzLnByb3RvdHlwZS5nZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XHJcbiAgICAgICAgLy8gaWYgd2UgZ290IGFsbCB0aGUgYXZhaWxhYmxlIHJvd3Mgd2UgZG9uJ3QgaGF2ZSBhbm90aGVyIHBhZ2VcclxuICAgICAgICBpZiAodGhpcy5Ub3RhbFJvd3MgPCB0aGlzLlJvd0NvdW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGlmIHBhZ2VTaXplIGlzIHN1cHBsaWVkLCB0aGVuIHdlIHVzZSB0aGF0IHJlZ2FyZGxlc3Mgb2YgYW55IHByZXZpb3VzIHZhbHVlc1xyXG4gICAgICAgIC8vIG90aGVyd2lzZSBnZXQgdGhlIHByZXZpb3VzIFJvd0xpbWl0IG9yIGRlZmF1bHQgdG8gMTBcclxuICAgICAgICB2YXIgcm93cyA9IHBhZ2VTaXplICE9PSB1bmRlZmluZWQgPyBwYWdlU2l6ZSA6IGhPUCh0aGlzLl9xdWVyeSwgXCJSb3dMaW1pdFwiKSA/IHRoaXMuX3F1ZXJ5LlJvd0xpbWl0IDogMTA7XHJcbiAgICAgICAgdmFyIHF1ZXJ5ID0gZXh0ZW5kKHRoaXMuX3F1ZXJ5LCB7XHJcbiAgICAgICAgICAgIFJvd0xpbWl0OiByb3dzLFxyXG4gICAgICAgICAgICBTdGFydFJvdzogcm93cyAqIChwYWdlTnVtYmVyIC0gMSksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gd2UgaGF2ZSByZWFjaGVkIHRoZSBlbmRcclxuICAgICAgICBpZiAocXVlcnkuU3RhcnRSb3cgPiB0aGlzLlRvdGFsUm93cykge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2VhcmNoID0gbmV3IFNlYXJjaCh0aGlzLl91cmwsIG51bGwpO1xyXG4gICAgICAgIHJldHVybiBzZWFyY2guZXhlY3V0ZShxdWVyeSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBGb3JtYXRzIGEgc2VhcmNoIHJlc3VsdHMgYXJyYXlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcmF3UmVzdWx0cyBUaGUgYXJyYXkgdG8gcHJvY2Vzc1xyXG4gICAgICovXHJcbiAgICBTZWFyY2hSZXN1bHRzLnByb3RvdHlwZS5mb3JtYXRTZWFyY2hSZXN1bHRzID0gZnVuY3Rpb24gKHJhd1Jlc3VsdHMpIHtcclxuICAgICAgICB2YXIgcmVzdWx0cyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIHZhciB0ZW1wUmVzdWx0cyA9IHJhd1Jlc3VsdHMucmVzdWx0cyA/IHJhd1Jlc3VsdHMucmVzdWx0cyA6IHJhd1Jlc3VsdHM7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCB0ZW1wUmVzdWx0c18xID0gdGVtcFJlc3VsdHM7IF9pIDwgdGVtcFJlc3VsdHNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIHRlbXBSZXN1bHQgPSB0ZW1wUmVzdWx0c18xW19pXTtcclxuICAgICAgICAgICAgdmFyIGNlbGxzID0gdGVtcFJlc3VsdC5DZWxscy5yZXN1bHRzID8gdGVtcFJlc3VsdC5DZWxscy5yZXN1bHRzIDogdGVtcFJlc3VsdC5DZWxscztcclxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGNlbGxzLnJlZHVjZShmdW5jdGlvbiAocmVzLCBjZWxsKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzLCBjZWxsLktleSwge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2VsbC5WYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgICAgIH0sIHt9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTZWFyY2hSZXN1bHRzO1xyXG59KCkpO1xyXG4vKipcclxuICogZGVmaW5lcyB0aGUgU29ydERpcmVjdGlvbiBlbnVtXHJcbiAqL1xyXG52YXIgU29ydERpcmVjdGlvbjtcclxuKGZ1bmN0aW9uIChTb3J0RGlyZWN0aW9uKSB7XHJcbiAgICBTb3J0RGlyZWN0aW9uW1NvcnREaXJlY3Rpb25bXCJBc2NlbmRpbmdcIl0gPSAwXSA9IFwiQXNjZW5kaW5nXCI7XHJcbiAgICBTb3J0RGlyZWN0aW9uW1NvcnREaXJlY3Rpb25bXCJEZXNjZW5kaW5nXCJdID0gMV0gPSBcIkRlc2NlbmRpbmdcIjtcclxuICAgIFNvcnREaXJlY3Rpb25bU29ydERpcmVjdGlvbltcIkZRTEZvcm11bGFcIl0gPSAyXSA9IFwiRlFMRm9ybXVsYVwiO1xyXG59KShTb3J0RGlyZWN0aW9uIHx8IChTb3J0RGlyZWN0aW9uID0ge30pKTtcclxuLyoqXHJcbiAqIGRlZmluZXMgdGhlIFJlb3JkZXJpbmdSdWxlTWF0Y2hUeXBlICBlbnVtXHJcbiAqL1xyXG52YXIgUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGU7XHJcbihmdW5jdGlvbiAoUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGUpIHtcclxuICAgIFJlb3JkZXJpbmdSdWxlTWF0Y2hUeXBlW1Jlb3JkZXJpbmdSdWxlTWF0Y2hUeXBlW1wiUmVzdWx0Q29udGFpbnNLZXl3b3JkXCJdID0gMF0gPSBcIlJlc3VsdENvbnRhaW5zS2V5d29yZFwiO1xyXG4gICAgUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbXCJUaXRsZUNvbnRhaW5zS2V5d29yZFwiXSA9IDFdID0gXCJUaXRsZUNvbnRhaW5zS2V5d29yZFwiO1xyXG4gICAgUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbXCJUaXRsZU1hdGNoZXNLZXl3b3JkXCJdID0gMl0gPSBcIlRpdGxlTWF0Y2hlc0tleXdvcmRcIjtcclxuICAgIFJlb3JkZXJpbmdSdWxlTWF0Y2hUeXBlW1Jlb3JkZXJpbmdSdWxlTWF0Y2hUeXBlW1wiVXJsU3RhcnRzV2l0aFwiXSA9IDNdID0gXCJVcmxTdGFydHNXaXRoXCI7XHJcbiAgICBSZW9yZGVyaW5nUnVsZU1hdGNoVHlwZVtSZW9yZGVyaW5nUnVsZU1hdGNoVHlwZVtcIlVybEV4YWN0bHlNYXRjaGVzXCJdID0gNF0gPSBcIlVybEV4YWN0bHlNYXRjaGVzXCI7XHJcbiAgICBSZW9yZGVyaW5nUnVsZU1hdGNoVHlwZVtSZW9yZGVyaW5nUnVsZU1hdGNoVHlwZVtcIkNvbnRlbnRUeXBlSXNcIl0gPSA1XSA9IFwiQ29udGVudFR5cGVJc1wiO1xyXG4gICAgUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbXCJGaWxlRXh0ZW5zaW9uTWF0Y2hlc1wiXSA9IDZdID0gXCJGaWxlRXh0ZW5zaW9uTWF0Y2hlc1wiO1xyXG4gICAgUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGVbXCJSZXN1bHRIYXNUYWdcIl0gPSA3XSA9IFwiUmVzdWx0SGFzVGFnXCI7XHJcbiAgICBSZW9yZGVyaW5nUnVsZU1hdGNoVHlwZVtSZW9yZGVyaW5nUnVsZU1hdGNoVHlwZVtcIk1hbnVhbENvbmRpdGlvblwiXSA9IDhdID0gXCJNYW51YWxDb25kaXRpb25cIjtcclxufSkoUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGUgfHwgKFJlb3JkZXJpbmdSdWxlTWF0Y2hUeXBlID0ge30pKTtcclxuLyoqXHJcbiAqIFNwZWNpZmllcyB0aGUgdHlwZSB2YWx1ZSBmb3IgdGhlIHByb3BlcnR5XHJcbiAqL1xyXG52YXIgUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZTtcclxuKGZ1bmN0aW9uIChRdWVyeVByb3BlcnR5VmFsdWVUeXBlKSB7XHJcbiAgICBRdWVyeVByb3BlcnR5VmFsdWVUeXBlW1F1ZXJ5UHJvcGVydHlWYWx1ZVR5cGVbXCJOb25lXCJdID0gMF0gPSBcIk5vbmVcIjtcclxuICAgIFF1ZXJ5UHJvcGVydHlWYWx1ZVR5cGVbUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZVtcIlN0cmluZ1R5cGVcIl0gPSAxXSA9IFwiU3RyaW5nVHlwZVwiO1xyXG4gICAgUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZVtRdWVyeVByb3BlcnR5VmFsdWVUeXBlW1wiSW50MzJUeXBlXCJdID0gMl0gPSBcIkludDMyVHlwZVwiO1xyXG4gICAgUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZVtRdWVyeVByb3BlcnR5VmFsdWVUeXBlW1wiQm9vbGVhblR5cGVcIl0gPSAzXSA9IFwiQm9vbGVhblR5cGVcIjtcclxuICAgIFF1ZXJ5UHJvcGVydHlWYWx1ZVR5cGVbUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZVtcIlN0cmluZ0FycmF5VHlwZVwiXSA9IDRdID0gXCJTdHJpbmdBcnJheVR5cGVcIjtcclxuICAgIFF1ZXJ5UHJvcGVydHlWYWx1ZVR5cGVbUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZVtcIlVuU3VwcG9ydGVkVHlwZVwiXSA9IDVdID0gXCJVblN1cHBvcnRlZFR5cGVcIjtcclxufSkoUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZSB8fCAoUXVlcnlQcm9wZXJ0eVZhbHVlVHlwZSA9IHt9KSk7XHJcbnZhciBTZWFyY2hCdWlsdEluU291cmNlSWQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTZWFyY2hCdWlsdEluU291cmNlSWQoKSB7XHJcbiAgICB9XHJcbiAgICBTZWFyY2hCdWlsdEluU291cmNlSWQuRG9jdW1lbnRzID0gXCJlN2VjOGNlZS1kZWQ4LTQzYzktYmViNS00MzZiNTRiMzFlODRcIjtcclxuICAgIFNlYXJjaEJ1aWx0SW5Tb3VyY2VJZC5JdGVtc01hdGNoaW5nQ29udGVudFR5cGUgPSBcIjVkYzlmNTAzLTgwMWUtNGNlZC04YTJjLTVkMTIzNzEzMjQxOVwiO1xyXG4gICAgU2VhcmNoQnVpbHRJblNvdXJjZUlkLkl0ZW1zTWF0Y2hpbmdUYWcgPSBcImUxMzI3YjljLTJiOGMtNGIyMy05OWM5LTM3MzBjYjI5YzNmN1wiO1xyXG4gICAgU2VhcmNoQnVpbHRJblNvdXJjZUlkLkl0ZW1zUmVsYXRlZFRvQ3VycmVudFVzZXIgPSBcIjQ4ZmVjNDJlLTRhOTItNDhjZS04MzYzLWMyNzAzYTQwZTY3ZFwiO1xyXG4gICAgU2VhcmNoQnVpbHRJblNvdXJjZUlkLkl0ZW1zV2l0aFNhbWVLZXl3b3JkQXNUaGlzSXRlbSA9IFwiNWMwNjkyODgtMWQxNy00NTRhLThhYzYtOWM2NDJhMDY1ZjQ4XCI7XHJcbiAgICBTZWFyY2hCdWlsdEluU291cmNlSWQuTG9jYWxQZW9wbGVSZXN1bHRzID0gXCJiMDlhNzk5MC0wNWVhLTRhZjktODFlZi1lZGZhYjE2YzRlMzFcIjtcclxuICAgIFNlYXJjaEJ1aWx0SW5Tb3VyY2VJZC5Mb2NhbFJlcG9ydHNBbmREYXRhUmVzdWx0cyA9IFwiMjAzZmJhMzYtMjc2My00MDYwLTk5MzEtOTExYWM4YzA1ODNiXCI7XHJcbiAgICBTZWFyY2hCdWlsdEluU291cmNlSWQuTG9jYWxTaGFyZVBvaW50UmVzdWx0cyA9IFwiODQxM2NkMzktMjE1Ni00ZTAwLWI1NGQtMTFlZmQ5YWJkYjg5XCI7XHJcbiAgICBTZWFyY2hCdWlsdEluU291cmNlSWQuTG9jYWxWaWRlb1Jlc3VsdHMgPSBcIjc4Yjc5M2NlLTc5NTYtNDY2OS1hYTNiLTQ1MWZjNWRlZmViZlwiO1xyXG4gICAgU2VhcmNoQnVpbHRJblNvdXJjZUlkLlBhZ2VzID0gXCI1ZTM0NTc4ZS00ZDA4LTRlZGMtOGJmMy0wMDJhY2YzY2RiY2NcIjtcclxuICAgIFNlYXJjaEJ1aWx0SW5Tb3VyY2VJZC5QaWN0dXJlcyA9IFwiMzg0MDNjOGMtMzk3NS00MWE4LTgyNmUtNzE3ZjJkNDE1NjhhXCI7XHJcbiAgICBTZWFyY2hCdWlsdEluU291cmNlSWQuUG9wdWxhciA9IFwiOTdjNzFkYjEtNThjZS00ODkxLThiNjQtNTg1YmMyMzI2YzEyXCI7XHJcbiAgICBTZWFyY2hCdWlsdEluU291cmNlSWQuUmVjZW50bHlDaGFuZ2VkSXRlbXMgPSBcImJhNjNiYmFlLWZhOWMtNDJjMC1iMDI3LTlhODc4ZjE2NTU3Y1wiO1xyXG4gICAgU2VhcmNoQnVpbHRJblNvdXJjZUlkLlJlY29tbWVuZGVkSXRlbXMgPSBcImVjNjc1MjUyLTE0ZmEtNGZiZS04NGRkLThkMDk4ZWQ3NDE4MVwiO1xyXG4gICAgU2VhcmNoQnVpbHRJblNvdXJjZUlkLldpa2kgPSBcIjk0NzliZjg1LWUyNTctNDMxOC1iNWE4LTgxYTE4MGY1ZmFhMVwiO1xyXG4gICAgcmV0dXJuIFNlYXJjaEJ1aWx0SW5Tb3VyY2VJZDtcclxufSgpKTtcblxudmFyIFNlYXJjaFN1Z2dlc3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2VhcmNoU3VnZ2VzdCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNlYXJjaFN1Z2dlc3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgU2VhcmNoU3VnZ2VzdC5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uIChxdWVyeSkge1xyXG4gICAgICAgIHRoaXMubWFwUXVlcnlUb1F1ZXJ5U3RyaW5nKHF1ZXJ5KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXQoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB2YXIgbWFwcGVyID0gaE9QKHJlc3BvbnNlLCBcInN1Z2dlc3RcIikgPyBmdW5jdGlvbiAocykgeyByZXR1cm4gcmVzcG9uc2Uuc3VnZ2VzdFtzXS5yZXN1bHRzOyB9IDogZnVuY3Rpb24gKHMpIHsgcmV0dXJuIHJlc3BvbnNlW3NdOyB9O1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgUGVvcGxlTmFtZXM6IG1hcHBlcihcIlBlb3BsZU5hbWVzXCIpLFxyXG4gICAgICAgICAgICAgICAgUGVyc29uYWxSZXN1bHRzOiBtYXBwZXIoXCJQZXJzb25hbFJlc3VsdHNcIiksXHJcbiAgICAgICAgICAgICAgICBRdWVyaWVzOiBtYXBwZXIoXCJRdWVyaWVzXCIpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFNlYXJjaFN1Z2dlc3QucHJvdG90eXBlLm1hcFF1ZXJ5VG9RdWVyeVN0cmluZyA9IGZ1bmN0aW9uIChxdWVyeSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHNldFByb3AgPSBmdW5jdGlvbiAocSkgeyByZXR1cm4gZnVuY3Rpb24gKGNoZWNrUHJvcCkgeyByZXR1cm4gZnVuY3Rpb24gKHNwKSB7XHJcbiAgICAgICAgICAgIGlmIChoT1AocSwgY2hlY2tQcm9wKSkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucXVlcnkuc2V0KHNwLCBxW2NoZWNrUHJvcF0udG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9OyB9OyB9O1xyXG4gICAgICAgIHRoaXMucXVlcnkuc2V0KFwicXVlcnl0ZXh0XCIsIFwiJ1wiICsgcXVlcnkucXVlcnl0ZXh0ICsgXCInXCIpO1xyXG4gICAgICAgIHZhciBxdWVyeVNldHRlciA9IHNldFByb3AocXVlcnkpO1xyXG4gICAgICAgIHF1ZXJ5U2V0dGVyKFwiY291bnRcIikoXCJpbnVtYmVyb2ZxdWVyeXN1Z2dlc3Rpb25zXCIpO1xyXG4gICAgICAgIHF1ZXJ5U2V0dGVyKFwicGVyc29uYWxDb3VudFwiKShcImludW1iZXJvZnJlc3VsdHN1Z2dlc3Rpb25zXCIpO1xyXG4gICAgICAgIHF1ZXJ5U2V0dGVyKFwicHJlUXVlcnlcIikoXCJmcHJlcXVlcnlzdWdnZXN0aW9uc1wiKTtcclxuICAgICAgICBxdWVyeVNldHRlcihcImhpdEhpZ2hsaWdodGluZ1wiKShcImZoaXRoaWdobGlnaHRpbmdcIik7XHJcbiAgICAgICAgcXVlcnlTZXR0ZXIoXCJjYXBpdGFsaXplXCIpKFwiZmNhcGl0YWxpemVmaXJzdGxldHRlcnNcIik7XHJcbiAgICAgICAgcXVlcnlTZXR0ZXIoXCJjdWx0dXJlXCIpKFwiY3VsdHVyZVwiKTtcclxuICAgICAgICBxdWVyeVNldHRlcihcInN0ZW1taW5nXCIpKFwiZW5hYmxlc3RlbW1pbmdcIik7XHJcbiAgICAgICAgcXVlcnlTZXR0ZXIoXCJpbmNsdWRlUGVvcGxlXCIpKFwic2hvd3Blb3BsZW5hbWVzdWdnZXN0aW9uc1wiKTtcclxuICAgICAgICBxdWVyeVNldHRlcihcInF1ZXJ5UnVsZXNcIikoXCJlbmFibGVxdWVyeXJ1bGVzXCIpO1xyXG4gICAgICAgIHF1ZXJ5U2V0dGVyKFwicHJlZml4TWF0Y2hcIikoXCJmcHJlZml4bWF0Y2hhbGx0ZXJtc1wiKTtcclxuICAgIH07XHJcbiAgICBTZWFyY2hTdWdnZXN0ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJfYXBpL3NlYXJjaC9zdWdnZXN0XCIpXHJcbiAgICBdLCBTZWFyY2hTdWdnZXN0KTtcclxuICAgIHJldHVybiBTZWFyY2hTdWdnZXN0O1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xuXG4vKipcclxuICogRGVzY3JpYmVzIGEgY29sbGVjdGlvbiBvZiBMaXN0IG9iamVjdHNcclxuICpcclxuICovXHJcbnZhciBGZWF0dXJlcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhGZWF0dXJlcywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEZlYXR1cmVzKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIEZlYXR1cmVzXzEgPSBGZWF0dXJlcztcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBsaXN0IHRvIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBJZCBvZiB0aGUgZmVhdHVyZSAoR1VJRClcclxuICAgICAqIEBwYXJhbSBmb3JjZSBJZiB0cnVlIHRoZSBmZWF0dXJlIGFjdGl2YXRpb24gd2lsbCBiZSBmb3JjZWRcclxuICAgICAqL1xyXG4gICAgRmVhdHVyZXMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChpZCwgZm9yY2UpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmIChmb3JjZSA9PT0gdm9pZCAwKSB7IGZvcmNlID0gZmFsc2U7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGZWF0dXJlc18xLCBcImFkZFwiKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7XHJcbiAgICAgICAgICAgICAgICBmZWF0ZGVmU2NvcGU6IDAsXHJcbiAgICAgICAgICAgICAgICBmZWF0dXJlSWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgZm9yY2U6IGZvcmNlLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICAgICAgZmVhdHVyZTogX3RoaXMuZ2V0QnlJZChpZCksXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgbGlzdCBmcm9tIHRoZSBjb2xsZWN0aW9uIGJ5IGd1aWQgaWRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaWQgVGhlIElkIG9mIHRoZSBmZWF0dXJlIChHVUlEKVxyXG4gICAgICovXHJcbiAgICBGZWF0dXJlcy5wcm90b3R5cGUuZ2V0QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciBmZWF0dXJlID0gbmV3IEZlYXR1cmUodGhpcyk7XHJcbiAgICAgICAgZmVhdHVyZS5jb25jYXQoXCIoJ1wiICsgaWQgKyBcIicpXCIpO1xyXG4gICAgICAgIHJldHVybiBmZWF0dXJlO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlcyAoZGVhY3RpdmF0ZXMpIGEgZmVhdHVyZSBmcm9tIHRoZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFRoZSBJZCBvZiB0aGUgZmVhdHVyZSAoR1VJRClcclxuICAgICAqIEBwYXJhbSBmb3JjZSBJZiB0cnVlIHRoZSBmZWF0dXJlIGRlYWN0aXZhdGlvbiB3aWxsIGJlIGZvcmNlZFxyXG4gICAgICovXHJcbiAgICBGZWF0dXJlcy5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGlkLCBmb3JjZSkge1xyXG4gICAgICAgIGlmIChmb3JjZSA9PT0gdm9pZCAwKSB7IGZvcmNlID0gZmFsc2U7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShGZWF0dXJlc18xLCBcInJlbW92ZVwiKS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7XHJcbiAgICAgICAgICAgICAgICBmZWF0dXJlSWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgZm9yY2U6IGZvcmNlLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgRmVhdHVyZXNfMTtcclxuICAgIEZlYXR1cmVzID0gRmVhdHVyZXNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwiZmVhdHVyZXNcIilcclxuICAgIF0sIEZlYXR1cmVzKTtcclxuICAgIHJldHVybiBGZWF0dXJlcztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG52YXIgRmVhdHVyZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhGZWF0dXJlLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRmVhdHVyZSgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgKGRlYWN0aXZhdGVzKSBhIGZlYXR1cmUgZnJvbSB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmb3JjZSBJZiB0cnVlIHRoZSBmZWF0dXJlIGRlYWN0aXZhdGlvbiB3aWxsIGJlIGZvcmNlZFxyXG4gICAgICovXHJcbiAgICBGZWF0dXJlLnByb3RvdHlwZS5kZWFjdGl2YXRlID0gZnVuY3Rpb24gKGZvcmNlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoZm9yY2UgPT09IHZvaWQgMCkgeyBmb3JjZSA9IGZhbHNlOyB9XHJcbiAgICAgICAgdmFyIHJlbW92ZURlcGVuZGVuY3kgPSB0aGlzLmFkZEJhdGNoRGVwZW5kZW5jeSgpO1xyXG4gICAgICAgIHZhciBpZEdldCA9IG5ldyBGZWF0dXJlKHRoaXMpLnNlbGVjdChcIkRlZmluaXRpb25JZFwiKTtcclxuICAgICAgICByZXR1cm4gaWRHZXQuZ2V0KCkudGhlbihmdW5jdGlvbiAoZmVhdHVyZSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IF90aGlzLmdldFBhcmVudChGZWF0dXJlcywgX3RoaXMucGFyZW50VXJsLCBcIlwiLCBfdGhpcy5iYXRjaCkucmVtb3ZlKGZlYXR1cmUuRGVmaW5pdGlvbklkLCBmb3JjZSk7XHJcbiAgICAgICAgICAgIHJlbW92ZURlcGVuZGVuY3koKTtcclxuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEZlYXR1cmU7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZUluc3RhbmNlKSk7XG5cbnZhciBSZWxhdGVkSXRlbU1hbmFnZXJJbXBsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFJlbGF0ZWRJdGVtTWFuYWdlckltcGwsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBSZWxhdGVkSXRlbU1hbmFnZXJJbXBsKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFJlbGF0ZWRJdGVtTWFuYWdlckltcGxfMSA9IFJlbGF0ZWRJdGVtTWFuYWdlckltcGw7XHJcbiAgICBSZWxhdGVkSXRlbU1hbmFnZXJJbXBsLkZyb21VcmwgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgaWYgKHVybCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlbGF0ZWRJdGVtTWFuYWdlckltcGxfMShcIlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGluZGV4ID0gdXJsLmluZGV4T2YoXCJfYXBpL1wiKTtcclxuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlbGF0ZWRJdGVtTWFuYWdlckltcGxfMSh1cmwuc3Vic3RyKDAsIGluZGV4KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbF8xKHVybCk7XHJcbiAgICB9O1xyXG4gICAgUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbC5wcm90b3R5cGUuZ2V0UmVsYXRlZEl0ZW1zID0gZnVuY3Rpb24gKHNvdXJjZUxpc3ROYW1lLCBzb3VyY2VJdGVtSWQpIHtcclxuICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLmNsb25lKFJlbGF0ZWRJdGVtTWFuYWdlckltcGxfMSwgbnVsbCk7XHJcbiAgICAgICAgcXVlcnkuY29uY2F0KFwiLkdldFJlbGF0ZWRJdGVtc1wiKTtcclxuICAgICAgICByZXR1cm4gcXVlcnkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgU291cmNlSXRlbUlEOiBzb3VyY2VJdGVtSWQsXHJcbiAgICAgICAgICAgICAgICBTb3VyY2VMaXN0TmFtZTogc291cmNlTGlzdE5hbWUsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFJlbGF0ZWRJdGVtTWFuYWdlckltcGwucHJvdG90eXBlLmdldFBhZ2VPbmVSZWxhdGVkSXRlbXMgPSBmdW5jdGlvbiAoc291cmNlTGlzdE5hbWUsIHNvdXJjZUl0ZW1JZCkge1xyXG4gICAgICAgIHZhciBxdWVyeSA9IHRoaXMuY2xvbmUoUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbF8xLCBudWxsKTtcclxuICAgICAgICBxdWVyeS5jb25jYXQoXCIuR2V0UGFnZU9uZVJlbGF0ZWRJdGVtc1wiKTtcclxuICAgICAgICByZXR1cm4gcXVlcnkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgU291cmNlSXRlbUlEOiBzb3VyY2VJdGVtSWQsXHJcbiAgICAgICAgICAgICAgICBTb3VyY2VMaXN0TmFtZTogc291cmNlTGlzdE5hbWUsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFJlbGF0ZWRJdGVtTWFuYWdlckltcGwucHJvdG90eXBlLmFkZFNpbmdsZUxpbmsgPSBmdW5jdGlvbiAoc291cmNlTGlzdE5hbWUsIHNvdXJjZUl0ZW1JZCwgc291cmNlV2ViVXJsLCB0YXJnZXRMaXN0TmFtZSwgdGFyZ2V0SXRlbUlELCB0YXJnZXRXZWJVcmwsIHRyeUFkZFJldmVyc2VMaW5rKSB7XHJcbiAgICAgICAgaWYgKHRyeUFkZFJldmVyc2VMaW5rID09PSB2b2lkIDApIHsgdHJ5QWRkUmV2ZXJzZUxpbmsgPSBmYWxzZTsgfVxyXG4gICAgICAgIHZhciBxdWVyeSA9IHRoaXMuY2xvbmUoUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbF8xLCBudWxsKTtcclxuICAgICAgICBxdWVyeS5jb25jYXQoXCIuQWRkU2luZ2xlTGlua1wiKTtcclxuICAgICAgICByZXR1cm4gcXVlcnkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgU291cmNlSXRlbUlEOiBzb3VyY2VJdGVtSWQsXHJcbiAgICAgICAgICAgICAgICBTb3VyY2VMaXN0TmFtZTogc291cmNlTGlzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICBTb3VyY2VXZWJVcmw6IHNvdXJjZVdlYlVybCxcclxuICAgICAgICAgICAgICAgIFRhcmdldEl0ZW1JRDogdGFyZ2V0SXRlbUlELFxyXG4gICAgICAgICAgICAgICAgVGFyZ2V0TGlzdE5hbWU6IHRhcmdldExpc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgVGFyZ2V0V2ViVXJsOiB0YXJnZXRXZWJVcmwsXHJcbiAgICAgICAgICAgICAgICBUcnlBZGRSZXZlcnNlTGluazogdHJ5QWRkUmV2ZXJzZUxpbmssXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHJlbGF0ZWQgaXRlbSBsaW5rIGZyb20gYW4gaXRlbSBzcGVjaWZpZWQgYnkgbGlzdCBuYW1lIGFuZCBpdGVtIGlkLCB0byBhbiBpdGVtIHNwZWNpZmllZCBieSB1cmxcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc291cmNlTGlzdE5hbWUgVGhlIHNvdXJjZSBsaXN0IG5hbWUgb3IgbGlzdCBpZFxyXG4gICAgICogQHBhcmFtIHNvdXJjZUl0ZW1JZCBUaGUgc291cmNlIGl0ZW0gaWRcclxuICAgICAqIEBwYXJhbSB0YXJnZXRJdGVtVXJsIFRoZSB0YXJnZXQgaXRlbSB1cmxcclxuICAgICAqIEBwYXJhbSB0cnlBZGRSZXZlcnNlTGluayBJZiBzZXQgdG8gdHJ1ZSB0cnkgdG8gYWRkIHRoZSByZXZlcnNlIGxpbmsgKHdpbGwgbm90IHJldHVybiBlcnJvciBpZiBpdCBmYWlscylcclxuICAgICAqL1xyXG4gICAgUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbC5wcm90b3R5cGUuYWRkU2luZ2xlTGlua1RvVXJsID0gZnVuY3Rpb24gKHNvdXJjZUxpc3ROYW1lLCBzb3VyY2VJdGVtSWQsIHRhcmdldEl0ZW1VcmwsIHRyeUFkZFJldmVyc2VMaW5rKSB7XHJcbiAgICAgICAgaWYgKHRyeUFkZFJldmVyc2VMaW5rID09PSB2b2lkIDApIHsgdHJ5QWRkUmV2ZXJzZUxpbmsgPSBmYWxzZTsgfVxyXG4gICAgICAgIHZhciBxdWVyeSA9IHRoaXMuY2xvbmUoUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbF8xLCBudWxsKTtcclxuICAgICAgICBxdWVyeS5jb25jYXQoXCIuQWRkU2luZ2xlTGlua1RvVXJsXCIpO1xyXG4gICAgICAgIHJldHVybiBxdWVyeS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyh7XHJcbiAgICAgICAgICAgICAgICBTb3VyY2VJdGVtSUQ6IHNvdXJjZUl0ZW1JZCxcclxuICAgICAgICAgICAgICAgIFNvdXJjZUxpc3ROYW1lOiBzb3VyY2VMaXN0TmFtZSxcclxuICAgICAgICAgICAgICAgIFRhcmdldEl0ZW1Vcmw6IHRhcmdldEl0ZW1VcmwsXHJcbiAgICAgICAgICAgICAgICBUcnlBZGRSZXZlcnNlTGluazogdHJ5QWRkUmV2ZXJzZUxpbmssXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHJlbGF0ZWQgaXRlbSBsaW5rIGZyb20gYW4gaXRlbSBzcGVjaWZpZWQgYnkgdXJsLCB0byBhbiBpdGVtIHNwZWNpZmllZCBieSBsaXN0IG5hbWUgYW5kIGl0ZW0gaWRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc291cmNlSXRlbVVybCBUaGUgc291cmNlIGl0ZW0gdXJsXHJcbiAgICAgKiBAcGFyYW0gdGFyZ2V0TGlzdE5hbWUgVGhlIHRhcmdldCBsaXN0IG5hbWUgb3IgbGlzdCBpZFxyXG4gICAgICogQHBhcmFtIHRhcmdldEl0ZW1JZCBUaGUgdGFyZ2V0IGl0ZW0gaWRcclxuICAgICAqIEBwYXJhbSB0cnlBZGRSZXZlcnNlTGluayBJZiBzZXQgdG8gdHJ1ZSB0cnkgdG8gYWRkIHRoZSByZXZlcnNlIGxpbmsgKHdpbGwgbm90IHJldHVybiBlcnJvciBpZiBpdCBmYWlscylcclxuICAgICAqL1xyXG4gICAgUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbC5wcm90b3R5cGUuYWRkU2luZ2xlTGlua0Zyb21VcmwgPSBmdW5jdGlvbiAoc291cmNlSXRlbVVybCwgdGFyZ2V0TGlzdE5hbWUsIHRhcmdldEl0ZW1JZCwgdHJ5QWRkUmV2ZXJzZUxpbmspIHtcclxuICAgICAgICBpZiAodHJ5QWRkUmV2ZXJzZUxpbmsgPT09IHZvaWQgMCkgeyB0cnlBZGRSZXZlcnNlTGluayA9IGZhbHNlOyB9XHJcbiAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5jbG9uZShSZWxhdGVkSXRlbU1hbmFnZXJJbXBsXzEsIG51bGwpO1xyXG4gICAgICAgIHF1ZXJ5LmNvbmNhdChcIi5BZGRTaW5nbGVMaW5rRnJvbVVybFwiKTtcclxuICAgICAgICByZXR1cm4gcXVlcnkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1Moe1xyXG4gICAgICAgICAgICAgICAgU291cmNlSXRlbVVybDogc291cmNlSXRlbVVybCxcclxuICAgICAgICAgICAgICAgIFRhcmdldEl0ZW1JRDogdGFyZ2V0SXRlbUlkLFxyXG4gICAgICAgICAgICAgICAgVGFyZ2V0TGlzdE5hbWU6IHRhcmdldExpc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgVHJ5QWRkUmV2ZXJzZUxpbms6IHRyeUFkZFJldmVyc2VMaW5rLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBSZWxhdGVkSXRlbU1hbmFnZXJJbXBsLnByb3RvdHlwZS5kZWxldGVTaW5nbGVMaW5rID0gZnVuY3Rpb24gKHNvdXJjZUxpc3ROYW1lLCBzb3VyY2VJdGVtSWQsIHNvdXJjZVdlYlVybCwgdGFyZ2V0TGlzdE5hbWUsIHRhcmdldEl0ZW1JZCwgdGFyZ2V0V2ViVXJsLCB0cnlEZWxldGVSZXZlcnNlTGluaykge1xyXG4gICAgICAgIGlmICh0cnlEZWxldGVSZXZlcnNlTGluayA9PT0gdm9pZCAwKSB7IHRyeURlbGV0ZVJldmVyc2VMaW5rID0gZmFsc2U7IH1cclxuICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLmNsb25lKFJlbGF0ZWRJdGVtTWFuYWdlckltcGxfMSwgbnVsbCk7XHJcbiAgICAgICAgcXVlcnkuY29uY2F0KFwiLkRlbGV0ZVNpbmdsZUxpbmtcIik7XHJcbiAgICAgICAgcmV0dXJuIHF1ZXJ5LnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHtcclxuICAgICAgICAgICAgICAgIFNvdXJjZUl0ZW1JRDogc291cmNlSXRlbUlkLFxyXG4gICAgICAgICAgICAgICAgU291cmNlTGlzdE5hbWU6IHNvdXJjZUxpc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgU291cmNlV2ViVXJsOiBzb3VyY2VXZWJVcmwsXHJcbiAgICAgICAgICAgICAgICBUYXJnZXRJdGVtSUQ6IHRhcmdldEl0ZW1JZCxcclxuICAgICAgICAgICAgICAgIFRhcmdldExpc3ROYW1lOiB0YXJnZXRMaXN0TmFtZSxcclxuICAgICAgICAgICAgICAgIFRhcmdldFdlYlVybDogdGFyZ2V0V2ViVXJsLFxyXG4gICAgICAgICAgICAgICAgVHJ5RGVsZXRlUmV2ZXJzZUxpbms6IHRyeURlbGV0ZVJldmVyc2VMaW5rLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbF8xO1xyXG4gICAgUmVsYXRlZEl0ZW1NYW5hZ2VySW1wbCA9IFJlbGF0ZWRJdGVtTWFuYWdlckltcGxfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwiX2FwaS9TUC5SZWxhdGVkSXRlbU1hbmFnZXJcIilcclxuICAgIF0sIFJlbGF0ZWRJdGVtTWFuYWdlckltcGwpO1xyXG4gICAgcmV0dXJuIFJlbGF0ZWRJdGVtTWFuYWdlckltcGw7XHJcbn0oU2hhcmVQb2ludFF1ZXJ5YWJsZSkpO1xuXG4vKipcclxuICogRGVzY3JpYmVzIGEgY29sbGVjdGlvbiBvZiB3ZWJzXHJcbiAqXHJcbiAqL1xyXG52YXIgV2VicyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhXZWJzLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gV2VicygpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBXZWJzXzEgPSBXZWJzO1xyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHdlYiB0byB0aGUgY29sbGVjdGlvblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0aXRsZSBUaGUgbmV3IHdlYidzIHRpdGxlXHJcbiAgICAgKiBAcGFyYW0gdXJsIFRoZSBuZXcgd2ViJ3MgcmVsYXRpdmUgdXJsXHJcbiAgICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gVGhlIG5ldyB3ZWIncyBkZXNjcmlwdGlvblxyXG4gICAgICogQHBhcmFtIHRlbXBsYXRlIFRoZSBuZXcgd2ViJ3MgdGVtcGxhdGUgaW50ZXJuYWwgbmFtZSAoZGVmYXVsdCA9IFNUUylcclxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBUaGUgbG9jYWxlIGlkIHRoYXQgc3BlY2lmaWVzIHRoZSBuZXcgd2ViJ3MgbGFuZ3VhZ2UgKGRlZmF1bHQgPSAxMDMzIFtFbmdsaXNoLCBVU10pXHJcbiAgICAgKiBAcGFyYW0gaW5oZXJpdFBlcm1pc3Npb25zIFdoZW4gdHJ1ZSwgcGVybWlzc2lvbnMgd2lsbCBiZSBpbmhlcml0ZWQgZnJvbSB0aGUgbmV3IHdlYidzIHBhcmVudCAoZGVmYXVsdCA9IHRydWUpXHJcbiAgICAgKi9cclxuICAgIFdlYnMucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh0aXRsZSwgdXJsLCBkZXNjcmlwdGlvbiwgdGVtcGxhdGUsIGxhbmd1YWdlLCBpbmhlcml0UGVybWlzc2lvbnMpIHtcclxuICAgICAgICBpZiAoZGVzY3JpcHRpb24gPT09IHZvaWQgMCkgeyBkZXNjcmlwdGlvbiA9IFwiXCI7IH1cclxuICAgICAgICBpZiAodGVtcGxhdGUgPT09IHZvaWQgMCkgeyB0ZW1wbGF0ZSA9IFwiU1RTXCI7IH1cclxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IHZvaWQgMCkgeyBsYW5ndWFnZSA9IDEwMzM7IH1cclxuICAgICAgICBpZiAoaW5oZXJpdFBlcm1pc3Npb25zID09PSB2b2lkIDApIHsgaW5oZXJpdFBlcm1pc3Npb25zID0gdHJ1ZTsgfVxyXG4gICAgICAgIHZhciBwcm9wcyA9IHtcclxuICAgICAgICAgICAgRGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBMYW5ndWFnZTogbGFuZ3VhZ2UsXHJcbiAgICAgICAgICAgIFRpdGxlOiB0aXRsZSxcclxuICAgICAgICAgICAgVXJsOiB1cmwsXHJcbiAgICAgICAgICAgIFVzZVNhbWVQZXJtaXNzaW9uc0FzUGFyZW50U2l0ZTogaW5oZXJpdFBlcm1pc3Npb25zLFxyXG4gICAgICAgICAgICBXZWJUZW1wbGF0ZTogdGVtcGxhdGUsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1Moe1xyXG4gICAgICAgICAgICBcInBhcmFtZXRlcnNcIjogZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgIFwiX19tZXRhZGF0YVwiOiB7IFwidHlwZVwiOiBcIlNQLldlYkNyZWF0aW9uSW5mb3JtYXRpb25cIiB9LFxyXG4gICAgICAgICAgICB9LCBwcm9wcyksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoV2Vic18xLCBcImFkZFwiKS5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICB3ZWI6IG5ldyBXZWIob2RhdGFVcmxGcm9tKGRhdGEpLnJlcGxhY2UoL19hcGlcXC93ZWJcXC8/L2ksIFwiXCIpKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgV2Vic18xO1xyXG4gICAgV2VicyA9IFdlYnNfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwid2Vic1wiKVxyXG4gICAgXSwgV2Vicyk7XHJcbiAgICByZXR1cm4gV2VicztcclxufShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbikpO1xyXG4vKipcclxuICogRGVzY3JpYmVzIGEgY29sbGVjdGlvbiBvZiB3ZWIgaW5mb3NcclxuICpcclxuICovXHJcbnZhciBXZWJJbmZvcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhXZWJJbmZvcywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFdlYkluZm9zKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFdlYkluZm9zID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgZGVmYXVsdFBhdGgoXCJ3ZWJpbmZvc1wiKVxyXG4gICAgXSwgV2ViSW5mb3MpO1xyXG4gICAgcmV0dXJuIFdlYkluZm9zO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKSk7XHJcbi8qKlxyXG4gKiBEZXNjcmliZXMgYSB3ZWJcclxuICpcclxuICovXHJcbnZhciBXZWIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoV2ViLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gV2ViKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFdlYl8xID0gV2ViO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHdlYiBpbnN0YW5jZSBmcm9tIHRoZSBnaXZlbiB1cmwgYnkgaW5kZXhpbmcgdGhlIGxvY2F0aW9uIG9mIHRoZSAvX2FwaS9cclxuICAgICAqIHNlZ21lbnQuIElmIHRoaXMgaXMgbm90IGZvdW5kIHRoZSBtZXRob2QgY3JlYXRlcyBhIG5ldyB3ZWIgd2l0aCB0aGUgZW50aXJlIHN0cmluZyBhc1xyXG4gICAgICogc3VwcGxpZWQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVybFxyXG4gICAgICovXHJcbiAgICBXZWIuZnJvbVVybCA9IGZ1bmN0aW9uICh1cmwsIHBhdGgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFdlYl8xKGV4dHJhY3RXZWJVcmwodXJsKSwgcGF0aCk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwid2Vic1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGlzIHdlYidzIHN1YndlYnNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFdlYnModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhpcyB3ZWIncyBwYXJlbnQgd2ViIGFuZCBkYXRhXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmdldFBhcmVudFdlYiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdChcIlBhcmVudFdlYi9JZFwiKS5leHBhbmQoXCJQYXJlbnRXZWJcIikuZ2V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgIHZhciBQYXJlbnRXZWIgPSBfYS5QYXJlbnRXZWI7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZShfdGhpcy50b1VybEFuZFF1ZXJ5KCkuc3BsaXQoXCIvX2FwaVwiKVswXSkub3BlbldlYkJ5SWQoUGFyZW50V2ViLklkKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICogUmV0dXJucyBhIGNvbGxlY3Rpb24gb2Ygb2JqZWN0cyB0aGF0IGNvbnRhaW4gbWV0YWRhdGEgYWJvdXQgc3Vic2l0ZXMgb2YgdGhlIGN1cnJlbnQgc2l0ZSBpbiB3aGljaCB0aGUgY3VycmVudCB1c2VyIGlzIGEgbWVtYmVyLlxyXG4gICAgKlxyXG4gICAgKiBAcGFyYW0gbldlYlRlbXBsYXRlRmlsdGVyIFNwZWNpZmllcyB0aGUgc2l0ZSBkZWZpbml0aW9uIChkZWZhdWx0ID0gLTEpXHJcbiAgICAqIEBwYXJhbSBuQ29uZmlndXJhdGlvbkZpbHRlciBBIDE2LWJpdCBpbnRlZ2VyIHRoYXQgc3BlY2lmaWVzIHRoZSBpZGVudGlmaWVyIG9mIGEgY29uZmlndXJhdGlvbiAoZGVmYXVsdCA9IC0xKVxyXG4gICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuZ2V0U3Vid2Vic0ZpbHRlcmVkRm9yQ3VycmVudFVzZXIgPSBmdW5jdGlvbiAobldlYlRlbXBsYXRlRmlsdGVyLCBuQ29uZmlndXJhdGlvbkZpbHRlcikge1xyXG4gICAgICAgIGlmIChuV2ViVGVtcGxhdGVGaWx0ZXIgPT09IHZvaWQgMCkgeyBuV2ViVGVtcGxhdGVGaWx0ZXIgPSAtMTsgfVxyXG4gICAgICAgIGlmIChuQ29uZmlndXJhdGlvbkZpbHRlciA9PT0gdm9pZCAwKSB7IG5Db25maWd1cmF0aW9uRmlsdGVyID0gLTE7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShXZWJzLCBcImdldFN1YndlYnNGaWx0ZXJlZEZvckN1cnJlbnRVc2VyKG5XZWJUZW1wbGF0ZUZpbHRlcj1cIiArIG5XZWJUZW1wbGF0ZUZpbHRlciArIFwiLG5Db25maWd1cmF0aW9uRmlsdGVyPVwiICsgbkNvbmZpZ3VyYXRpb25GaWx0ZXIgKyBcIilcIik7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwiYWxsUHJvcGVydGllc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQWxsb3dzIGFjY2VzcyB0byB0aGUgd2ViJ3MgYWxsIHByb3BlcnRpZXMgY29sbGVjdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTaGFyZVBvaW50UXVlcnlhYmxlQ29sbGVjdGlvbiwgXCJhbGxwcm9wZXJ0aWVzXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwid2ViaW5mb3NcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgYSBjb2xsZWN0aW9uIG9mIFdlYkluZm9zIGZvciB0aGlzIHdlYidzIHN1YndlYnNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFdlYkluZm9zKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwiY29udGVudFR5cGVzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBjb250ZW50IHR5cGVzIGF2YWlsYWJsZSBpbiB0aGlzIHdlYlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29udGVudFR5cGVzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwibGlzdHNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGxpc3RzIGluIHRoaXMgd2ViXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0cyh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcImZpZWxkc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgZmllbGRzIGluIHRoaXMgd2ViXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZHModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViLnByb3RvdHlwZSwgXCJmZWF0dXJlc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgYWN0aXZlIGZlYXR1cmVzIGZvciB0aGlzIHdlYlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmVhdHVyZXModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViLnByb3RvdHlwZSwgXCJhdmFpbGFibGVmaWVsZHNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGF2YWlsYWJsZSBmaWVsZHMgaW4gdGhpcyB3ZWJcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkcyh0aGlzLCBcImF2YWlsYWJsZWZpZWxkc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcIm5hdmlnYXRpb25cIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIG5hdmlnYXRpb24gb3B0aW9ucyBpbiB0aGlzIHdlYlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgTmF2aWdhdGlvbih0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcInNpdGVVc2Vyc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgc2l0ZSB1c2Vyc1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZVVzZXJzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwic2l0ZUdyb3Vwc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgc2l0ZSBncm91cHNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNpdGVHcm91cHModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViLnByb3RvdHlwZSwgXCJzaXRlVXNlckluZm9MaXN0XCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHNpdGUgdXNlciBpbmZvIGxpc3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IExpc3QodGhpcywgXCJzaXRldXNlcmluZm9saXN0XCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwicmVnaW9uYWxTZXR0aW5nc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyByZWdpb25hbCBzZXR0aW5nc1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVnaW9uYWxTZXR0aW5ncyh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcImN1cnJlbnRVc2VyXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBjdXJyZW50IHVzZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBDdXJyZW50VXNlcih0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcImZvbGRlcnNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIHRvcC1sZXZlbCBmb2xkZXJzIGluIHRoaXMgd2ViXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGb2xkZXJzKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwidXNlckN1c3RvbUFjdGlvbnNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgYWxsIHVzZXIgY3VzdG9tIGFjdGlvbnMgZm9yIHRoaXMgd2ViXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBVc2VyQ3VzdG9tQWN0aW9ucyh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcInJvbGVEZWZpbml0aW9uc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgY29sbGVjdGlvbiBvZiBSb2xlRGVmaW5pdGlvbiByZXNvdXJjZXNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJvbGVEZWZpbml0aW9ucyh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcInJlbGF0ZWRJdGVtc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUHJvdmlkZXMgYW4gaW50ZXJmYWNlIHRvIG1hbmFnZSByZWxhdGVkIGl0ZW1zXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFJlbGF0ZWRJdGVtTWFuYWdlckltcGwuRnJvbVVybCh0aGlzLnRvVXJsKCkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGJhdGNoIGZvciByZXF1ZXN0cyB3aXRoaW4gdGhlIGNvbnRleHQgb2YgdGhpcyB3ZWJcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuY3JlYXRlQmF0Y2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTUEJhdGNoKHRoaXMucGFyZW50VXJsKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViLnByb3RvdHlwZSwgXCJyb290Rm9sZGVyXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSByb290IGZvbGRlciBvZiB0aGlzIHdlYlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRm9sZGVyKHRoaXMsIFwicm9vdEZvbGRlclwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcImFzc29jaWF0ZWRPd25lckdyb3VwXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSBhc3NvY2lhdGVkIG93bmVyIGdyb3VwIGZvciB0aGlzIHdlYlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZUdyb3VwKHRoaXMsIFwiYXNzb2NpYXRlZG93bmVyZ3JvdXBcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViLnByb3RvdHlwZSwgXCJhc3NvY2lhdGVkTWVtYmVyR3JvdXBcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIGFzc29jaWF0ZWQgbWVtYmVyIGdyb3VwIGZvciB0aGlzIHdlYlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZUdyb3VwKHRoaXMsIFwiYXNzb2NpYXRlZG1lbWJlcmdyb3VwXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYi5wcm90b3R5cGUsIFwiYXNzb2NpYXRlZFZpc2l0b3JHcm91cFwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgYXNzb2NpYXRlZCB2aXNpdG9yIGdyb3VwIGZvciB0aGlzIHdlYlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2l0ZUdyb3VwKHRoaXMsIFwiYXNzb2NpYXRlZHZpc2l0b3Jncm91cFwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGZvbGRlciBieSBzZXJ2ZXIgcmVsYXRpdmUgdXJsXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGZvbGRlclJlbGF0aXZlVXJsIFRoZSBzZXJ2ZXIgcmVsYXRpdmUgcGF0aCB0byB0aGUgZm9sZGVyIChpbmNsdWRpbmcgL3NpdGVzLyBpZiBhcHBsaWNhYmxlKVxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmdldEZvbGRlckJ5U2VydmVyUmVsYXRpdmVVcmwgPSBmdW5jdGlvbiAoZm9sZGVyUmVsYXRpdmVVcmwpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEZvbGRlcih0aGlzLCBcImdldEZvbGRlckJ5U2VydmVyUmVsYXRpdmVVcmwoJ1wiICsgZm9sZGVyUmVsYXRpdmVVcmwgKyBcIicpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGZvbGRlciBieSBzZXJ2ZXIgcmVsYXRpdmUgcmVsYXRpdmUgcGF0aCBpZiB5b3VyIGZvbGRlciBuYW1lIGNvbnRhaW5zICMgYW5kICUgY2hhcmFjdGVyc1xyXG4gICAgICogeW91IG5lZWQgdG8gZmlyc3QgZW5jb2RlIHRoZSBmaWxlIG5hbWUgdXNpbmcgZW5jb2RlVVJJQ29tcG9uZW50KCkgYW5kIHRoZW4gcGFzcyB0aGUgdXJsXHJcbiAgICAgKiBsZXQgdXJsID0gXCIvc2l0ZXMvdGVzdC9TaGFyZWQgRG9jdW1lbnRzL1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KFwiJTEyM1wiKTtcclxuICAgICAqIFRoaXMgd29ya3Mgb25seSBpbiBTaGFyZVBvaW50IG9ubGluZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZm9sZGVyUmVsYXRpdmVVcmwgVGhlIHNlcnZlciByZWxhdGl2ZSBwYXRoIHRvIHRoZSBmb2xkZXIgKGluY2x1ZGluZyAvc2l0ZXMvIGlmIGFwcGxpY2FibGUpXHJcbiAgICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuZ2V0Rm9sZGVyQnlTZXJ2ZXJSZWxhdGl2ZVBhdGggPSBmdW5jdGlvbiAoZm9sZGVyUmVsYXRpdmVVcmwpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEZvbGRlcih0aGlzLCBcImdldEZvbGRlckJ5U2VydmVyUmVsYXRpdmVQYXRoKGRlY29kZWRVcmw9J1wiICsgZm9sZGVyUmVsYXRpdmVVcmwgKyBcIicpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGZpbGUgYnkgc2VydmVyIHJlbGF0aXZlIHVybFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmaWxlUmVsYXRpdmVVcmwgVGhlIHNlcnZlciByZWxhdGl2ZSBwYXRoIHRvIHRoZSBmaWxlIChpbmNsdWRpbmcgL3NpdGVzLyBpZiBhcHBsaWNhYmxlKVxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmdldEZpbGVCeVNlcnZlclJlbGF0aXZlVXJsID0gZnVuY3Rpb24gKGZpbGVSZWxhdGl2ZVVybCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgRmlsZSh0aGlzLCBcImdldEZpbGVCeVNlcnZlclJlbGF0aXZlVXJsKCdcIiArIGZpbGVSZWxhdGl2ZVVybCArIFwiJylcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgZmlsZSBieSBzZXJ2ZXIgcmVsYXRpdmUgdXJsIGlmIHlvdXIgZmlsZSBuYW1lIGNvbnRhaW5zICMgYW5kICUgY2hhcmFjdGVyc1xyXG4gICAgICogeW91IG5lZWQgdG8gZmlyc3QgZW5jb2RlIHRoZSBmaWxlIG5hbWUgdXNpbmcgZW5jb2RlVVJJQ29tcG9uZW50KCkgYW5kIHRoZW4gcGFzcyB0aGUgdXJsXHJcbiAgICAgKiBsZXQgdXJsID0gXCIvc2l0ZXMvdGVzdC9TaGFyZWQgRG9jdW1lbnRzL1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KFwiJTEyMy5kb2N4XCIpO1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmaWxlUmVsYXRpdmVVcmwgVGhlIHNlcnZlciByZWxhdGl2ZSBwYXRoIHRvIHRoZSBmaWxlIChpbmNsdWRpbmcgL3NpdGVzLyBpZiBhcHBsaWNhYmxlKVxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmdldEZpbGVCeVNlcnZlclJlbGF0aXZlUGF0aCA9IGZ1bmN0aW9uIChmaWxlUmVsYXRpdmVVcmwpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEZpbGUodGhpcywgXCJnZXRGaWxlQnlTZXJ2ZXJSZWxhdGl2ZVBhdGgoZGVjb2RlZFVybD0nXCIgKyBmaWxlUmVsYXRpdmVVcmwgKyBcIicpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGxpc3QgYnkgc2VydmVyIHJlbGF0aXZlIHVybCAobGlzdCdzIHJvb3QgZm9sZGVyKVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsaXN0UmVsYXRpdmVVcmwgVGhlIHNlcnZlciByZWxhdGl2ZSBwYXRoIHRvIHRoZSBsaXN0J3Mgcm9vdCBmb2xkZXIgKGluY2x1ZGluZyAvc2l0ZXMvIGlmIGFwcGxpY2FibGUpXHJcbiAgICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuZ2V0TGlzdCA9IGZ1bmN0aW9uIChsaXN0UmVsYXRpdmVVcmwpIHtcclxuICAgICAgICByZXR1cm4gbmV3IExpc3QodGhpcywgXCJnZXRMaXN0KCdcIiArIGxpc3RSZWxhdGl2ZVVybCArIFwiJylcIik7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVcGRhdGVzIHRoaXMgd2ViIGluc3RhbmNlIHdpdGggdGhlIHN1cHBsaWVkIHByb3BlcnRpZXNcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBBIHBsYWluIG9iamVjdCBoYXNoIG9mIHZhbHVlcyB0byB1cGRhdGUgZm9yIHRoZSB3ZWJcclxuICAgICAqL1xyXG4gICAgV2ViLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAocHJvcGVydGllcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKGV4dGVuZCh7XHJcbiAgICAgICAgICAgIFwiX19tZXRhZGF0YVwiOiB7IFwidHlwZVwiOiBcIlNQLldlYlwiIH0sXHJcbiAgICAgICAgfSwgcHJvcGVydGllcykpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keTogcG9zdEJvZHksXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgIFwiWC1IVFRQLU1ldGhvZFwiOiBcIk1FUkdFXCIsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIHdlYjogX3RoaXMsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWxldGVzIHRoaXMgd2ViXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5kZWxldGVDb3JlLmNhbGwodGhpcyk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBBcHBsaWVzIHRoZSB0aGVtZSBzcGVjaWZpZWQgYnkgdGhlIGNvbnRlbnRzIG9mIGVhY2ggb2YgdGhlIGZpbGVzIHNwZWNpZmllZCBpbiB0aGUgYXJndW1lbnRzIHRvIHRoZSBzaXRlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbG9yUGFsZXR0ZVVybCBUaGUgc2VydmVyLXJlbGF0aXZlIFVSTCBvZiB0aGUgY29sb3IgcGFsZXR0ZSBmaWxlXHJcbiAgICAgKiBAcGFyYW0gZm9udFNjaGVtZVVybCBUaGUgc2VydmVyLXJlbGF0aXZlIFVSTCBvZiB0aGUgZm9udCBzY2hlbWVcclxuICAgICAqIEBwYXJhbSBiYWNrZ3JvdW5kSW1hZ2VVcmwgVGhlIHNlcnZlci1yZWxhdGl2ZSBVUkwgb2YgdGhlIGJhY2tncm91bmQgaW1hZ2VcclxuICAgICAqIEBwYXJhbSBzaGFyZUdlbmVyYXRlZCBXaGVuIHRydWUsIHRoZSBnZW5lcmF0ZWQgdGhlbWUgZmlsZXMgYXJlIHN0b3JlZCBpbiB0aGUgcm9vdCBzaXRlLiBXaGVuIGZhbHNlLCB0aGV5IGFyZSBzdG9yZWQgaW4gdGhpcyB3ZWJcclxuICAgICAqL1xyXG4gICAgV2ViLnByb3RvdHlwZS5hcHBseVRoZW1lID0gZnVuY3Rpb24gKGNvbG9yUGFsZXR0ZVVybCwgZm9udFNjaGVtZVVybCwgYmFja2dyb3VuZEltYWdlVXJsLCBzaGFyZUdlbmVyYXRlZCkge1xyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyh7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZVVybDogYmFja2dyb3VuZEltYWdlVXJsLFxyXG4gICAgICAgICAgICBjb2xvclBhbGV0dGVVcmw6IGNvbG9yUGFsZXR0ZVVybCxcclxuICAgICAgICAgICAgZm9udFNjaGVtZVVybDogZm9udFNjaGVtZVVybCxcclxuICAgICAgICAgICAgc2hhcmVHZW5lcmF0ZWQ6IHNoYXJlR2VuZXJhdGVkLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFdlYl8xLCBcImFwcGx5dGhlbWVcIikucG9zdENvcmUoeyBib2R5OiBwb3N0Qm9keSB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEFwcGxpZXMgdGhlIHNwZWNpZmllZCBzaXRlIGRlZmluaXRpb24gb3Igc2l0ZSB0ZW1wbGF0ZSB0byB0aGUgV2ViIHNpdGUgdGhhdCBoYXMgbm8gdGVtcGxhdGUgYXBwbGllZCB0byBpdFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0ZW1wbGF0ZSBOYW1lIG9mIHRoZSBzaXRlIGRlZmluaXRpb24gb3IgdGhlIG5hbWUgb2YgdGhlIHNpdGUgdGVtcGxhdGVcclxuICAgICAqL1xyXG4gICAgV2ViLnByb3RvdHlwZS5hcHBseVdlYlRlbXBsYXRlID0gZnVuY3Rpb24gKHRlbXBsYXRlKSB7XHJcbiAgICAgICAgdmFyIHEgPSB0aGlzLmNsb25lKFdlYl8xLCBcImFwcGx5d2VidGVtcGxhdGVcIik7XHJcbiAgICAgICAgcS5jb25jYXQoXCIoQHQpXCIpO1xyXG4gICAgICAgIHEucXVlcnkuc2V0KFwiQHRcIiwgdGVtcGxhdGUpO1xyXG4gICAgICAgIHJldHVybiBxLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVja3Mgd2hldGhlciB0aGUgc3BlY2lmaWVkIGxvZ2luIG5hbWUgYmVsb25ncyB0byBhIHZhbGlkIHVzZXIgaW4gdGhlIHdlYi4gSWYgdGhlIHVzZXIgZG9lc24ndCBleGlzdCwgYWRkcyB0aGUgdXNlciB0byB0aGUgd2ViLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsb2dpbk5hbWUgVGhlIGxvZ2luIG5hbWUgb2YgdGhlIHVzZXIgKGV4OiBpOjAjLmZ8bWVtYmVyc2hpcHx1c2VyQGRvbWFpbi5vbm1pY3Jvc29mdC5jb20pXHJcbiAgICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuZW5zdXJlVXNlciA9IGZ1bmN0aW9uIChsb2dpbk5hbWUpIHtcclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1Moe1xyXG4gICAgICAgICAgICBsb2dvbk5hbWU6IGxvZ2luTmFtZSxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShXZWJfMSwgXCJlbnN1cmV1c2VyXCIpLnBvc3RDb3JlKHsgYm9keTogcG9zdEJvZHkgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIHVzZXI6IG5ldyBTaXRlVXNlcihvZGF0YVVybEZyb20oZGF0YSkpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIGNvbGxlY3Rpb24gb2Ygc2l0ZSB0ZW1wbGF0ZXMgYXZhaWxhYmxlIGZvciB0aGUgc2l0ZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBUaGUgbG9jYWxlIGlkIG9mIHRoZSBzaXRlIHRlbXBsYXRlcyB0byByZXRyaWV2ZSAoZGVmYXVsdCA9IDEwMzMgW0VuZ2xpc2gsIFVTXSlcclxuICAgICAqIEBwYXJhbSBpbmNsdWRlQ3Jvc3NMYW5ndWFnZSBXaGVuIHRydWUsIGluY2x1ZGVzIGxhbmd1YWdlLW5ldXRyYWwgc2l0ZSB0ZW1wbGF0ZXM7IG90aGVyd2lzZSBmYWxzZSAoZGVmYXVsdCA9IHRydWUpXHJcbiAgICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuYXZhaWxhYmxlV2ViVGVtcGxhdGVzID0gZnVuY3Rpb24gKGxhbmd1YWdlLCBpbmNsdWRlQ3Jvc3NMYW51Z2FnZSkge1xyXG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gdm9pZCAwKSB7IGxhbmd1YWdlID0gMTAzMzsgfVxyXG4gICAgICAgIGlmIChpbmNsdWRlQ3Jvc3NMYW51Z2FnZSA9PT0gdm9pZCAwKSB7IGluY2x1ZGVDcm9zc0xhbnVnYWdlID0gdHJ1ZTsgfVxyXG4gICAgICAgIHJldHVybiBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24odGhpcywgXCJnZXRhdmFpbGFibGV3ZWJ0ZW1wbGF0ZXMobGNpZD1cIiArIGxhbmd1YWdlICsgXCIsIGRvaW5jbHVkZWNyb3NzbGFuZ3VhZ2U9XCIgKyBpbmNsdWRlQ3Jvc3NMYW51Z2FnZSArIFwiKVwiKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGxpc3QgZ2FsbGVyeSBvbiB0aGUgc2l0ZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0eXBlIFRoZSBnYWxsZXJ5IHR5cGUgLSBXZWJUZW1wbGF0ZUNhdGFsb2cgPSAxMTEsIFdlYlBhcnRDYXRhbG9nID0gMTEzIExpc3RUZW1wbGF0ZUNhdGFsb2cgPSAxMTQsXHJcbiAgICAgKiBNYXN0ZXJQYWdlQ2F0YWxvZyA9IDExNiwgU29sdXRpb25DYXRhbG9nID0gMTIxLCBUaGVtZUNhdGFsb2cgPSAxMjMsIERlc2lnbkNhdGFsb2cgPSAxMjQsIEFwcERhdGFDYXRhbG9nID0gMTI1XHJcbiAgICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuZ2V0Q2F0YWxvZyA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoV2ViXzEsIFwiZ2V0Y2F0YWxvZyhcIiArIHR5cGUgKyBcIilcIikuc2VsZWN0KFwiSWRcIikuZ2V0KCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IExpc3Qob2RhdGFVcmxGcm9tKGRhdGEpKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGNvbGxlY3Rpb24gb2YgY2hhbmdlcyBmcm9tIHRoZSBjaGFuZ2UgbG9nIHRoYXQgaGF2ZSBvY2N1cnJlZCB3aXRoaW4gdGhlIGxpc3QsIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgcXVlcnlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcXVlcnkgVGhlIGNoYW5nZSBxdWVyeVxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmdldENoYW5nZXMgPSBmdW5jdGlvbiAocXVlcnkpIHtcclxuICAgICAgICB2YXIgcG9zdEJvZHkgPSBqc1MoeyBcInF1ZXJ5XCI6IGV4dGVuZCh7IFwiX19tZXRhZGF0YVwiOiB7IFwidHlwZVwiOiBcIlNQLkNoYW5nZVF1ZXJ5XCIgfSB9LCBxdWVyeSkgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoV2ViXzEsIFwiZ2V0Y2hhbmdlc1wiKS5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWIucHJvdG90eXBlLCBcImN1c3RvbUxpc3RUZW1wbGF0ZVwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgY3VzdG9tIGxpc3QgdGVtcGxhdGVzIGZvciB0aGUgc2l0ZVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24odGhpcywgXCJnZXRjdXN0b21saXN0dGVtcGxhdGVzXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSB1c2VyIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHNwZWNpZmllZCBtZW1iZXIgaWRlbnRpZmllciBmb3IgdGhlIGN1cnJlbnQgc2l0ZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBUaGUgaWQgb2YgdGhlIHVzZXJcclxuICAgICAqL1xyXG4gICAgV2ViLnByb3RvdHlwZS5nZXRVc2VyQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgU2l0ZVVzZXIodGhpcywgXCJnZXRVc2VyQnlJZChcIiArIGlkICsgXCIpXCIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgbmFtZSBvZiB0aGUgaW1hZ2UgZmlsZSBmb3IgdGhlIGljb24gdGhhdCBpcyB1c2VkIHRvIHJlcHJlc2VudCB0aGUgc3BlY2lmaWVkIGZpbGVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZmlsZW5hbWUgVGhlIGZpbGUgbmFtZS4gSWYgdGhpcyBwYXJhbWV0ZXIgaXMgZW1wdHksIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlbXB0eSBzdHJpbmdcclxuICAgICAqIEBwYXJhbSBzaXplIFRoZSBzaXplIG9mIHRoZSBpY29uOiAxNngxNiBwaXhlbHMgPSAwLCAzMngzMiBwaXhlbHMgPSAxIChkZWZhdWx0ID0gMClcclxuICAgICAqIEBwYXJhbSBwcm9nSWQgVGhlIFByb2dJRCBvZiB0aGUgYXBwbGljYXRpb24gdGhhdCB3YXMgdXNlZCB0byBjcmVhdGUgdGhlIGZpbGUsIGluIHRoZSBmb3JtIE9MRVNlcnZlck5hbWUuT2JqZWN0TmFtZVxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLm1hcFRvSWNvbiA9IGZ1bmN0aW9uIChmaWxlbmFtZSwgc2l6ZSwgcHJvZ0lkKSB7XHJcbiAgICAgICAgaWYgKHNpemUgPT09IHZvaWQgMCkgeyBzaXplID0gMDsgfVxyXG4gICAgICAgIGlmIChwcm9nSWQgPT09IHZvaWQgMCkgeyBwcm9nSWQgPSBcIlwiOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoV2ViXzEsIFwibWFwdG9pY29uKGZpbGVuYW1lPSdcIiArIGZpbGVuYW1lICsgXCInLCBwcm9naWQ9J1wiICsgcHJvZ0lkICsgXCInLCBzaXplPVwiICsgc2l6ZSArIFwiKVwiKS5nZXQoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHRlbmFudCBwcm9wZXJ0eSBjb3JyZXNwb25kaW5nIHRvIHRoZSBzcGVjaWZpZWQga2V5IGluIHRoZSBhcHAgY2F0YWxvZyBzaXRlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGtleSBJZCBvZiBzdG9yYWdlIGVudGl0eSB0byBiZSBzZXRcclxuICAgICAqL1xyXG4gICAgV2ViLnByb3RvdHlwZS5nZXRTdG9yYWdlRW50aXR5ID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFdlYl8xLCBcImdldFN0b3JhZ2VFbnRpdHkoJ1wiICsga2V5ICsgXCInKVwiKS5nZXQoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgd2lsbCBzZXQgdGhlIHN0b3JhZ2UgZW50aXR5IGlkZW50aWZpZWQgYnkgdGhlIGdpdmVuIGtleSAoTVVTVCBiZSBjYWxsZWQgaW4gdGhlIGNvbnRleHQgb2YgdGhlIGFwcCBjYXRhbG9nKVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBrZXkgSWQgb2Ygc3RvcmFnZSBlbnRpdHkgdG8gYmUgc2V0XHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgVmFsdWUgb2Ygc3RvcmFnZSBlbnRpdHkgdG8gYmUgc2V0XHJcbiAgICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gRGVzY3JpcHRpb24gb2Ygc3RvcmFnZSBlbnRpdHkgdG8gYmUgc2V0XHJcbiAgICAgKiBAcGFyYW0gY29tbWVudHMgQ29tbWVudHMgb2Ygc3RvcmFnZSBlbnRpdHkgdG8gYmUgc2V0XHJcbiAgICAgKi9cclxuICAgIFdlYi5wcm90b3R5cGUuc2V0U3RvcmFnZUVudGl0eSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBkZXNjcmlwdGlvbiwgY29tbWVudHMpIHtcclxuICAgICAgICBpZiAoZGVzY3JpcHRpb24gPT09IHZvaWQgMCkgeyBkZXNjcmlwdGlvbiA9IFwiXCI7IH1cclxuICAgICAgICBpZiAoY29tbWVudHMgPT09IHZvaWQgMCkgeyBjb21tZW50cyA9IFwiXCI7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShXZWJfMSwgXCJzZXRTdG9yYWdlRW50aXR5XCIpLnBvc3RDb3JlKHtcclxuICAgICAgICAgICAgYm9keToganNTKHtcclxuICAgICAgICAgICAgICAgIGNvbW1lbnRzOiBjb21tZW50cyxcclxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgIGtleToga2V5LFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgd2lsbCByZW1vdmUgdGhlIHN0b3JhZ2UgZW50aXR5IGlkZW50aWZpZWQgYnkgdGhlIGdpdmVuIGtleVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBrZXkgSWQgb2Ygc3RvcmFnZSBlbnRpdHkgdG8gYmUgcmVtb3ZlZFxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLnJlbW92ZVN0b3JhZ2VFbnRpdHkgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoV2ViXzEsIFwicmVtb3ZlU3RvcmFnZUVudGl0eSgnXCIgKyBrZXkgKyBcIicpXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBhcHAgY2F0YWxvZyBmb3IgdGhpcyB3ZWJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXJsIE9wdGlvbmFsIHVybCBvciB3ZWIgY29udGFpbmluZyB0aGUgYXBwIGNhdGFsb2cgKGRlZmF1bHQ6IGN1cnJlbnQgd2ViKVxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmdldEFwcENhdGFsb2cgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBBcHBDYXRhbG9nKHVybCB8fCB0aGlzKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIGNvbGxlY3Rpb24gb2YgYXZhaWxhYmxlIGNsaWVudCBzaWRlIHdlYiBwYXJ0cyBmb3IgdGhpcyB3ZWIgaW5zdGFuY2VcclxuICAgICAqL1xyXG4gICAgV2ViLnByb3RvdHlwZS5nZXRDbGllbnRTaWRlV2ViUGFydHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU2hhcmVQb2ludFF1ZXJ5YWJsZUNvbGxlY3Rpb24sIFwiR2V0Q2xpZW50U2lkZVdlYlBhcnRzXCIpLmdldCgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBjbGllbnQgc2lkZSBwYWdlXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBhZ2VOYW1lIE5hbWUgb2YgdGhlIG5ldyBwYWdlXHJcbiAgICAgKiBAcGFyYW0gdGl0bGUgRGlzcGxheSB0aXRsZSBvZiB0aGUgbmV3IHBhZ2VcclxuICAgICAqIEBwYXJhbSBsaWJyYXJ5VGl0bGUgVGl0bGUgb2YgdGhlIGxpYnJhcnkgaW4gd2hpY2ggdG8gY3JlYXRlIHRoZSBuZXcgcGFnZS4gRGVmYXVsdDogXCJTaXRlIFBhZ2VzXCJcclxuICAgICAqL1xyXG4gICAgV2ViLnByb3RvdHlwZS5hZGRDbGllbnRTaWRlUGFnZSA9IGZ1bmN0aW9uIChwYWdlTmFtZSwgdGl0bGUsIGxpYnJhcnlUaXRsZSkge1xyXG4gICAgICAgIGlmICh0aXRsZSA9PT0gdm9pZCAwKSB7IHRpdGxlID0gcGFnZU5hbWUucmVwbGFjZSgvXFwuW14vLl0rJC8sIFwiXCIpOyB9XHJcbiAgICAgICAgaWYgKGxpYnJhcnlUaXRsZSA9PT0gdm9pZCAwKSB7IGxpYnJhcnlUaXRsZSA9IFwiU2l0ZSBQYWdlc1wiOyB9XHJcbiAgICAgICAgcmV0dXJuIENsaWVudFNpZGVQYWdlLmNyZWF0ZSh0aGlzLmxpc3RzLmdldEJ5VGl0bGUobGlicmFyeVRpdGxlKSwgcGFnZU5hbWUsIHRpdGxlKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgY2xpZW50IHNpZGUgcGFnZSB1c2luZyB0aGUgbGlicmFyeSBwYXRoXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBhZ2VOYW1lIE5hbWUgb2YgdGhlIG5ldyBwYWdlXHJcbiAgICAgKiBAcGFyYW0gbGlzdFJlbGF0aXZlUGF0aCBUaGUgc2VydmVyIHJlbGF0aXZlIHBhdGggdG8gdGhlIGxpc3QncyByb290IGZvbGRlciAoaW5jbHVkaW5nIC9zaXRlcy8gaWYgYXBwbGljYWJsZSlcclxuICAgICAqIEBwYXJhbSB0aXRsZSBEaXNwbGF5IHRpdGxlIG9mIHRoZSBuZXcgcGFnZVxyXG4gICAgICovXHJcbiAgICBXZWIucHJvdG90eXBlLmFkZENsaWVudFNpZGVQYWdlQnlQYXRoID0gZnVuY3Rpb24gKHBhZ2VOYW1lLCBsaXN0UmVsYXRpdmVQYXRoLCB0aXRsZSkge1xyXG4gICAgICAgIGlmICh0aXRsZSA9PT0gdm9pZCAwKSB7IHRpdGxlID0gcGFnZU5hbWUucmVwbGFjZSgvXFwuW14vLl0rJC8sIFwiXCIpOyB9XHJcbiAgICAgICAgcmV0dXJuIENsaWVudFNpZGVQYWdlLmNyZWF0ZSh0aGlzLmdldExpc3QobGlzdFJlbGF0aXZlUGF0aCksIHBhZ2VOYW1lLCB0aXRsZSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIFdlYl8xO1xyXG4gICAgV2ViID0gV2ViXzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcIl9hcGkvd2ViXCIpXHJcbiAgICBdLCBXZWIpO1xyXG4gICAgcmV0dXJuIFdlYjtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlV2ViKSk7XG5cbi8qKlxyXG4gKiBEZXNjcmliZXMgYSBzaXRlIGNvbGxlY3Rpb25cclxuICpcclxuICovXHJcbnZhciBTaXRlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNpdGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTaXRlKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFNpdGVfMSA9IFNpdGU7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2l0ZS5wcm90b3R5cGUsIFwicm9vdFdlYlwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgcm9vdCB3ZWIgb2YgdGhlIHNpdGUgY29sbGVjdGlvblxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgV2ViKHRoaXMsIFwicm9vdHdlYlwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTaXRlLnByb3RvdHlwZSwgXCJmZWF0dXJlc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgYWN0aXZlIGZlYXR1cmVzIGZvciB0aGlzIHNpdGUgY29sbGVjdGlvblxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmVhdHVyZXModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2l0ZS5wcm90b3R5cGUsIFwidXNlckN1c3RvbUFjdGlvbnNcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgYWxsIGN1c3RvbSBhY3Rpb25zIGZvciB0aGlzIHNpdGUgY29sbGVjdGlvblxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVXNlckN1c3RvbUFjdGlvbnModGhpcyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSBXZWIgaW5zdGFuY2UgcmVwcmVzZW50aW5nIHRoZSByb290IHdlYiBvZiB0aGUgc2l0ZSBjb2xsZWN0aW9uXHJcbiAgICAgKiBjb3JyZWN0bHkgc2V0dXAgZm9yIGNoYWluaW5nIHdpdGhpbiB0aGUgbGlicmFyeVxyXG4gICAgICovXHJcbiAgICBTaXRlLnByb3RvdHlwZS5nZXRSb290V2ViID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJvb3RXZWIuc2VsZWN0KFwiVXJsXCIpLmdldCgpLnRoZW4oZnVuY3Rpb24gKHdlYikgeyByZXR1cm4gbmV3IFdlYih3ZWIuVXJsKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBjb250ZXh0IGluZm9ybWF0aW9uIGZvciB0aGlzIHNpdGUgY29sbGVjdGlvblxyXG4gICAgICovXHJcbiAgICBTaXRlLnByb3RvdHlwZS5nZXRDb250ZXh0SW5mbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcSA9IG5ldyBTaXRlXzEodGhpcy5wYXJlbnRVcmwsIFwiX2FwaS9jb250ZXh0aW5mb1wiKTtcclxuICAgICAgICByZXR1cm4gcS5wb3N0Q29yZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGhPUChkYXRhLCBcIkdldENvbnRleHRXZWJJbmZvcm1hdGlvblwiKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSBkYXRhLkdldENvbnRleHRXZWJJbmZvcm1hdGlvbjtcclxuICAgICAgICAgICAgICAgIGluZm8uU3VwcG9ydGVkU2NoZW1hVmVyc2lvbnMgPSBpbmZvLlN1cHBvcnRlZFNjaGVtYVZlcnNpb25zLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5mbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBkb2N1bWVudCBsaWJyYXJpZXMgb24gYSBzaXRlLiBTdGF0aWMgbWV0aG9kLiAoU2hhcmVQb2ludCBPbmxpbmUgb25seSlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYWJzb2x1dGVXZWJVcmwgVGhlIGFic29sdXRlIHVybCBvZiB0aGUgd2ViIHdob3NlIGRvY3VtZW50IGxpYnJhcmllcyBzaG91bGQgYmUgcmV0dXJuZWRcclxuICAgICAqL1xyXG4gICAgU2l0ZS5wcm90b3R5cGUuZ2V0RG9jdW1lbnRMaWJyYXJpZXMgPSBmdW5jdGlvbiAoYWJzb2x1dGVXZWJVcmwpIHtcclxuICAgICAgICB2YXIgcSA9IG5ldyBTaGFyZVBvaW50UXVlcnlhYmxlKFwiXCIsIFwiX2FwaS9zcC53ZWIuZ2V0ZG9jdW1lbnRsaWJyYXJpZXMoQHYpXCIpO1xyXG4gICAgICAgIHEucXVlcnkuc2V0KFwiQHZcIiwgXCInXCIgKyBhYnNvbHV0ZVdlYlVybCArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gcS5nZXQoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChoT1AoZGF0YSwgXCJHZXREb2N1bWVudExpYnJhcmllc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuR2V0RG9jdW1lbnRMaWJyYXJpZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgc2l0ZSB1cmwgZnJvbSBhIHBhZ2UgdXJsXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFic29sdXRlUGFnZVVybCBUaGUgYWJzb2x1dGUgdXJsIG9mIHRoZSBwYWdlXHJcbiAgICAgKi9cclxuICAgIFNpdGUucHJvdG90eXBlLmdldFdlYlVybEZyb21QYWdlVXJsID0gZnVuY3Rpb24gKGFic29sdXRlUGFnZVVybCkge1xyXG4gICAgICAgIHZhciBxID0gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGUoXCJcIiwgXCJfYXBpL3NwLndlYi5nZXR3ZWJ1cmxmcm9tcGFnZXVybChAdilcIik7XHJcbiAgICAgICAgcS5xdWVyeS5zZXQoXCJAdlwiLCBcIidcIiArIGFic29sdXRlUGFnZVVybCArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gcS5nZXQoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChoT1AoZGF0YSwgXCJHZXRXZWJVcmxGcm9tUGFnZVVybFwiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuR2V0V2ViVXJsRnJvbVBhZ2VVcmw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBiYXRjaCBmb3IgcmVxdWVzdHMgd2l0aGluIHRoZSBjb250ZXh0IG9mIHRoaXMgc2l0ZSBjb2xsZWN0aW9uXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBTaXRlLnByb3RvdHlwZS5jcmVhdGVCYXRjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFNQQmF0Y2godGhpcy5wYXJlbnRVcmwpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogT3BlbnMgYSB3ZWIgYnkgaWQgKHVzaW5nIFBPU1QpXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHdlYklkIFRoZSBHVUlEIGlkIG9mIHRoZSB3ZWIgdG8gb3BlblxyXG4gICAgICovXHJcbiAgICBTaXRlLnByb3RvdHlwZS5vcGVuV2ViQnlJZCA9IGZ1bmN0aW9uICh3ZWJJZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNpdGVfMSwgXCJvcGVuV2ViQnlJZCgnXCIgKyB3ZWJJZCArIFwiJylcIikucG9zdENvcmUoKS50aGVuKGZ1bmN0aW9uIChkKSB7IHJldHVybiAoe1xyXG4gICAgICAgICAgICBkYXRhOiBkLFxyXG4gICAgICAgICAgICB3ZWI6IFdlYi5mcm9tVXJsKGRbXCJvZGF0YS5pZFwiXSB8fCBkLl9fbWV0YWRhdGEudXJpKSxcclxuICAgICAgICB9KTsgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIFNpdGVfMTtcclxuICAgIFNpdGUgPSBTaXRlXzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcIl9hcGkvc2l0ZVwiKVxyXG4gICAgXSwgU2l0ZSk7XHJcbiAgICByZXR1cm4gU2l0ZTtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcblxudmFyIFVzZXJQcm9maWxlUXVlcnkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVXNlclByb2ZpbGVRdWVyeSwgX3N1cGVyKTtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgVXNlclByb2ZpbGVRdWVyeSBjbGFzc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBiYXNlVXJsIFRoZSB1cmwgb3IgU2hhcmVQb2ludFF1ZXJ5YWJsZSB3aGljaCBmb3JtcyB0aGUgcGFyZW50IG9mIHRoaXMgdXNlciBwcm9maWxlIHF1ZXJ5XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIFVzZXJQcm9maWxlUXVlcnkoYmFzZVVybCwgcGF0aCkge1xyXG4gICAgICAgIGlmIChwYXRoID09PSB2b2lkIDApIHsgcGF0aCA9IFwiX2FwaS9zcC51c2VycHJvZmlsZXMucGVvcGxlbWFuYWdlclwiOyB9XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgYmFzZVVybCwgcGF0aCkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jbGllbnRQZW9wbGVQaWNrZXJRdWVyeSA9IChuZXcgQ2xpZW50UGVvcGxlUGlja2VyUXVlcnkoYmFzZVVybCkpLmNvbmZpZ3VyZUZyb20oX3RoaXMpO1xyXG4gICAgICAgIF90aGlzLnByb2ZpbGVMb2FkZXIgPSAobmV3IFByb2ZpbGVMb2FkZXIoYmFzZVVybCkpLmNvbmZpZ3VyZUZyb20oX3RoaXMpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZSwgXCJlZGl0UHJvZmlsZUxpbmtcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSB1cmwgb2YgdGhlIGVkaXQgcHJvZmlsZSBwYWdlIGZvciB0aGUgY3VycmVudCB1c2VyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb25lKFVzZXJQcm9maWxlUXVlcnksIFwiRWRpdFByb2ZpbGVMaW5rXCIpLmdldCgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFVzZXJQcm9maWxlUXVlcnkucHJvdG90eXBlLCBcImlzTXlQZW9wbGVMaXN0UHVibGljXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBIGJvb2xlYW4gdmFsdWUgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB0aGUgY3VycmVudCB1c2VyJ3MgXCJQZW9wbGUgSSdtIEZvbGxvd2luZ1wiIGxpc3QgaXMgcHVibGljXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb25lKFVzZXJQcm9maWxlUXVlcnksIFwiSXNNeVBlb3BsZUxpc3RQdWJsaWNcIikuZ2V0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEEgYm9vbGVhbiB2YWx1ZSB0aGF0IGluZGljYXRlcyB3aGV0aGVyIHRoZSBjdXJyZW50IHVzZXIgaXMgYmVpbmcgZm9sbG93ZWQgYnkgdGhlIHNwZWNpZmllZCB1c2VyXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgYWNjb3VudCBuYW1lIG9mIHRoZSB1c2VyXHJcbiAgICAgKi9cclxuICAgIFVzZXJQcm9maWxlUXVlcnkucHJvdG90eXBlLmFtSUZvbGxvd2VkQnkgPSBmdW5jdGlvbiAobG9naW5OYW1lKSB7XHJcbiAgICAgICAgdmFyIHEgPSB0aGlzLmNsb25lKFVzZXJQcm9maWxlUXVlcnksIFwiYW1pZm9sbG93ZWRieShAdilcIik7XHJcbiAgICAgICAgcS5xdWVyeS5zZXQoXCJAdlwiLCBcIidcIiArIGVuY29kZVVSSUNvbXBvbmVudChsb2dpbk5hbWUpICsgXCInXCIpO1xyXG4gICAgICAgIHJldHVybiBxLmdldCgpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQSBib29sZWFuIHZhbHVlIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIGN1cnJlbnQgdXNlciBpcyBmb2xsb3dpbmcgdGhlIHNwZWNpZmllZCB1c2VyXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgYWNjb3VudCBuYW1lIG9mIHRoZSB1c2VyXHJcbiAgICAgKi9cclxuICAgIFVzZXJQcm9maWxlUXVlcnkucHJvdG90eXBlLmFtSUZvbGxvd2luZyA9IGZ1bmN0aW9uIChsb2dpbk5hbWUpIHtcclxuICAgICAgICB2YXIgcSA9IHRoaXMuY2xvbmUoVXNlclByb2ZpbGVRdWVyeSwgXCJhbWlmb2xsb3dpbmcoQHYpXCIpO1xyXG4gICAgICAgIHEucXVlcnkuc2V0KFwiQHZcIiwgXCInXCIgKyBlbmNvZGVVUklDb21wb25lbnQobG9naW5OYW1lKSArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gcS5nZXQoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGFncyB0aGF0IHRoZSBjdXJyZW50IHVzZXIgaXMgZm9sbG93aW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG1heENvdW50IFRoZSBtYXhpbXVtIG51bWJlciBvZiB0YWdzIHRvIHJldHJpZXZlIChkZWZhdWx0IGlzIDIwKVxyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5nZXRGb2xsb3dlZFRhZ3MgPSBmdW5jdGlvbiAobWF4Q291bnQpIHtcclxuICAgICAgICBpZiAobWF4Q291bnQgPT09IHZvaWQgMCkgeyBtYXhDb3VudCA9IDIwOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoVXNlclByb2ZpbGVRdWVyeSwgXCJnZXRmb2xsb3dlZHRhZ3MoXCIgKyBtYXhDb3VudCArIFwiKVwiKS5nZXQoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIHBlb3BsZSB3aG8gYXJlIGZvbGxvd2luZyB0aGUgc3BlY2lmaWVkIHVzZXJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbG9naW5OYW1lIFRoZSBhY2NvdW50IG5hbWUgb2YgdGhlIHVzZXJcclxuICAgICAqL1xyXG4gICAgVXNlclByb2ZpbGVRdWVyeS5wcm90b3R5cGUuZ2V0Rm9sbG93ZXJzRm9yID0gZnVuY3Rpb24gKGxvZ2luTmFtZSkge1xyXG4gICAgICAgIHZhciBxID0gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBcImdldGZvbGxvd2Vyc2ZvcihAdilcIik7XHJcbiAgICAgICAgcS5xdWVyeS5zZXQoXCJAdlwiLCBcIidcIiArIGVuY29kZVVSSUNvbXBvbmVudChsb2dpbk5hbWUpICsgXCInXCIpO1xyXG4gICAgICAgIHJldHVybiBxLmdldCgpO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZSwgXCJteUZvbGxvd2Vyc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgcGVvcGxlIHdobyBhcmUgZm9sbG93aW5nIHRoZSBjdXJyZW50IHVzZXJcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uKHRoaXMsIFwiZ2V0bXlmb2xsb3dlcnNcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVXNlclByb2ZpbGVRdWVyeS5wcm90b3R5cGUsIFwibXlQcm9wZXJ0aWVzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHVzZXIgcHJvcGVydGllcyBmb3IgdGhlIGN1cnJlbnQgdXNlclxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVXNlclByb2ZpbGVRdWVyeSh0aGlzLCBcImdldG15cHJvcGVydGllc1wiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgcGVvcGxlIHdobyB0aGUgc3BlY2lmaWVkIHVzZXIgaXMgZm9sbG93aW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgYWNjb3VudCBuYW1lIG9mIHRoZSB1c2VyLlxyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5nZXRQZW9wbGVGb2xsb3dlZEJ5ID0gZnVuY3Rpb24gKGxvZ2luTmFtZSkge1xyXG4gICAgICAgIHZhciBxID0gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBcImdldHBlb3BsZWZvbGxvd2VkYnkoQHYpXCIpO1xyXG4gICAgICAgIHEucXVlcnkuc2V0KFwiQHZcIiwgXCInXCIgKyBlbmNvZGVVUklDb21wb25lbnQobG9naW5OYW1lKSArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gcS5nZXQoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdXNlciBwcm9wZXJ0aWVzIGZvciB0aGUgc3BlY2lmaWVkIHVzZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgYWNjb3VudCBuYW1lIG9mIHRoZSB1c2VyLlxyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5nZXRQcm9wZXJ0aWVzRm9yID0gZnVuY3Rpb24gKGxvZ2luTmFtZSkge1xyXG4gICAgICAgIHZhciBxID0gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBcImdldHByb3BlcnRpZXNmb3IoQHYpXCIpO1xyXG4gICAgICAgIHEucXVlcnkuc2V0KFwiQHZcIiwgXCInXCIgKyBlbmNvZGVVUklDb21wb25lbnQobG9naW5OYW1lKSArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gcS5nZXQoKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVXNlclByb2ZpbGVRdWVyeS5wcm90b3R5cGUsIFwidHJlbmRpbmdUYWdzXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXRzIHRoZSAyMCBtb3N0IHBvcHVsYXIgaGFzaCB0YWdzIG92ZXIgdGhlIHBhc3Qgd2Vlaywgc29ydGVkIHNvIHRoYXQgdGhlIG1vc3QgcG9wdWxhciB0YWcgYXBwZWFycyBmaXJzdFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBxID0gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBudWxsKTtcclxuICAgICAgICAgICAgcS5jb25jYXQoXCIuZ2V0dHJlbmRpbmd0YWdzXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gcS5nZXQoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgc3BlY2lmaWVkIHVzZXIgcHJvZmlsZSBwcm9wZXJ0eSBmb3IgdGhlIHNwZWNpZmllZCB1c2VyXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgYWNjb3VudCBuYW1lIG9mIHRoZSB1c2VyXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIFRoZSBjYXNlLXNlbnNpdGl2ZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB0byBnZXRcclxuICAgICAqL1xyXG4gICAgVXNlclByb2ZpbGVRdWVyeS5wcm90b3R5cGUuZ2V0VXNlclByb2ZpbGVQcm9wZXJ0eUZvciA9IGZ1bmN0aW9uIChsb2dpbk5hbWUsIHByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgIHZhciBxID0gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBcImdldHVzZXJwcm9maWxlcHJvcGVydHlmb3IoYWNjb3VudG5hbWU9QHYsIHByb3BlcnR5bmFtZT0nXCIgKyBwcm9wZXJ0eU5hbWUgKyBcIicpXCIpO1xyXG4gICAgICAgIHEucXVlcnkuc2V0KFwiQHZcIiwgXCInXCIgKyBlbmNvZGVVUklDb21wb25lbnQobG9naW5OYW1lKSArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gcS5nZXQoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCB1c2VyIGZyb20gdGhlIHVzZXIncyBsaXN0IG9mIHN1Z2dlc3RlZCBwZW9wbGUgdG8gZm9sbG93XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxvZ2luTmFtZSBUaGUgYWNjb3VudCBuYW1lIG9mIHRoZSB1c2VyXHJcbiAgICAgKi9cclxuICAgIFVzZXJQcm9maWxlUXVlcnkucHJvdG90eXBlLmhpZGVTdWdnZXN0aW9uID0gZnVuY3Rpb24gKGxvZ2luTmFtZSkge1xyXG4gICAgICAgIHZhciBxID0gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBcImhpZGVzdWdnZXN0aW9uKEB2KVwiKTtcclxuICAgICAgICBxLnF1ZXJ5LnNldChcIkB2XCIsIFwiJ1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KGxvZ2luTmFtZSkgKyBcIidcIik7XHJcbiAgICAgICAgcmV0dXJuIHEucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEEgYm9vbGVhbiB2YWx1ZXMgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB0aGUgZmlyc3QgdXNlciBpcyBmb2xsb3dpbmcgdGhlIHNlY29uZCB1c2VyXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGZvbGxvd2VyIFRoZSBhY2NvdW50IG5hbWUgb2YgdGhlIHVzZXIgd2hvIG1pZ2h0IGJlIGZvbGxvd2luZyB0aGUgZm9sbG93ZWVcclxuICAgICAqIEBwYXJhbSBmb2xsb3dlZSBUaGUgYWNjb3VudCBuYW1lIG9mIHRoZSB1c2VyIHdobyBtaWdodCBiZSBmb2xsb3dlZCBieSB0aGUgZm9sbG93ZXJcclxuICAgICAqL1xyXG4gICAgVXNlclByb2ZpbGVRdWVyeS5wcm90b3R5cGUuaXNGb2xsb3dpbmcgPSBmdW5jdGlvbiAoZm9sbG93ZXIsIGZvbGxvd2VlKSB7XHJcbiAgICAgICAgdmFyIHEgPSB0aGlzLmNsb25lKFVzZXJQcm9maWxlUXVlcnksIG51bGwpO1xyXG4gICAgICAgIHEuY29uY2F0KFwiLmlzZm9sbG93aW5nKHBvc3NpYmxlZm9sbG93ZXJhY2NvdW50bmFtZT1AdiwgcG9zc2libGVmb2xsb3dlZWFjY291bnRuYW1lPUB5KVwiKTtcclxuICAgICAgICBxLnF1ZXJ5LnNldChcIkB2XCIsIFwiJ1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KGZvbGxvd2VyKSArIFwiJ1wiKTtcclxuICAgICAgICBxLnF1ZXJ5LnNldChcIkB5XCIsIFwiJ1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KGZvbGxvd2VlKSArIFwiJ1wiKTtcclxuICAgICAgICByZXR1cm4gcS5nZXQoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFVwbG9hZHMgYW5kIHNldHMgdGhlIHVzZXIgcHJvZmlsZSBwaWN0dXJlIChVc2VycyBjYW4gdXBsb2FkIGEgcGljdHVyZSB0byB0aGVpciBvd24gcHJvZmlsZSBvbmx5KS4gTm90IHN1cHBvcnRlZCBmb3IgYmF0Y2hpbmcuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHByb2ZpbGVQaWNTb3VyY2UgQmxvYiBkYXRhIHJlcHJlc2VudGluZyB0aGUgdXNlcidzIHBpY3R1cmUgaW4gQk1QLCBKUEVHLCBvciBQTkcgZm9ybWF0IG9mIHVwIHRvIDQuNzZNQlxyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5zZXRNeVByb2ZpbGVQaWMgPSBmdW5jdGlvbiAocHJvZmlsZVBpY1NvdXJjZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGJ1ZmZlciA9IGUudGFyZ2V0LnJlc3VsdDsgfTtcclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHByb2ZpbGVQaWNTb3VyY2UpO1xyXG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBVc2VyUHJvZmlsZVF1ZXJ5KF90aGlzLCBcInNldG15cHJvZmlsZXBpY3R1cmVcIik7XHJcbiAgICAgICAgICAgIHJlcXVlc3QucG9zdENvcmUoe1xyXG4gICAgICAgICAgICAgICAgYm9keTogU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDE2QXJyYXkoYnVmZmVyKSksXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKF8pIHsgcmV0dXJuIHJlc29sdmUoKTsgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHJlamVjdChlKTsgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIHNpbmdsZSB2YWx1ZSBVc2VyIFByb2ZpbGUgcHJvcGVydHlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYWNjb3VudE5hbWUgVGhlIGFjY291bnQgbmFtZSBvZiB0aGUgdXNlclxyXG4gICAgICogQHBhcmFtIHByb3BlcnR5TmFtZSBQcm9wZXJ0eSBuYW1lXHJcbiAgICAgKiBAcGFyYW0gcHJvcGVydHlWYWx1ZSBQcm9wZXJ0eSB2YWx1ZVxyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5zZXRTaW5nbGVWYWx1ZVByb2ZpbGVQcm9wZXJ0eSA9IGZ1bmN0aW9uIChhY2NvdW50TmFtZSwgcHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgICAgdmFyIHBvc3RCb2R5ID0ganNTKHtcclxuICAgICAgICAgICAgYWNjb3VudE5hbWU6IGFjY291bnROYW1lLFxyXG4gICAgICAgICAgICBwcm9wZXJ0eU5hbWU6IHByb3BlcnR5TmFtZSxcclxuICAgICAgICAgICAgcHJvcGVydHlWYWx1ZTogcHJvcGVydHlWYWx1ZSxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBcIlNldFNpbmdsZVZhbHVlUHJvZmlsZVByb3BlcnR5XCIpXHJcbiAgICAgICAgICAgIC5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2V0cyBtdWx0aSB2YWx1ZWQgVXNlciBQcm9maWxlIHByb3BlcnR5XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFjY291bnROYW1lIFRoZSBhY2NvdW50IG5hbWUgb2YgdGhlIHVzZXJcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUgUHJvcGVydHkgbmFtZVxyXG4gICAgICogQHBhcmFtIHByb3BlcnR5VmFsdWVzIFByb3BlcnR5IHZhbHVlc1xyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5zZXRNdWx0aVZhbHVlZFByb2ZpbGVQcm9wZXJ0eSA9IGZ1bmN0aW9uIChhY2NvdW50TmFtZSwgcHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlcykge1xyXG4gICAgICAgIHZhciBwb3N0Qm9keSA9IGpzUyh7XHJcbiAgICAgICAgICAgIGFjY291bnROYW1lOiBhY2NvdW50TmFtZSxcclxuICAgICAgICAgICAgcHJvcGVydHlOYW1lOiBwcm9wZXJ0eU5hbWUsXHJcbiAgICAgICAgICAgIHByb3BlcnR5VmFsdWVzOiBwcm9wZXJ0eVZhbHVlcyxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShVc2VyUHJvZmlsZVF1ZXJ5LCBcIlNldE11bHRpVmFsdWVkUHJvZmlsZVByb3BlcnR5XCIpXHJcbiAgICAgICAgICAgIC5wb3N0Q29yZSh7IGJvZHk6IHBvc3RCb2R5IH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogUHJvdmlzaW9ucyBvbmUgb3IgbW9yZSB1c2VycycgcGVyc29uYWwgc2l0ZXMuIChNeSBTaXRlIGFkbWluaXN0cmF0b3Igb24gU2hhcmVQb2ludCBPbmxpbmUgb25seSlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZW1haWxzIFRoZSBlbWFpbCBhZGRyZXNzZXMgb2YgdGhlIHVzZXJzIHRvIHByb3Zpc2lvbiBzaXRlcyBmb3JcclxuICAgICAqL1xyXG4gICAgVXNlclByb2ZpbGVRdWVyeS5wcm90b3R5cGUuY3JlYXRlUGVyc29uYWxTaXRlRW5xdWV1ZUJ1bGsgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGVtYWlscyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIGVtYWlsc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9maWxlTG9hZGVyLmNyZWF0ZVBlcnNvbmFsU2l0ZUVucXVldWVCdWxrKGVtYWlscyk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFVzZXJQcm9maWxlUXVlcnkucHJvdG90eXBlLCBcIm93bmVyVXNlclByb2ZpbGVcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIHVzZXIgcHJvZmlsZSBvZiB0aGUgc2l0ZSBvd25lclxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb2ZpbGVMb2FkZXIub3duZXJVc2VyUHJvZmlsZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZSwgXCJ1c2VyUHJvZmlsZVwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgdXNlciBwcm9maWxlIGZvciB0aGUgY3VycmVudCB1c2VyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb2ZpbGVMb2FkZXIudXNlclByb2ZpbGU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEVucXVldWVzIGNyZWF0aW5nIGEgcGVyc29uYWwgc2l0ZSBmb3IgdGhpcyB1c2VyLCB3aGljaCBjYW4gYmUgdXNlZCB0byBzaGFyZSBkb2N1bWVudHMsIHdlYiBwYWdlcywgYW5kIG90aGVyIGZpbGVzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGludGVyYWN0aXZlUmVxdWVzdCB0cnVlIGlmIGludGVyYWN0aXZlbHkgKHdlYikgaW5pdGlhdGVkIHJlcXVlc3QsIG9yIGZhbHNlIChkZWZhdWx0KSBpZiBub24taW50ZXJhY3RpdmVseSAoY2xpZW50KSBpbml0aWF0ZWQgcmVxdWVzdFxyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5jcmVhdGVQZXJzb25hbFNpdGUgPSBmdW5jdGlvbiAoaW50ZXJhY3RpdmVSZXF1ZXN0KSB7XHJcbiAgICAgICAgaWYgKGludGVyYWN0aXZlUmVxdWVzdCA9PT0gdm9pZCAwKSB7IGludGVyYWN0aXZlUmVxdWVzdCA9IGZhbHNlOyB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvZmlsZUxvYWRlci5jcmVhdGVQZXJzb25hbFNpdGUoaW50ZXJhY3RpdmVSZXF1ZXN0KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdGhlIHByaXZhY3kgc2V0dGluZ3MgZm9yIHRoaXMgcHJvZmlsZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzaGFyZSB0cnVlIHRvIG1ha2UgYWxsIHNvY2lhbCBkYXRhIHB1YmxpYzsgZmFsc2UgdG8gbWFrZSBhbGwgc29jaWFsIGRhdGEgcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBVc2VyUHJvZmlsZVF1ZXJ5LnByb3RvdHlwZS5zaGFyZUFsbFNvY2lhbERhdGEgPSBmdW5jdGlvbiAoc2hhcmUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9maWxlTG9hZGVyLnNoYXJlQWxsU29jaWFsRGF0YShzaGFyZSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXNvbHZlcyB1c2VyIG9yIGdyb3VwIHVzaW5nIHNwZWNpZmllZCBxdWVyeSBwYXJhbWV0ZXJzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHF1ZXJ5UGFyYW1zIFRoZSBxdWVyeSBwYXJhbWV0ZXJzIHVzZWQgdG8gcGVyZm9ybSByZXNvbHZlXHJcbiAgICAgKi9cclxuICAgIFVzZXJQcm9maWxlUXVlcnkucHJvdG90eXBlLmNsaWVudFBlb3BsZVBpY2tlclJlc29sdmVVc2VyID0gZnVuY3Rpb24gKHF1ZXJ5UGFyYW1zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50UGVvcGxlUGlja2VyUXVlcnkuY2xpZW50UGVvcGxlUGlja2VyUmVzb2x2ZVVzZXIocXVlcnlQYXJhbXMpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogU2VhcmNoZXMgZm9yIHVzZXJzIG9yIGdyb3VwcyB1c2luZyBzcGVjaWZpZWQgcXVlcnkgcGFyYW1ldGVyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBxdWVyeVBhcmFtcyBUaGUgcXVlcnkgcGFyYW1ldGVycyB1c2VkIHRvIHBlcmZvcm0gc2VhcmNoXHJcbiAgICAgKi9cclxuICAgIFVzZXJQcm9maWxlUXVlcnkucHJvdG90eXBlLmNsaWVudFBlb3BsZVBpY2tlclNlYXJjaFVzZXIgPSBmdW5jdGlvbiAocXVlcnlQYXJhbXMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbGllbnRQZW9wbGVQaWNrZXJRdWVyeS5jbGllbnRQZW9wbGVQaWNrZXJTZWFyY2hVc2VyKHF1ZXJ5UGFyYW1zKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVXNlclByb2ZpbGVRdWVyeTtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UpKTtcclxudmFyIFByb2ZpbGVMb2FkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoUHJvZmlsZUxvYWRlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFByb2ZpbGVMb2FkZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgUHJvZmlsZUxvYWRlcl8xID0gUHJvZmlsZUxvYWRlcjtcclxuICAgIC8qKlxyXG4gICAgICogUHJvdmlzaW9ucyBvbmUgb3IgbW9yZSB1c2VycycgcGVyc29uYWwgc2l0ZXMuIChNeSBTaXRlIGFkbWluaXN0cmF0b3Igb24gU2hhcmVQb2ludCBPbmxpbmUgb25seSkgRG9lc24ndCBzdXBwb3J0IGJhdGNoaW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGVtYWlscyBUaGUgZW1haWwgYWRkcmVzc2VzIG9mIHRoZSB1c2VycyB0byBwcm92aXNpb24gc2l0ZXMgZm9yXHJcbiAgICAgKi9cclxuICAgIFByb2ZpbGVMb2FkZXIucHJvdG90eXBlLmNyZWF0ZVBlcnNvbmFsU2l0ZUVucXVldWVCdWxrID0gZnVuY3Rpb24gKGVtYWlscykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFByb2ZpbGVMb2FkZXJfMSwgXCJjcmVhdGVwZXJzb25hbHNpdGVlbnF1ZXVlYnVsa1wiLCBmYWxzZSkucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiBqc1MoeyBcImVtYWlsSURzXCI6IGVtYWlscyB9KSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJvZmlsZUxvYWRlci5wcm90b3R5cGUsIFwib3duZXJVc2VyUHJvZmlsZVwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0cyB0aGUgdXNlciBwcm9maWxlIG9mIHRoZSBzaXRlIG93bmVyLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBxID0gdGhpcy5nZXRQYXJlbnQoUHJvZmlsZUxvYWRlcl8xLCB0aGlzLnBhcmVudFVybCwgXCJfYXBpL3NwLnVzZXJwcm9maWxlcy5wcm9maWxlbG9hZGVyLmdldG93bmVydXNlcnByb2ZpbGVcIik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmhhc0JhdGNoKSB7XHJcbiAgICAgICAgICAgICAgICBxID0gcS5pbkJhdGNoKHRoaXMuYmF0Y2gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBxLnBvc3RDb3JlKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJvZmlsZUxvYWRlci5wcm90b3R5cGUsIFwidXNlclByb2ZpbGVcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldHMgdGhlIHVzZXIgcHJvZmlsZSBvZiB0aGUgY3VycmVudCB1c2VyLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb25lKFByb2ZpbGVMb2FkZXJfMSwgXCJnZXR1c2VycHJvZmlsZVwiKS5wb3N0Q29yZSgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBFbnF1ZXVlcyBjcmVhdGluZyBhIHBlcnNvbmFsIHNpdGUgZm9yIHRoaXMgdXNlciwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gc2hhcmUgZG9jdW1lbnRzLCB3ZWIgcGFnZXMsIGFuZCBvdGhlciBmaWxlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaW50ZXJhY3RpdmVSZXF1ZXN0IHRydWUgaWYgaW50ZXJhY3RpdmVseSAod2ViKSBpbml0aWF0ZWQgcmVxdWVzdCwgb3IgZmFsc2UgKGRlZmF1bHQpIGlmIG5vbi1pbnRlcmFjdGl2ZWx5IChjbGllbnQpIGluaXRpYXRlZCByZXF1ZXN0XHJcbiAgICAgKi9cclxuICAgIFByb2ZpbGVMb2FkZXIucHJvdG90eXBlLmNyZWF0ZVBlcnNvbmFsU2l0ZSA9IGZ1bmN0aW9uIChpbnRlcmFjdGl2ZVJlcXVlc3QpIHtcclxuICAgICAgICBpZiAoaW50ZXJhY3RpdmVSZXF1ZXN0ID09PSB2b2lkIDApIHsgaW50ZXJhY3RpdmVSZXF1ZXN0ID0gZmFsc2U7IH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShQcm9maWxlTG9hZGVyXzEsIFwiZ2V0dXNlcnByb2ZpbGUvY3JlYXRlcGVyc29uYWxzaXRlZW5xdWUoXCIgKyBpbnRlcmFjdGl2ZVJlcXVlc3QgKyBcIilcIikucG9zdENvcmUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdGhlIHByaXZhY3kgc2V0dGluZ3MgZm9yIHRoaXMgcHJvZmlsZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzaGFyZSB0cnVlIHRvIG1ha2UgYWxsIHNvY2lhbCBkYXRhIHB1YmxpYzsgZmFsc2UgdG8gbWFrZSBhbGwgc29jaWFsIGRhdGEgcHJpdmF0ZS5cclxuICAgICAqL1xyXG4gICAgUHJvZmlsZUxvYWRlci5wcm90b3R5cGUuc2hhcmVBbGxTb2NpYWxEYXRhID0gZnVuY3Rpb24gKHNoYXJlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoUHJvZmlsZUxvYWRlcl8xLCBcImdldHVzZXJwcm9maWxlL3NoYXJlYWxsc29jaWFsZGF0YShcIiArIHNoYXJlICsgXCIpXCIpLnBvc3RDb3JlKCk7XHJcbiAgICB9O1xyXG4gICAgdmFyIFByb2ZpbGVMb2FkZXJfMTtcclxuICAgIFByb2ZpbGVMb2FkZXIgPSBQcm9maWxlTG9hZGVyXzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcIl9hcGkvc3AudXNlcnByb2ZpbGVzLnByb2ZpbGVsb2FkZXIuZ2V0cHJvZmlsZWxvYWRlclwiKVxyXG4gICAgXSwgUHJvZmlsZUxvYWRlcik7XHJcbiAgICByZXR1cm4gUHJvZmlsZUxvYWRlcjtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlKSk7XHJcbnZhciBDbGllbnRQZW9wbGVQaWNrZXJRdWVyeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhDbGllbnRQZW9wbGVQaWNrZXJRdWVyeSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENsaWVudFBlb3BsZVBpY2tlclF1ZXJ5KCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIENsaWVudFBlb3BsZVBpY2tlclF1ZXJ5XzEgPSBDbGllbnRQZW9wbGVQaWNrZXJRdWVyeTtcclxuICAgIC8qKlxyXG4gICAgICogUmVzb2x2ZXMgdXNlciBvciBncm91cCB1c2luZyBzcGVjaWZpZWQgcXVlcnkgcGFyYW1ldGVyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBxdWVyeVBhcmFtcyBUaGUgcXVlcnkgcGFyYW1ldGVycyB1c2VkIHRvIHBlcmZvcm0gcmVzb2x2ZVxyXG4gICAgICovXHJcbiAgICBDbGllbnRQZW9wbGVQaWNrZXJRdWVyeS5wcm90b3R5cGUuY2xpZW50UGVvcGxlUGlja2VyUmVzb2x2ZVVzZXIgPSBmdW5jdGlvbiAocXVlcnlQYXJhbXMpIHtcclxuICAgICAgICB2YXIgcSA9IHRoaXMuY2xvbmUoQ2xpZW50UGVvcGxlUGlja2VyUXVlcnlfMSwgbnVsbCk7XHJcbiAgICAgICAgcS5jb25jYXQoXCIuY2xpZW50cGVvcGxlcGlja2VycmVzb2x2ZXVzZXJcIik7XHJcbiAgICAgICAgcmV0dXJuIHEucG9zdENvcmUoe1xyXG4gICAgICAgICAgICBib2R5OiB0aGlzLmNyZWF0ZUNsaWVudFBlb3BsZVBpY2tlclF1ZXJ5UGFyYW1ldGVyc1JlcXVlc3RCb2R5KHF1ZXJ5UGFyYW1zKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLkNsaWVudFBlb3BsZVBpY2tlclJlc29sdmVVc2VyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oSlNPTi5wYXJzZSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTZWFyY2hlcyBmb3IgdXNlcnMgb3IgZ3JvdXBzIHVzaW5nIHNwZWNpZmllZCBxdWVyeSBwYXJhbWV0ZXJzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHF1ZXJ5UGFyYW1zIFRoZSBxdWVyeSBwYXJhbWV0ZXJzIHVzZWQgdG8gcGVyZm9ybSBzZWFyY2hcclxuICAgICAqL1xyXG4gICAgQ2xpZW50UGVvcGxlUGlja2VyUXVlcnkucHJvdG90eXBlLmNsaWVudFBlb3BsZVBpY2tlclNlYXJjaFVzZXIgPSBmdW5jdGlvbiAocXVlcnlQYXJhbXMpIHtcclxuICAgICAgICB2YXIgcSA9IHRoaXMuY2xvbmUoQ2xpZW50UGVvcGxlUGlja2VyUXVlcnlfMSwgbnVsbCk7XHJcbiAgICAgICAgcS5jb25jYXQoXCIuY2xpZW50cGVvcGxlcGlja2Vyc2VhcmNodXNlclwiKTtcclxuICAgICAgICByZXR1cm4gcS5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IHRoaXMuY3JlYXRlQ2xpZW50UGVvcGxlUGlja2VyUXVlcnlQYXJhbWV0ZXJzUmVxdWVzdEJvZHkocXVlcnlQYXJhbXMpLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiByZXMgPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuQ2xpZW50UGVvcGxlUGlja2VyU2VhcmNoVXNlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKEpTT04ucGFyc2UpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBDbGllbnRQZW9wbGVQaWNrZXJRdWVyeVBhcmFtZXRlcnMgcmVxdWVzdCBib2R5XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHF1ZXJ5UGFyYW1zIFRoZSBxdWVyeSBwYXJhbWV0ZXJzIHRvIGNyZWF0ZSByZXF1ZXN0IGJvZHlcclxuICAgICAqL1xyXG4gICAgQ2xpZW50UGVvcGxlUGlja2VyUXVlcnkucHJvdG90eXBlLmNyZWF0ZUNsaWVudFBlb3BsZVBpY2tlclF1ZXJ5UGFyYW1ldGVyc1JlcXVlc3RCb2R5ID0gZnVuY3Rpb24gKHF1ZXJ5UGFyYW1zKSB7XHJcbiAgICAgICAgcmV0dXJuIGpzUyh7XHJcbiAgICAgICAgICAgIFwicXVlcnlQYXJhbXNcIjogZXh0ZW5kKG1ldGFkYXRhKFwiU1AuVUkuQXBwbGljYXRpb25QYWdlcy5DbGllbnRQZW9wbGVQaWNrZXJRdWVyeVBhcmFtZXRlcnNcIiksIHF1ZXJ5UGFyYW1zKSxcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgQ2xpZW50UGVvcGxlUGlja2VyUXVlcnlfMTtcclxuICAgIENsaWVudFBlb3BsZVBpY2tlclF1ZXJ5ID0gQ2xpZW50UGVvcGxlUGlja2VyUXVlcnlfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGRlZmF1bHRQYXRoKFwiX2FwaS9zcC51aS5hcHBsaWNhdGlvbnBhZ2VzLmNsaWVudHBlb3BsZXBpY2tlcndlYnNlcnZpY2VpbnRlcmZhY2VcIilcclxuICAgIF0sIENsaWVudFBlb3BsZVBpY2tlclF1ZXJ5KTtcclxuICAgIHJldHVybiBDbGllbnRQZW9wbGVQaWNrZXJRdWVyeTtcclxufShTaGFyZVBvaW50UXVlcnlhYmxlKSk7XG5cbi8qKlxyXG4gKiBFeHBvc2VzIHNvY2lhbCBmb2xsb3dpbmcgbWV0aG9kc1xyXG4gKi9cclxudmFyIFNvY2lhbFF1ZXJ5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNvY2lhbFF1ZXJ5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU29jaWFsUXVlcnkoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgU29jaWFsUXVlcnlfMSA9IFNvY2lhbFF1ZXJ5O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNvY2lhbFF1ZXJ5LnByb3RvdHlwZSwgXCJteVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgTXlTb2NpYWxRdWVyeSh0aGlzKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIFVSSSB0byBhIHNpdGUgdGhhdCBsaXN0cyB0aGUgY3VycmVudCB1c2VyJ3MgZm9sbG93ZWQgc2l0ZXMuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFF1ZXJ5LnByb3RvdHlwZS5nZXRGb2xsb3dlZFNpdGVzVXJpID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNvY2lhbFF1ZXJ5XzEsIFwiRm9sbG93ZWRTaXRlc1VyaVwiKS5nZXQoKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByLkZvbGxvd2VkU2l0ZXNVcmkgfHwgcjtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSBVUkkgdG8gYSBzaXRlIHRoYXQgbGlzdHMgdGhlIGN1cnJlbnQgdXNlcidzIGZvbGxvd2VkIGRvY3VtZW50cy5cclxuICAgICAqL1xyXG4gICAgU29jaWFsUXVlcnkucHJvdG90eXBlLmdldEZvbGxvd2VkRG9jdW1lbnRzVXJpID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFNvY2lhbFF1ZXJ5XzEsIFwiRm9sbG93ZWREb2N1bWVudHNVcmlcIikuZ2V0KCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICByZXR1cm4gci5Gb2xsb3dlZERvY3VtZW50c1VyaSB8fCByO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogTWFrZXMgdGhlIGN1cnJlbnQgdXNlciBzdGFydCBmb2xsb3dpbmcgYSB1c2VyLCBkb2N1bWVudCwgc2l0ZSwgb3IgdGFnXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFjdG9ySW5mbyBUaGUgYWN0b3IgdG8gc3RhcnQgZm9sbG93aW5nXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFF1ZXJ5LnByb3RvdHlwZS5mb2xsb3cgPSBmdW5jdGlvbiAoYWN0b3JJbmZvKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU29jaWFsUXVlcnlfMSwgXCJmb2xsb3dcIikucG9zdENvcmUoeyBib2R5OiB0aGlzLmNyZWF0ZVNvY2lhbEFjdG9ySW5mb1JlcXVlc3RCb2R5KGFjdG9ySW5mbykgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgY3VycmVudCB1c2VyIGlzIGZvbGxvd2luZyBhIHNwZWNpZmllZCB1c2VyLCBkb2N1bWVudCwgc2l0ZSwgb3IgdGFnXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFjdG9ySW5mbyBUaGUgYWN0b3IgdG8gZmluZCB0aGUgZm9sbG93aW5nIHN0YXR1cyBmb3JcclxuICAgICAqL1xyXG4gICAgU29jaWFsUXVlcnkucHJvdG90eXBlLmlzRm9sbG93ZWQgPSBmdW5jdGlvbiAoYWN0b3JJbmZvKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoU29jaWFsUXVlcnlfMSwgXCJpc2ZvbGxvd2VkXCIpLnBvc3RDb3JlKHsgYm9keTogdGhpcy5jcmVhdGVTb2NpYWxBY3RvckluZm9SZXF1ZXN0Qm9keShhY3RvckluZm8pIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogTWFrZXMgdGhlIGN1cnJlbnQgdXNlciBzdG9wIGZvbGxvd2luZyBhIHVzZXIsIGRvY3VtZW50LCBzaXRlLCBvciB0YWdcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYWN0b3JJbmZvIFRoZSBhY3RvciB0byBzdG9wIGZvbGxvd2luZ1xyXG4gICAgICovXHJcbiAgICBTb2NpYWxRdWVyeS5wcm90b3R5cGUuc3RvcEZvbGxvd2luZyA9IGZ1bmN0aW9uIChhY3RvckluZm8pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShTb2NpYWxRdWVyeV8xLCBcInN0b3Bmb2xsb3dpbmdcIikucG9zdENvcmUoeyBib2R5OiB0aGlzLmNyZWF0ZVNvY2lhbEFjdG9ySW5mb1JlcXVlc3RCb2R5KGFjdG9ySW5mbykgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIFNvY2lhbEFjdG9ySW5mbyByZXF1ZXN0IGJvZHlcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYWN0b3JJbmZvIFRoZSBhY3RvciB0byBjcmVhdGUgcmVxdWVzdCBib2R5XHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFF1ZXJ5LnByb3RvdHlwZS5jcmVhdGVTb2NpYWxBY3RvckluZm9SZXF1ZXN0Qm9keSA9IGZ1bmN0aW9uIChhY3RvckluZm8pIHtcclxuICAgICAgICByZXR1cm4ganNTKHtcclxuICAgICAgICAgICAgXCJhY3RvclwiOiBPYmplY3QuYXNzaWduKG1ldGFkYXRhKFwiU1AuU29jaWFsLlNvY2lhbEFjdG9ySW5mb1wiKSwge1xyXG4gICAgICAgICAgICAgICAgSWQ6IG51bGwsXHJcbiAgICAgICAgICAgIH0sIGFjdG9ySW5mbyksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIFNvY2lhbFF1ZXJ5XzE7XHJcbiAgICBTb2NpYWxRdWVyeSA9IFNvY2lhbFF1ZXJ5XzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcIl9hcGkvc29jaWFsLmZvbGxvd2luZ1wiKVxyXG4gICAgXSwgU29jaWFsUXVlcnkpO1xyXG4gICAgcmV0dXJuIFNvY2lhbFF1ZXJ5O1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG52YXIgTXlTb2NpYWxRdWVyeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhNeVNvY2lhbFF1ZXJ5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gTXlTb2NpYWxRdWVyeSgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBNeVNvY2lhbFF1ZXJ5XzEgPSBNeVNvY2lhbFF1ZXJ5O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHVzZXJzLCBkb2N1bWVudHMsIHNpdGVzLCBhbmQgdGFncyB0aGF0IHRoZSBjdXJyZW50IHVzZXIgaXMgZm9sbG93aW5nLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0eXBlcyBCaXR3aXNlIHNldCBvZiBTb2NpYWxBY3RvclR5cGVzIHRvIHJldHJpZXZlXHJcbiAgICAgKi9cclxuICAgIE15U29jaWFsUXVlcnkucHJvdG90eXBlLmZvbGxvd2VkID0gZnVuY3Rpb24gKHR5cGVzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoTXlTb2NpYWxRdWVyeV8xLCBcImZvbGxvd2VkKHR5cGVzPVwiICsgdHlwZXMgKyBcIilcIikuZ2V0KCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICByZXR1cm4gaE9QKHIsIFwiRm9sbG93ZWRcIikgPyByLkZvbGxvd2VkLnJlc3VsdHMgOiByO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgY291bnQgb2YgdXNlcnMsIGRvY3VtZW50cywgc2l0ZXMsIGFuZCB0YWdzIHRoYXQgdGhlIGN1cnJlbnQgdXNlciBpcyBmb2xsb3dpbmcuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHR5cGVzIEJpdHdpc2Ugc2V0IG9mIFNvY2lhbEFjdG9yVHlwZXMgdG8gcmV0cmlldmVcclxuICAgICAqL1xyXG4gICAgTXlTb2NpYWxRdWVyeS5wcm90b3R5cGUuZm9sbG93ZWRDb3VudCA9IGZ1bmN0aW9uICh0eXBlcykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKE15U29jaWFsUXVlcnlfMSwgXCJmb2xsb3dlZGNvdW50KHR5cGVzPVwiICsgdHlwZXMgKyBcIilcIikuZ2V0KCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICByZXR1cm4gci5Gb2xsb3dlZENvdW50IHx8IHI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSB1c2VycyB3aG8gYXJlIGZvbGxvd2luZyB0aGUgY3VycmVudCB1c2VyLlxyXG4gICAgICovXHJcbiAgICBNeVNvY2lhbFF1ZXJ5LnByb3RvdHlwZS5mb2xsb3dlcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoTXlTb2NpYWxRdWVyeV8xLCBcImZvbGxvd2Vyc1wiKS5nZXQoKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBoT1AociwgXCJGb2xsb3dlcnNcIikgPyByLkZvbGxvd2Vycy5yZXN1bHRzIDogcjtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdXNlcnMgd2hvIHRoZSBjdXJyZW50IHVzZXIgbWlnaHQgd2FudCB0byBmb2xsb3cuXHJcbiAgICAgKi9cclxuICAgIE15U29jaWFsUXVlcnkucHJvdG90eXBlLnN1Z2dlc3Rpb25zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKE15U29jaWFsUXVlcnlfMSwgXCJzdWdnZXN0aW9uc1wiKS5nZXQoKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBoT1AociwgXCJTdWdnZXN0aW9uc1wiKSA/IHIuU3VnZ2VzdGlvbnMucmVzdWx0cyA6IHI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIE15U29jaWFsUXVlcnlfMTtcclxuICAgIE15U29jaWFsUXVlcnkgPSBNeVNvY2lhbFF1ZXJ5XzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBkZWZhdWx0UGF0aChcIm15XCIpXHJcbiAgICBdLCBNeVNvY2lhbFF1ZXJ5KTtcclxuICAgIHJldHVybiBNeVNvY2lhbFF1ZXJ5O1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGVJbnN0YW5jZSkpO1xyXG4vKipcclxuICogU29jaWFsIGFjdG9yIHR5cGVcclxuICpcclxuICovXHJcbnZhciBTb2NpYWxBY3RvclR5cGU7XHJcbihmdW5jdGlvbiAoU29jaWFsQWN0b3JUeXBlKSB7XHJcbiAgICBTb2NpYWxBY3RvclR5cGVbU29jaWFsQWN0b3JUeXBlW1wiVXNlclwiXSA9IDBdID0gXCJVc2VyXCI7XHJcbiAgICBTb2NpYWxBY3RvclR5cGVbU29jaWFsQWN0b3JUeXBlW1wiRG9jdW1lbnRcIl0gPSAxXSA9IFwiRG9jdW1lbnRcIjtcclxuICAgIFNvY2lhbEFjdG9yVHlwZVtTb2NpYWxBY3RvclR5cGVbXCJTaXRlXCJdID0gMl0gPSBcIlNpdGVcIjtcclxuICAgIFNvY2lhbEFjdG9yVHlwZVtTb2NpYWxBY3RvclR5cGVbXCJUYWdcIl0gPSAzXSA9IFwiVGFnXCI7XHJcbn0pKFNvY2lhbEFjdG9yVHlwZSB8fCAoU29jaWFsQWN0b3JUeXBlID0ge30pKTtcclxuLyoqXHJcbiAqIFNvY2lhbCBhY3RvciB0eXBlXHJcbiAqXHJcbiAqL1xyXG4vKiB0c2xpbnQ6ZGlzYWJsZTpuby1iaXR3aXNlICovXHJcbnZhciBTb2NpYWxBY3RvclR5cGVzO1xyXG4oZnVuY3Rpb24gKFNvY2lhbEFjdG9yVHlwZXMpIHtcclxuICAgIFNvY2lhbEFjdG9yVHlwZXNbU29jaWFsQWN0b3JUeXBlc1tcIk5vbmVcIl0gPSAwXSA9IFwiTm9uZVwiO1xyXG4gICAgU29jaWFsQWN0b3JUeXBlc1tTb2NpYWxBY3RvclR5cGVzW1wiVXNlclwiXSA9IDFdID0gXCJVc2VyXCI7XHJcbiAgICBTb2NpYWxBY3RvclR5cGVzW1NvY2lhbEFjdG9yVHlwZXNbXCJEb2N1bWVudFwiXSA9IDJdID0gXCJEb2N1bWVudFwiO1xyXG4gICAgU29jaWFsQWN0b3JUeXBlc1tTb2NpYWxBY3RvclR5cGVzW1wiU2l0ZVwiXSA9IDRdID0gXCJTaXRlXCI7XHJcbiAgICBTb2NpYWxBY3RvclR5cGVzW1NvY2lhbEFjdG9yVHlwZXNbXCJUYWdcIl0gPSA4XSA9IFwiVGFnXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBzZXQgZXhjbHVkZXMgZG9jdW1lbnRzIGFuZCBzaXRlcyB0aGF0IGRvIG5vdCBoYXZlIGZlZWRzLlxyXG4gICAgICovXHJcbiAgICBTb2NpYWxBY3RvclR5cGVzW1NvY2lhbEFjdG9yVHlwZXNbXCJFeGNsdWRlQ29udGVudFdpdGhvdXRGZWVkc1wiXSA9IDI2ODQzNTQ1Nl0gPSBcIkV4Y2x1ZGVDb250ZW50V2l0aG91dEZlZWRzXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBzZXQgaW5jbHVkZXMgZ3JvdXAgc2l0ZXNcclxuICAgICAqL1xyXG4gICAgU29jaWFsQWN0b3JUeXBlc1tTb2NpYWxBY3RvclR5cGVzW1wiSW5jbHVkZUdyb3Vwc1NpdGVzXCJdID0gNTM2ODcwOTEyXSA9IFwiSW5jbHVkZUdyb3Vwc1NpdGVzXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBzZXQgaW5jbHVkZXMgb25seSBpdGVtcyBjcmVhdGVkIHdpdGhpbiB0aGUgbGFzdCAyNCBob3Vyc1xyXG4gICAgICovXHJcbiAgICBTb2NpYWxBY3RvclR5cGVzW1NvY2lhbEFjdG9yVHlwZXNbXCJXaXRoaW5MYXN0MjRIb3Vyc1wiXSA9IDEwNzM3NDE4MjRdID0gXCJXaXRoaW5MYXN0MjRIb3Vyc1wiO1xyXG59KShTb2NpYWxBY3RvclR5cGVzIHx8IChTb2NpYWxBY3RvclR5cGVzID0ge30pKTtcclxuLyogdHNsaW50OmVuYWJsZSAqL1xyXG4vKipcclxuICogUmVzdWx0IGZyb20gZm9sbG93aW5nXHJcbiAqXHJcbiAqL1xyXG52YXIgU29jaWFsRm9sbG93UmVzdWx0O1xyXG4oZnVuY3Rpb24gKFNvY2lhbEZvbGxvd1Jlc3VsdCkge1xyXG4gICAgU29jaWFsRm9sbG93UmVzdWx0W1NvY2lhbEZvbGxvd1Jlc3VsdFtcIk9rXCJdID0gMF0gPSBcIk9rXCI7XHJcbiAgICBTb2NpYWxGb2xsb3dSZXN1bHRbU29jaWFsRm9sbG93UmVzdWx0W1wiQWxyZWFkeUZvbGxvd2luZ1wiXSA9IDFdID0gXCJBbHJlYWR5Rm9sbG93aW5nXCI7XHJcbiAgICBTb2NpYWxGb2xsb3dSZXN1bHRbU29jaWFsRm9sbG93UmVzdWx0W1wiTGltaXRSZWFjaGVkXCJdID0gMl0gPSBcIkxpbWl0UmVhY2hlZFwiO1xyXG4gICAgU29jaWFsRm9sbG93UmVzdWx0W1NvY2lhbEZvbGxvd1Jlc3VsdFtcIkludGVybmFsRXJyb3JcIl0gPSAzXSA9IFwiSW50ZXJuYWxFcnJvclwiO1xyXG59KShTb2NpYWxGb2xsb3dSZXN1bHQgfHwgKFNvY2lhbEZvbGxvd1Jlc3VsdCA9IHt9KSk7XHJcbi8qKlxyXG4gKiBTcGVjaWZpZXMgYW4gZXhjZXB0aW9uIG9yIHN0YXR1cyBjb2RlLlxyXG4gKi9cclxudmFyIFNvY2lhbFN0YXR1c0NvZGU7XHJcbihmdW5jdGlvbiAoU29jaWFsU3RhdHVzQ29kZSkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgb3BlcmF0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHlcclxuICAgICAqL1xyXG4gICAgU29jaWFsU3RhdHVzQ29kZVtTb2NpYWxTdGF0dXNDb2RlW1wiT0tcIl0gPSAwXSA9IFwiT0tcIjtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIHJlcXVlc3QgaXMgaW52YWxpZC5cclxuICAgICAqL1xyXG4gICAgU29jaWFsU3RhdHVzQ29kZVtTb2NpYWxTdGF0dXNDb2RlW1wiSW52YWxpZFJlcXVlc3RcIl0gPSAxXSA9IFwiSW52YWxpZFJlcXVlc3RcIjtcclxuICAgIC8qKlxyXG4gICAgICogIFRoZSBjdXJyZW50IHVzZXIgaXMgbm90IGF1dGhvcml6ZWQgdG8gcGVyZm9ybSB0aGUgb3BlcmF0aW9uLlxyXG4gICAgICovXHJcbiAgICBTb2NpYWxTdGF0dXNDb2RlW1NvY2lhbFN0YXR1c0NvZGVbXCJBY2Nlc3NEZW5pZWRcIl0gPSAyXSA9IFwiQWNjZXNzRGVuaWVkXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSB0YXJnZXQgb2YgdGhlIG9wZXJhdGlvbiB3YXMgbm90IGZvdW5kLlxyXG4gICAgICovXHJcbiAgICBTb2NpYWxTdGF0dXNDb2RlW1NvY2lhbFN0YXR1c0NvZGVbXCJJdGVtTm90Rm91bmRcIl0gPSAzXSA9IFwiSXRlbU5vdEZvdW5kXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBvcGVyYXRpb24gaXMgaW52YWxpZCBmb3IgdGhlIHRhcmdldCdzIGN1cnJlbnQgc3RhdGUuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFN0YXR1c0NvZGVbU29jaWFsU3RhdHVzQ29kZVtcIkludmFsaWRPcGVyYXRpb25cIl0gPSA0XSA9IFwiSW52YWxpZE9wZXJhdGlvblwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgb3BlcmF0aW9uIGNvbXBsZXRlZCB3aXRob3V0IG1vZGlmeWluZyB0aGUgdGFyZ2V0LlxyXG4gICAgICovXHJcbiAgICBTb2NpYWxTdGF0dXNDb2RlW1NvY2lhbFN0YXR1c0NvZGVbXCJJdGVtTm90TW9kaWZpZWRcIl0gPSA1XSA9IFwiSXRlbU5vdE1vZGlmaWVkXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBvcGVyYXRpb24gZmFpbGVkIGJlY2F1c2UgYW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFN0YXR1c0NvZGVbU29jaWFsU3RhdHVzQ29kZVtcIkludGVybmFsRXJyb3JcIl0gPSA2XSA9IFwiSW50ZXJuYWxFcnJvclwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgb3BlcmF0aW9uIGZhaWxlZCBiZWNhdXNlIHRoZSBzZXJ2ZXIgY291bGQgbm90IGFjY2VzcyB0aGUgZGlzdHJpYnV0ZWQgY2FjaGUuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFN0YXR1c0NvZGVbU29jaWFsU3RhdHVzQ29kZVtcIkNhY2hlUmVhZEVycm9yXCJdID0gN10gPSBcIkNhY2hlUmVhZEVycm9yXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBvcGVyYXRpb24gc3VjY2VlZGVkIGJ1dCB0aGUgc2VydmVyIGNvdWxkIG5vdCB1cGRhdGUgdGhlIGRpc3RyaWJ1dGVkIGNhY2hlLlxyXG4gICAgICovXHJcbiAgICBTb2NpYWxTdGF0dXNDb2RlW1NvY2lhbFN0YXR1c0NvZGVbXCJDYWNoZVVwZGF0ZUVycm9yXCJdID0gOF0gPSBcIkNhY2hlVXBkYXRlRXJyb3JcIjtcclxuICAgIC8qKlxyXG4gICAgICogTm8gcGVyc29uYWwgc2l0ZSBleGlzdHMgZm9yIHRoZSBjdXJyZW50IHVzZXIsIGFuZCBubyBmdXJ0aGVyIGluZm9ybWF0aW9uIGlzIGF2YWlsYWJsZS5cclxuICAgICAqL1xyXG4gICAgU29jaWFsU3RhdHVzQ29kZVtTb2NpYWxTdGF0dXNDb2RlW1wiUGVyc29uYWxTaXRlTm90Rm91bmRcIl0gPSA5XSA9IFwiUGVyc29uYWxTaXRlTm90Rm91bmRcIjtcclxuICAgIC8qKlxyXG4gICAgICogTm8gcGVyc29uYWwgc2l0ZSBleGlzdHMgZm9yIHRoZSBjdXJyZW50IHVzZXIsIGFuZCBhIHByZXZpb3VzIGF0dGVtcHQgdG8gY3JlYXRlIG9uZSBmYWlsZWQuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFN0YXR1c0NvZGVbU29jaWFsU3RhdHVzQ29kZVtcIkZhaWxlZFRvQ3JlYXRlUGVyc29uYWxTaXRlXCJdID0gMTBdID0gXCJGYWlsZWRUb0NyZWF0ZVBlcnNvbmFsU2l0ZVwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBObyBwZXJzb25hbCBzaXRlIGV4aXN0cyBmb3IgdGhlIGN1cnJlbnQgdXNlciwgYW5kIGEgcHJldmlvdXMgYXR0ZW1wdCB0byBjcmVhdGUgb25lIHdhcyBub3QgYXV0aG9yaXplZC5cclxuICAgICAqL1xyXG4gICAgU29jaWFsU3RhdHVzQ29kZVtTb2NpYWxTdGF0dXNDb2RlW1wiTm90QXV0aG9yaXplZFRvQ3JlYXRlUGVyc29uYWxTaXRlXCJdID0gMTFdID0gXCJOb3RBdXRob3JpemVkVG9DcmVhdGVQZXJzb25hbFNpdGVcIjtcclxuICAgIC8qKlxyXG4gICAgICogTm8gcGVyc29uYWwgc2l0ZSBleGlzdHMgZm9yIHRoZSBjdXJyZW50IHVzZXIsIGFuZCBubyBhdHRlbXB0IHNob3VsZCBiZSBtYWRlIHRvIGNyZWF0ZSBvbmUuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFN0YXR1c0NvZGVbU29jaWFsU3RhdHVzQ29kZVtcIkNhbm5vdENyZWF0ZVBlcnNvbmFsU2l0ZVwiXSA9IDEyXSA9IFwiQ2Fubm90Q3JlYXRlUGVyc29uYWxTaXRlXCI7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBvcGVyYXRpb24gd2FzIHJlamVjdGVkIGJlY2F1c2UgYW4gaW50ZXJuYWwgbGltaXQgaGFkIGJlZW4gcmVhY2hlZC5cclxuICAgICAqL1xyXG4gICAgU29jaWFsU3RhdHVzQ29kZVtTb2NpYWxTdGF0dXNDb2RlW1wiTGltaXRSZWFjaGVkXCJdID0gMTNdID0gXCJMaW1pdFJlYWNoZWRcIjtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIG9wZXJhdGlvbiBmYWlsZWQgYmVjYXVzZSBhbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgdGhlIHByb2Nlc3Npbmcgb2YgdGhlIHNwZWNpZmllZCBhdHRhY2htZW50LlxyXG4gICAgICovXHJcbiAgICBTb2NpYWxTdGF0dXNDb2RlW1NvY2lhbFN0YXR1c0NvZGVbXCJBdHRhY2htZW50RXJyb3JcIl0gPSAxNF0gPSBcIkF0dGFjaG1lbnRFcnJvclwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgb3BlcmF0aW9uIHN1Y2NlZWRlZCB3aXRoIHJlY292ZXJhYmxlIGVycm9yczsgdGhlIHJldHVybmVkIGRhdGEgaXMgaW5jb21wbGV0ZS5cclxuICAgICAqL1xyXG4gICAgU29jaWFsU3RhdHVzQ29kZVtTb2NpYWxTdGF0dXNDb2RlW1wiUGFydGlhbERhdGFcIl0gPSAxNV0gPSBcIlBhcnRpYWxEYXRhXCI7XHJcbiAgICAvKipcclxuICAgICAqIEEgcmVxdWlyZWQgU2hhcmVQb2ludCBmZWF0dXJlIGlzIG5vdCBlbmFibGVkLlxyXG4gICAgICovXHJcbiAgICBTb2NpYWxTdGF0dXNDb2RlW1NvY2lhbFN0YXR1c0NvZGVbXCJGZWF0dXJlRGlzYWJsZWRcIl0gPSAxNl0gPSBcIkZlYXR1cmVEaXNhYmxlZFwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgc2l0ZSdzIHN0b3JhZ2UgcXVvdGEgaGFzIGJlZW4gZXhjZWVkZWQuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFN0YXR1c0NvZGVbU29jaWFsU3RhdHVzQ29kZVtcIlN0b3JhZ2VRdW90YUV4Y2VlZGVkXCJdID0gMTddID0gXCJTdG9yYWdlUXVvdGFFeGNlZWRlZFwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgb3BlcmF0aW9uIGZhaWxlZCBiZWNhdXNlIHRoZSBzZXJ2ZXIgY291bGQgbm90IGFjY2VzcyB0aGUgZGF0YWJhc2UuXHJcbiAgICAgKi9cclxuICAgIFNvY2lhbFN0YXR1c0NvZGVbU29jaWFsU3RhdHVzQ29kZVtcIkRhdGFiYXNlRXJyb3JcIl0gPSAxOF0gPSBcIkRhdGFiYXNlRXJyb3JcIjtcclxufSkoU29jaWFsU3RhdHVzQ29kZSB8fCAoU29jaWFsU3RhdHVzQ29kZSA9IHt9KSk7XG5cbi8qKlxyXG4gKiBBbGxvd3MgZm9yIGNhbGxpbmcgb2YgdGhlIHN0YXRpYyBTUC5VdGlsaXRpZXMuVXRpbGl0eSBtZXRob2RzIGJ5IHN1cHBseWluZyB0aGUgbWV0aG9kIG5hbWVcclxuICovXHJcbnZhciBVdGlsaXR5TWV0aG9kID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFV0aWxpdHlNZXRob2QsIF9zdXBlcik7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFV0aWxpdHkgbWV0aG9kIGNsYXNzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGJhc2VVcmwgVGhlIHBhcmVudCB1cmwgcHJvdmlkZXJcclxuICAgICAqIEBwYXJhbSBtZXRob2ROYW1lIFRoZSBzdGF0aWMgbWV0aG9kIG5hbWUgdG8gY2FsbCBvbiB0aGUgdXRpbGl0eSBjbGFzc1xyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBVdGlsaXR5TWV0aG9kKGJhc2VVcmwsIG1ldGhvZE5hbWUpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyLmNhbGwodGhpcywgVXRpbGl0eU1ldGhvZC5nZXRCYXNlVXJsKGJhc2VVcmwpLCBcIl9hcGkvU1AuVXRpbGl0aWVzLlV0aWxpdHkuXCIgKyBtZXRob2ROYW1lKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgVXRpbGl0eU1ldGhvZC5nZXRCYXNlVXJsID0gZnVuY3Rpb24gKGNhbmRpZGF0ZSkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgY2FuZGlkYXRlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjYW5kaWRhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjID0gY2FuZGlkYXRlO1xyXG4gICAgICAgIHZhciB1cmwgPSBjLnRvVXJsKCk7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gdXJsLmluZGV4T2YoXCJfYXBpL1wiKTtcclxuICAgICAgICBpZiAoaW5kZXggPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1cmw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1cmwuc3Vic3RyKDAsIGluZGV4KTtcclxuICAgIH07XHJcbiAgICBVdGlsaXR5TWV0aG9kLnByb3RvdHlwZS5leGN1dGUgPSBmdW5jdGlvbiAocHJvcHMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wb3N0Q29yZSh7XHJcbiAgICAgICAgICAgIGJvZHk6IGpzUyhwcm9wcyksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBTZW5kcyBhbiBlbWFpbCBiYXNlZCBvbiB0aGUgc3VwcGxpZWQgcHJvcGVydGllc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwcm9wcyBUaGUgcHJvcGVydGllcyBvZiB0aGUgZW1haWwgdG8gc2VuZFxyXG4gICAgICovXHJcbiAgICBVdGlsaXR5TWV0aG9kLnByb3RvdHlwZS5zZW5kRW1haWwgPSBmdW5jdGlvbiAocHJvcHMpIHtcclxuICAgICAgICB2YXIgcGFyYW1zID0ge1xyXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiBleHRlbmQobWV0YWRhdGEoXCJTUC5VdGlsaXRpZXMuRW1haWxQcm9wZXJ0aWVzXCIpLCB7XHJcbiAgICAgICAgICAgICAgICBCb2R5OiBwcm9wcy5Cb2R5LFxyXG4gICAgICAgICAgICAgICAgRnJvbTogcHJvcHMuRnJvbSxcclxuICAgICAgICAgICAgICAgIFN1YmplY3Q6IHByb3BzLlN1YmplY3QsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHByb3BzLlRvICYmIHByb3BzLlRvLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcGFyYW1zLnByb3BlcnRpZXMgPSBleHRlbmQocGFyYW1zLnByb3BlcnRpZXMsIHtcclxuICAgICAgICAgICAgICAgIFRvOiB7IHJlc3VsdHM6IHByb3BzLlRvIH0sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocHJvcHMuQ0MgJiYgcHJvcHMuQ0MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBwYXJhbXMucHJvcGVydGllcyA9IGV4dGVuZChwYXJhbXMucHJvcGVydGllcywge1xyXG4gICAgICAgICAgICAgICAgQ0M6IHsgcmVzdWx0czogcHJvcHMuQ0MgfSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9wcy5CQ0MgJiYgcHJvcHMuQkNDLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcGFyYW1zLnByb3BlcnRpZXMgPSBleHRlbmQocGFyYW1zLnByb3BlcnRpZXMsIHtcclxuICAgICAgICAgICAgICAgIEJDQzogeyByZXN1bHRzOiBwcm9wcy5CQ0MgfSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9wcy5BZGRpdGlvbmFsSGVhZGVycykge1xyXG4gICAgICAgICAgICBwYXJhbXMucHJvcGVydGllcyA9IGV4dGVuZChwYXJhbXMucHJvcGVydGllcywge1xyXG4gICAgICAgICAgICAgICAgQWRkaXRpb25hbEhlYWRlcnM6IHByb3BzLkFkZGl0aW9uYWxIZWFkZXJzLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoVXRpbGl0eU1ldGhvZCwgXCJTZW5kRW1haWxcIiwgdHJ1ZSkuZXhjdXRlKHBhcmFtcyk7XHJcbiAgICB9O1xyXG4gICAgVXRpbGl0eU1ldGhvZC5wcm90b3R5cGUuZ2V0Q3VycmVudFVzZXJFbWFpbEFkZHJlc3NlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShVdGlsaXR5TWV0aG9kLCBcIkdldEN1cnJlbnRVc2VyRW1haWxBZGRyZXNzZXNcIiwgdHJ1ZSkuZXhjdXRlKHt9KTtcclxuICAgIH07XHJcbiAgICBVdGlsaXR5TWV0aG9kLnByb3RvdHlwZS5yZXNvbHZlUHJpbmNpcGFsID0gZnVuY3Rpb24gKGlucHV0LCBzY29wZXMsIHNvdXJjZXMsIGlucHV0SXNFbWFpbE9ubHksIGFkZFRvVXNlckluZm9MaXN0LCBtYXRjaFVzZXJJbmZvTGlzdCkge1xyXG4gICAgICAgIGlmIChtYXRjaFVzZXJJbmZvTGlzdCA9PT0gdm9pZCAwKSB7IG1hdGNoVXNlckluZm9MaXN0ID0gZmFsc2U7IH1cclxuICAgICAgICB2YXIgcGFyYW1zID0ge1xyXG4gICAgICAgICAgICBhZGRUb1VzZXJJbmZvTGlzdDogYWRkVG9Vc2VySW5mb0xpc3QsXHJcbiAgICAgICAgICAgIGlucHV0OiBpbnB1dCxcclxuICAgICAgICAgICAgaW5wdXRJc0VtYWlsT25seTogaW5wdXRJc0VtYWlsT25seSxcclxuICAgICAgICAgICAgbWF0Y2hVc2VySW5mb0xpc3Q6IG1hdGNoVXNlckluZm9MaXN0LFxyXG4gICAgICAgICAgICBzY29wZXM6IHNjb3BlcyxcclxuICAgICAgICAgICAgc291cmNlczogc291cmNlcyxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFV0aWxpdHlNZXRob2QsIFwiUmVzb2x2ZVByaW5jaXBhbEluQ3VycmVudENvbnRleHRcIiwgdHJ1ZSkuZXhjdXRlKHBhcmFtcyk7XHJcbiAgICB9O1xyXG4gICAgVXRpbGl0eU1ldGhvZC5wcm90b3R5cGUuc2VhcmNoUHJpbmNpcGFscyA9IGZ1bmN0aW9uIChpbnB1dCwgc2NvcGVzLCBzb3VyY2VzLCBncm91cE5hbWUsIG1heENvdW50KSB7XHJcbiAgICAgICAgdmFyIHBhcmFtcyA9IHtcclxuICAgICAgICAgICAgZ3JvdXBOYW1lOiBncm91cE5hbWUsXHJcbiAgICAgICAgICAgIGlucHV0OiBpbnB1dCxcclxuICAgICAgICAgICAgbWF4Q291bnQ6IG1heENvdW50LFxyXG4gICAgICAgICAgICBzY29wZXM6IHNjb3BlcyxcclxuICAgICAgICAgICAgc291cmNlczogc291cmNlcyxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKFV0aWxpdHlNZXRob2QsIFwiU2VhcmNoUHJpbmNpcGFsc1VzaW5nQ29udGV4dFdlYlwiLCB0cnVlKS5leGN1dGUocGFyYW1zKTtcclxuICAgIH07XHJcbiAgICBVdGlsaXR5TWV0aG9kLnByb3RvdHlwZS5jcmVhdGVFbWFpbEJvZHlGb3JJbnZpdGF0aW9uID0gZnVuY3Rpb24gKHBhZ2VBZGRyZXNzKSB7XHJcbiAgICAgICAgdmFyIHBhcmFtcyA9IHtcclxuICAgICAgICAgICAgcGFnZUFkZHJlc3M6IHBhZ2VBZGRyZXNzLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoVXRpbGl0eU1ldGhvZCwgXCJDcmVhdGVFbWFpbEJvZHlGb3JJbnZpdGF0aW9uXCIsIHRydWUpLmV4Y3V0ZShwYXJhbXMpO1xyXG4gICAgfTtcclxuICAgIFV0aWxpdHlNZXRob2QucHJvdG90eXBlLmV4cGFuZEdyb3Vwc1RvUHJpbmNpcGFscyA9IGZ1bmN0aW9uIChpbnB1dHMsIG1heENvdW50KSB7XHJcbiAgICAgICAgaWYgKG1heENvdW50ID09PSB2b2lkIDApIHsgbWF4Q291bnQgPSAzMDsgfVxyXG4gICAgICAgIHZhciBwYXJhbXMgPSB7XHJcbiAgICAgICAgICAgIGlucHV0czogaW5wdXRzLFxyXG4gICAgICAgICAgICBtYXhDb3VudDogbWF4Q291bnQsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShVdGlsaXR5TWV0aG9kLCBcIkV4cGFuZEdyb3Vwc1RvUHJpbmNpcGFsc1wiLCB0cnVlKS5leGN1dGUocGFyYW1zKTtcclxuICAgIH07XHJcbiAgICBVdGlsaXR5TWV0aG9kLnByb3RvdHlwZS5jcmVhdGVXaWtpUGFnZSA9IGZ1bmN0aW9uIChpbmZvKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoVXRpbGl0eU1ldGhvZCwgXCJDcmVhdGVXaWtpUGFnZUluQ29udGV4dFdlYlwiLCB0cnVlKS5leGN1dGUoe1xyXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiBpbmZvLFxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IHIsXHJcbiAgICAgICAgICAgICAgICBmaWxlOiBuZXcgRmlsZShvZGF0YVVybEZyb20ocikpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBVdGlsaXR5TWV0aG9kO1xyXG59KFNoYXJlUG9pbnRRdWVyeWFibGUpKTtcblxuLyoqXHJcbiAqIFJvb3Qgb2YgdGhlIFNoYXJlUG9pbnQgUkVTVCBtb2R1bGVcclxuICovXHJcbnZhciBTUFJlc3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFNQUmVzdCBjbGFzc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgb3B0aW9uc1xyXG4gICAgICogQHBhcmFtIGJhc2VVcmwgQSBzdHJpbmcgdGhhdCBzaG91bGQgZm9ybSB0aGUgYmFzZSBwYXJ0IG9mIHRoZSB1cmxcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gU1BSZXN0KF9vcHRpb25zLCBfYmFzZVVybCkge1xyXG4gICAgICAgIGlmIChfb3B0aW9ucyA9PT0gdm9pZCAwKSB7IF9vcHRpb25zID0ge307IH1cclxuICAgICAgICBpZiAoX2Jhc2VVcmwgPT09IHZvaWQgMCkgeyBfYmFzZVVybCA9IFwiXCI7IH1cclxuICAgICAgICB0aGlzLl9vcHRpb25zID0gX29wdGlvbnM7XHJcbiAgICAgICAgdGhpcy5fYmFzZVVybCA9IF9iYXNlVXJsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDb25maWd1cmVzIGluc3RhbmNlIHdpdGggYWRkaXRpb25hbCBvcHRpb25zIGFuZCBiYXNlVXJsLlxyXG4gICAgICogUHJvdmlkZWQgY29uZmlndXJhdGlvbiB1c2VkIGJ5IG90aGVyIG9iamVjdHMgaW4gYSBjaGFpblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgb3B0aW9uc1xyXG4gICAgICogQHBhcmFtIGJhc2VVcmwgQSBzdHJpbmcgdGhhdCBzaG91bGQgZm9ybSB0aGUgYmFzZSBwYXJ0IG9mIHRoZSB1cmxcclxuICAgICAqL1xyXG4gICAgU1BSZXN0LnByb3RvdHlwZS5jb25maWd1cmUgPSBmdW5jdGlvbiAob3B0aW9ucywgYmFzZVVybCkge1xyXG4gICAgICAgIGlmIChiYXNlVXJsID09PSB2b2lkIDApIHsgYmFzZVVybCA9IFwiXCI7IH1cclxuICAgICAgICByZXR1cm4gbmV3IFNQUmVzdChvcHRpb25zLCBiYXNlVXJsKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEdsb2JhbCBTaGFyZVBvaW50IGNvbmZpZ3VyYXRpb24gb3B0aW9uc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb25maWcgVGhlIFNoYXJlUG9pbnQgY29uZmlndXJhdGlvbiB0byBhcHBseVxyXG4gICAgICovXHJcbiAgICBTUFJlc3QucHJvdG90eXBlLnNldHVwID0gZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgICAgIHNldHVwKGNvbmZpZyk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBFeGVjdXRlcyBhIHNlYXJjaCBhZ2FpbnN0IHRoaXMgd2ViIGNvbnRleHRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcXVlcnkgVGhlIFNlYXJjaFF1ZXJ5IGRlZmluaXRpb25cclxuICAgICAqL1xyXG4gICAgU1BSZXN0LnByb3RvdHlwZS5zZWFyY2hTdWdnZXN0ID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcbiAgICAgICAgdmFyIGZpbmFsUXVlcnk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBxdWVyeSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBmaW5hbFF1ZXJ5ID0geyBxdWVyeXRleHQ6IHF1ZXJ5IH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBmaW5hbFF1ZXJ5ID0gcXVlcnk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZShTZWFyY2hTdWdnZXN0KS5leGVjdXRlKGZpbmFsUXVlcnkpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogRXhlY3V0ZXMgYSBzZWFyY2ggYWdhaW5zdCB0aGlzIHdlYiBjb250ZXh0XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHF1ZXJ5IFRoZSBTZWFyY2hRdWVyeSBkZWZpbml0aW9uXHJcbiAgICAgKi9cclxuICAgIFNQUmVzdC5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKFNlYXJjaCkuZXhlY3V0ZShxdWVyeSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBFeGVjdXRlcyB0aGUgcHJvdmlkZWQgc2VhcmNoIHF1ZXJ5LCBjYWNoaW5nIHRoZSByZXN1bHRzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHF1ZXJ5IFRoZSBTZWFyY2hRdWVyeSBkZWZpbml0aW9uXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgc2V0IG9mIGNhY2hpbmcgb3B0aW9ucyB1c2VkIHRvIHN0b3JlIHRoZSByZXN1bHRzXHJcbiAgICAgKi9cclxuICAgIFNQUmVzdC5wcm90b3R5cGUuc2VhcmNoV2l0aENhY2hpbmcgPSBmdW5jdGlvbiAocXVlcnksIG9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGUoU2VhcmNoKS51c2luZ0NhY2hpbmcob3B0aW9ucykuZXhlY3V0ZShxdWVyeSk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNQUmVzdC5wcm90b3R5cGUsIFwic2l0ZVwiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQmVnaW5zIGEgc2l0ZSBjb2xsZWN0aW9uIHNjb3BlZCBSRVNUIHJlcXVlc3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGUoU2l0ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1BSZXN0LnByb3RvdHlwZSwgXCJ3ZWJcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEJlZ2lucyBhIHdlYiBzY29wZWQgUkVTVCByZXF1ZXN0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKFdlYik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1BSZXN0LnByb3RvdHlwZSwgXCJwcm9maWxlc1wiLCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQWNjZXNzIHRvIHVzZXIgcHJvZmlsZSBtZXRob2RzXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKFVzZXJQcm9maWxlUXVlcnkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNQUmVzdC5wcm90b3R5cGUsIFwic29jaWFsXCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBY2Nlc3MgdG8gc29jaWFsIG1ldGhvZHNcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKFNvY2lhbFF1ZXJ5KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTUFJlc3QucHJvdG90eXBlLCBcIm5hdmlnYXRpb25cIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFjY2VzcyB0byB0aGUgc2l0ZSBjb2xsZWN0aW9uIGxldmVsIG5hdmlnYXRpb24gc2VydmljZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IE5hdmlnYXRpb25TZXJ2aWNlKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgYmF0Y2ggb2JqZWN0IGZvciB1c2Ugd2l0aCB0aGUgU2hhcmVQb2ludFF1ZXJ5YWJsZS5hZGRUb0JhdGNoIG1ldGhvZFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgU1BSZXN0LnByb3RvdHlwZS5jcmVhdGVCYXRjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy53ZWIuY3JlYXRlQmF0Y2goKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1BSZXN0LnByb3RvdHlwZSwgXCJ1dGlsaXR5XCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTdGF0aWMgdXRpbGl0aWVzIG1ldGhvZHMgZnJvbSBTUC5VdGlsaXRpZXMuVXRpbGl0eVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGUoVXRpbGl0eU1ldGhvZCwgXCJcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEhhbmRsZXMgY3JlYXRpbmcgYW5kIGNvbmZpZ3VyaW5nIHRoZSBvYmplY3RzIHJldHVybmVkIGZyb20gdGhpcyBjbGFzc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmbSBUaGUgZmFjdG9yeSBtZXRob2QgdXNlZCB0byBjcmVhdGUgdGhlIGluc3RhbmNlXHJcbiAgICAgKiBAcGFyYW0gcGF0aCBPcHRpb25hbCBhZGRpdGlvbmFsIHBhdGggaW5mb3JtYXRpb24gdG8gcGFzcyB0byB0aGUgZmFjdG9yeSBtZXRob2RcclxuICAgICAqL1xyXG4gICAgU1BSZXN0LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoZm0sIHBhdGgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IGZtKHRoaXMuX2Jhc2VVcmwsIHBhdGgpLmNvbmZpZ3VyZSh0aGlzLl9vcHRpb25zKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU1BSZXN0O1xyXG59KCkpO1xyXG52YXIgc3AgPSBuZXcgU1BSZXN0KCk7XG5cbmV4cG9ydCB7IG9kYXRhVXJsRnJvbSwgc3BPRGF0YUVudGl0eSwgc3BPRGF0YUVudGl0eUFycmF5LCBTaGFyZVBvaW50UXVlcnlhYmxlLCBTaGFyZVBvaW50UXVlcnlhYmxlSW5zdGFuY2UsIFNoYXJlUG9pbnRRdWVyeWFibGVDb2xsZWN0aW9uLCBTaGFyZVBvaW50UXVlcnlhYmxlU2VjdXJhYmxlLCBGaWxlRm9sZGVyU2hhcmVkLCBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlLCBTaGFyZVBvaW50UXVlcnlhYmxlU2hhcmVhYmxlRmlsZSwgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUZvbGRlciwgU2hhcmVQb2ludFF1ZXJ5YWJsZVNoYXJlYWJsZUl0ZW0sIFNoYXJlUG9pbnRRdWVyeWFibGVTaGFyZWFibGVXZWIsIEFwcENhdGFsb2csIEFwcCwgU1BCYXRjaCwgQ29udGVudFR5cGUsIENvbnRlbnRUeXBlcywgRmllbGRMaW5rLCBGaWVsZExpbmtzLCBGaWVsZCwgRmllbGRzLCBDaGVja2luVHlwZSwgV2ViUGFydHNQZXJzb25hbGl6YXRpb25TY29wZSwgTW92ZU9wZXJhdGlvbnMsIFRlbXBsYXRlRmlsZVR5cGUsIEZpbGUsIEZpbGVzLCBGb2xkZXIsIEZvbGRlcnMsIFNQSHR0cENsaWVudCwgSXRlbSwgSXRlbXMsIEl0ZW1WZXJzaW9uLCBJdGVtVmVyc2lvbnMsIFBhZ2VkSXRlbUNvbGxlY3Rpb24sIE5hdmlnYXRpb25Ob2RlcywgTmF2aWdhdGlvbk5vZGUsIE5hdmlnYXRpb25TZXJ2aWNlLCBMaXN0LCBMaXN0cywgUmVnaW9uYWxTZXR0aW5ncywgSW5zdGFsbGVkTGFuZ3VhZ2VzLCBUaW1lWm9uZSwgVGltZVpvbmVzLCBzcCwgU1BSZXN0LCBSb2xlRGVmaW5pdGlvbkJpbmRpbmdzLCBTZWFyY2gsIFNlYXJjaFF1ZXJ5QnVpbGRlciwgU2VhcmNoUmVzdWx0cywgU29ydERpcmVjdGlvbiwgUmVvcmRlcmluZ1J1bGVNYXRjaFR5cGUsIFF1ZXJ5UHJvcGVydHlWYWx1ZVR5cGUsIFNlYXJjaEJ1aWx0SW5Tb3VyY2VJZCwgU2VhcmNoU3VnZ2VzdCwgU2l0ZSwgVXNlclByb2ZpbGVRdWVyeSwgdG9BYnNvbHV0ZVVybCwgZXh0cmFjdFdlYlVybCwgVXRpbGl0eU1ldGhvZCwgVmlldywgVmlld3MsIFZpZXdGaWVsZHMsIFdlYlBhcnREZWZpbml0aW9ucywgV2ViUGFydERlZmluaXRpb24sIFdlYlBhcnQsIFdlYiwgUHJvbW90ZWRTdGF0ZSwgQ2xpZW50U2lkZVBhZ2UsIENhbnZhc1NlY3Rpb24sIENhbnZhc0NvbnRyb2wsIENhbnZhc0NvbHVtbiwgQ2xpZW50U2lkZVBhcnQsIENsaWVudFNpZGVUZXh0LCBDbGllbnRTaWRlV2VicGFydCwgQ29tbWVudHMsIENvbW1lbnQsIFJlcGxpZXMsIFNvY2lhbFF1ZXJ5LCBNeVNvY2lhbFF1ZXJ5LCBTb2NpYWxBY3RvclR5cGUsIFNvY2lhbEFjdG9yVHlwZXMsIFNvY2lhbEZvbGxvd1Jlc3VsdCwgU29jaWFsU3RhdHVzQ29kZSwgQ29udHJvbE1vZGUsIEZpZWxkVHlwZXMsIERhdGVUaW1lRmllbGRGb3JtYXRUeXBlLCBBZGRGaWVsZE9wdGlvbnMsIENhbGVuZGFyVHlwZSwgVXJsRmllbGRGb3JtYXRUeXBlLCBQZXJtaXNzaW9uS2luZCwgUHJpbmNpcGFsVHlwZSQxIGFzIFByaW5jaXBhbFR5cGUsIFByaW5jaXBhbFNvdXJjZSwgUm9sZVR5cGUsIFBhZ2VUeXBlLCBTaGFyaW5nTGlua0tpbmQsIFNoYXJpbmdSb2xlLCBTaGFyaW5nT3BlcmF0aW9uU3RhdHVzQ29kZSwgU1BTaGFyZWRPYmplY3RUeXBlLCBTaGFyaW5nRG9tYWluUmVzdHJpY3Rpb25Nb2RlLCBSZW5kZXJMaXN0RGF0YU9wdGlvbnMsIEZpZWxkVXNlclNlbGVjdGlvbk1vZGUsIENob2ljZUZpZWxkRm9ybWF0VHlwZSwgVXJsWm9uZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3AuZXM1LmpzLm1hcFxuIiwiLyohIGFkYWwtYW5ndWxhciB2MS4wLjE3IDIwMTgtMDItMjcgKi9cclxudmFyIEF1dGhlbnRpY2F0aW9uQ29udGV4dD1mdW5jdGlvbigpe1widXNlIHN0cmljdFwiO3JldHVybiBBdXRoZW50aWNhdGlvbkNvbnRleHQ9ZnVuY3Rpb24oYSl7aWYodGhpcy5SRVFVRVNUX1RZUEU9e0xPR0lOOlwiTE9HSU5cIixSRU5FV19UT0tFTjpcIlJFTkVXX1RPS0VOXCIsVU5LTk9XTjpcIlVOS05PV05cIn0sdGhpcy5SRVNQT05TRV9UWVBFPXtJRF9UT0tFTl9UT0tFTjpcImlkX3Rva2VuIHRva2VuXCIsVE9LRU46XCJ0b2tlblwifSx0aGlzLkNPTlNUQU5UUz17QUNDRVNTX1RPS0VOOlwiYWNjZXNzX3Rva2VuXCIsRVhQSVJFU19JTjpcImV4cGlyZXNfaW5cIixJRF9UT0tFTjpcImlkX3Rva2VuXCIsRVJST1JfREVTQ1JJUFRJT046XCJlcnJvcl9kZXNjcmlwdGlvblwiLFNFU1NJT05fU1RBVEU6XCJzZXNzaW9uX3N0YXRlXCIsRVJST1I6XCJlcnJvclwiLFNUT1JBR0U6e1RPS0VOX0tFWVM6XCJhZGFsLnRva2VuLmtleXNcIixBQ0NFU1NfVE9LRU5fS0VZOlwiYWRhbC5hY2Nlc3MudG9rZW4ua2V5XCIsRVhQSVJBVElPTl9LRVk6XCJhZGFsLmV4cGlyYXRpb24ua2V5XCIsU1RBVEVfTE9HSU46XCJhZGFsLnN0YXRlLmxvZ2luXCIsU1RBVEVfUkVORVc6XCJhZGFsLnN0YXRlLnJlbmV3XCIsTk9OQ0VfSURUT0tFTjpcImFkYWwubm9uY2UuaWR0b2tlblwiLFNFU1NJT05fU1RBVEU6XCJhZGFsLnNlc3Npb24uc3RhdGVcIixVU0VSTkFNRTpcImFkYWwudXNlcm5hbWVcIixJRFRPS0VOOlwiYWRhbC5pZHRva2VuXCIsRVJST1I6XCJhZGFsLmVycm9yXCIsRVJST1JfREVTQ1JJUFRJT046XCJhZGFsLmVycm9yLmRlc2NyaXB0aW9uXCIsTE9HSU5fUkVRVUVTVDpcImFkYWwubG9naW4ucmVxdWVzdFwiLExPR0lOX0VSUk9SOlwiYWRhbC5sb2dpbi5lcnJvclwiLFJFTkVXX1NUQVRVUzpcImFkYWwudG9rZW4ucmVuZXcuc3RhdHVzXCIsQU5HVUxBUl9MT0dJTl9SRVFVRVNUOlwiYWRhbC5hbmd1bGFyLmxvZ2luLnJlcXVlc3RcIn0sUkVTT1VSQ0VfREVMSU1FVEVSOlwifFwiLENBQ0hFX0RFTElNRVRFUjpcInx8XCIsTE9BREZSQU1FX1RJTUVPVVQ6NmUzLFRPS0VOX1JFTkVXX1NUQVRVU19DQU5DRUxFRDpcIkNhbmNlbGVkXCIsVE9LRU5fUkVORVdfU1RBVFVTX0NPTVBMRVRFRDpcIkNvbXBsZXRlZFwiLFRPS0VOX1JFTkVXX1NUQVRVU19JTl9QUk9HUkVTUzpcIkluIFByb2dyZXNzXCIsTE9HR0lOR19MRVZFTDp7RVJST1I6MCxXQVJOOjEsSU5GTzoyLFZFUkJPU0U6M30sTEVWRUxfU1RSSU5HX01BUDp7MDpcIkVSUk9SOlwiLDE6XCJXQVJOSU5HOlwiLDI6XCJJTkZPOlwiLDM6XCJWRVJCT1NFOlwifSxQT1BVUF9XSURUSDo0ODMsUE9QVVBfSEVJR0hUOjYwMH0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fc2luZ2xldG9uSW5zdGFuY2UpcmV0dXJuIEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX3NpbmdsZXRvbkluc3RhbmNlO2lmKEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX3NpbmdsZXRvbkluc3RhbmNlPXRoaXMsdGhpcy5pbnN0YW5jZT1cImh0dHBzOi8vbG9naW4ubWljcm9zb2Z0b25saW5lLmNvbS9cIix0aGlzLmNvbmZpZz17fSx0aGlzLmNhbGxiYWNrPW51bGwsdGhpcy5wb3BVcD0hMSx0aGlzLmlzQW5ndWxhcj0hMSx0aGlzLl91c2VyPW51bGwsdGhpcy5fYWN0aXZlUmVuZXdhbHM9e30sdGhpcy5fbG9naW5JblByb2dyZXNzPSExLHRoaXMuX2FjcXVpcmVUb2tlbkluUHJvZ3Jlc3M9ITEsdGhpcy5fcmVuZXdTdGF0ZXM9W10sdGhpcy5fY2FsbEJhY2tNYXBwZWRUb1JlbmV3U3RhdGVzPXt9LHRoaXMuX2NhbGxCYWNrc01hcHBlZFRvUmVuZXdTdGF0ZXM9e30sdGhpcy5fb3BlbmVkV2luZG93cz1bXSx0aGlzLl9yZXF1ZXN0VHlwZT10aGlzLlJFUVVFU1RfVFlQRS5MT0dJTix3aW5kb3cuX2FkYWxJbnN0YW5jZT10aGlzLGEuZGlzcGxheUNhbGwmJlwiZnVuY3Rpb25cIiE9dHlwZW9mIGEuZGlzcGxheUNhbGwpdGhyb3cgbmV3IEVycm9yKFwiZGlzcGxheUNhbGwgaXMgbm90IGEgZnVuY3Rpb25cIik7aWYoIWEuY2xpZW50SWQpdGhyb3cgbmV3IEVycm9yKFwiY2xpZW50SWQgaXMgcmVxdWlyZWRcIik7dGhpcy5jb25maWc9dGhpcy5fY2xvbmVDb25maWcoYSksdm9pZCAwPT09dGhpcy5jb25maWcubmF2aWdhdGVUb0xvZ2luUmVxdWVzdFVybCYmKHRoaXMuY29uZmlnLm5hdmlnYXRlVG9Mb2dpblJlcXVlc3RVcmw9ITApLHRoaXMuY29uZmlnLnBvcFVwJiYodGhpcy5wb3BVcD0hMCksdGhpcy5jb25maWcuY2FsbGJhY2smJlwiZnVuY3Rpb25cIj09dHlwZW9mIHRoaXMuY29uZmlnLmNhbGxiYWNrJiYodGhpcy5jYWxsYmFjaz10aGlzLmNvbmZpZy5jYWxsYmFjayksdGhpcy5jb25maWcuaW5zdGFuY2UmJih0aGlzLmluc3RhbmNlPXRoaXMuY29uZmlnLmluc3RhbmNlKSx0aGlzLmNvbmZpZy5sb2dpblJlc291cmNlfHwodGhpcy5jb25maWcubG9naW5SZXNvdXJjZT10aGlzLmNvbmZpZy5jbGllbnRJZCksdGhpcy5jb25maWcucmVkaXJlY3RVcml8fCh0aGlzLmNvbmZpZy5yZWRpcmVjdFVyaT13aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdChcIj9cIilbMF0uc3BsaXQoXCIjXCIpWzBdKSx0aGlzLmNvbmZpZy5wb3N0TG9nb3V0UmVkaXJlY3RVcml8fCh0aGlzLmNvbmZpZy5wb3N0TG9nb3V0UmVkaXJlY3RVcmk9d2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoXCI/XCIpWzBdLnNwbGl0KFwiI1wiKVswXSksdGhpcy5jb25maWcuYW5vbnltb3VzRW5kcG9pbnRzfHwodGhpcy5jb25maWcuYW5vbnltb3VzRW5kcG9pbnRzPVtdKSx0aGlzLmNvbmZpZy5pc0FuZ3VsYXImJih0aGlzLmlzQW5ndWxhcj10aGlzLmNvbmZpZy5pc0FuZ3VsYXIpLHRoaXMuY29uZmlnLmxvYWRGcmFtZVRpbWVvdXQmJih0aGlzLkNPTlNUQU5UUy5MT0FERlJBTUVfVElNRU9VVD10aGlzLmNvbmZpZy5sb2FkRnJhbWVUaW1lb3V0KX0sXCJ1bmRlZmluZWRcIiE9dHlwZW9mIHdpbmRvdyYmKHdpbmRvdy5Mb2dnaW5nPXtwaWlMb2dnaW5nRW5hYmxlZDohMSxsZXZlbDowLGxvZzpmdW5jdGlvbihhKXt9fSksQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5sb2dpbj1mdW5jdGlvbigpe2lmKHRoaXMuX2xvZ2luSW5Qcm9ncmVzcylyZXR1cm4gdm9pZCB0aGlzLmluZm8oXCJMb2dpbiBpbiBwcm9ncmVzc1wiKTt0aGlzLl9sb2dpbkluUHJvZ3Jlc3M9ITA7dmFyIGE9dGhpcy5fZ3VpZCgpO3RoaXMuY29uZmlnLnN0YXRlPWEsdGhpcy5faWRUb2tlbk5vbmNlPXRoaXMuX2d1aWQoKTt2YXIgYj10aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuQU5HVUxBUl9MT0dJTl9SRVFVRVNUKTtiJiZcIlwiIT09Yj90aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFOR1VMQVJfTE9HSU5fUkVRVUVTVCxcIlwiKTpiPXdpbmRvdy5sb2NhdGlvbi5ocmVmLHRoaXMudmVyYm9zZShcIkV4cGVjdGVkIHN0YXRlOiBcIithK1wiIHN0YXJ0UGFnZTpcIitiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkxPR0lOX1JFUVVFU1QsYiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9FUlJPUixcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNUQVRFX0xPR0lOLGEsITApLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTk9OQ0VfSURUT0tFTix0aGlzLl9pZFRva2VuTm9uY2UsITApLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1IsXCJcIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTixcIlwiKTt2YXIgYz10aGlzLl9nZXROYXZpZ2F0ZVVybChcImlkX3Rva2VuXCIsbnVsbCkrXCImbm9uY2U9XCIrZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuX2lkVG9rZW5Ob25jZSk7dGhpcy5jb25maWcuZGlzcGxheUNhbGw/dGhpcy5jb25maWcuZGlzcGxheUNhbGwoYyk6dGhpcy5wb3BVcD8odGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5TVEFURV9MT0dJTixcIlwiKSx0aGlzLl9yZW5ld1N0YXRlcy5wdXNoKGEpLHRoaXMucmVnaXN0ZXJDYWxsYmFjayhhLHRoaXMuY29uZmlnLmNsaWVudElkLHRoaXMuY2FsbGJhY2spLHRoaXMuX2xvZ2luUG9wdXAoYykpOnRoaXMucHJvbXB0VXNlcihjKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fb3BlblBvcHVwPWZ1bmN0aW9uKGEsYixjLGQpe3RyeXt2YXIgZT13aW5kb3cuc2NyZWVuTGVmdD93aW5kb3cuc2NyZWVuTGVmdDp3aW5kb3cuc2NyZWVuWCxmPXdpbmRvdy5zY3JlZW5Ub3A/d2luZG93LnNjcmVlblRvcDp3aW5kb3cuc2NyZWVuWSxnPXdpbmRvdy5pbm5lcldpZHRofHxkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGh8fGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGgsaD13aW5kb3cuaW5uZXJIZWlnaHR8fGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHR8fGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0LGk9Zy8yLWMvMitlLGo9aC8yLWQvMitmLGs9d2luZG93Lm9wZW4oYSxiLFwid2lkdGg9XCIrYytcIiwgaGVpZ2h0PVwiK2QrXCIsIHRvcD1cIitqK1wiLCBsZWZ0PVwiK2kpO3JldHVybiBrLmZvY3VzJiZrLmZvY3VzKCksa31jYXRjaChhKXtyZXR1cm4gdGhpcy53YXJuKFwiRXJyb3Igb3BlbmluZyBwb3B1cCwgXCIrYS5tZXNzYWdlKSx0aGlzLl9sb2dpbkluUHJvZ3Jlc3M9ITEsdGhpcy5fYWNxdWlyZVRva2VuSW5Qcm9ncmVzcz0hMSxudWxsfX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5faGFuZGxlUG9wdXBFcnJvcj1mdW5jdGlvbihhLGIsYyxkLGUpe3RoaXMud2FybihkKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SLGMpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1JfREVTQ1JJUFRJT04sZCksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9FUlJPUixlKSxiJiZ0aGlzLl9hY3RpdmVSZW5ld2Fsc1tiXSYmKHRoaXMuX2FjdGl2ZVJlbmV3YWxzW2JdPW51bGwpLHRoaXMuX2xvZ2luSW5Qcm9ncmVzcz0hMSx0aGlzLl9hY3F1aXJlVG9rZW5JblByb2dyZXNzPSExLGEmJmEoZCxudWxsLGMpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9sb2dpblBvcHVwPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aGlzLl9vcGVuUG9wdXAoYSxcImxvZ2luXCIsdGhpcy5DT05TVEFOVFMuUE9QVVBfV0lEVEgsdGhpcy5DT05TVEFOVFMuUE9QVVBfSEVJR0hUKSxlPWN8fHRoaXMuY2FsbGJhY2s7aWYobnVsbD09ZCl7dmFyIGY9XCJQb3B1cCBXaW5kb3cgaXMgbnVsbC4gVGhpcyBjYW4gaGFwcGVuIGlmIHlvdSBhcmUgdXNpbmcgSUVcIjtyZXR1cm4gdm9pZCB0aGlzLl9oYW5kbGVQb3B1cEVycm9yKGUsYixcIkVycm9yIG9wZW5pbmcgcG9wdXBcIixmLGYpfWlmKHRoaXMuX29wZW5lZFdpbmRvd3MucHVzaChkKSwtMSE9dGhpcy5jb25maWcucmVkaXJlY3RVcmkuaW5kZXhPZihcIiNcIikpdmFyIGc9dGhpcy5jb25maWcucmVkaXJlY3RVcmkuc3BsaXQoXCIjXCIpWzBdO2Vsc2UgdmFyIGc9dGhpcy5jb25maWcucmVkaXJlY3RVcmk7dmFyIGg9dGhpcyxpPXdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpe2lmKCFkfHxkLmNsb3NlZHx8dm9pZCAwPT09ZC5jbG9zZWQpe3ZhciBhPVwiUG9wdXAgV2luZG93IGNsb3NlZFwiLGM9XCJQb3B1cCBXaW5kb3cgY2xvc2VkIGJ5IFVJIGFjdGlvbi8gUG9wdXAgV2luZG93IGhhbmRsZSBkZXN0cm95ZWQgZHVlIHRvIGNyb3NzIHpvbmUgbmF2aWdhdGlvbiBpbiBJRS9FZGdlXCI7cmV0dXJuIGguaXNBbmd1bGFyJiZoLl9icm9hZGNhc3QoXCJhZGFsOnBvcFVwQ2xvc2VkXCIsYytoLkNPTlNUQU5UUy5SRVNPVVJDRV9ERUxJTUVURVIrYSksaC5faGFuZGxlUG9wdXBFcnJvcihlLGIsYSxjLGMpLHZvaWQgd2luZG93LmNsZWFySW50ZXJ2YWwoaSl9dHJ5e3ZhciBmPWQubG9jYXRpb247aWYoLTEhPWVuY29kZVVSSShmLmhyZWYpLmluZGV4T2YoZW5jb2RlVVJJKGcpKSlyZXR1cm4gaC5pc0FuZ3VsYXI/aC5fYnJvYWRjYXN0KFwiYWRhbDpwb3BVcEhhc2hDaGFuZ2VkXCIsZi5oYXNoKTpoLmhhbmRsZVdpbmRvd0NhbGxiYWNrKGYuaGFzaCksd2luZG93LmNsZWFySW50ZXJ2YWwoaSksaC5fbG9naW5JblByb2dyZXNzPSExLGguX2FjcXVpcmVUb2tlbkluUHJvZ3Jlc3M9ITEsaC5pbmZvKFwiQ2xvc2luZyBwb3B1cCB3aW5kb3dcIiksaC5fb3BlbmVkV2luZG93cz1bXSx2b2lkIGQuY2xvc2UoKX1jYXRjaChhKXt9fSwxKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fYnJvYWRjYXN0PWZ1bmN0aW9uKGEsYil7IWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShhLGIpe2I9Ynx8e2J1YmJsZXM6ITEsY2FuY2VsYWJsZTohMSxkZXRhaWw6dm9pZCAwfTt2YXIgYz1kb2N1bWVudC5jcmVhdGVFdmVudChcIkN1c3RvbUV2ZW50XCIpO3JldHVybiBjLmluaXRDdXN0b21FdmVudChhLGIuYnViYmxlcyxiLmNhbmNlbGFibGUsYi5kZXRhaWwpLGN9aWYoXCJmdW5jdGlvblwiPT10eXBlb2Ygd2luZG93LkN1c3RvbUV2ZW50KXJldHVybiExO2EucHJvdG90eXBlPXdpbmRvdy5FdmVudC5wcm90b3R5cGUsd2luZG93LkN1c3RvbUV2ZW50PWF9KCk7dmFyIGM9bmV3IEN1c3RvbUV2ZW50KGEse2RldGFpbDpifSk7d2luZG93LmRpc3BhdGNoRXZlbnQoYyl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUubG9naW5JblByb2dyZXNzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xvZ2luSW5Qcm9ncmVzc30sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5faGFzUmVzb3VyY2U9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlRPS0VOX0tFWVMpO3JldHVybiBiJiYhdGhpcy5faXNFbXB0eShiKSYmYi5pbmRleE9mKGErdGhpcy5DT05TVEFOVFMuUkVTT1VSQ0VfREVMSU1FVEVSKT4tMX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5nZXRDYWNoZWRUb2tlbj1mdW5jdGlvbihhKXtpZighdGhpcy5faGFzUmVzb3VyY2UoYSkpcmV0dXJuIG51bGw7dmFyIGI9dGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVkrYSksYz10aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVhQSVJBVElPTl9LRVkrYSksZD10aGlzLmNvbmZpZy5leHBpcmVPZmZzZXRTZWNvbmRzfHwzMDA7cmV0dXJuIGMmJmM+dGhpcy5fbm93KCkrZD9iOih0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVkrYSxcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVYUElSQVRJT05fS0VZK2EsMCksbnVsbCl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuZ2V0Q2FjaGVkVXNlcj1mdW5jdGlvbigpe2lmKHRoaXMuX3VzZXIpcmV0dXJuIHRoaXMuX3VzZXI7dmFyIGE9dGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLklEVE9LRU4pO3JldHVybiB0aGlzLl91c2VyPXRoaXMuX2NyZWF0ZVVzZXIoYSksdGhpcy5fdXNlcn0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5yZWdpc3RlckNhbGxiYWNrPWZ1bmN0aW9uKGEsYixjKXt0aGlzLl9hY3RpdmVSZW5ld2Fsc1tiXT1hLHRoaXMuX2NhbGxCYWNrc01hcHBlZFRvUmVuZXdTdGF0ZXNbYV18fCh0aGlzLl9jYWxsQmFja3NNYXBwZWRUb1JlbmV3U3RhdGVzW2FdPVtdKTt2YXIgZD10aGlzO3RoaXMuX2NhbGxCYWNrc01hcHBlZFRvUmVuZXdTdGF0ZXNbYV0ucHVzaChjKSx0aGlzLl9jYWxsQmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbYV18fCh0aGlzLl9jYWxsQmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbYV09ZnVuY3Rpb24oYyxlLGYsZyl7ZC5fYWN0aXZlUmVuZXdhbHNbYl09bnVsbDtmb3IodmFyIGg9MDtoPGQuX2NhbGxCYWNrc01hcHBlZFRvUmVuZXdTdGF0ZXNbYV0ubGVuZ3RoOysraCl0cnl7ZC5fY2FsbEJhY2tzTWFwcGVkVG9SZW5ld1N0YXRlc1thXVtoXShjLGUsZixnKX1jYXRjaChmKXtkLndhcm4oZil9ZC5fY2FsbEJhY2tzTWFwcGVkVG9SZW5ld1N0YXRlc1thXT1udWxsLGQuX2NhbGxCYWNrTWFwcGVkVG9SZW5ld1N0YXRlc1thXT1udWxsfSl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX3JlbmV3VG9rZW49ZnVuY3Rpb24oYSxiLGMpe3RoaXMuaW5mbyhcInJlbmV3VG9rZW4gaXMgY2FsbGVkIGZvciByZXNvdXJjZTpcIithKTt2YXIgZD10aGlzLl9hZGRBZGFsRnJhbWUoXCJhZGFsUmVuZXdGcmFtZVwiK2EpLGU9dGhpcy5fZ3VpZCgpK1wifFwiK2E7dGhpcy5jb25maWcuc3RhdGU9ZSx0aGlzLl9yZW5ld1N0YXRlcy5wdXNoKGUpLHRoaXMudmVyYm9zZShcIlJlbmV3IHRva2VuIEV4cGVjdGVkIHN0YXRlOiBcIitlKSxjPWN8fFwidG9rZW5cIjt2YXIgZj10aGlzLl91cmxSZW1vdmVRdWVyeVN0cmluZ1BhcmFtZXRlcih0aGlzLl9nZXROYXZpZ2F0ZVVybChjLGEpLFwicHJvbXB0XCIpO2M9PT10aGlzLlJFU1BPTlNFX1RZUEUuSURfVE9LRU5fVE9LRU4mJih0aGlzLl9pZFRva2VuTm9uY2U9dGhpcy5fZ3VpZCgpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTk9OQ0VfSURUT0tFTix0aGlzLl9pZFRva2VuTm9uY2UsITApLGYrPVwiJm5vbmNlPVwiK2VuY29kZVVSSUNvbXBvbmVudCh0aGlzLl9pZFRva2VuTm9uY2UpKSxmKz1cIiZwcm9tcHQ9bm9uZVwiLGY9dGhpcy5fYWRkSGludFBhcmFtZXRlcnMoZiksdGhpcy5yZWdpc3RlckNhbGxiYWNrKGUsYSxiKSx0aGlzLnZlcmJvc2VQaWkoXCJOYXZpZ2F0ZSB0bzpcIitmKSxkLnNyYz1cImFib3V0OmJsYW5rXCIsdGhpcy5fbG9hZEZyYW1lVGltZW91dChmLFwiYWRhbFJlbmV3RnJhbWVcIithLGEpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9yZW5ld0lkVG9rZW49ZnVuY3Rpb24oYSxiKXt0aGlzLmluZm8oXCJyZW5ld0lkVG9rZW4gaXMgY2FsbGVkXCIpO3ZhciBjPXRoaXMuX2FkZEFkYWxGcmFtZShcImFkYWxJZFRva2VuRnJhbWVcIiksZD10aGlzLl9ndWlkKCkrXCJ8XCIrdGhpcy5jb25maWcuY2xpZW50SWQ7dGhpcy5faWRUb2tlbk5vbmNlPXRoaXMuX2d1aWQoKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLk5PTkNFX0lEVE9LRU4sdGhpcy5faWRUb2tlbk5vbmNlLCEwKSx0aGlzLmNvbmZpZy5zdGF0ZT1kLHRoaXMuX3JlbmV3U3RhdGVzLnB1c2goZCksdGhpcy52ZXJib3NlKFwiUmVuZXcgSWR0b2tlbiBFeHBlY3RlZCBzdGF0ZTogXCIrZCk7dmFyIGU9bnVsbD09PWJ8fHZvaWQgMD09PWI/bnVsbDp0aGlzLmNvbmZpZy5jbGllbnRJZCxiPWJ8fFwiaWRfdG9rZW5cIixmPXRoaXMuX3VybFJlbW92ZVF1ZXJ5U3RyaW5nUGFyYW1ldGVyKHRoaXMuX2dldE5hdmlnYXRlVXJsKGIsZSksXCJwcm9tcHRcIik7Zis9XCImcHJvbXB0PW5vbmVcIixmPXRoaXMuX2FkZEhpbnRQYXJhbWV0ZXJzKGYpLGYrPVwiJm5vbmNlPVwiK2VuY29kZVVSSUNvbXBvbmVudCh0aGlzLl9pZFRva2VuTm9uY2UpLHRoaXMucmVnaXN0ZXJDYWxsYmFjayhkLHRoaXMuY29uZmlnLmNsaWVudElkLGEpLHRoaXMudmVyYm9zZVBpaShcIk5hdmlnYXRlIHRvOlwiK2YpLGMuc3JjPVwiYWJvdXQ6YmxhbmtcIix0aGlzLl9sb2FkRnJhbWVUaW1lb3V0KGYsXCJhZGFsSWRUb2tlbkZyYW1lXCIsdGhpcy5jb25maWcuY2xpZW50SWQpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl91cmxDb250YWluc1F1ZXJ5U3RyaW5nUGFyYW1ldGVyPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBSZWdFeHAoXCJbXFxcXD8mXVwiK2ErXCI9XCIpLnRlc3QoYil9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX3VybFJlbW92ZVF1ZXJ5U3RyaW5nUGFyYW1ldGVyPWZ1bmN0aW9uKGEsYil7dmFyIGM9bmV3IFJlZ0V4cChcIihcXFxcJlwiK2IrXCI9KVteJl0rXCIpO3JldHVybiBhPWEucmVwbGFjZShjLFwiXCIpLGM9bmV3IFJlZ0V4cChcIihcIitiK1wiPSlbXiZdKyZcIiksYT1hLnJlcGxhY2UoYyxcIlwiKSxjPW5ldyBSZWdFeHAoXCIoXCIrYitcIj0pW14mXStcIiksYT1hLnJlcGxhY2UoYyxcIlwiKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fbG9hZEZyYW1lVGltZW91dD1mdW5jdGlvbihhLGIsYyl7dGhpcy52ZXJib3NlKFwiU2V0IGxvYWRpbmcgc3RhdGUgdG8gcGVuZGluZyBmb3I6IFwiK2MpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuUkVORVdfU1RBVFVTK2MsdGhpcy5DT05TVEFOVFMuVE9LRU5fUkVORVdfU1RBVFVTX0lOX1BST0dSRVNTKSx0aGlzLl9sb2FkRnJhbWUoYSxiKTt2YXIgZD10aGlzO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtpZihkLl9nZXRJdGVtKGQuQ09OU1RBTlRTLlNUT1JBR0UuUkVORVdfU1RBVFVTK2MpPT09ZC5DT05TVEFOVFMuVE9LRU5fUkVORVdfU1RBVFVTX0lOX1BST0dSRVNTKXtkLnZlcmJvc2UoXCJMb2FkaW5nIGZyYW1lIGhhcyB0aW1lZCBvdXQgYWZ0ZXI6IFwiK2QuQ09OU1RBTlRTLkxPQURGUkFNRV9USU1FT1VULzFlMytcIiBzZWNvbmRzIGZvciByZXNvdXJjZSBcIitjKTt2YXIgYT1kLl9hY3RpdmVSZW5ld2Fsc1tjXTthJiZkLl9jYWxsQmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbYV0mJmQuX2NhbGxCYWNrTWFwcGVkVG9SZW5ld1N0YXRlc1thXShcIlRva2VuIHJlbmV3YWwgb3BlcmF0aW9uIGZhaWxlZCBkdWUgdG8gdGltZW91dFwiLG51bGwsXCJUb2tlbiBSZW5ld2FsIEZhaWxlZFwiKSxkLl9zYXZlSXRlbShkLkNPTlNUQU5UUy5TVE9SQUdFLlJFTkVXX1NUQVRVUytjLGQuQ09OU1RBTlRTLlRPS0VOX1JFTkVXX1NUQVRVU19DQU5DRUxFRCl9fSxkLkNPTlNUQU5UUy5MT0FERlJBTUVfVElNRU9VVCl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2xvYWRGcmFtZT1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXM7Yy5pbmZvKFwiTG9hZEZyYW1lOiBcIitiKTt2YXIgZD1iO3NldFRpbWVvdXQoZnVuY3Rpb24oKXt2YXIgYj1jLl9hZGRBZGFsRnJhbWUoZCk7XCJcIiE9PWIuc3JjJiZcImFib3V0OmJsYW5rXCIhPT1iLnNyY3x8KGIuc3JjPWEsYy5fbG9hZEZyYW1lKGEsZCkpfSw1MDApfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmFjcXVpcmVUb2tlbj1mdW5jdGlvbihhLGIpe2lmKHRoaXMuX2lzRW1wdHkoYSkpcmV0dXJuIHRoaXMud2FybihcInJlc291cmNlIGlzIHJlcXVpcmVkXCIpLHZvaWQgYihcInJlc291cmNlIGlzIHJlcXVpcmVkXCIsbnVsbCxcInJlc291cmNlIGlzIHJlcXVpcmVkXCIpO3ZhciBjPXRoaXMuZ2V0Q2FjaGVkVG9rZW4oYSk7cmV0dXJuIGM/KHRoaXMuaW5mbyhcIlRva2VuIGlzIGFscmVhZHkgaW4gY2FjaGUgZm9yIHJlc291cmNlOlwiK2EpLHZvaWQgYihudWxsLGMsbnVsbCkpOnRoaXMuX3VzZXJ8fHRoaXMuY29uZmlnLmV4dHJhUXVlcnlQYXJhbWV0ZXImJi0xIT09dGhpcy5jb25maWcuZXh0cmFRdWVyeVBhcmFtZXRlci5pbmRleE9mKFwibG9naW5faGludFwiKT92b2lkKHRoaXMuX2FjdGl2ZVJlbmV3YWxzW2FdP3RoaXMucmVnaXN0ZXJDYWxsYmFjayh0aGlzLl9hY3RpdmVSZW5ld2Fsc1thXSxhLGIpOih0aGlzLl9yZXF1ZXN0VHlwZT10aGlzLlJFUVVFU1RfVFlQRS5SRU5FV19UT0tFTixhPT09dGhpcy5jb25maWcuY2xpZW50SWQ/dGhpcy5fdXNlcj8odGhpcy52ZXJib3NlKFwicmVuZXdpbmcgaWR0b2tlblwiKSx0aGlzLl9yZW5ld0lkVG9rZW4oYikpOih0aGlzLnZlcmJvc2UoXCJyZW5ld2luZyBpZHRva2VuIGFuZCBhY2Nlc3NfdG9rZW5cIiksdGhpcy5fcmVuZXdJZFRva2VuKGIsdGhpcy5SRVNQT05TRV9UWVBFLklEX1RPS0VOX1RPS0VOKSk6dGhpcy5fdXNlcj8odGhpcy52ZXJib3NlKFwicmVuZXdpbmcgYWNjZXNzX3Rva2VuXCIpLHRoaXMuX3JlbmV3VG9rZW4oYSxiKSk6KHRoaXMudmVyYm9zZShcInJlbmV3aW5nIGlkdG9rZW4gYW5kIGFjY2Vzc190b2tlblwiKSx0aGlzLl9yZW5ld1Rva2VuKGEsYix0aGlzLlJFU1BPTlNFX1RZUEUuSURfVE9LRU5fVE9LRU4pKSkpOih0aGlzLndhcm4oXCJVc2VyIGxvZ2luIGlzIHJlcXVpcmVkXCIpLHZvaWQgYihcIlVzZXIgbG9naW4gaXMgcmVxdWlyZWRcIixudWxsLFwibG9naW4gcmVxdWlyZWRcIikpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmFjcXVpcmVUb2tlblBvcHVwPWZ1bmN0aW9uKGEsYixjLGQpe2lmKHRoaXMuX2lzRW1wdHkoYSkpcmV0dXJuIHRoaXMud2FybihcInJlc291cmNlIGlzIHJlcXVpcmVkXCIpLHZvaWQgZChcInJlc291cmNlIGlzIHJlcXVpcmVkXCIsbnVsbCxcInJlc291cmNlIGlzIHJlcXVpcmVkXCIpO2lmKCF0aGlzLl91c2VyKXJldHVybiB0aGlzLndhcm4oXCJVc2VyIGxvZ2luIGlzIHJlcXVpcmVkXCIpLHZvaWQgZChcIlVzZXIgbG9naW4gaXMgcmVxdWlyZWRcIixudWxsLFwibG9naW4gcmVxdWlyZWRcIik7aWYodGhpcy5fYWNxdWlyZVRva2VuSW5Qcm9ncmVzcylyZXR1cm4gdGhpcy53YXJuKFwiQWNxdWlyZSB0b2tlbiBpbnRlcmFjdGl2ZSBpcyBhbHJlYWR5IGluIHByb2dyZXNzXCIpLHZvaWQgZChcIkFjcXVpcmUgdG9rZW4gaW50ZXJhY3RpdmUgaXMgYWxyZWFkeSBpbiBwcm9ncmVzc1wiLG51bGwsXCJBY3F1aXJlIHRva2VuIGludGVyYWN0aXZlIGlzIGFscmVhZHkgaW4gcHJvZ3Jlc3NcIik7dmFyIGU9dGhpcy5fZ3VpZCgpK1wifFwiK2E7dGhpcy5jb25maWcuc3RhdGU9ZSx0aGlzLl9yZW5ld1N0YXRlcy5wdXNoKGUpLHRoaXMuX3JlcXVlc3RUeXBlPXRoaXMuUkVRVUVTVF9UWVBFLlJFTkVXX1RPS0VOLHRoaXMudmVyYm9zZShcIlJlbmV3IHRva2VuIEV4cGVjdGVkIHN0YXRlOiBcIitlKTt2YXIgZj10aGlzLl91cmxSZW1vdmVRdWVyeVN0cmluZ1BhcmFtZXRlcih0aGlzLl9nZXROYXZpZ2F0ZVVybChcInRva2VuXCIsYSksXCJwcm9tcHRcIik7aWYoZis9XCImcHJvbXB0PXNlbGVjdF9hY2NvdW50XCIsYiYmKGYrPWIpLGMmJi0xPT09Zi5pbmRleE9mKFwiJmNsYWltc1wiKSlmKz1cIiZjbGFpbXM9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGMpO2Vsc2UgaWYoYyYmLTEhPT1mLmluZGV4T2YoXCImY2xhaW1zXCIpKXRocm93IG5ldyBFcnJvcihcIkNsYWltcyBjYW5ub3QgYmUgcGFzc2VkIGFzIGFuIGV4dHJhUXVlcnlQYXJhbWV0ZXJcIik7Zj10aGlzLl9hZGRIaW50UGFyYW1ldGVycyhmKSx0aGlzLl9hY3F1aXJlVG9rZW5JblByb2dyZXNzPSEwLHRoaXMuaW5mbyhcImFjcXVpcmVUb2tlbiBpbnRlcmFjdGl2ZSBpcyBjYWxsZWQgZm9yIHRoZSByZXNvdXJjZSBcIithKSx0aGlzLnJlZ2lzdGVyQ2FsbGJhY2soZSxhLGQpLHRoaXMuX2xvZ2luUG9wdXAoZixhLGQpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmFjcXVpcmVUb2tlblJlZGlyZWN0PWZ1bmN0aW9uKGEsYixjKXtpZih0aGlzLl9pc0VtcHR5KGEpKXJldHVybiB0aGlzLndhcm4oXCJyZXNvdXJjZSBpcyByZXF1aXJlZFwiKSx2b2lkIGQoXCJyZXNvdXJjZSBpcyByZXF1aXJlZFwiLG51bGwsXCJyZXNvdXJjZSBpcyByZXF1aXJlZFwiKTt2YXIgZD10aGlzLmNhbGxiYWNrO2lmKCF0aGlzLl91c2VyKXJldHVybiB0aGlzLndhcm4oXCJVc2VyIGxvZ2luIGlzIHJlcXVpcmVkXCIpLHZvaWQgZChcIlVzZXIgbG9naW4gaXMgcmVxdWlyZWRcIixudWxsLFwibG9naW4gcmVxdWlyZWRcIik7aWYodGhpcy5fYWNxdWlyZVRva2VuSW5Qcm9ncmVzcylyZXR1cm4gdGhpcy53YXJuKFwiQWNxdWlyZSB0b2tlbiBpbnRlcmFjdGl2ZSBpcyBhbHJlYWR5IGluIHByb2dyZXNzXCIpLHZvaWQgZChcIkFjcXVpcmUgdG9rZW4gaW50ZXJhY3RpdmUgaXMgYWxyZWFkeSBpbiBwcm9ncmVzc1wiLG51bGwsXCJBY3F1aXJlIHRva2VuIGludGVyYWN0aXZlIGlzIGFscmVhZHkgaW4gcHJvZ3Jlc3NcIik7dmFyIGU9dGhpcy5fZ3VpZCgpK1wifFwiK2E7dGhpcy5jb25maWcuc3RhdGU9ZSx0aGlzLnZlcmJvc2UoXCJSZW5ldyB0b2tlbiBFeHBlY3RlZCBzdGF0ZTogXCIrZSk7dmFyIGY9dGhpcy5fdXJsUmVtb3ZlUXVlcnlTdHJpbmdQYXJhbWV0ZXIodGhpcy5fZ2V0TmF2aWdhdGVVcmwoXCJ0b2tlblwiLGEpLFwicHJvbXB0XCIpO2lmKGYrPVwiJnByb21wdD1zZWxlY3RfYWNjb3VudFwiLGImJihmKz1iKSxjJiYtMT09PWYuaW5kZXhPZihcIiZjbGFpbXNcIikpZis9XCImY2xhaW1zPVwiK2VuY29kZVVSSUNvbXBvbmVudChjKTtlbHNlIGlmKGMmJi0xIT09Zi5pbmRleE9mKFwiJmNsYWltc1wiKSl0aHJvdyBuZXcgRXJyb3IoXCJDbGFpbXMgY2Fubm90IGJlIHBhc3NlZCBhcyBhbiBleHRyYVF1ZXJ5UGFyYW1ldGVyXCIpO2Y9dGhpcy5fYWRkSGludFBhcmFtZXRlcnMoZiksdGhpcy5fYWNxdWlyZVRva2VuSW5Qcm9ncmVzcz0hMCx0aGlzLmluZm8oXCJhY3F1aXJlVG9rZW4gaW50ZXJhY3RpdmUgaXMgY2FsbGVkIGZvciB0aGUgcmVzb3VyY2UgXCIrYSksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9SRVFVRVNULHdpbmRvdy5sb2NhdGlvbi5ocmVmKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNUQVRFX1JFTkVXLGUsITApLHRoaXMucHJvbXB0VXNlcihmKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5wcm9tcHRVc2VyPWZ1bmN0aW9uKGEpe2E/KHRoaXMuaW5mb1BpaShcIk5hdmlnYXRlIHRvOlwiK2EpLHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGEpKTp0aGlzLmluZm8oXCJOYXZpZ2F0ZSB1cmwgaXMgZW1wdHlcIil9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuY2xlYXJDYWNoZT1mdW5jdGlvbigpe3RoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTE9HSU5fUkVRVUVTVCxcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFOR1VMQVJfTE9HSU5fUkVRVUVTVCxcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNFU1NJT05fU1RBVEUsXCJcIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5TVEFURV9MT0dJTixcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNUQVRFX1JFTkVXLFwiXCIpLHRoaXMuX3JlbmV3U3RhdGVzPVtdLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTk9OQ0VfSURUT0tFTixcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLklEVE9LRU4sXCJcIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUixcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVSUk9SX0RFU0NSSVBUSU9OLFwiXCIpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTE9HSU5fRVJST1IsXCJcIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9FUlJPUixcIlwiKTt2YXIgYT10aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuVE9LRU5fS0VZUyk7aWYoIXRoaXMuX2lzRW1wdHkoYSkpe2E9YS5zcGxpdCh0aGlzLkNPTlNUQU5UUy5SRVNPVVJDRV9ERUxJTUVURVIpO2Zvcih2YXIgYj0wO2I8YS5sZW5ndGgmJlwiXCIhPT1hW2JdO2IrKyl0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVkrYVtiXSxcIlwiKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkVYUElSQVRJT05fS0VZK2FbYl0sMCl9dGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5UT0tFTl9LRVlTLFwiXCIpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmNsZWFyQ2FjaGVGb3JSZXNvdXJjZT1mdW5jdGlvbihhKXt0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlNUQVRFX1JFTkVXLFwiXCIpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1IsXCJcIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTixcIlwiKSx0aGlzLl9oYXNSZXNvdXJjZShhKSYmKHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuQUNDRVNTX1RPS0VOX0tFWSthLFwiXCIpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVhQSVJBVElPTl9LRVkrYSwwKSl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUubG9nT3V0PWZ1bmN0aW9uKCl7dGhpcy5jbGVhckNhY2hlKCksdGhpcy5fdXNlcj1udWxsO3ZhciBhO2lmKHRoaXMuY29uZmlnLmxvZ091dFVyaSlhPXRoaXMuY29uZmlnLmxvZ091dFVyaTtlbHNle3ZhciBiPVwiY29tbW9uXCIsYz1cIlwiO3RoaXMuY29uZmlnLnRlbmFudCYmKGI9dGhpcy5jb25maWcudGVuYW50KSx0aGlzLmNvbmZpZy5wb3N0TG9nb3V0UmVkaXJlY3RVcmkmJihjPVwicG9zdF9sb2dvdXRfcmVkaXJlY3RfdXJpPVwiK2VuY29kZVVSSUNvbXBvbmVudCh0aGlzLmNvbmZpZy5wb3N0TG9nb3V0UmVkaXJlY3RVcmkpKSxhPXRoaXMuaW5zdGFuY2UrYitcIi9vYXV0aDIvbG9nb3V0P1wiK2N9dGhpcy5pbmZvUGlpKFwiTG9nb3V0IG5hdmlnYXRlIHRvOiBcIithKSx0aGlzLnByb21wdFVzZXIoYSl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2lzRW1wdHk9ZnVuY3Rpb24oYSl7cmV0dXJuIHZvaWQgMD09PWF8fCFhfHwwPT09YS5sZW5ndGh9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuZ2V0VXNlcj1mdW5jdGlvbihhKXtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBhKXRocm93IG5ldyBFcnJvcihcImNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uXCIpO2lmKHRoaXMuX3VzZXIpcmV0dXJuIHZvaWQgYShudWxsLHRoaXMuX3VzZXIpO3ZhciBiPXRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5JRFRPS0VOKTt0aGlzLl9pc0VtcHR5KGIpPyh0aGlzLndhcm4oXCJVc2VyIGluZm9ybWF0aW9uIGlzIG5vdCBhdmFpbGFibGVcIiksYShcIlVzZXIgaW5mb3JtYXRpb24gaXMgbm90IGF2YWlsYWJsZVwiLG51bGwpKToodGhpcy5pbmZvKFwiVXNlciBleGlzdHMgaW4gY2FjaGU6IFwiKSx0aGlzLl91c2VyPXRoaXMuX2NyZWF0ZVVzZXIoYiksYShudWxsLHRoaXMuX3VzZXIpKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fYWRkSGludFBhcmFtZXRlcnM9ZnVuY3Rpb24oYSl7aWYodGhpcy5fdXNlciYmdGhpcy5fdXNlci5wcm9maWxlKWlmKHRoaXMuX3VzZXIucHJvZmlsZS5zaWQmJi0xIT09YS5pbmRleE9mKFwiJnByb21wdD1ub25lXCIpKXRoaXMuX3VybENvbnRhaW5zUXVlcnlTdHJpbmdQYXJhbWV0ZXIoXCJzaWRcIixhKXx8KGErPVwiJnNpZD1cIitlbmNvZGVVUklDb21wb25lbnQodGhpcy5fdXNlci5wcm9maWxlLnNpZCkpO2Vsc2UgaWYodGhpcy5fdXNlci5wcm9maWxlLnVwbiYmKHRoaXMuX3VybENvbnRhaW5zUXVlcnlTdHJpbmdQYXJhbWV0ZXIoXCJsb2dpbl9oaW50XCIsYSl8fChhKz1cIiZsb2dpbl9oaW50PVwiK2VuY29kZVVSSUNvbXBvbmVudCh0aGlzLl91c2VyLnByb2ZpbGUudXBuKSksIXRoaXMuX3VybENvbnRhaW5zUXVlcnlTdHJpbmdQYXJhbWV0ZXIoXCJkb21haW5faGludFwiLGEpJiZ0aGlzLl91c2VyLnByb2ZpbGUudXBuLmluZGV4T2YoXCJAXCIpPi0xKSl7dmFyIGI9dGhpcy5fdXNlci5wcm9maWxlLnVwbi5zcGxpdChcIkBcIik7YSs9XCImZG9tYWluX2hpbnQ9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGJbYi5sZW5ndGgtMV0pfXJldHVybiBhfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9jcmVhdGVVc2VyPWZ1bmN0aW9uKGEpe3ZhciBiPW51bGwsYz10aGlzLl9leHRyYWN0SWRUb2tlbihhKTtyZXR1cm4gYyYmYy5oYXNPd25Qcm9wZXJ0eShcImF1ZFwiKSYmKGMuYXVkLnRvTG93ZXJDYXNlKCk9PT10aGlzLmNvbmZpZy5jbGllbnRJZC50b0xvd2VyQ2FzZSgpPyhiPXt1c2VyTmFtZTpcIlwiLHByb2ZpbGU6Y30sYy5oYXNPd25Qcm9wZXJ0eShcInVwblwiKT9iLnVzZXJOYW1lPWMudXBuOmMuaGFzT3duUHJvcGVydHkoXCJlbWFpbFwiKSYmKGIudXNlck5hbWU9Yy5lbWFpbCkpOnRoaXMud2FybihcIklkVG9rZW4gaGFzIGludmFsaWQgYXVkIGZpZWxkXCIpKSxifSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9nZXRIYXNoPWZ1bmN0aW9uKGEpe3JldHVybiBhLmluZGV4T2YoXCIjL1wiKT4tMT9hPWEuc3Vic3RyaW5nKGEuaW5kZXhPZihcIiMvXCIpKzIpOmEuaW5kZXhPZihcIiNcIik+LTEmJihhPWEuc3Vic3RyaW5nKDEpKSxhfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmlzQ2FsbGJhY2s9ZnVuY3Rpb24oYSl7YT10aGlzLl9nZXRIYXNoKGEpO3ZhciBiPXRoaXMuX2Rlc2VyaWFsaXplKGEpO3JldHVybiBiLmhhc093blByb3BlcnR5KHRoaXMuQ09OU1RBTlRTLkVSUk9SX0RFU0NSSVBUSU9OKXx8Yi5oYXNPd25Qcm9wZXJ0eSh0aGlzLkNPTlNUQU5UUy5BQ0NFU1NfVE9LRU4pfHxiLmhhc093blByb3BlcnR5KHRoaXMuQ09OU1RBTlRTLklEX1RPS0VOKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5nZXRMb2dpbkVycm9yPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5MT0dJTl9FUlJPUil9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuZ2V0UmVxdWVzdEluZm89ZnVuY3Rpb24oYSl7YT10aGlzLl9nZXRIYXNoKGEpO3ZhciBiPXRoaXMuX2Rlc2VyaWFsaXplKGEpLGM9e3ZhbGlkOiExLHBhcmFtZXRlcnM6e30sc3RhdGVNYXRjaDohMSxzdGF0ZVJlc3BvbnNlOlwiXCIscmVxdWVzdFR5cGU6dGhpcy5SRVFVRVNUX1RZUEUuVU5LTk9XTn07aWYoYiYmKGMucGFyYW1ldGVycz1iLGIuaGFzT3duUHJvcGVydHkodGhpcy5DT05TVEFOVFMuRVJST1JfREVTQ1JJUFRJT04pfHxiLmhhc093blByb3BlcnR5KHRoaXMuQ09OU1RBTlRTLkFDQ0VTU19UT0tFTil8fGIuaGFzT3duUHJvcGVydHkodGhpcy5DT05TVEFOVFMuSURfVE9LRU4pKSl7Yy52YWxpZD0hMDt2YXIgZD1cIlwiO2lmKCFiLmhhc093blByb3BlcnR5KFwic3RhdGVcIikpcmV0dXJuIHRoaXMud2FybihcIk5vIHN0YXRlIHJldHVybmVkXCIpLGM7aWYodGhpcy52ZXJib3NlKFwiU3RhdGU6IFwiK2Iuc3RhdGUpLGQ9Yi5zdGF0ZSxjLnN0YXRlUmVzcG9uc2U9ZCx0aGlzLl9tYXRjaFN0YXRlKGMpKXJldHVybiBjO2lmKCFjLnN0YXRlTWF0Y2gmJndpbmRvdy5wYXJlbnQpe2MucmVxdWVzdFR5cGU9dGhpcy5fcmVxdWVzdFR5cGU7Zm9yKHZhciBlPXRoaXMuX3JlbmV3U3RhdGVzLGY9MDtmPGUubGVuZ3RoO2YrKylpZihlW2ZdPT09Yy5zdGF0ZVJlc3BvbnNlKXtjLnN0YXRlTWF0Y2g9ITA7YnJlYWt9fX1yZXR1cm4gY30sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fbWF0Y2hOb25jZT1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTk9OQ0VfSURUT0tFTik7aWYoYil7Yj1iLnNwbGl0KHRoaXMuQ09OU1RBTlRTLkNBQ0hFX0RFTElNRVRFUik7Zm9yKHZhciBjPTA7YzxiLmxlbmd0aDtjKyspaWYoYltjXT09PWEucHJvZmlsZS5ub25jZSlyZXR1cm4hMH1yZXR1cm4hMX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fbWF0Y2hTdGF0ZT1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuU1RBVEVfTE9HSU4pO2lmKGIpe2I9Yi5zcGxpdCh0aGlzLkNPTlNUQU5UUy5DQUNIRV9ERUxJTUVURVIpO2Zvcih2YXIgYz0wO2M8Yi5sZW5ndGg7YysrKWlmKGJbY109PT1hLnN0YXRlUmVzcG9uc2UpcmV0dXJuIGEucmVxdWVzdFR5cGU9dGhpcy5SRVFVRVNUX1RZUEUuTE9HSU4sYS5zdGF0ZU1hdGNoPSEwLCEwfXZhciBkPXRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5TVEFURV9SRU5FVyk7aWYoZCl7ZD1kLnNwbGl0KHRoaXMuQ09OU1RBTlRTLkNBQ0hFX0RFTElNRVRFUik7Zm9yKHZhciBjPTA7YzxkLmxlbmd0aDtjKyspaWYoZFtjXT09PWEuc3RhdGVSZXNwb25zZSlyZXR1cm4gYS5yZXF1ZXN0VHlwZT10aGlzLlJFUVVFU1RfVFlQRS5SRU5FV19UT0tFTixhLnN0YXRlTWF0Y2g9ITAsITB9cmV0dXJuITF9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2dldFJlc291cmNlRnJvbVN0YXRlPWZ1bmN0aW9uKGEpe2lmKGEpe3ZhciBiPWEuaW5kZXhPZihcInxcIik7aWYoYj4tMSYmYisxPGEubGVuZ3RoKXJldHVybiBhLnN1YnN0cmluZyhiKzEpfXJldHVyblwiXCJ9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuc2F2ZVRva2VuRnJvbUhhc2g9ZnVuY3Rpb24oYSl7dGhpcy5pbmZvKFwiU3RhdGUgc3RhdHVzOlwiK2Euc3RhdGVNYXRjaCtcIjsgUmVxdWVzdCB0eXBlOlwiK2EucmVxdWVzdFR5cGUpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1IsXCJcIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTixcIlwiKTt2YXIgYj10aGlzLl9nZXRSZXNvdXJjZUZyb21TdGF0ZShhLnN0YXRlUmVzcG9uc2UpO2lmKGEucGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eSh0aGlzLkNPTlNUQU5UUy5FUlJPUl9ERVNDUklQVElPTikpdGhpcy5pbmZvUGlpKFwiRXJyb3IgOlwiK2EucGFyYW1ldGVycy5lcnJvcitcIjsgRXJyb3IgZGVzY3JpcHRpb246XCIrYS5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLkVSUk9SX0RFU0NSSVBUSU9OXSksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUixhLnBhcmFtZXRlcnMuZXJyb3IpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVJST1JfREVTQ1JJUFRJT04sYS5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLkVSUk9SX0RFU0NSSVBUSU9OXSksYS5yZXF1ZXN0VHlwZT09PXRoaXMuUkVRVUVTVF9UWVBFLkxPR0lOJiYodGhpcy5fbG9naW5JblByb2dyZXNzPSExLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTE9HSU5fRVJST1IsYS5wYXJhbWV0ZXJzLmVycm9yX2Rlc2NyaXB0aW9uKSk7ZWxzZSBpZihhLnN0YXRlTWF0Y2gpe3RoaXMuaW5mbyhcIlN0YXRlIGlzIHJpZ2h0XCIpLGEucGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eSh0aGlzLkNPTlNUQU5UUy5TRVNTSU9OX1NUQVRFKSYmdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5TRVNTSU9OX1NUQVRFLGEucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5TRVNTSU9OX1NUQVRFXSk7dmFyIGM7YS5wYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KHRoaXMuQ09OU1RBTlRTLkFDQ0VTU19UT0tFTikmJih0aGlzLmluZm8oXCJGcmFnbWVudCBoYXMgYWNjZXNzIHRva2VuXCIpLHRoaXMuX2hhc1Jlc291cmNlKGIpfHwoYz10aGlzLl9nZXRJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuVE9LRU5fS0VZUyl8fFwiXCIsdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5UT0tFTl9LRVlTLGMrYit0aGlzLkNPTlNUQU5UUy5SRVNPVVJDRV9ERUxJTUVURVIpKSx0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLkFDQ0VTU19UT0tFTl9LRVkrYixhLnBhcmFtZXRlcnNbdGhpcy5DT05TVEFOVFMuQUNDRVNTX1RPS0VOXSksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FWFBJUkFUSU9OX0tFWStiLHRoaXMuX2V4cGlyZXNJbihhLnBhcmFtZXRlcnNbdGhpcy5DT05TVEFOVFMuRVhQSVJFU19JTl0pKSksYS5wYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KHRoaXMuQ09OU1RBTlRTLklEX1RPS0VOKSYmKHRoaXMuaW5mbyhcIkZyYWdtZW50IGhhcyBpZCB0b2tlblwiKSx0aGlzLl9sb2dpbkluUHJvZ3Jlc3M9ITEsdGhpcy5fdXNlcj10aGlzLl9jcmVhdGVVc2VyKGEucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5JRF9UT0tFTl0pLHRoaXMuX3VzZXImJnRoaXMuX3VzZXIucHJvZmlsZT90aGlzLl9tYXRjaE5vbmNlKHRoaXMuX3VzZXIpPyh0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLklEVE9LRU4sYS5wYXJhbWV0ZXJzW3RoaXMuQ09OU1RBTlRTLklEX1RPS0VOXSksYj10aGlzLmNvbmZpZy5sb2dpblJlc291cmNlP3RoaXMuY29uZmlnLmxvZ2luUmVzb3VyY2U6dGhpcy5jb25maWcuY2xpZW50SWQsdGhpcy5faGFzUmVzb3VyY2UoYil8fChjPXRoaXMuX2dldEl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5UT0tFTl9LRVlTKXx8XCJcIix0aGlzLl9zYXZlSXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLlRPS0VOX0tFWVMsYytiK3RoaXMuQ09OU1RBTlRTLlJFU09VUkNFX0RFTElNRVRFUikpLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuQUNDRVNTX1RPS0VOX0tFWStiLGEucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5JRF9UT0tFTl0pLHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuRVhQSVJBVElPTl9LRVkrYix0aGlzLl91c2VyLnByb2ZpbGUuZXhwKSk6KHRoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuTE9HSU5fRVJST1IsXCJOb25jZSByZWNlaXZlZDogXCIrdGhpcy5fdXNlci5wcm9maWxlLm5vbmNlK1wiIGlzIG5vdCBzYW1lIGFzIHJlcXVlc3RlZDogXCIrdGhpcy5fZ2V0SXRlbSh0aGlzLkNPTlNUQU5UUy5TVE9SQUdFLk5PTkNFX0lEVE9LRU4pKSx0aGlzLl91c2VyPW51bGwpOihhLnBhcmFtZXRlcnMuZXJyb3I9XCJpbnZhbGlkIGlkX3Rva2VuXCIsYS5wYXJhbWV0ZXJzLmVycm9yX2Rlc2NyaXB0aW9uPVwiSW52YWxpZCBpZF90b2tlbi4gaWRfdG9rZW46IFwiK2EucGFyYW1ldGVyc1t0aGlzLkNPTlNUQU5UUy5JRF9UT0tFTl0sdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUixcImludmFsaWQgaWRfdG9rZW5cIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTixcIkludmFsaWQgaWRfdG9rZW4uIGlkX3Rva2VuOiBcIithLnBhcmFtZXRlcnNbdGhpcy5DT05TVEFOVFMuSURfVE9LRU5dKSkpfWVsc2UgYS5wYXJhbWV0ZXJzLmVycm9yPVwiSW52YWxpZF9zdGF0ZVwiLGEucGFyYW1ldGVycy5lcnJvcl9kZXNjcmlwdGlvbj1cIkludmFsaWRfc3RhdGUuIHN0YXRlOiBcIithLnN0YXRlUmVzcG9uc2UsdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUixcIkludmFsaWRfc3RhdGVcIiksdGhpcy5fc2F2ZUl0ZW0odGhpcy5DT05TVEFOVFMuU1RPUkFHRS5FUlJPUl9ERVNDUklQVElPTixcIkludmFsaWRfc3RhdGUuIHN0YXRlOiBcIithLnN0YXRlUmVzcG9uc2UpO3RoaXMuX3NhdmVJdGVtKHRoaXMuQ09OU1RBTlRTLlNUT1JBR0UuUkVORVdfU1RBVFVTK2IsdGhpcy5DT05TVEFOVFMuVE9LRU5fUkVORVdfU1RBVFVTX0NPTVBMRVRFRCl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuZ2V0UmVzb3VyY2VGb3JFbmRwb2ludD1mdW5jdGlvbihhKXtpZih0aGlzLmNvbmZpZyYmdGhpcy5jb25maWcuYW5vbnltb3VzRW5kcG9pbnRzKWZvcih2YXIgYj0wO2I8dGhpcy5jb25maWcuYW5vbnltb3VzRW5kcG9pbnRzLmxlbmd0aDtiKyspaWYoYS5pbmRleE9mKHRoaXMuY29uZmlnLmFub255bW91c0VuZHBvaW50c1tiXSk+LTEpcmV0dXJuIG51bGw7aWYodGhpcy5jb25maWcmJnRoaXMuY29uZmlnLmVuZHBvaW50cylmb3IodmFyIGMgaW4gdGhpcy5jb25maWcuZW5kcG9pbnRzKWlmKGEuaW5kZXhPZihjKT4tMSlyZXR1cm4gdGhpcy5jb25maWcuZW5kcG9pbnRzW2NdO3JldHVybiBhLmluZGV4T2YoXCJodHRwOi8vXCIpPi0xfHxhLmluZGV4T2YoXCJodHRwczovL1wiKT4tMT90aGlzLl9nZXRIb3N0RnJvbVVyaShhKT09PXRoaXMuX2dldEhvc3RGcm9tVXJpKHRoaXMuY29uZmlnLnJlZGlyZWN0VXJpKT90aGlzLmNvbmZpZy5sb2dpblJlc291cmNlOm51bGw6dGhpcy5jb25maWcubG9naW5SZXNvdXJjZX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fZ2V0SG9zdEZyb21Vcmk9ZnVuY3Rpb24oYSl7dmFyIGI9U3RyaW5nKGEpLnJlcGxhY2UoL14oaHR0cHM/OilcXC9cXC8vLFwiXCIpO3JldHVybiBiPWIuc3BsaXQoXCIvXCIpWzBdfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmhhbmRsZVdpbmRvd0NhbGxiYWNrPWZ1bmN0aW9uKGEpe2lmKG51bGw9PWEmJihhPXdpbmRvdy5sb2NhdGlvbi5oYXNoKSx0aGlzLmlzQ2FsbGJhY2soYSkpe3ZhciBiPW51bGwsYz0hMTt0aGlzLl9vcGVuZWRXaW5kb3dzLmxlbmd0aD4wJiZ0aGlzLl9vcGVuZWRXaW5kb3dzW3RoaXMuX29wZW5lZFdpbmRvd3MubGVuZ3RoLTFdLm9wZW5lciYmdGhpcy5fb3BlbmVkV2luZG93c1t0aGlzLl9vcGVuZWRXaW5kb3dzLmxlbmd0aC0xXS5vcGVuZXIuX2FkYWxJbnN0YW5jZT8oYj10aGlzLl9vcGVuZWRXaW5kb3dzW3RoaXMuX29wZW5lZFdpbmRvd3MubGVuZ3RoLTFdLm9wZW5lci5fYWRhbEluc3RhbmNlLGM9ITApOndpbmRvdy5wYXJlbnQmJndpbmRvdy5wYXJlbnQuX2FkYWxJbnN0YW5jZSYmKGI9d2luZG93LnBhcmVudC5fYWRhbEluc3RhbmNlKTt2YXIgZCxlLGY9Yi5nZXRSZXF1ZXN0SW5mbyhhKSxnPW51bGw7ZT1jfHx3aW5kb3cucGFyZW50IT09d2luZG93P2IuX2NhbGxCYWNrTWFwcGVkVG9SZW5ld1N0YXRlc1tmLnN0YXRlUmVzcG9uc2VdOmIuY2FsbGJhY2ssYi5pbmZvKFwiUmV0dXJuZWQgZnJvbSByZWRpcmVjdCB1cmxcIiksYi5zYXZlVG9rZW5Gcm9tSGFzaChmKSxmLnJlcXVlc3RUeXBlPT09dGhpcy5SRVFVRVNUX1RZUEUuUkVORVdfVE9LRU4mJndpbmRvdy5wYXJlbnQ/KHdpbmRvdy5wYXJlbnQhPT13aW5kb3c/Yi52ZXJib3NlKFwiV2luZG93IGlzIGluIGlmcmFtZSwgYWNxdWlyaW5nIHRva2VuIHNpbGVudGx5XCIpOmIudmVyYm9zZShcImFjcXVpcmluZyB0b2tlbiBpbnRlcmFjdGl2ZSBpbiBwcm9ncmVzc1wiKSxkPWYucGFyYW1ldGVyc1tiLkNPTlNUQU5UUy5BQ0NFU1NfVE9LRU5dfHxmLnBhcmFtZXRlcnNbYi5DT05TVEFOVFMuSURfVE9LRU5dLGc9Yi5DT05TVEFOVFMuQUNDRVNTX1RPS0VOKTpmLnJlcXVlc3RUeXBlPT09dGhpcy5SRVFVRVNUX1RZUEUuTE9HSU4mJihkPWYucGFyYW1ldGVyc1tiLkNPTlNUQU5UUy5JRF9UT0tFTl0sZz1iLkNPTlNUQU5UUy5JRF9UT0tFTik7dmFyIGg9Zi5wYXJhbWV0ZXJzW2IuQ09OU1RBTlRTLkVSUk9SX0RFU0NSSVBUSU9OXSxpPWYucGFyYW1ldGVyc1tiLkNPTlNUQU5UUy5FUlJPUl07dHJ5e2UmJmUoaCxkLGksZyl9Y2F0Y2goYSl7Yi5lcnJvcihcIkVycm9yIG9jY3VycmVkIGluIHVzZXIgZGVmaW5lZCBjYWxsYmFjayBmdW5jdGlvbjogXCIrYSl9d2luZG93LnBhcmVudCE9PXdpbmRvd3x8Y3x8KGIuY29uZmlnLm5hdmlnYXRlVG9Mb2dpblJlcXVlc3RVcmw/d2luZG93LmxvY2F0aW9uLmhyZWY9Yi5fZ2V0SXRlbShiLkNPTlNUQU5UUy5TVE9SQUdFLkxPR0lOX1JFUVVFU1QpOndpbmRvdy5sb2NhdGlvbi5oYXNoPVwiXCIpfX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fZ2V0TmF2aWdhdGVVcmw9ZnVuY3Rpb24oYSxiKXt2YXIgYz1cImNvbW1vblwiO3RoaXMuY29uZmlnLnRlbmFudCYmKGM9dGhpcy5jb25maWcudGVuYW50KTt2YXIgZD10aGlzLmluc3RhbmNlK2MrXCIvb2F1dGgyL2F1dGhvcml6ZVwiK3RoaXMuX3NlcmlhbGl6ZShhLHRoaXMuY29uZmlnLGIpK3RoaXMuX2FkZExpYk1ldGFkYXRhKCk7cmV0dXJuIHRoaXMuaW5mbyhcIk5hdmlnYXRlIHVybDpcIitkKSxkfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9leHRyYWN0SWRUb2tlbj1mdW5jdGlvbihhKXt2YXIgYj10aGlzLl9kZWNvZGVKd3QoYSk7aWYoIWIpcmV0dXJuIG51bGw7dHJ5e3ZhciBjPWIuSldTUGF5bG9hZCxkPXRoaXMuX2Jhc2U2NERlY29kZVN0cmluZ1VybFNhZmUoYyk7cmV0dXJuIGQ/SlNPTi5wYXJzZShkKToodGhpcy5pbmZvKFwiVGhlIHJldHVybmVkIGlkX3Rva2VuIGNvdWxkIG5vdCBiZSBiYXNlNjQgdXJsIHNhZmUgZGVjb2RlZC5cIiksbnVsbCl9Y2F0Y2goYSl7dGhpcy5lcnJvcihcIlRoZSByZXR1cm5lZCBpZF90b2tlbiBjb3VsZCBub3QgYmUgZGVjb2RlZFwiLGEpfXJldHVybiBudWxsfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9iYXNlNjREZWNvZGVTdHJpbmdVcmxTYWZlPWZ1bmN0aW9uKGEpe3JldHVybiBhPWEucmVwbGFjZSgvLS9nLFwiK1wiKS5yZXBsYWNlKC9fL2csXCIvXCIpLHdpbmRvdy5hdG9iP2RlY29kZVVSSUNvbXBvbmVudChlc2NhcGUod2luZG93LmF0b2IoYSkpKTpkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHRoaXMuX2RlY29kZShhKSkpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9kZWNvZGU9ZnVuY3Rpb24oYSl7dmFyIGI9XCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPVwiO2E9U3RyaW5nKGEpLnJlcGxhY2UoLz0rJC8sXCJcIik7dmFyIGM9YS5sZW5ndGg7aWYoYyU0PT0xKXRocm93IG5ldyBFcnJvcihcIlRoZSB0b2tlbiB0byBiZSBkZWNvZGVkIGlzIG5vdCBjb3JyZWN0bHkgZW5jb2RlZC5cIik7Zm9yKHZhciBkLGUsZixnLGgsaSxqLGssbD1cIlwiLG09MDttPGM7bSs9NCl7aWYoZD1iLmluZGV4T2YoYS5jaGFyQXQobSkpLGU9Yi5pbmRleE9mKGEuY2hhckF0KG0rMSkpLGY9Yi5pbmRleE9mKGEuY2hhckF0KG0rMikpLGc9Yi5pbmRleE9mKGEuY2hhckF0KG0rMykpLG0rMj09PWMtMSl7aD1kPDwxOHxlPDwxMnxmPDw2LGk9aD4+MTYmMjU1LGo9aD4+OCYyNTUsbCs9U3RyaW5nLmZyb21DaGFyQ29kZShpLGopO2JyZWFrfWlmKG0rMT09PWMtMSl7aD1kPDwxOHxlPDwxMixpPWg+PjE2JjI1NSxsKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpO2JyZWFrfWg9ZDw8MTh8ZTw8MTJ8Zjw8NnxnLGk9aD4+MTYmMjU1LGo9aD4+OCYyNTUsaz0yNTUmaCxsKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGksaixrKX1yZXR1cm4gbH0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fZGVjb2RlSnd0PWZ1bmN0aW9uKGEpe2lmKHRoaXMuX2lzRW1wdHkoYSkpcmV0dXJuIG51bGw7dmFyIGI9L14oW15cXC5cXHNdKilcXC4oW15cXC5cXHNdKylcXC4oW15cXC5cXHNdKikkLyxjPWIuZXhlYyhhKTtyZXR1cm4hY3x8Yy5sZW5ndGg8ND8odGhpcy53YXJuKFwiVGhlIHJldHVybmVkIGlkX3Rva2VuIGlzIG5vdCBwYXJzZWFibGUuXCIpLG51bGwpOntoZWFkZXI6Y1sxXSxKV1NQYXlsb2FkOmNbMl0sSldTU2lnOmNbM119fSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9jb252ZXJ0VXJsU2FmZVRvUmVndWxhckJhc2U2NEVuY29kZWRTdHJpbmc9ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZShcIi1cIixcIitcIikucmVwbGFjZShcIl9cIixcIi9cIil9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX3NlcmlhbGl6ZT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9W107aWYobnVsbCE9PWIpe2QucHVzaChcIj9yZXNwb25zZV90eXBlPVwiK2EpLGQucHVzaChcImNsaWVudF9pZD1cIitlbmNvZGVVUklDb21wb25lbnQoYi5jbGllbnRJZCkpLGMmJmQucHVzaChcInJlc291cmNlPVwiK2VuY29kZVVSSUNvbXBvbmVudChjKSksZC5wdXNoKFwicmVkaXJlY3RfdXJpPVwiK2VuY29kZVVSSUNvbXBvbmVudChiLnJlZGlyZWN0VXJpKSksZC5wdXNoKFwic3RhdGU9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGIuc3RhdGUpKSxiLmhhc093blByb3BlcnR5KFwic2xpY2VcIikmJmQucHVzaChcInNsaWNlPVwiK2VuY29kZVVSSUNvbXBvbmVudChiLnNsaWNlKSksYi5oYXNPd25Qcm9wZXJ0eShcImV4dHJhUXVlcnlQYXJhbWV0ZXJcIikmJmQucHVzaChiLmV4dHJhUXVlcnlQYXJhbWV0ZXIpO3ZhciBlPWIuY29ycmVsYXRpb25JZD9iLmNvcnJlbGF0aW9uSWQ6dGhpcy5fZ3VpZCgpO2QucHVzaChcImNsaWVudC1yZXF1ZXN0LWlkPVwiK2VuY29kZVVSSUNvbXBvbmVudChlKSl9cmV0dXJuIGQuam9pbihcIiZcIil9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2Rlc2VyaWFsaXplPWZ1bmN0aW9uKGEpe3ZhciBiLGM9L1xcKy9nLGQ9LyhbXiY9XSspPShbXiZdKikvZyxlPWZ1bmN0aW9uKGEpe3JldHVybiBkZWNvZGVVUklDb21wb25lbnQoYS5yZXBsYWNlKGMsXCIgXCIpKX0sZj17fTtmb3IoYj1kLmV4ZWMoYSk7YjspZltlKGJbMV0pXT1lKGJbMl0pLGI9ZC5leGVjKGEpO3JldHVybiBmfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9kZWNpbWFsVG9IZXg9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPWEudG9TdHJpbmcoMTYpO2IubGVuZ3RoPDI7KWI9XCIwXCIrYjtyZXR1cm4gYn0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fZ3VpZD1mdW5jdGlvbigpe3ZhciBhPXdpbmRvdy5jcnlwdG98fHdpbmRvdy5tc0NyeXB0bztpZihhJiZhLmdldFJhbmRvbVZhbHVlcyl7dmFyIGI9bmV3IFVpbnQ4QXJyYXkoMTYpO3JldHVybiBhLmdldFJhbmRvbVZhbHVlcyhiKSxiWzZdfD02NCxiWzZdJj03OSxiWzhdfD0xMjgsYls4XSY9MTkxLHRoaXMuX2RlY2ltYWxUb0hleChiWzBdKSt0aGlzLl9kZWNpbWFsVG9IZXgoYlsxXSkrdGhpcy5fZGVjaW1hbFRvSGV4KGJbMl0pK3RoaXMuX2RlY2ltYWxUb0hleChiWzNdKStcIi1cIit0aGlzLl9kZWNpbWFsVG9IZXgoYls0XSkrdGhpcy5fZGVjaW1hbFRvSGV4KGJbNV0pK1wiLVwiK3RoaXMuX2RlY2ltYWxUb0hleChiWzZdKSt0aGlzLl9kZWNpbWFsVG9IZXgoYls3XSkrXCItXCIrdGhpcy5fZGVjaW1hbFRvSGV4KGJbOF0pK3RoaXMuX2RlY2ltYWxUb0hleChiWzldKStcIi1cIit0aGlzLl9kZWNpbWFsVG9IZXgoYlsxMF0pK3RoaXMuX2RlY2ltYWxUb0hleChiWzExXSkrdGhpcy5fZGVjaW1hbFRvSGV4KGJbMTJdKSt0aGlzLl9kZWNpbWFsVG9IZXgoYlsxM10pK3RoaXMuX2RlY2ltYWxUb0hleChiWzE0XSkrdGhpcy5fZGVjaW1hbFRvSGV4KGJbMTVdKX1mb3IodmFyIGM9XCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIixkPVwiMDEyMzQ1Njc4OWFiY2RlZlwiLGU9MCxmPVwiXCIsZz0wO2c8MzY7ZysrKVwiLVwiIT09Y1tnXSYmXCI0XCIhPT1jW2ddJiYoZT0xNipNYXRoLnJhbmRvbSgpfDApLFwieFwiPT09Y1tnXT9mKz1kW2VdOlwieVwiPT09Y1tnXT8oZSY9MyxlfD04LGYrPWRbZV0pOmYrPWNbZ107cmV0dXJuIGZ9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2V4cGlyZXNJbj1mdW5jdGlvbihhKXtyZXR1cm4gYXx8KGE9MzU5OSksdGhpcy5fbm93KCkrcGFyc2VJbnQoYSwxMCl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX25vdz1mdW5jdGlvbigpe3JldHVybiBNYXRoLnJvdW5kKChuZXcgRGF0ZSkuZ2V0VGltZSgpLzFlMyl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2FkZEFkYWxGcmFtZT1mdW5jdGlvbihhKXtpZih2b2lkIDAhPT1hKXt0aGlzLmluZm8oXCJBZGQgYWRhbCBmcmFtZSB0byBkb2N1bWVudDpcIithKTt2YXIgYj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKTtpZighYil7aWYoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCYmZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50JiYod2luZG93Lm9wZXJhfHwtMT09PXdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFIDUuMFwiKSkpe3ZhciBjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7Yy5zZXRBdHRyaWJ1dGUoXCJpZFwiLGEpLGMuc2V0QXR0cmlidXRlKFwiYXJpYS1oaWRkZW5cIixcInRydWVcIiksYy5zdHlsZS52aXNpYmlsaXR5PVwiaGlkZGVuXCIsYy5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCIsYy5zdHlsZS53aWR0aD1jLnN0eWxlLmhlaWdodD1jLmJvcmRlcldpZHRoPVwiMHB4XCIsYj1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF0uYXBwZW5kQ2hpbGQoYyl9ZWxzZSBkb2N1bWVudC5ib2R5JiZkb2N1bWVudC5ib2R5Lmluc2VydEFkamFjZW50SFRNTCYmZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmVFbmRcIiwnPGlmcmFtZSBuYW1lPVwiJythKydcIiBpZD1cIicrYSsnXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmVcIj48L2lmcmFtZT4nKTt3aW5kb3cuZnJhbWVzJiZ3aW5kb3cuZnJhbWVzW2FdJiYoYj13aW5kb3cuZnJhbWVzW2FdKX1yZXR1cm4gYn19LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX3NhdmVJdGVtPWZ1bmN0aW9uKGEsYixjKXtpZih0aGlzLmNvbmZpZyYmdGhpcy5jb25maWcuY2FjaGVMb2NhdGlvbiYmXCJsb2NhbFN0b3JhZ2VcIj09PXRoaXMuY29uZmlnLmNhY2hlTG9jYXRpb24pe2lmKCF0aGlzLl9zdXBwb3J0c0xvY2FsU3RvcmFnZSgpKXJldHVybiB0aGlzLmluZm8oXCJMb2NhbCBzdG9yYWdlIGlzIG5vdCBzdXBwb3J0ZWRcIiksITE7aWYoYyl7dmFyIGQ9dGhpcy5fZ2V0SXRlbShhKXx8XCJcIjtsb2NhbFN0b3JhZ2Uuc2V0SXRlbShhLGQrYit0aGlzLkNPTlNUQU5UUy5DQUNIRV9ERUxJTUVURVIpfWVsc2UgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYSxiKTtyZXR1cm4hMH1yZXR1cm4gdGhpcy5fc3VwcG9ydHNTZXNzaW9uU3RvcmFnZSgpPyhzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGEsYiksITApOih0aGlzLmluZm8oXCJTZXNzaW9uIHN0b3JhZ2UgaXMgbm90IHN1cHBvcnRlZFwiKSwhMSl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2dldEl0ZW09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuY29uZmlnJiZ0aGlzLmNvbmZpZy5jYWNoZUxvY2F0aW9uJiZcImxvY2FsU3RvcmFnZVwiPT09dGhpcy5jb25maWcuY2FjaGVMb2NhdGlvbj90aGlzLl9zdXBwb3J0c0xvY2FsU3RvcmFnZSgpP2xvY2FsU3RvcmFnZS5nZXRJdGVtKGEpOih0aGlzLmluZm8oXCJMb2NhbCBzdG9yYWdlIGlzIG5vdCBzdXBwb3J0ZWRcIiksbnVsbCk6dGhpcy5fc3VwcG9ydHNTZXNzaW9uU3RvcmFnZSgpP3Nlc3Npb25TdG9yYWdlLmdldEl0ZW0oYSk6KHRoaXMuaW5mbyhcIlNlc3Npb24gc3RvcmFnZSBpcyBub3Qgc3VwcG9ydGVkXCIpLG51bGwpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9zdXBwb3J0c0xvY2FsU3RvcmFnZT1mdW5jdGlvbigpe3RyeXtyZXR1cm4hIXdpbmRvdy5sb2NhbFN0b3JhZ2UmJih3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJzdG9yYWdlVGVzdFwiLFwiQVwiKSxcIkFcIj09d2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic3RvcmFnZVRlc3RcIikmJih3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJzdG9yYWdlVGVzdFwiKSwhd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic3RvcmFnZVRlc3RcIikpKX1jYXRjaChhKXtyZXR1cm4hMX19LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX3N1cHBvcnRzU2Vzc2lvblN0b3JhZ2U9ZnVuY3Rpb24oKXt0cnl7cmV0dXJuISF3aW5kb3cuc2Vzc2lvblN0b3JhZ2UmJih3aW5kb3cuc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInN0b3JhZ2VUZXN0XCIsXCJBXCIpLFwiQVwiPT13aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInN0b3JhZ2VUZXN0XCIpJiYod2luZG93LnNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oXCJzdG9yYWdlVGVzdFwiKSwhd2luZG93LnNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJzdG9yYWdlVGVzdFwiKSkpfWNhdGNoKGEpe3JldHVybiExfX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5fY2xvbmVDb25maWc9ZnVuY3Rpb24oYSl7aWYobnVsbD09PWF8fFwib2JqZWN0XCIhPXR5cGVvZiBhKXJldHVybiBhO3ZhciBiPXt9O2Zvcih2YXIgYyBpbiBhKWEuaGFzT3duUHJvcGVydHkoYykmJihiW2NdPWFbY10pO3JldHVybiBifSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLl9hZGRMaWJNZXRhZGF0YT1mdW5jdGlvbigpe3JldHVyblwiJngtY2xpZW50LVNLVT1KcyZ4LWNsaWVudC1WZXI9XCIrdGhpcy5fbGliVmVyc2lvbigpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmxvZz1mdW5jdGlvbihhLGIsYyxkKXtpZihhPD1Mb2dnaW5nLmxldmVsKXtpZighTG9nZ2luZy5waWlMb2dnaW5nRW5hYmxlZCYmZClyZXR1cm47dmFyIGU9KG5ldyBEYXRlKS50b1VUQ1N0cmluZygpLGY9XCJcIjtmPXRoaXMuY29uZmlnLmNvcnJlbGF0aW9uSWQ/ZStcIjpcIit0aGlzLmNvbmZpZy5jb3JyZWxhdGlvbklkK1wiLVwiK3RoaXMuX2xpYlZlcnNpb24oKStcIi1cIit0aGlzLkNPTlNUQU5UUy5MRVZFTF9TVFJJTkdfTUFQW2FdK1wiIFwiK2I6ZStcIjpcIit0aGlzLl9saWJWZXJzaW9uKCkrXCItXCIrdGhpcy5DT05TVEFOVFMuTEVWRUxfU1RSSU5HX01BUFthXStcIiBcIitiLGMmJihmKz1cIlxcbnN0YWNrOlxcblwiK2Muc3RhY2spLExvZ2dpbmcubG9nKGYpfX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5lcnJvcj1mdW5jdGlvbihhLGIpe3RoaXMubG9nKHRoaXMuQ09OU1RBTlRTLkxPR0dJTkdfTEVWRUwuRVJST1IsYSxiKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS53YXJuPWZ1bmN0aW9uKGEpe3RoaXMubG9nKHRoaXMuQ09OU1RBTlRTLkxPR0dJTkdfTEVWRUwuV0FSTixhLG51bGwpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLmluZm89ZnVuY3Rpb24oYSl7XHJcbnRoaXMubG9nKHRoaXMuQ09OU1RBTlRTLkxPR0dJTkdfTEVWRUwuSU5GTyxhLG51bGwpfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLnZlcmJvc2U9ZnVuY3Rpb24oYSl7dGhpcy5sb2codGhpcy5DT05TVEFOVFMuTE9HR0lOR19MRVZFTC5WRVJCT1NFLGEsbnVsbCl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuZXJyb3JQaWk9ZnVuY3Rpb24oYSxiKXt0aGlzLmxvZyh0aGlzLkNPTlNUQU5UUy5MT0dHSU5HX0xFVkVMLkVSUk9SLGEsYiwhMCl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUud2FyblBpaT1mdW5jdGlvbihhKXt0aGlzLmxvZyh0aGlzLkNPTlNUQU5UUy5MT0dHSU5HX0xFVkVMLldBUk4sYSxudWxsLCEwKX0sQXV0aGVudGljYXRpb25Db250ZXh0LnByb3RvdHlwZS5pbmZvUGlpPWZ1bmN0aW9uKGEpe3RoaXMubG9nKHRoaXMuQ09OU1RBTlRTLkxPR0dJTkdfTEVWRUwuSU5GTyxhLG51bGwsITApfSxBdXRoZW50aWNhdGlvbkNvbnRleHQucHJvdG90eXBlLnZlcmJvc2VQaWk9ZnVuY3Rpb24oYSl7dGhpcy5sb2codGhpcy5DT05TVEFOVFMuTE9HR0lOR19MRVZFTC5WRVJCT1NFLGEsbnVsbCwhMCl9LEF1dGhlbnRpY2F0aW9uQ29udGV4dC5wcm90b3R5cGUuX2xpYlZlcnNpb249ZnVuY3Rpb24oKXtyZXR1cm5cIjEuMC4xN1wifSxcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cyYmKG1vZHVsZS5leHBvcnRzPUF1dGhlbnRpY2F0aW9uQ29udGV4dCxtb2R1bGUuZXhwb3J0cy5pbmplY3Q9ZnVuY3Rpb24oYSl7cmV0dXJuIG5ldyBBdXRoZW50aWNhdGlvbkNvbnRleHQoYSl9KSxBdXRoZW50aWNhdGlvbkNvbnRleHR9KCk7IiwiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcclxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcclxuTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcclxuS0lORCwgRUlUSEVSIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIFdJVEhPVVQgTElNSVRBVElPTiBBTlkgSU1QTElFRFxyXG5XQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgVElUTEUsIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLFxyXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxyXG5cclxuU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXHJcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIGlmIChlLmluZGV4T2YocFtpXSkgPCAwKVxyXG4gICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIGV4cG9ydHMpIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKCFleHBvcnRzLmhhc093blByb3BlcnR5KHApKSBleHBvcnRzW3BdID0gbVtwXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcclxuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XHJcbiAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgcmVzdWx0W2tdID0gbW9kW2tdO1xyXG4gICAgcmVzdWx0LmRlZmF1bHQgPSBtb2Q7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG4iLCJpbXBvcnQgeyBTUFV0aWwgfSBmcm9tIFwiLi9zcHV0aWxcIjtcclxuXHJcbig8YW55PndpbmRvdykuc3BVdGlsID0gbmV3IFNQVXRpbCgpO1xyXG4iLCJpbXBvcnQgeyBzcCB9IGZyb20gXCJAcG5wL3NwXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU1BVdGlsIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiSW5pdGlhbGl6aW5nIFNQVXRpbFwiKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBzZXRSZXN1bHQodmFsOiBhbnkpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud29ya2JlbmNoXCIpLmlubmVySFRNTCA9IHZhbDtcclxuICB9XHJcblxyXG4gIHJlc3VsdDogSFRNTEVsZW1lbnQ7XHJcblxyXG4gIGdldFdlYlRpdGxlKCk6IHZvaWQge1xyXG4gICAgc3Aud2ViXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuZ2V0KClcclxuICAgICAgLnRoZW4odyA9PiB7XHJcbiAgICAgICAgU1BVdGlsLnNldFJlc3VsdCh3LlRpdGxlKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRMaXN0Rm9yV2ViKCkge1xyXG4gICAgc3Aud2ViLmxpc3RzXHJcbiAgICAgIC5zZWxlY3QoXCJJZFwiLCBcIlRpdGxlXCIpXHJcbiAgICAgIC5vcmRlckJ5KFwiVGl0bGVcIilcclxuICAgICAgLmdldCgpXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uKGxpc3RJZHMpIHtcclxuICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBsaXN0SWRzKSB7XHJcbiAgICAgICAgICB2YXIgbCA9IHNwLndlYi5saXN0cy5nZXRCeUlkKGxpc3RJZHNbaW5kZXhdLklkKTtcclxuICAgICAgICAgIGwuZ2V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBsaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhrZXkgKyBcIjogXCIgKyBsaXN0W2tleV0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRMaXN0SXRlbXMoKSB7XHJcbiAgICBsZXQgbGlzdCA9IHNwLndlYi5saXN0cy5nZXRCeVRpdGxlKFwiTmV3c1wiKTtcclxuXHJcbiAgICBsaXN0Lml0ZW1zXHJcbiAgICAgIC5nZXQoKVxyXG4gICAgICAudGhlbihmdW5jdGlvbihpdGVtcykge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGZvciAodmFyIGtleSBpbiBpdGVtc1tpXSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhrZXkgKyBcIjogXCIgKyBpdGVtc1tpXVtrZXldKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGRMaXN0SXRlbSgpIHtcclxuICAgIGxldCBsaXN0ID0gc3Aud2ViLmxpc3RzLmdldEJ5VGl0bGUoXCJOZXdzXCIpO1xyXG5cclxuICAgIGxpc3QuaXRlbXNcclxuICAgICAgLmFkZCh7XHJcbiAgICAgICAgVGl0bGU6IFwiVGl0bGVcIixcclxuICAgICAgICBCb2R5OiBcIkJvZHkgZm9yIFBuUCBDb3JlIEpTIExpc3QgSXRlbVwiXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKGlhciA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coaWFyKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVMaXN0SXRlbSgpIHtcclxuICAgIGxldCBsaXN0ID0gc3Aud2ViLmxpc3RzLmdldEJ5VGl0bGUoXCJOZXdzXCIpO1xyXG5cclxuICAgIGxpc3QuaXRlbXNcclxuICAgICAgLmdldEJ5SWQoMSlcclxuICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgVGl0bGU6IFwiTXkgTmV3IFRpdGxlXCIsXHJcbiAgICAgICAgQm9keTogXCJIZXJlIGlzIGEgbmV3IGJvZHlcIlxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhpKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVMaXN0SXRlbSgpIHtcclxuICAgIGxldCBsaXN0ID0gc3Aud2ViLmxpc3RzLmdldEJ5VGl0bGUoXCJOZXdzXCIpO1xyXG5cclxuICAgIGxpc3QuaXRlbXNcclxuICAgICAgLmdldEJ5SWQoMSlcclxuICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgIC50aGVuKCgpID0+IGNvbnNvbGUubG9nKFwiaXRlbSBkZWxldGVkXCIpKTtcclxuICB9XHJcbn1cclxuIiwidmFyIGc7XG5cbi8vIFRoaXMgd29ya3MgaW4gbm9uLXN0cmljdCBtb2RlXG5nID0gKGZ1bmN0aW9uKCkge1xuXHRyZXR1cm4gdGhpcztcbn0pKCk7XG5cbnRyeSB7XG5cdC8vIFRoaXMgd29ya3MgaWYgZXZhbCBpcyBhbGxvd2VkIChzZWUgQ1NQKVxuXHRnID0gZyB8fCBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCkgfHwgKDEsIGV2YWwpKFwidGhpc1wiKTtcbn0gY2F0Y2ggKGUpIHtcblx0Ly8gVGhpcyB3b3JrcyBpZiB0aGUgd2luZG93IHJlZmVyZW5jZSBpcyBhdmFpbGFibGVcblx0aWYgKHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIpIGcgPSB3aW5kb3c7XG59XG5cbi8vIGcgY2FuIHN0aWxsIGJlIHVuZGVmaW5lZCwgYnV0IG5vdGhpbmcgdG8gZG8gYWJvdXQgaXQuLi5cbi8vIFdlIHJldHVybiB1bmRlZmluZWQsIGluc3RlYWQgb2Ygbm90aGluZyBoZXJlLCBzbyBpdCdzXG4vLyBlYXNpZXIgdG8gaGFuZGxlIHRoaXMgY2FzZS4gaWYoIWdsb2JhbCkgeyAuLi59XG5cbm1vZHVsZS5leHBvcnRzID0gZztcbiJdLCJzb3VyY2VSb290IjoiIn0=